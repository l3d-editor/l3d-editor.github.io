var iT=Object.defineProperty;var sT=(n,e,t)=>e in n?iT(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var P=(n,e,t)=>(sT(n,typeof e!="symbol"?e+"":e,t),t);const aT=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}};aT();var os=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function oT(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function lT(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function Vd(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var I={exports:{}},wt={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Nx=Object.getOwnPropertySymbols,cT=Object.prototype.hasOwnProperty,uT=Object.prototype.propertyIsEnumerable;function dT(n){if(n==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function hT(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de",Object.getOwnPropertyNames(n)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var r=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(s){i[s]=s}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var tS=hT()?Object.assign:function(n,e){for(var t,r=dT(n),i,s=1;s<arguments.length;s++){t=Object(arguments[s]);for(var a in t)cT.call(t,a)&&(r[a]=t[a]);if(Nx){i=Nx(t);for(var o=0;o<i.length;o++)uT.call(t,i[o])&&(r[i[o]]=t[i[o]])}}return r};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T0=tS,Zl=60103,nS=60106;wt.Fragment=60107;wt.StrictMode=60108;wt.Profiler=60114;var rS=60109,iS=60110,sS=60112;wt.Suspense=60113;var aS=60115,oS=60116;if(typeof Symbol=="function"&&Symbol.for){var ai=Symbol.for;Zl=ai("react.element"),nS=ai("react.portal"),wt.Fragment=ai("react.fragment"),wt.StrictMode=ai("react.strict_mode"),wt.Profiler=ai("react.profiler"),rS=ai("react.provider"),iS=ai("react.context"),sS=ai("react.forward_ref"),wt.Suspense=ai("react.suspense"),aS=ai("react.memo"),oS=ai("react.lazy")}var kx=typeof Symbol=="function"&&Symbol.iterator;function fT(n){return n===null||typeof n!="object"?null:(n=kx&&n[kx]||n["@@iterator"],typeof n=="function"?n:null)}function vd(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lS={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},cS={};function ql(n,e,t){this.props=n,this.context=e,this.refs=cS,this.updater=t||lS}ql.prototype.isReactComponent={};ql.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error(vd(85));this.updater.enqueueSetState(this,n,e,"setState")};ql.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function uS(){}uS.prototype=ql.prototype;function C0(n,e,t){this.props=n,this.context=e,this.refs=cS,this.updater=t||lS}var P0=C0.prototype=new uS;P0.constructor=C0;T0(P0,ql.prototype);P0.isPureReactComponent=!0;var I0={current:null},dS=Object.prototype.hasOwnProperty,hS={key:!0,ref:!0,__self:!0,__source:!0};function fS(n,e,t){var r,i={},s=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)dS.call(e,r)&&!hS.hasOwnProperty(r)&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=t;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in o=n.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return{$$typeof:Zl,type:n,key:s,ref:a,props:i,_owner:I0.current}}function pT(n,e){return{$$typeof:Zl,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function L0(n){return typeof n=="object"&&n!==null&&n.$$typeof===Zl}function mT(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Ox=/\/+/g;function xm(n,e){return typeof n=="object"&&n!==null&&n.key!=null?mT(""+n.key):e.toString(36)}function qh(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Zl:case nS:a=!0}}if(a)return a=n,i=i(a),n=r===""?"."+xm(a,0):r,Array.isArray(i)?(t="",n!=null&&(t=n.replace(Ox,"$&/")+"/"),qh(i,e,t,"",function(c){return c})):i!=null&&(L0(i)&&(i=pT(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(Ox,"$&/")+"/")+n)),e.push(i)),1;if(a=0,r=r===""?".":r+":",Array.isArray(n))for(var o=0;o<n.length;o++){s=n[o];var l=r+xm(s,o);a+=qh(s,e,t,l,i)}else if(l=fT(n),typeof l=="function")for(n=l.call(n),o=0;!(s=n.next()).done;)s=s.value,l=r+xm(s,o++),a+=qh(s,e,t,l,i);else if(s==="object")throw e=""+n,Error(vd(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e));return a}function jd(n,e,t){if(n==null)return n;var r=[],i=0;return qh(n,r,"","",function(s){return e.call(t,s,i++)}),r}function gT(n){if(n._status===-1){var e=n._result;e=e(),n._status=0,n._result=e,e.then(function(t){n._status===0&&(t=t.default,n._status=1,n._result=t)},function(t){n._status===0&&(n._status=2,n._result=t)})}if(n._status===1)return n._result;throw n._result}var pS={current:null};function xs(){var n=pS.current;if(n===null)throw Error(vd(321));return n}var vT={ReactCurrentDispatcher:pS,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:I0,IsSomeRendererActing:{current:!1},assign:T0};wt.Children={map:jd,forEach:function(n,e,t){jd(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return jd(n,function(){e++}),e},toArray:function(n){return jd(n,function(e){return e})||[]},only:function(n){if(!L0(n))throw Error(vd(143));return n}};wt.Component=ql;wt.PureComponent=C0;wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vT;wt.cloneElement=function(n,e,t){if(n==null)throw Error(vd(267,n));var r=T0({},n.props),i=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=I0.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)dS.call(e,l)&&!hS.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];r.children=o}return{$$typeof:Zl,type:n.type,key:i,ref:s,props:r,_owner:a}};wt.createContext=function(n,e){return e===void 0&&(e=null),n={$$typeof:iS,_calculateChangedBits:e,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null},n.Provider={$$typeof:rS,_context:n},n.Consumer=n};wt.createElement=fS;wt.createFactory=function(n){var e=fS.bind(null,n);return e.type=n,e};wt.createRef=function(){return{current:null}};wt.forwardRef=function(n){return{$$typeof:sS,render:n}};wt.isValidElement=L0;wt.lazy=function(n){return{$$typeof:oS,_payload:{_status:-1,_result:n},_init:gT}};wt.memo=function(n,e){return{$$typeof:aS,type:n,compare:e===void 0?null:e}};wt.useCallback=function(n,e){return xs().useCallback(n,e)};wt.useContext=function(n,e){return xs().useContext(n,e)};wt.useDebugValue=function(){};wt.useEffect=function(n,e){return xs().useEffect(n,e)};wt.useImperativeHandle=function(n,e,t){return xs().useImperativeHandle(n,e,t)};wt.useLayoutEffect=function(n,e){return xs().useLayoutEffect(n,e)};wt.useMemo=function(n,e){return xs().useMemo(n,e)};wt.useReducer=function(n,e,t){return xs().useReducer(n,e,t)};wt.useRef=function(n){return xs().useRef(n)};wt.useState=function(n){return xs().useState(n)};wt.version="17.0.2";I.exports=wt;var Zr=I.exports,aa={exports:{}},ri={},mS={exports:{}},gS={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){var e,t,r,i;if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var l=null,c=null,u=function(){if(l!==null)try{var k=n.unstable_now();l(!0,k),l=null}catch(V){throw setTimeout(u,0),V}};e=function(k){l!==null?setTimeout(e,0,k):(l=k,setTimeout(u,0))},t=function(k,V){c=setTimeout(k,V)},r=function(){clearTimeout(c)},n.unstable_shouldYield=function(){return!1},i=n.unstable_forceFrameRate=function(){}}else{var h=window.setTimeout,d=window.clearTimeout;if(typeof console!="undefined"){var f=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof f!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var v=!1,g=null,y=-1,p=5,m=0;n.unstable_shouldYield=function(){return n.unstable_now()>=m},i=function(){},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):p=0<k?Math.floor(1e3/k):5};var x=new MessageChannel,w=x.port2;x.port1.onmessage=function(){if(g!==null){var k=n.unstable_now();m=k+p;try{g(!0,k)?w.postMessage(null):(v=!1,g=null)}catch(V){throw w.postMessage(null),V}}else v=!1},e=function(k){g=k,v||(v=!0,w.postMessage(null))},t=function(k,V){y=h(function(){k(n.unstable_now())},V)},r=function(){d(y),y=-1}}function b(k,V){var $=k.length;k.push(V);e:for(;;){var Q=$-1>>>1,ie=k[Q];if(ie!==void 0&&0<F(ie,V))k[Q]=V,k[$]=ie,$=Q;else break e}}function C(k){return k=k[0],k===void 0?null:k}function A(k){var V=k[0];if(V!==void 0){var $=k.pop();if($!==V){k[0]=$;e:for(var Q=0,ie=k.length;Q<ie;){var ne=2*(Q+1)-1,Se=k[ne],_e=ne+1,we=k[_e];if(Se!==void 0&&0>F(Se,$))we!==void 0&&0>F(we,Se)?(k[Q]=we,k[_e]=$,Q=_e):(k[Q]=Se,k[ne]=$,Q=ne);else if(we!==void 0&&0>F(we,$))k[Q]=we,k[_e]=$,Q=_e;else break e}}return V}return null}function F(k,V){var $=k.sortIndex-V.sortIndex;return $!==0?$:k.id-V.id}var N=[],O=[],H=1,D=null,U=3,_=!1,z=!1,j=!1;function R(k){for(var V=C(O);V!==null;){if(V.callback===null)A(O);else if(V.startTime<=k)A(O),V.sortIndex=V.expirationTime,b(N,V);else break;V=C(O)}}function ee(k){if(j=!1,R(k),!z)if(C(N)!==null)z=!0,e(J);else{var V=C(O);V!==null&&t(ee,V.startTime-k)}}function J(k,V){z=!1,j&&(j=!1,r()),_=!0;var $=U;try{for(R(V),D=C(N);D!==null&&(!(D.expirationTime>V)||k&&!n.unstable_shouldYield());){var Q=D.callback;if(typeof Q=="function"){D.callback=null,U=D.priorityLevel;var ie=Q(D.expirationTime<=V);V=n.unstable_now(),typeof ie=="function"?D.callback=ie:D===C(N)&&A(N),R(V)}else A(N);D=C(N)}if(D!==null)var ne=!0;else{var Se=C(O);Se!==null&&t(ee,Se.startTime-V),ne=!1}return ne}finally{D=null,U=$,_=!1}}var le=i;n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_continueExecution=function(){z||_||(z=!0,e(J))},n.unstable_getCurrentPriorityLevel=function(){return U},n.unstable_getFirstCallbackNode=function(){return C(N)},n.unstable_next=function(k){switch(U){case 1:case 2:case 3:var V=3;break;default:V=U}var $=U;U=V;try{return k()}finally{U=$}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=le,n.unstable_runWithPriority=function(k,V){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var $=U;U=k;try{return V()}finally{U=$}},n.unstable_scheduleCallback=function(k,V,$){var Q=n.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?Q+$:Q):$=Q,k){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=$+ie,k={id:H++,callback:V,priorityLevel:k,startTime:$,expirationTime:ie,sortIndex:-1},$>Q?(k.sortIndex=$,b(O,k),C(N)===null&&k===C(O)&&(j?r():j=!0,t(ee,$-Q))):(k.sortIndex=ie,b(N,k),z||_||(z=!0,e(J))),k},n.unstable_wrapCallback=function(k){var V=U;return function(){var $=U;U=V;try{return k.apply(this,arguments)}finally{U=$}}}})(gS);mS.exports=gS;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gp=I.exports,jt=tS,Sn=mS.exports;function Ee(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!gp)throw Error(Ee(227));var vS=new Set,Du={};function lo(n,e){Dl(n,e),Dl(n+"Capture",e)}function Dl(n,e){for(Du[n]=e,n=0;n<e.length;n++)vS.add(e[n])}var gs=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),yT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,zx=Object.prototype.hasOwnProperty,Ux={},Bx={};function xT(n){return zx.call(Bx,n)?!0:zx.call(Ux,n)?!1:yT.test(n)?Bx[n]=!0:(Ux[n]=!0,!1)}function wT(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function _T(n,e,t,r){if(e===null||typeof e=="undefined"||wT(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function cr(n,e,t,r,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var Bn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Bn[n]=new cr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Bn[e]=new cr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Bn[n]=new cr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Bn[n]=new cr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Bn[n]=new cr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Bn[n]=new cr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Bn[n]=new cr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Bn[n]=new cr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Bn[n]=new cr(n,5,!1,n.toLowerCase(),null,!1,!1)});var R0=/[\-:]([a-z])/g;function F0(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(R0,F0);Bn[e]=new cr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(R0,F0);Bn[e]=new cr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(R0,F0);Bn[e]=new cr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Bn[n]=new cr(n,1,!1,n.toLowerCase(),null,!1,!1)});Bn.xlinkHref=new cr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Bn[n]=new cr(n,1,!1,n.toLowerCase(),null,!0,!0)});function D0(n,e,t,r){var i=Bn.hasOwnProperty(e)?Bn[e]:null,s=i!==null?i.type===0:r?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");s||(_T(e,t,i,r)&&(t=null),r||i===null?xT(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var co=gp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Zc=60103,Ba=60106,ks=60107,N0=60108,ou=60114,k0=60109,O0=60110,vp=60112,lu=60113,vf=60120,yp=60115,z0=60116,U0=60121,B0=60128,yS=60129,H0=60130,sv=60131;if(typeof Symbol=="function"&&Symbol.for){var pn=Symbol.for;Zc=pn("react.element"),Ba=pn("react.portal"),ks=pn("react.fragment"),N0=pn("react.strict_mode"),ou=pn("react.profiler"),k0=pn("react.provider"),O0=pn("react.context"),vp=pn("react.forward_ref"),lu=pn("react.suspense"),vf=pn("react.suspense_list"),yp=pn("react.memo"),z0=pn("react.lazy"),U0=pn("react.block"),pn("react.scope"),B0=pn("react.opaque.id"),yS=pn("react.debug_trace_mode"),H0=pn("react.offscreen"),sv=pn("react.legacy_hidden")}var Hx=typeof Symbol=="function"&&Symbol.iterator;function _c(n){return n===null||typeof n!="object"?null:(n=Hx&&n[Hx]||n["@@iterator"],typeof n=="function"?n:null)}var wm;function qc(n){if(wm===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);wm=e&&e[1]||""}return`
`+wm+n}var _m=!1;function Wd(n,e){if(!n||_m)return"";_m=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(n,[],e)}else{try{e.call()}catch(l){r=l}n.call(e.prototype)}else{try{throw Error()}catch(l){r=l}n()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=r.stack.split(`
`),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||i[a]!==s[o])return`
`+i[a].replace(" at new "," at ");while(1<=a&&0<=o);break}}}finally{_m=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?qc(n):""}function bT(n){switch(n.tag){case 5:return qc(n.type);case 16:return qc("Lazy");case 13:return qc("Suspense");case 19:return qc("SuspenseList");case 0:case 2:case 15:return n=Wd(n.type,!1),n;case 11:return n=Wd(n.type.render,!1),n;case 22:return n=Wd(n.type._render,!1),n;case 1:return n=Wd(n.type,!0),n;default:return""}}function fl(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case ks:return"Fragment";case Ba:return"Portal";case ou:return"Profiler";case N0:return"StrictMode";case lu:return"Suspense";case vf:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case O0:return(n.displayName||"Context")+".Consumer";case k0:return(n._context.displayName||"Context")+".Provider";case vp:var e=n.render;return e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case yp:return fl(n.type);case U0:return fl(n._render);case z0:e=n._payload,n=n._init;try{return fl(n(e))}catch{}}return null}function oa(n){switch(typeof n){case"boolean":case"number":case"object":case"string":case"undefined":return n;default:return""}}function xS(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function ST(n){var e=xS(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t!="undefined"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Xd(n){n._valueTracker||(n._valueTracker=ST(n))}function wS(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=xS(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function yf(n){if(n=n||(typeof document!="undefined"?document:void 0),typeof n=="undefined")return null;try{return n.activeElement||n.body}catch{return n.body}}function av(n,e){var t=e.checked;return jt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t!=null?t:n._wrapperState.initialChecked})}function Gx(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=oa(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function _S(n,e){e=e.checked,e!=null&&D0(n,"checked",e,!1)}function ov(n,e){_S(n,e);var t=oa(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?lv(n,e.type,t):e.hasOwnProperty("defaultValue")&&lv(n,e.type,oa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Vx(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function lv(n,e,t){(e!=="number"||yf(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}function MT(n){var e="";return gp.Children.forEach(n,function(t){t!=null&&(e+=t)}),e}function cv(n,e){return n=jt({children:void 0},e),(e=MT(e.children))&&(n.children=e),n}function pl(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+oa(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function uv(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ee(91));return jt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function jx(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Ee(92));if(Array.isArray(t)){if(!(1>=t.length))throw Error(Ee(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:oa(t)}}function bS(n,e){var t=oa(e.value),r=oa(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function Wx(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}var dv={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function SS(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function hv(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?SS(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Yd,MS=function(n){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!==dv.svg||"innerHTML"in n)n.innerHTML=e;else{for(Yd=Yd||document.createElement("div"),Yd.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Yd.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Nu(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var cu={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ET=["Webkit","ms","Moz","O"];Object.keys(cu).forEach(function(n){ET.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),cu[e]=cu[n]})});function ES(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||cu.hasOwnProperty(n)&&cu[n]?(""+e).trim():e+"px"}function AS(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=ES(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var AT=jt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fv(n,e){if(e){if(AT[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ee(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ee(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(Ee(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ee(62))}}function pv(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function G0(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var mv=null,ml=null,gl=null;function Xx(n){if(n=xd(n)){if(typeof mv!="function")throw Error(Ee(280));var e=n.stateNode;e&&(e=Mp(e),mv(n.stateNode,n.type,e))}}function TS(n){ml?gl?gl.push(n):gl=[n]:ml=n}function CS(){if(ml){var n=ml,e=gl;if(gl=ml=null,Xx(n),e)for(n=0;n<e.length;n++)Xx(e[n])}}function V0(n,e){return n(e)}function PS(n,e,t,r,i){return n(e,t,r,i)}function j0(){}var IS=V0,Ha=!1,bm=!1;function W0(){(ml!==null||gl!==null)&&(j0(),CS())}function TT(n,e,t){if(bm)return n(e,t);bm=!0;try{return IS(n,e,t)}finally{bm=!1,W0()}}function ku(n,e){var t=n.stateNode;if(t===null)return null;var r=Mp(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Ee(231,e,typeof t));return t}var gv=!1;if(gs)try{var bc={};Object.defineProperty(bc,"passive",{get:function(){gv=!0}}),window.addEventListener("test",bc,bc),window.removeEventListener("test",bc,bc)}catch{gv=!1}function CT(n,e,t,r,i,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var uu=!1,xf=null,wf=!1,vv=null,PT={onError:function(n){uu=!0,xf=n}};function IT(n,e,t,r,i,s,a,o,l){uu=!1,xf=null,CT.apply(PT,arguments)}function LT(n,e,t,r,i,s,a,o,l){if(IT.apply(this,arguments),uu){if(uu){var c=xf;uu=!1,xf=null}else throw Error(Ee(198));wf||(wf=!0,vv=c)}}function uo(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,(e.flags&1026)!==0&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function LS(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Yx(n){if(uo(n)!==n)throw Error(Ee(188))}function RT(n){var e=n.alternate;if(!e){if(e=uo(n),e===null)throw Error(Ee(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return Yx(i),n;if(s===r)return Yx(i),e;s=s.sibling}throw Error(Ee(188))}if(t.return!==r.return)t=i,r=s;else{for(var a=!1,o=i.child;o;){if(o===t){a=!0,t=i,r=s;break}if(o===r){a=!0,r=i,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,r=i;break}if(o===r){a=!0,r=s,t=i;break}o=o.sibling}if(!a)throw Error(Ee(189))}}if(t.alternate!==r)throw Error(Ee(190))}if(t.tag!==3)throw Error(Ee(188));return t.stateNode.current===t?n:e}function RS(n){if(n=RT(n),!n)return null;for(var e=n;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===n)break;for(;!e.sibling;){if(!e.return||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function $x(n,e){for(var t=n.alternate;e!==null;){if(e===n||e===t)return!0;e=e.return}return!1}var FS,X0,DS,NS,yv=!1,Hi=[],Ys=null,$s=null,Zs=null,Ou=new Map,zu=new Map,Sc=[],Zx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xv(n,e,t,r,i){return{blockedOn:n,domEventName:e,eventSystemFlags:t|16,nativeEvent:i,targetContainers:[r]}}function qx(n,e){switch(n){case"focusin":case"focusout":Ys=null;break;case"dragenter":case"dragleave":$s=null;break;case"mouseover":case"mouseout":Zs=null;break;case"pointerover":case"pointerout":Ou.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":zu.delete(e.pointerId)}}function Mc(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n=xv(e,t,r,i,s),e!==null&&(e=xd(e),e!==null&&X0(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function FT(n,e,t,r,i){switch(e){case"focusin":return Ys=Mc(Ys,n,e,t,r,i),!0;case"dragenter":return $s=Mc($s,n,e,t,r,i),!0;case"mouseover":return Zs=Mc(Zs,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return Ou.set(s,Mc(Ou.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,zu.set(s,Mc(zu.get(s)||null,n,e,t,r,i)),!0}return!1}function DT(n){var e=Ga(n.target);if(e!==null){var t=uo(e);if(t!==null){if(e=t.tag,e===13){if(e=LS(t),e!==null){n.blockedOn=e,NS(n.lanePriority,function(){Sn.unstable_runWithPriority(n.priority,function(){DS(t)})});return}}else if(e===3&&t.stateNode.hydrate){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Qh(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=q0(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t!==null)return e=xd(t),e!==null&&X0(e),n.blockedOn=t,!1;e.shift()}return!0}function Qx(n,e,t){Qh(n)&&t.delete(e)}function NT(){for(yv=!1;0<Hi.length;){var n=Hi[0];if(n.blockedOn!==null){n=xd(n.blockedOn),n!==null&&FS(n);break}for(var e=n.targetContainers;0<e.length;){var t=q0(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t!==null){n.blockedOn=t;break}e.shift()}n.blockedOn===null&&Hi.shift()}Ys!==null&&Qh(Ys)&&(Ys=null),$s!==null&&Qh($s)&&($s=null),Zs!==null&&Qh(Zs)&&(Zs=null),Ou.forEach(Qx),zu.forEach(Qx)}function Ec(n,e){n.blockedOn===e&&(n.blockedOn=null,yv||(yv=!0,Sn.unstable_scheduleCallback(Sn.unstable_NormalPriority,NT)))}function kS(n){function e(i){return Ec(i,n)}if(0<Hi.length){Ec(Hi[0],n);for(var t=1;t<Hi.length;t++){var r=Hi[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Ys!==null&&Ec(Ys,n),$s!==null&&Ec($s,n),Zs!==null&&Ec(Zs,n),Ou.forEach(e),zu.forEach(e),t=0;t<Sc.length;t++)r=Sc[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Sc.length&&(t=Sc[0],t.blockedOn===null);)DT(t),t.blockedOn===null&&Sc.shift()}function $d(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Jo={animationend:$d("Animation","AnimationEnd"),animationiteration:$d("Animation","AnimationIteration"),animationstart:$d("Animation","AnimationStart"),transitionend:$d("Transition","TransitionEnd")},Sm={},OS={};gs&&(OS=document.createElement("div").style,"AnimationEvent"in window||(delete Jo.animationend.animation,delete Jo.animationiteration.animation,delete Jo.animationstart.animation),"TransitionEvent"in window||delete Jo.transitionend.transition);function xp(n){if(Sm[n])return Sm[n];if(!Jo[n])return n;var e=Jo[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in OS)return Sm[n]=e[t];return n}var zS=xp("animationend"),US=xp("animationiteration"),BS=xp("animationstart"),HS=xp("transitionend"),GS=new Map,Y0=new Map,kT=["abort","abort",zS,"animationEnd",US,"animationIteration",BS,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",HS,"transitionEnd","waiting","waiting"];function $0(n,e){for(var t=0;t<n.length;t+=2){var r=n[t],i=n[t+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Y0.set(r,e),GS.set(r,i),lo(i,[r])}}var OT=Sn.unstable_now;OT();var Ft=8;function Zo(n){if((1&n)!==0)return Ft=15,1;if((2&n)!==0)return Ft=14,2;if((4&n)!==0)return Ft=13,4;var e=24&n;return e!==0?(Ft=12,e):(n&32)!==0?(Ft=11,32):(e=192&n,e!==0?(Ft=10,e):(n&256)!==0?(Ft=9,256):(e=3584&n,e!==0?(Ft=8,e):(n&4096)!==0?(Ft=7,4096):(e=4186112&n,e!==0?(Ft=6,e):(e=62914560&n,e!==0?(Ft=5,e):n&67108864?(Ft=4,67108864):(n&134217728)!==0?(Ft=3,134217728):(e=805306368&n,e!==0?(Ft=2,e):(1073741824&n)!==0?(Ft=1,1073741824):(Ft=8,n))))))}function zT(n){switch(n){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function UT(n){switch(n){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(Ee(358,n))}}function Uu(n,e){var t=n.pendingLanes;if(t===0)return Ft=0;var r=0,i=0,s=n.expiredLanes,a=n.suspendedLanes,o=n.pingedLanes;if(s!==0)r=s,i=Ft=15;else if(s=t&134217727,s!==0){var l=s&~a;l!==0?(r=Zo(l),i=Ft):(o&=s,o!==0&&(r=Zo(o),i=Ft))}else s=t&~a,s!==0?(r=Zo(s),i=Ft):o!==0&&(r=Zo(o),i=Ft);if(r===0)return 0;if(r=31-la(r),r=t&((0>r?0:1<<r)<<1)-1,e!==0&&e!==r&&(e&a)===0){if(Zo(e),i<=Ft)return e;Ft=i}if(e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-la(e),i=1<<t,r|=n[t],e&=~i;return r}function VS(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function _f(n,e){switch(n){case 15:return 1;case 14:return 2;case 12:return n=qo(24&~e),n===0?_f(10,e):n;case 10:return n=qo(192&~e),n===0?_f(8,e):n;case 8:return n=qo(3584&~e),n===0&&(n=qo(4186112&~e),n===0&&(n=512)),n;case 2:return e=qo(805306368&~e),e===0&&(e=268435456),e}throw Error(Ee(358,n))}function qo(n){return n&-n}function Mm(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function wp(n,e,t){n.pendingLanes|=e;var r=e-1;n.suspendedLanes&=r,n.pingedLanes&=r,n=n.eventTimes,e=31-la(e),n[e]=t}var la=Math.clz32?Math.clz32:GT,BT=Math.log,HT=Math.LN2;function GT(n){return n===0?32:31-(BT(n)/HT|0)|0}var VT=Sn.unstable_UserBlockingPriority,jT=Sn.unstable_runWithPriority,Jh=!0;function WT(n,e,t,r){Ha||j0();var i=Z0,s=Ha;Ha=!0;try{PS(i,n,e,t,r)}finally{(Ha=s)||W0()}}function XT(n,e,t,r){jT(VT,Z0.bind(null,n,e,t,r))}function Z0(n,e,t,r){if(Jh){var i;if((i=(e&4)===0)&&0<Hi.length&&-1<Zx.indexOf(n))n=xv(null,n,e,t,r),Hi.push(n);else{var s=q0(n,e,t,r);if(s===null)i&&qx(n,r);else{if(i){if(-1<Zx.indexOf(n)){n=xv(s,n,e,t,r),Hi.push(n);return}if(FT(s,n,e,t,r))return;qx(n,r)}nM(n,e,r,null,t)}}}}function q0(n,e,t,r){var i=G0(r);if(i=Ga(i),i!==null){var s=uo(i);if(s===null)i=null;else{var a=s.tag;if(a===13){if(i=LS(s),i!==null)return i;i=null}else if(a===3){if(s.stateNode.hydrate)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return nM(n,e,r,i,t),null}var Gs=null,Q0=null,Kh=null;function jS(){if(Kh)return Kh;var n,e=Q0,t=e.length,r,i="value"in Gs?Gs.value:Gs.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===i[s-r];r++);return Kh=i.slice(n,1<r?1-r:void 0)}function ef(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Zd(){return!0}function Jx(){return!1}function Nr(n){function e(t,r,i,s,a){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Zd:Jx,this.isPropagationStopped=Jx,this}return jt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Zd)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Zd)},persist:function(){},isPersistent:Zd}),e}var Ql={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},J0=Nr(Ql),yd=jt({},Ql,{view:0,detail:0}),YT=Nr(yd),Em,Am,Ac,_p=jt({},yd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:K0,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Ac&&(Ac&&n.type==="mousemove"?(Em=n.screenX-Ac.screenX,Am=n.screenY-Ac.screenY):Am=Em=0,Ac=n),Em)},movementY:function(n){return"movementY"in n?n.movementY:Am}}),Kx=Nr(_p),$T=jt({},_p,{dataTransfer:0}),ZT=Nr($T),qT=jt({},yd,{relatedTarget:0}),Tm=Nr(qT),QT=jt({},Ql,{animationName:0,elapsedTime:0,pseudoElement:0}),JT=Nr(QT),KT=jt({},Ql,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),eC=Nr(KT),tC=jt({},Ql,{data:0}),ew=Nr(tC),nC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},iC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sC(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=iC[n])?!!e[n]:!1}function K0(){return sC}var aC=jt({},yd,{key:function(n){if(n.key){var e=nC[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=ef(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?rC[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:K0,charCode:function(n){return n.type==="keypress"?ef(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ef(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),oC=Nr(aC),lC=jt({},_p,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tw=Nr(lC),cC=jt({},yd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:K0}),uC=Nr(cC),dC=jt({},Ql,{propertyName:0,elapsedTime:0,pseudoElement:0}),hC=Nr(dC),fC=jt({},_p,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),pC=Nr(fC),mC=[9,13,27,32],ey=gs&&"CompositionEvent"in window,du=null;gs&&"documentMode"in document&&(du=document.documentMode);var gC=gs&&"TextEvent"in window&&!du,WS=gs&&(!ey||du&&8<du&&11>=du),nw=String.fromCharCode(32),rw=!1;function XS(n,e){switch(n){case"keyup":return mC.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function YS(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ko=!1;function vC(n,e){switch(n){case"compositionend":return YS(e);case"keypress":return e.which!==32?null:(rw=!0,nw);case"textInput":return n=e.data,n===nw&&rw?null:n;default:return null}}function yC(n,e){if(Ko)return n==="compositionend"||!ey&&XS(n,e)?(n=jS(),Kh=Q0=Gs=null,Ko=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return WS&&e.locale!=="ko"?null:e.data;default:return null}}var xC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iw(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!xC[n.type]:e==="textarea"}function $S(n,e,t,r){TS(r),e=bf(e,"onChange"),0<e.length&&(t=new J0("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var hu=null,Bu=null;function wC(n){KS(n,0)}function bp(n){var e=tl(n);if(wS(e))return n}function _C(n,e){if(n==="change")return e}var ZS=!1;if(gs){var Cm;if(gs){var Pm="oninput"in document;if(!Pm){var sw=document.createElement("div");sw.setAttribute("oninput","return;"),Pm=typeof sw.oninput=="function"}Cm=Pm}else Cm=!1;ZS=Cm&&(!document.documentMode||9<document.documentMode)}function aw(){hu&&(hu.detachEvent("onpropertychange",qS),Bu=hu=null)}function qS(n){if(n.propertyName==="value"&&bp(Bu)){var e=[];if($S(e,Bu,n,G0(n)),n=wC,Ha)n(e);else{Ha=!0;try{V0(n,e)}finally{Ha=!1,W0()}}}}function bC(n,e,t){n==="focusin"?(aw(),hu=e,Bu=t,hu.attachEvent("onpropertychange",qS)):n==="focusout"&&aw()}function SC(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return bp(Bu)}function MC(n,e){if(n==="click")return bp(e)}function EC(n,e){if(n==="input"||n==="change")return bp(e)}function AC(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Yr=typeof Object.is=="function"?Object.is:AC,TC=Object.prototype.hasOwnProperty;function Hu(n,e){if(Yr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++)if(!TC.call(e,t[r])||!Yr(n[t[r]],e[t[r]]))return!1;return!0}function ow(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function lw(n,e){var t=ow(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=ow(t)}}function QS(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?QS(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function cw(){for(var n=window,e=yf();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=yf(n.document)}return e}function wv(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}var CC=gs&&"documentMode"in document&&11>=document.documentMode,el=null,_v=null,fu=null,bv=!1;function uw(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;bv||el==null||el!==yf(r)||(r=el,"selectionStart"in r&&wv(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),fu&&Hu(fu,r)||(fu=r,r=bf(_v,"onSelect"),0<r.length&&(e=new J0("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=el)))}$0("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);$0("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);$0(kT,2);for(var dw="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Im=0;Im<dw.length;Im++)Y0.set(dw[Im],0);Dl("onMouseEnter",["mouseout","mouseover"]);Dl("onMouseLeave",["mouseout","mouseover"]);Dl("onPointerEnter",["pointerout","pointerover"]);Dl("onPointerLeave",["pointerout","pointerover"]);lo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));lo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));lo("onBeforeInput",["compositionend","keypress","textInput","paste"]);lo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));lo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));lo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),JS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qc));function hw(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,LT(r,e,void 0,n),n.currentTarget=null}function KS(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&i.isPropagationStopped())break e;hw(i,o,c),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&i.isPropagationStopped())break e;hw(i,o,c),s=l}}}if(wf)throw n=vv,wf=!1,vv=null,n}function Ot(n,e){var t=iM(e),r=n+"__bubble";t.has(r)||(tM(e,n,2,!1),t.add(r))}var fw="_reactListening"+Math.random().toString(36).slice(2);function eM(n){n[fw]||(n[fw]=!0,vS.forEach(function(e){JS.has(e)||pw(e,!1,n,null),pw(e,!0,n,null)}))}function pw(n,e,t,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,s=t;if(n==="selectionchange"&&t.nodeType!==9&&(s=t.ownerDocument),r!==null&&!e&&JS.has(n)){if(n!=="scroll")return;i|=2,s=r}var a=iM(s),o=n+"__"+(e?"capture":"bubble");a.has(o)||(e&&(i|=4),tM(s,n,i,e),a.add(o))}function tM(n,e,t,r){var i=Y0.get(e);switch(i===void 0?2:i){case 0:i=WT;break;case 1:i=XT;break;default:i=Z0}t=i.bind(null,e,t,n),i=void 0,!gv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function nM(n,e,t,r,i){var s=r;if((e&1)===0&&(e&2)===0&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;a=a.return}for(;o!==null;){if(a=Ga(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}TT(function(){var c=s,u=G0(t),h=[];e:{var d=GS.get(n);if(d!==void 0){var f=J0,v=n;switch(n){case"keypress":if(ef(t)===0)break e;case"keydown":case"keyup":f=oC;break;case"focusin":v="focus",f=Tm;break;case"focusout":v="blur",f=Tm;break;case"beforeblur":case"afterblur":f=Tm;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Kx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=ZT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=uC;break;case zS:case US:case BS:f=JT;break;case HS:f=hC;break;case"scroll":f=YT;break;case"wheel":f=pC;break;case"copy":case"cut":case"paste":f=eC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=tw}var g=(e&4)!==0,y=!g&&n==="scroll",p=g?d!==null?d+"Capture":null:d;g=[];for(var m=c,x;m!==null;){x=m;var w=x.stateNode;if(x.tag===5&&w!==null&&(x=w,p!==null&&(w=ku(m,p),w!=null&&g.push(Gu(m,w,x)))),y)break;m=m.return}0<g.length&&(d=new f(d,v,null,t,u),h.push({event:d,listeners:g}))}}if((e&7)===0){e:{if(d=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",d&&(e&16)===0&&(v=t.relatedTarget||t.fromElement)&&(Ga(v)||v[Jl]))break e;if((f||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,f?(v=t.relatedTarget||t.toElement,f=c,v=v?Ga(v):null,v!==null&&(y=uo(v),v!==y||v.tag!==5&&v.tag!==6)&&(v=null)):(f=null,v=c),f!==v)){if(g=Kx,w="onMouseLeave",p="onMouseEnter",m="mouse",(n==="pointerout"||n==="pointerover")&&(g=tw,w="onPointerLeave",p="onPointerEnter",m="pointer"),y=f==null?d:tl(f),x=v==null?d:tl(v),d=new g(w,m+"leave",f,t,u),d.target=y,d.relatedTarget=x,w=null,Ga(u)===c&&(g=new g(p,m+"enter",v,t,u),g.target=x,g.relatedTarget=y,w=g),y=w,f&&v)t:{for(g=f,p=v,m=0,x=g;x;x=xo(x))m++;for(x=0,w=p;w;w=xo(w))x++;for(;0<m-x;)g=xo(g),m--;for(;0<x-m;)p=xo(p),x--;for(;m--;){if(g===p||p!==null&&g===p.alternate)break t;g=xo(g),p=xo(p)}g=null}else g=null;f!==null&&mw(h,d,f,g,!1),v!==null&&y!==null&&mw(h,y,v,g,!0)}}e:{if(d=c?tl(c):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var b=_C;else if(iw(d))if(ZS)b=EC;else{b=SC;var C=bC}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(b=MC);if(b&&(b=b(n,c))){$S(h,b,t,u);break e}C&&C(n,d,c),n==="focusout"&&(C=d._wrapperState)&&C.controlled&&d.type==="number"&&lv(d,"number",d.value)}switch(C=c?tl(c):window,n){case"focusin":(iw(C)||C.contentEditable==="true")&&(el=C,_v=c,fu=null);break;case"focusout":fu=_v=el=null;break;case"mousedown":bv=!0;break;case"contextmenu":case"mouseup":case"dragend":bv=!1,uw(h,t,u);break;case"selectionchange":if(CC)break;case"keydown":case"keyup":uw(h,t,u)}var A;if(ey)e:{switch(n){case"compositionstart":var F="onCompositionStart";break e;case"compositionend":F="onCompositionEnd";break e;case"compositionupdate":F="onCompositionUpdate";break e}F=void 0}else Ko?XS(n,t)&&(F="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(F="onCompositionStart");F&&(WS&&t.locale!=="ko"&&(Ko||F!=="onCompositionStart"?F==="onCompositionEnd"&&Ko&&(A=jS()):(Gs=u,Q0="value"in Gs?Gs.value:Gs.textContent,Ko=!0)),C=bf(c,F),0<C.length&&(F=new ew(F,n,null,t,u),h.push({event:F,listeners:C}),A?F.data=A:(A=YS(t),A!==null&&(F.data=A)))),(A=gC?vC(n,t):yC(n,t))&&(c=bf(c,"onBeforeInput"),0<c.length&&(u=new ew("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=A))}KS(h,e)})}function Gu(n,e,t){return{instance:n,listener:e,currentTarget:t}}function bf(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=ku(n,t),s!=null&&r.unshift(Gu(n,s,i)),s=ku(n,e),s!=null&&r.push(Gu(n,s,i))),n=n.return}return r}function xo(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function mw(n,e,t,r,i){for(var s=e._reactName,a=[];t!==null&&t!==r;){var o=t,l=o.alternate,c=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&c!==null&&(o=c,i?(l=ku(t,s),l!=null&&a.unshift(Gu(t,l,o))):i||(l=ku(t,s),l!=null&&a.push(Gu(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}function Sf(){}var Lm=null,Rm=null;function rM(n,e){switch(n){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function Sv(n,e){return n==="textarea"||n==="option"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var gw=typeof setTimeout=="function"?setTimeout:void 0,PC=typeof clearTimeout=="function"?clearTimeout:void 0;function ty(n){n.nodeType===1?n.textContent="":n.nodeType===9&&(n=n.body,n!=null&&(n.textContent=""))}function vl(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break}return n}function vw(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Fm=0;function IC(n){return{$$typeof:B0,toString:n,valueOf:n}}var Sp=Math.random().toString(36).slice(2),Vs="__reactFiber$"+Sp,Mf="__reactProps$"+Sp,Jl="__reactContainer$"+Sp,yw="__reactEvents$"+Sp;function Ga(n){var e=n[Vs];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Jl]||t[Vs]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=vw(n);n!==null;){if(t=n[Vs])return t;n=vw(n)}return e}n=t,t=n.parentNode}return null}function xd(n){return n=n[Vs]||n[Jl],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function tl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Ee(33))}function Mp(n){return n[Mf]||null}function iM(n){var e=n[yw];return e===void 0&&(e=n[yw]=new Set),e}var Mv=[],nl=-1;function ba(n){return{current:n}}function zt(n){0>nl||(n.current=Mv[nl],Mv[nl]=null,nl--)}function Jt(n,e){nl++,Mv[nl]=n.current,n.current=e}var ca={},Jn=ba(ca),yr=ba(!1),eo=ca;function Nl(n,e){var t=n.type.contextTypes;if(!t)return ca;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function xr(n){return n=n.childContextTypes,n!=null}function Ef(){zt(yr),zt(Jn)}function xw(n,e,t){if(Jn.current!==ca)throw Error(Ee(168));Jt(Jn,e),Jt(yr,t)}function sM(n,e,t){var r=n.stateNode;if(n=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in n))throw Error(Ee(108,fl(e)||"Unknown",i));return jt({},t,r)}function tf(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ca,eo=Jn.current,Jt(Jn,n),Jt(yr,yr.current),!0}function ww(n,e,t){var r=n.stateNode;if(!r)throw Error(Ee(169));t?(n=sM(n,e,eo),r.__reactInternalMemoizedMergedChildContext=n,zt(yr),zt(Jn),Jt(Jn,n)):zt(yr),Jt(yr,t)}var ny=null,Za=null,LC=Sn.unstable_runWithPriority,ry=Sn.unstable_scheduleCallback,Ev=Sn.unstable_cancelCallback,RC=Sn.unstable_shouldYield,_w=Sn.unstable_requestPaint,Av=Sn.unstable_now,FC=Sn.unstable_getCurrentPriorityLevel,Ep=Sn.unstable_ImmediatePriority,aM=Sn.unstable_UserBlockingPriority,oM=Sn.unstable_NormalPriority,lM=Sn.unstable_LowPriority,cM=Sn.unstable_IdlePriority,Dm={},DC=_w!==void 0?_w:function(){},ss=null,nf=null,Nm=!1,bw=Av(),Zn=1e4>bw?Av:function(){return Av()-bw};function kl(){switch(FC()){case Ep:return 99;case aM:return 98;case oM:return 97;case lM:return 96;case cM:return 95;default:throw Error(Ee(332))}}function uM(n){switch(n){case 99:return Ep;case 98:return aM;case 97:return oM;case 96:return lM;case 95:return cM;default:throw Error(Ee(332))}}function to(n,e){return n=uM(n),LC(n,e)}function Vu(n,e,t){return n=uM(n),ry(n,e,t)}function Zi(){if(nf!==null){var n=nf;nf=null,Ev(n)}dM()}function dM(){if(!Nm&&ss!==null){Nm=!0;var n=0;try{var e=ss;to(99,function(){for(;n<e.length;n++){var t=e[n];do t=t(!0);while(t!==null)}}),ss=null}catch(t){throw ss!==null&&(ss=ss.slice(n+1)),ry(Ep,Zi),t}finally{Nm=!1}}}var NC=co.ReactCurrentBatchConfig;function fi(n,e){if(n&&n.defaultProps){e=jt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var Af=ba(null),Tf=null,rl=null,Cf=null;function iy(){Cf=rl=Tf=null}function sy(n){var e=Af.current;zt(Af),n.type._context._currentValue=e}function hM(n,e){for(;n!==null;){var t=n.alternate;if((n.childLanes&e)===e){if(t===null||(t.childLanes&e)===e)break;t.childLanes|=e}else n.childLanes|=e,t!==null&&(t.childLanes|=e);n=n.return}}function yl(n,e){Tf=n,Cf=rl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&e)!==0&&(wi=!0),n.firstContext=null)}function Jr(n,e){if(Cf!==n&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(Cf=n,e=1073741823),e={context:n,observedBits:e,next:null},rl===null){if(Tf===null)throw Error(Ee(308));rl=e,Tf.dependencies={lanes:0,firstContext:e,responders:null}}else rl=rl.next=e;return n._currentValue}var Fs=!1;function ay(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function fM(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function qs(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Qs(n,e){if(n=n.updateQueue,n!==null){n=n.shared;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}}function Sw(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function ju(n,e,t,r){var i=n.updateQueue;Fs=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?s=c:a.next=c,a=l;var u=n.alternate;if(u!==null){u=u.updateQueue;var h=u.lastBaseUpdate;h!==a&&(h===null?u.firstBaseUpdate=c:h.next=c,u.lastBaseUpdate=l)}}if(s!==null){h=i.baseState,a=0,u=c=l=null;do{o=s.lane;var d=s.eventTime;if((r&o)===o){u!==null&&(u=u.next={eventTime:d,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=n,v=s;switch(o=e,d=t,v.tag){case 1:if(f=v.payload,typeof f=="function"){h=f.call(d,h,o);break e}h=f;break e;case 3:f.flags=f.flags&-4097|64;case 0:if(f=v.payload,o=typeof f=="function"?f.call(d,h,o):f,o==null)break e;h=jt({},h,o);break e;case 2:Fs=!0}}s.callback!==null&&(n.flags|=32,o=i.effects,o===null?i.effects=[s]:o.push(s))}else d={eventTime:d,lane:o,tag:s.tag,payload:s.payload,callback:s.callback,next:null},u===null?(c=u=d,l=h):u=u.next=d,a|=o;if(s=s.next,s===null){if(o=i.shared.pending,o===null)break;s=o.next,o.next=null,i.lastBaseUpdate=o,i.shared.pending=null}}while(1);u===null&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,_d|=a,n.lanes=a,n.memoizedState=h}}function Mw(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Ee(191,i));i.call(r)}}}var pM=new gp.Component().refs;function Pf(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:jt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ap={isMounted:function(n){return(n=n._reactInternals)?uo(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Ir(),i=Js(n),s=qs(r,i);s.payload=e,t!=null&&(s.callback=t),Qs(n,s),Ks(n,i,r)},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Ir(),i=Js(n),s=qs(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),Qs(n,s),Ks(n,i,r)},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ir(),r=Js(n),i=qs(t,r);i.tag=2,e!=null&&(i.callback=e),Qs(n,i),Ks(n,r,t)}};function Ew(n,e,t,r,i,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!Hu(t,r)||!Hu(i,s):!0}function mM(n,e,t){var r=!1,i=ca,s=e.contextType;return typeof s=="object"&&s!==null?s=Jr(s):(i=xr(e)?eo:Jn.current,r=e.contextTypes,s=(r=r!=null)?Nl(n,i):ca),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ap,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function Aw(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Ap.enqueueReplaceState(e,e.state,null)}function Tv(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs=pM,ay(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Jr(s):(s=xr(e)?eo:Jn.current,i.context=Nl(n,s)),ju(n,t,i,r),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Pf(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Ap.enqueueReplaceState(i,i.state,null),ju(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4)}var qd=Array.isArray;function Tc(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Ee(309));var r=t.stateNode}if(!r)throw Error(Ee(147,n));var i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(s){var a=r.refs;a===pM&&(a=r.refs={}),s===null?delete a[i]:a[i]=s},e._stringRef=i,e)}if(typeof n!="string")throw Error(Ee(284));if(!t._owner)throw Error(Ee(290,n))}return n}function Qd(n,e){if(n.type!=="textarea")throw Error(Ee(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function gM(n){function e(y,p){if(n){var m=y.lastEffect;m!==null?(m.nextEffect=p,y.lastEffect=p):y.firstEffect=y.lastEffect=p,p.nextEffect=null,p.flags=8}}function t(y,p){if(!n)return null;for(;p!==null;)e(y,p),p=p.sibling;return null}function r(y,p){for(y=new Map;p!==null;)p.key!==null?y.set(p.key,p):y.set(p.index,p),p=p.sibling;return y}function i(y,p){return y=da(y,p),y.index=0,y.sibling=null,y}function s(y,p,m){return y.index=m,n?(m=y.alternate,m!==null?(m=m.index,m<p?(y.flags=2,p):m):(y.flags=2,p)):p}function a(y){return n&&y.alternate===null&&(y.flags=2),y}function o(y,p,m,x){return p===null||p.tag!==6?(p=Bm(m,y.mode,x),p.return=y,p):(p=i(p,m),p.return=y,p)}function l(y,p,m,x){return p!==null&&p.elementType===m.type?(x=i(p,m.props),x.ref=Tc(y,p,m),x.return=y,x):(x=of(m.type,m.key,m.props,null,y.mode,x),x.ref=Tc(y,p,m),x.return=y,x)}function c(y,p,m,x){return p===null||p.tag!==4||p.stateNode.containerInfo!==m.containerInfo||p.stateNode.implementation!==m.implementation?(p=Hm(m,y.mode,x),p.return=y,p):(p=i(p,m.children||[]),p.return=y,p)}function u(y,p,m,x,w){return p===null||p.tag!==7?(p=bl(m,y.mode,x,w),p.return=y,p):(p=i(p,m),p.return=y,p)}function h(y,p,m){if(typeof p=="string"||typeof p=="number")return p=Bm(""+p,y.mode,m),p.return=y,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Zc:return m=of(p.type,p.key,p.props,null,y.mode,m),m.ref=Tc(y,null,p),m.return=y,m;case Ba:return p=Hm(p,y.mode,m),p.return=y,p}if(qd(p)||_c(p))return p=bl(p,y.mode,m,null),p.return=y,p;Qd(y,p)}return null}function d(y,p,m,x){var w=p!==null?p.key:null;if(typeof m=="string"||typeof m=="number")return w!==null?null:o(y,p,""+m,x);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Zc:return m.key===w?m.type===ks?u(y,p,m.props.children,x,w):l(y,p,m,x):null;case Ba:return m.key===w?c(y,p,m,x):null}if(qd(m)||_c(m))return w!==null?null:u(y,p,m,x,null);Qd(y,m)}return null}function f(y,p,m,x,w){if(typeof x=="string"||typeof x=="number")return y=y.get(m)||null,o(p,y,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Zc:return y=y.get(x.key===null?m:x.key)||null,x.type===ks?u(p,y,x.props.children,w,x.key):l(p,y,x,w);case Ba:return y=y.get(x.key===null?m:x.key)||null,c(p,y,x,w)}if(qd(x)||_c(x))return y=y.get(m)||null,u(p,y,x,w,null);Qd(p,x)}return null}function v(y,p,m,x){for(var w=null,b=null,C=p,A=p=0,F=null;C!==null&&A<m.length;A++){C.index>A?(F=C,C=null):F=C.sibling;var N=d(y,C,m[A],x);if(N===null){C===null&&(C=F);break}n&&C&&N.alternate===null&&e(y,C),p=s(N,p,A),b===null?w=N:b.sibling=N,b=N,C=F}if(A===m.length)return t(y,C),w;if(C===null){for(;A<m.length;A++)C=h(y,m[A],x),C!==null&&(p=s(C,p,A),b===null?w=C:b.sibling=C,b=C);return w}for(C=r(y,C);A<m.length;A++)F=f(C,y,A,m[A],x),F!==null&&(n&&F.alternate!==null&&C.delete(F.key===null?A:F.key),p=s(F,p,A),b===null?w=F:b.sibling=F,b=F);return n&&C.forEach(function(O){return e(y,O)}),w}function g(y,p,m,x){var w=_c(m);if(typeof w!="function")throw Error(Ee(150));if(m=w.call(m),m==null)throw Error(Ee(151));for(var b=w=null,C=p,A=p=0,F=null,N=m.next();C!==null&&!N.done;A++,N=m.next()){C.index>A?(F=C,C=null):F=C.sibling;var O=d(y,C,N.value,x);if(O===null){C===null&&(C=F);break}n&&C&&O.alternate===null&&e(y,C),p=s(O,p,A),b===null?w=O:b.sibling=O,b=O,C=F}if(N.done)return t(y,C),w;if(C===null){for(;!N.done;A++,N=m.next())N=h(y,N.value,x),N!==null&&(p=s(N,p,A),b===null?w=N:b.sibling=N,b=N);return w}for(C=r(y,C);!N.done;A++,N=m.next())N=f(C,y,A,N.value,x),N!==null&&(n&&N.alternate!==null&&C.delete(N.key===null?A:N.key),p=s(N,p,A),b===null?w=N:b.sibling=N,b=N);return n&&C.forEach(function(H){return e(y,H)}),w}return function(y,p,m,x){var w=typeof m=="object"&&m!==null&&m.type===ks&&m.key===null;w&&(m=m.props.children);var b=typeof m=="object"&&m!==null;if(b)switch(m.$$typeof){case Zc:e:{for(b=m.key,w=p;w!==null;){if(w.key===b){switch(w.tag){case 7:if(m.type===ks){t(y,w.sibling),p=i(w,m.props.children),p.return=y,y=p;break e}break;default:if(w.elementType===m.type){t(y,w.sibling),p=i(w,m.props),p.ref=Tc(y,w,m),p.return=y,y=p;break e}}t(y,w);break}else e(y,w);w=w.sibling}m.type===ks?(p=bl(m.props.children,y.mode,x,m.key),p.return=y,y=p):(x=of(m.type,m.key,m.props,null,y.mode,x),x.ref=Tc(y,p,m),x.return=y,y=x)}return a(y);case Ba:e:{for(w=m.key;p!==null;){if(p.key===w)if(p.tag===4&&p.stateNode.containerInfo===m.containerInfo&&p.stateNode.implementation===m.implementation){t(y,p.sibling),p=i(p,m.children||[]),p.return=y,y=p;break e}else{t(y,p);break}else e(y,p);p=p.sibling}p=Hm(m,y.mode,x),p.return=y,y=p}return a(y)}if(typeof m=="string"||typeof m=="number")return m=""+m,p!==null&&p.tag===6?(t(y,p.sibling),p=i(p,m),p.return=y,y=p):(t(y,p),p=Bm(m,y.mode,x),p.return=y,y=p),a(y);if(qd(m))return v(y,p,m,x);if(_c(m))return g(y,p,m,x);if(b&&Qd(y,m),typeof m=="undefined"&&!w)switch(y.tag){case 1:case 22:case 0:case 11:case 15:throw Error(Ee(152,fl(y.type)||"Component"))}return t(y,p)}}var If=gM(!0),vM=gM(!1),wd={},ji=ba(wd),Wu=ba(wd),Xu=ba(wd);function Va(n){if(n===wd)throw Error(Ee(174));return n}function Cv(n,e){switch(Jt(Xu,e),Jt(Wu,n),Jt(ji,wd),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:hv(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=hv(e,n)}zt(ji),Jt(ji,e)}function Ol(){zt(ji),zt(Wu),zt(Xu)}function Tw(n){Va(Xu.current);var e=Va(ji.current),t=hv(e,n.type);e!==t&&(Jt(Wu,n),Jt(ji,t))}function oy(n){Wu.current===n&&(zt(ji),zt(Wu))}var Qt=ba(0);function Lf(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ds=null,js=null,Wi=!1;function yM(n,e){var t=$r(5,null,null,0);t.elementType="DELETED",t.type="DELETED",t.stateNode=e,t.return=n,t.flags=8,n.lastEffect!==null?(n.lastEffect.nextEffect=t,n.lastEffect=t):n.firstEffect=n.lastEffect=t}function Cw(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function Pv(n){if(Wi){var e=js;if(e){var t=e;if(!Cw(n,e)){if(e=vl(t.nextSibling),!e||!Cw(n,e)){n.flags=n.flags&-1025|2,Wi=!1,ds=n;return}yM(ds,t)}ds=n,js=vl(e.firstChild)}else n.flags=n.flags&-1025|2,Wi=!1,ds=n}}function Pw(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ds=n}function Jd(n){if(n!==ds)return!1;if(!Wi)return Pw(n),Wi=!0,!1;var e=n.type;if(n.tag!==5||e!=="head"&&e!=="body"&&!Sv(e,n.memoizedProps))for(e=js;e;)yM(n,e),e=vl(e.nextSibling);if(Pw(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ee(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){js=vl(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}js=null}}else js=ds?vl(n.stateNode.nextSibling):null;return!0}function km(){js=ds=null,Wi=!1}var xl=[];function ly(){for(var n=0;n<xl.length;n++)xl[n]._workInProgressVersionPrimary=null;xl.length=0}var pu=co.ReactCurrentDispatcher,qr=co.ReactCurrentBatchConfig,Yu=0,on=null,$n=null,Nn=null,Rf=!1,mu=!1;function hr(){throw Error(Ee(321))}function cy(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Yr(n[t],e[t]))return!1;return!0}function uy(n,e,t,r,i,s){if(Yu=s,on=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,pu.current=n===null||n.memoizedState===null?OC:zC,n=t(r,i),mu){s=0;do{if(mu=!1,!(25>s))throw Error(Ee(301));s+=1,Nn=$n=null,e.updateQueue=null,pu.current=UC,n=t(r,i)}while(mu)}if(pu.current=kf,e=$n!==null&&$n.next!==null,Yu=0,Nn=$n=on=null,Rf=!1,e)throw Error(Ee(300));return n}function ja(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nn===null?on.memoizedState=Nn=n:Nn=Nn.next=n,Nn}function ho(){if($n===null){var n=on.alternate;n=n!==null?n.memoizedState:null}else n=$n.next;var e=Nn===null?on.memoizedState:Nn.next;if(e!==null)Nn=e,$n=n;else{if(n===null)throw Error(Ee(310));$n=n,n={memoizedState:$n.memoizedState,baseState:$n.baseState,baseQueue:$n.baseQueue,queue:$n.queue,next:null},Nn===null?on.memoizedState=Nn=n:Nn=Nn.next=n}return Nn}function Gi(n,e){return typeof e=="function"?e(n):e}function Cc(n){var e=ho(),t=e.queue;if(t===null)throw Error(Ee(311));t.lastRenderedReducer=n;var r=$n,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,t.pending=null}if(i!==null){i=i.next,r=r.baseState;var o=a=s=null,l=i;do{var c=l.lane;if((Yu&c)===c)o!==null&&(o=o.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),r=l.eagerReducer===n?l.eagerState:n(r,l.action);else{var u={lane:c,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};o===null?(a=o=u,s=r):o=o.next=u,on.lanes|=c,_d|=c}l=l.next}while(l!==null&&l!==i);o===null?s=r:o.next=a,Yr(r,e.memoizedState)||(wi=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=o,t.lastRenderedState=r}return[e.memoizedState,t.dispatch]}function Pc(n){var e=ho(),t=e.queue;if(t===null)throw Error(Ee(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do s=n(s,a.action),a=a.next;while(a!==i);Yr(s,e.memoizedState)||(wi=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function Iw(n,e,t){var r=e._getVersion;r=r(e._source);var i=e._workInProgressVersionPrimary;if(i!==null?n=i===r:(n=n.mutableReadLanes,(n=(Yu&n)===n)&&(e._workInProgressVersionPrimary=r,xl.push(e))),n)return t(e._source);throw xl.push(e),Error(Ee(350))}function xM(n,e,t,r){var i=or;if(i===null)throw Error(Ee(349));var s=e._getVersion,a=s(e._source),o=pu.current,l=o.useState(function(){return Iw(i,e,t)}),c=l[1],u=l[0];l=Nn;var h=n.memoizedState,d=h.refs,f=d.getSnapshot,v=h.source;h=h.subscribe;var g=on;return n.memoizedState={refs:d,source:e,subscribe:r},o.useEffect(function(){d.getSnapshot=t,d.setSnapshot=c;var y=s(e._source);if(!Yr(a,y)){y=t(e._source),Yr(u,y)||(c(y),y=Js(g),i.mutableReadLanes|=y&i.pendingLanes),y=i.mutableReadLanes,i.entangledLanes|=y;for(var p=i.entanglements,m=y;0<m;){var x=31-la(m),w=1<<x;p[x]|=y,m&=~w}}},[t,e,r]),o.useEffect(function(){return r(e._source,function(){var y=d.getSnapshot,p=d.setSnapshot;try{p(y(e._source));var m=Js(g);i.mutableReadLanes|=m&i.pendingLanes}catch(x){p(function(){throw x})}})},[e,r]),Yr(f,t)&&Yr(v,e)&&Yr(h,r)||(n={pending:null,dispatch:null,lastRenderedReducer:Gi,lastRenderedState:u},n.dispatch=c=fy.bind(null,on,n),l.queue=n,l.baseQueue=null,u=Iw(i,e,t),l.memoizedState=l.baseState=u),u}function wM(n,e,t){var r=ho();return xM(r,n,e,t)}function Ic(n){var e=ja();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n=e.queue={pending:null,dispatch:null,lastRenderedReducer:Gi,lastRenderedState:n},n=n.dispatch=fy.bind(null,on,n),[e.memoizedState,n]}function Ff(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=on.updateQueue,e===null?(e={lastEffect:null},on.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Lw(n){var e=ja();return n={current:n},e.memoizedState=n}function Df(){return ho().memoizedState}function Iv(n,e,t,r){var i=ja();on.flags|=n,i.memoizedState=Ff(1|e,t,void 0,r===void 0?null:r)}function dy(n,e,t,r){var i=ho();r=r===void 0?null:r;var s=void 0;if($n!==null){var a=$n.memoizedState;if(s=a.destroy,r!==null&&cy(r,a.deps)){Ff(e,t,s,r);return}}on.flags|=n,i.memoizedState=Ff(1|e,t,s,r)}function Rw(n,e){return Iv(516,4,n,e)}function Nf(n,e){return dy(516,4,n,e)}function _M(n,e){return dy(4,2,n,e)}function bM(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function SM(n,e,t){return t=t!=null?t.concat([n]):null,dy(4,2,bM.bind(null,e,n),t)}function hy(){}function MM(n,e){var t=ho();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&cy(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function EM(n,e){var t=ho();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&cy(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function kC(n,e){var t=kl();to(98>t?98:t,function(){n(!0)}),to(97<t?97:t,function(){var r=qr.transition;qr.transition=1;try{n(!1),e()}finally{qr.transition=r}})}function fy(n,e,t){var r=Ir(),i=Js(n),s={lane:i,action:t,eagerReducer:null,eagerState:null,next:null},a=e.pending;if(a===null?s.next=s:(s.next=a.next,a.next=s),e.pending=s,a=n.alternate,n===on||a!==null&&a===on)mu=Rf=!0;else{if(n.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,l=a(o,t);if(s.eagerReducer=a,s.eagerState=l,Yr(l,o))return}catch{}finally{}Ks(n,i,r)}}var kf={readContext:Jr,useCallback:hr,useContext:hr,useEffect:hr,useImperativeHandle:hr,useLayoutEffect:hr,useMemo:hr,useReducer:hr,useRef:hr,useState:hr,useDebugValue:hr,useDeferredValue:hr,useTransition:hr,useMutableSource:hr,useOpaqueIdentifier:hr,unstable_isNewReconciler:!1},OC={readContext:Jr,useCallback:function(n,e){return ja().memoizedState=[n,e===void 0?null:e],n},useContext:Jr,useEffect:Rw,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Iv(4,2,bM.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Iv(4,2,n,e)},useMemo:function(n,e){var t=ja();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=ja();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n=r.queue={pending:null,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},n=n.dispatch=fy.bind(null,on,n),[r.memoizedState,n]},useRef:Lw,useState:Ic,useDebugValue:hy,useDeferredValue:function(n){var e=Ic(n),t=e[0],r=e[1];return Rw(function(){var i=qr.transition;qr.transition=1;try{r(n)}finally{qr.transition=i}},[n]),t},useTransition:function(){var n=Ic(!1),e=n[0];return n=kC.bind(null,n[1]),Lw(n),[n,e]},useMutableSource:function(n,e,t){var r=ja();return r.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:n,subscribe:t},xM(r,n,e,t)},useOpaqueIdentifier:function(){if(Wi){var n=!1,e=IC(function(){throw n||(n=!0,t("r:"+(Fm++).toString(36))),Error(Ee(355))}),t=Ic(e)[1];return(on.mode&2)===0&&(on.flags|=516,Ff(5,function(){t("r:"+(Fm++).toString(36))},void 0,null)),e}return e="r:"+(Fm++).toString(36),Ic(e),e},unstable_isNewReconciler:!1},zC={readContext:Jr,useCallback:MM,useContext:Jr,useEffect:Nf,useImperativeHandle:SM,useLayoutEffect:_M,useMemo:EM,useReducer:Cc,useRef:Df,useState:function(){return Cc(Gi)},useDebugValue:hy,useDeferredValue:function(n){var e=Cc(Gi),t=e[0],r=e[1];return Nf(function(){var i=qr.transition;qr.transition=1;try{r(n)}finally{qr.transition=i}},[n]),t},useTransition:function(){var n=Cc(Gi)[0];return[Df().current,n]},useMutableSource:wM,useOpaqueIdentifier:function(){return Cc(Gi)[0]},unstable_isNewReconciler:!1},UC={readContext:Jr,useCallback:MM,useContext:Jr,useEffect:Nf,useImperativeHandle:SM,useLayoutEffect:_M,useMemo:EM,useReducer:Pc,useRef:Df,useState:function(){return Pc(Gi)},useDebugValue:hy,useDeferredValue:function(n){var e=Pc(Gi),t=e[0],r=e[1];return Nf(function(){var i=qr.transition;qr.transition=1;try{r(n)}finally{qr.transition=i}},[n]),t},useTransition:function(){var n=Pc(Gi)[0];return[Df().current,n]},useMutableSource:wM,useOpaqueIdentifier:function(){return Pc(Gi)[0]},unstable_isNewReconciler:!1},BC=co.ReactCurrentOwner,wi=!1;function pr(n,e,t,r){e.child=n===null?vM(e,null,t,r):If(e,n.child,t,r)}function Fw(n,e,t,r,i){t=t.render;var s=e.ref;return yl(e,i),r=uy(n,e,t,r,s,i),n!==null&&!wi?(e.updateQueue=n.updateQueue,e.flags&=-517,n.lanes&=~i,hs(n,e,i)):(e.flags|=1,pr(n,e,r,i),e.child)}function Dw(n,e,t,r,i,s){if(n===null){var a=t.type;return typeof a=="function"&&!xy(a)&&a.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=a,AM(n,e,a,r,i,s)):(n=of(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}return a=n.child,(i&s)===0&&(i=a.memoizedProps,t=t.compare,t=t!==null?t:Hu,t(i,r)&&n.ref===e.ref)?hs(n,e,s):(e.flags|=1,n=da(a,r),n.ref=e.ref,n.return=e,e.child=n)}function AM(n,e,t,r,i,s){if(n!==null&&Hu(n.memoizedProps,r)&&n.ref===e.ref)if(wi=!1,(s&i)!==0)(n.flags&16384)!==0&&(wi=!0);else return e.lanes=n.lanes,hs(n,e,s);return Lv(n,e,t,r,s)}function Om(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden"||r.mode==="unstable-defer-without-hiding")if((e.mode&4)===0)e.memoizedState={baseLanes:0},eh(e,t);else if((t&1073741824)!==0)e.memoizedState={baseLanes:0},eh(e,s!==null?s.baseLanes:t);else return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n},eh(e,n),null;else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,eh(e,r);return pr(n,e,i,t),e.child}function TM(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=128)}function Lv(n,e,t,r,i){var s=xr(t)?eo:Jn.current;return s=Nl(e,s),yl(e,i),t=uy(n,e,t,r,s,i),n!==null&&!wi?(e.updateQueue=n.updateQueue,e.flags&=-517,n.lanes&=~i,hs(n,e,i)):(e.flags|=1,pr(n,e,t,i),e.child)}function Nw(n,e,t,r,i){if(xr(t)){var s=!0;tf(e)}else s=!1;if(yl(e,i),e.stateNode===null)n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),mM(e,t,r),Tv(e,t,r,i),r=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,c=t.contextType;typeof c=="object"&&c!==null?c=Jr(c):(c=xr(t)?eo:Jn.current,c=Nl(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==c)&&Aw(e,a,r,c),Fs=!1;var d=e.memoizedState;a.state=d,ju(e,r,a,i),l=e.memoizedState,o!==r||d!==l||yr.current||Fs?(typeof u=="function"&&(Pf(e,t,u,r),l=e.memoizedState),(o=Fs||Ew(e,t,o,r,d,l,c))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4)):(typeof a.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4),r=!1)}else{a=e.stateNode,fM(n,e),o=e.memoizedProps,c=e.type===e.elementType?o:fi(e.type,o),a.props=c,h=e.pendingProps,d=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Jr(l):(l=xr(t)?eo:Jn.current,l=Nl(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||d!==l)&&Aw(e,a,r,l),Fs=!1,d=e.memoizedState,a.state=d,ju(e,r,a,i);var v=e.memoizedState;o!==h||d!==v||yr.current||Fs?(typeof f=="function"&&(Pf(e,t,f,r),v=e.memoizedState),(c=Fs||Ew(e,t,c,r,d,v,l))?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,v,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,v,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&d===n.memoizedState||(e.flags|=256),e.memoizedProps=r,e.memoizedState=v),a.props=r,a.state=v,a.context=l,r=c):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&d===n.memoizedState||(e.flags|=256),r=!1)}return Rv(n,e,t,r,s,i)}function Rv(n,e,t,r,i,s){TM(n,e);var a=(e.flags&64)!==0;if(!r&&!a)return i&&ww(e,t,!1),hs(n,e,s);r=e.stateNode,BC.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=If(e,n.child,null,s),e.child=If(e,null,o,s)):pr(n,e,o,s),e.memoizedState=r.state,i&&ww(e,t,!0),e.child}function kw(n){var e=n.stateNode;e.pendingContext?xw(n,e.pendingContext,e.pendingContext!==e.context):e.context&&xw(n,e.context,!1),Cv(n,e.containerInfo)}var Kd={dehydrated:null,retryLane:0};function Ow(n,e,t){var r=e.pendingProps,i=Qt.current,s=!1,a;return(a=(e.flags&64)!==0)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-65):n!==null&&n.memoizedState===null||r.fallback===void 0||r.unstable_avoidThisFallback===!0||(i|=1),Jt(Qt,i&1),n===null?(r.fallback!==void 0&&Pv(e),n=r.children,i=r.fallback,s?(n=zw(e,n,i,t),e.child.memoizedState={baseLanes:t},e.memoizedState=Kd,n):typeof r.unstable_expectedLoadTime=="number"?(n=zw(e,n,i,t),e.child.memoizedState={baseLanes:t},e.memoizedState=Kd,e.lanes=33554432,n):(t=wy({mode:"visible",children:n},e.mode,t,null),t.return=e,e.child=t)):n.memoizedState!==null?s?(r=Bw(n,e,r.children,r.fallback,t),s=e.child,i=n.child.memoizedState,s.memoizedState=i===null?{baseLanes:t}:{baseLanes:i.baseLanes|t},s.childLanes=n.childLanes&~t,e.memoizedState=Kd,r):(t=Uw(n,e,r.children,t),e.memoizedState=null,t):s?(r=Bw(n,e,r.children,r.fallback,t),s=e.child,i=n.child.memoizedState,s.memoizedState=i===null?{baseLanes:t}:{baseLanes:i.baseLanes|t},s.childLanes=n.childLanes&~t,e.memoizedState=Kd,r):(t=Uw(n,e,r.children,t),e.memoizedState=null,t)}function zw(n,e,t,r){var i=n.mode,s=n.child;return e={mode:"hidden",children:e},(i&2)===0&&s!==null?(s.childLanes=0,s.pendingProps=e):s=wy(e,i,0,null),t=bl(t,i,r,null),s.return=n,t.return=n,s.sibling=t,n.child=s,t}function Uw(n,e,t,r){var i=n.child;return n=i.sibling,t=da(i,{mode:"visible",children:t}),(e.mode&2)===0&&(t.lanes=r),t.return=e,t.sibling=null,n!==null&&(n.nextEffect=null,n.flags=8,e.firstEffect=e.lastEffect=n),e.child=t}function Bw(n,e,t,r,i){var s=e.mode,a=n.child;n=a.sibling;var o={mode:"hidden",children:t};return(s&2)===0&&e.child!==a?(t=e.child,t.childLanes=0,t.pendingProps=o,a=t.lastEffect,a!==null?(e.firstEffect=t.firstEffect,e.lastEffect=a,a.nextEffect=null):e.firstEffect=e.lastEffect=null):t=da(a,o),n!==null?r=da(n,r):(r=bl(r,s,i,null),r.flags|=2),r.return=e,t.return=e,t.sibling=r,e.child=t,r}function Hw(n,e){n.lanes|=e;var t=n.alternate;t!==null&&(t.lanes|=e),hM(n.return,e)}function zm(n,e,t,r,i,s){var a=n.memoizedState;a===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i,lastEffect:s}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=t,a.tailMode=i,a.lastEffect=s)}function Gw(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(pr(n,e,r.children,t),r=Qt.current,(r&2)!==0)r=r&1|2,e.flags|=64;else{if(n!==null&&(n.flags&64)!==0)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Hw(n,t);else if(n.tag===19)Hw(n,t);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Jt(Qt,r),(e.mode&2)===0)e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Lf(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),zm(e,!1,i,t,s,e.lastEffect);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Lf(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}zm(e,!0,t,null,s,e.lastEffect);break;case"together":zm(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function hs(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),_d|=e.lanes,(t&e.childLanes)!==0){if(n!==null&&e.child!==n.child)throw Error(Ee(153));if(e.child!==null){for(n=e.child,t=da(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=da(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}return null}var CM,Fv,PM,IM;CM=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Fv=function(){};PM=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Va(ji.current);var s=null;switch(t){case"input":i=av(n,i),r=av(n,r),s=[];break;case"option":i=cv(n,i),r=cv(n,r),s=[];break;case"select":i=jt({},i,{value:void 0}),r=jt({},r,{value:void 0}),s=[];break;case"textarea":i=uv(n,i),r=uv(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Sf)}fv(t,r);var a;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var o=i[c];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Du.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(o=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Du.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Ot("scroll",n),s||o===l||(s=[])):typeof l=="object"&&l!==null&&l.$$typeof===B0?l.toString():(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};IM=function(n,e,t,r){t!==r&&(e.flags|=4)};function Lc(n,e){if(!Wi)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function HC(n,e,t){var r=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return xr(e.type)&&Ef(),null;case 3:return Ol(),zt(yr),zt(Jn),ly(),r=e.stateNode,r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Jd(e)?e.flags|=4:r.hydrate||(e.flags|=256)),Fv(e),null;case 5:oy(e);var i=Va(Xu.current);if(t=e.type,n!==null&&e.stateNode!=null)PM(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=128);else{if(!r){if(e.stateNode===null)throw Error(Ee(166));return null}if(n=Va(ji.current),Jd(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[Vs]=e,r[Mf]=s,t){case"dialog":Ot("cancel",r),Ot("close",r);break;case"iframe":case"object":case"embed":Ot("load",r);break;case"video":case"audio":for(n=0;n<Qc.length;n++)Ot(Qc[n],r);break;case"source":Ot("error",r);break;case"img":case"image":case"link":Ot("error",r),Ot("load",r);break;case"details":Ot("toggle",r);break;case"input":Gx(r,s),Ot("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Ot("invalid",r);break;case"textarea":jx(r,s),Ot("invalid",r)}fv(t,s),n=null;for(var a in s)s.hasOwnProperty(a)&&(i=s[a],a==="children"?typeof i=="string"?r.textContent!==i&&(n=["children",i]):typeof i=="number"&&r.textContent!==""+i&&(n=["children",""+i]):Du.hasOwnProperty(a)&&i!=null&&a==="onScroll"&&Ot("scroll",r));switch(t){case"input":Xd(r),Vx(r,s,!0);break;case"textarea":Xd(r),Wx(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Sf)}r=n,e.updateQueue=r,r!==null&&(e.flags|=4)}else{switch(a=i.nodeType===9?i:i.ownerDocument,n===dv.html&&(n=SS(t)),n===dv.html?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[Vs]=e,n[Mf]=r,CM(n,e,!1,!1),e.stateNode=n,a=pv(t,r),t){case"dialog":Ot("cancel",n),Ot("close",n),i=r;break;case"iframe":case"object":case"embed":Ot("load",n),i=r;break;case"video":case"audio":for(i=0;i<Qc.length;i++)Ot(Qc[i],n);i=r;break;case"source":Ot("error",n),i=r;break;case"img":case"image":case"link":Ot("error",n),Ot("load",n),i=r;break;case"details":Ot("toggle",n),i=r;break;case"input":Gx(n,r),i=av(n,r),Ot("invalid",n);break;case"option":i=cv(n,r);break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=jt({},r,{value:void 0}),Ot("invalid",n);break;case"textarea":jx(n,r),i=uv(n,r),Ot("invalid",n);break;default:i=r}fv(t,i);var o=i;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?AS(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&MS(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Nu(n,l):typeof l=="number"&&Nu(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Du.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Ot("scroll",n):l!=null&&D0(n,s,l,a))}switch(t){case"input":Xd(n),Vx(n,r,!1);break;case"textarea":Xd(n),Wx(n);break;case"option":r.value!=null&&n.setAttribute("value",""+oa(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?pl(n,!!r.multiple,s,!1):r.defaultValue!=null&&pl(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Sf)}rM(t,r)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(n&&e.stateNode!=null)IM(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Ee(166));t=Va(Xu.current),Va(ji.current),Jd(e)?(r=e.stateNode,t=e.memoizedProps,r[Vs]=e,r.nodeValue!==t&&(e.flags|=4)):(r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Vs]=e,e.stateNode=r)}return null;case 13:return zt(Qt),r=e.memoizedState,(e.flags&64)!==0?(e.lanes=t,e):(r=r!==null,t=!1,n===null?e.memoizedProps.fallback!==void 0&&Jd(e):t=n.memoizedState!==null,r&&!t&&(e.mode&2)!==0&&(n===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(Qt.current&1)!==0?On===0&&(On=3):((On===0||On===3)&&(On=4),or===null||(_d&134217727)===0&&(ec&134217727)===0||wl(or,qn))),(r||t)&&(e.flags|=4),null);case 4:return Ol(),Fv(e),n===null&&eM(e.stateNode.containerInfo),null;case 10:return sy(e),null;case 17:return xr(e.type)&&Ef(),null;case 19:if(zt(Qt),r=e.memoizedState,r===null)return null;if(s=(e.flags&64)!==0,a=r.rendering,a===null)if(s)Lc(r,!1);else{if(On!==0||n!==null&&(n.flags&64)!==0)for(n=e.child;n!==null;){if(a=Lf(n),a!==null){for(e.flags|=64,Lc(r,!1),s=a.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),r.lastEffect===null&&(e.firstEffect=null),e.lastEffect=r.lastEffect,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Jt(Qt,Qt.current&1|2),e.child}n=n.sibling}r.tail!==null&&Zn()>Uv&&(e.flags|=64,s=!0,Lc(r,!1),e.lanes=33554432)}else{if(!s)if(n=Lf(a),n!==null){if(e.flags|=64,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Lc(r,!0),r.tail===null&&r.tailMode==="hidden"&&!a.alternate&&!Wi)return e=e.lastEffect=r.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*Zn()-r.renderingStartTime>Uv&&t!==1073741824&&(e.flags|=64,s=!0,Lc(r,!1),e.lanes=33554432);r.isBackwards?(a.sibling=e.child,e.child=a):(t=r.last,t!==null?t.sibling=a:e.child=a,r.last=a)}return r.tail!==null?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.lastEffect=e.lastEffect,r.renderingStartTime=Zn(),t.sibling=null,e=Qt.current,Jt(Qt,s?e&1|2:e&1),t):null;case 23:case 24:return yy(),n!==null&&n.memoizedState!==null!=(e.memoizedState!==null)&&r.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(Ee(156,e.tag))}function GC(n){switch(n.tag){case 1:xr(n.type)&&Ef();var e=n.flags;return e&4096?(n.flags=e&-4097|64,n):null;case 3:if(Ol(),zt(yr),zt(Jn),ly(),e=n.flags,(e&64)!==0)throw Error(Ee(285));return n.flags=e&-4097|64,n;case 5:return oy(n),null;case 13:return zt(Qt),e=n.flags,e&4096?(n.flags=e&-4097|64,n):null;case 19:return zt(Qt),null;case 4:return Ol(),null;case 10:return sy(n),null;case 23:case 24:return yy(),null;default:return null}}function py(n,e){try{var t="",r=e;do t+=bT(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i}}function Dv(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var VC=typeof WeakMap=="function"?WeakMap:Map;function LM(n,e,t){t=qs(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){zf||(zf=!0,Bv=r),Dv(n,e)},t}function RM(n,e,t){t=qs(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return Dv(n,e),r(i)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){typeof r!="function"&&(Vi===null?Vi=new Set([this]):Vi.add(this),Dv(n,e));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}var jC=typeof WeakSet=="function"?WeakSet:Set;function Vw(n){var e=n.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(t){ea(n,t)}else e.current=null}function WC(n,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&n!==null){var t=n.memoizedProps,r=n.memoizedState;n=e.stateNode,e=n.getSnapshotBeforeUpdate(e.elementType===e.type?t:fi(e.type,t),r),n.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&ty(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(Ee(163))}function XC(n,e,t){switch(t.tag){case 0:case 11:case 15:case 22:if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){n=e=e.next;do{if((n.tag&3)===3){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){n=e=e.next;do{var i=n;r=i.next,i=i.tag,(i&4)!==0&&(i&1)!==0&&(HM(t,n),eP(t,n)),n=r}while(n!==e)}return;case 1:n=t.stateNode,t.flags&4&&(e===null?n.componentDidMount():(r=t.elementType===t.type?e.memoizedProps:fi(t.type,e.memoizedProps),n.componentDidUpdate(r,e.memoizedState,n.__reactInternalSnapshotBeforeUpdate))),e=t.updateQueue,e!==null&&Mw(t,e,n);return;case 3:if(e=t.updateQueue,e!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Mw(t,e,n)}return;case 5:n=t.stateNode,e===null&&t.flags&4&&rM(t.type,t.memoizedProps)&&n.focus();return;case 6:return;case 4:return;case 12:return;case 13:t.memoizedState===null&&(t=t.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&kS(t))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(Ee(163))}function jw(n,e){for(var t=n;;){if(t.tag===5){var r=t.stateNode;if(e)r=r.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none";else{r=t.stateNode;var i=t.memoizedProps.style;i=i!=null&&i.hasOwnProperty("display")?i.display:null,r.style.display=ES("display",i)}}else if(t.tag===6)t.stateNode.nodeValue=e?"":t.memoizedProps;else if((t.tag!==23&&t.tag!==24||t.memoizedState===null||t===n)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break;for(;t.sibling===null;){if(t.return===null||t.return===n)return;t=t.return}t.sibling.return=t.return,t=t.sibling}}function Ww(n,e){if(Za&&typeof Za.onCommitFiberUnmount=="function")try{Za.onCommitFiberUnmount(ny,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(n=e.updateQueue,n!==null&&(n=n.lastEffect,n!==null)){var t=n=n.next;do{var r=t,i=r.destroy;if(r=r.tag,i!==void 0)if((r&4)!==0)HM(e,t);else{r=e;try{i()}catch(s){ea(r,s)}}t=t.next}while(t!==n)}break;case 1:if(Vw(e),n=e.stateNode,typeof n.componentWillUnmount=="function")try{n.props=e.memoizedProps,n.state=e.memoizedState,n.componentWillUnmount()}catch(s){ea(e,s)}break;case 5:Vw(e);break;case 4:FM(n,e)}}function Xw(n){n.alternate=null,n.child=null,n.dependencies=null,n.firstEffect=null,n.lastEffect=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.return=null,n.updateQueue=null}function Yw(n){return n.tag===5||n.tag===3||n.tag===4}function $w(n){e:{for(var e=n.return;e!==null;){if(Yw(e))break e;e=e.return}throw Error(Ee(160))}var t=e;switch(e=t.stateNode,t.tag){case 5:var r=!1;break;case 3:e=e.containerInfo,r=!0;break;case 4:e=e.containerInfo,r=!0;break;default:throw Error(Ee(161))}t.flags&16&&(Nu(e,""),t.flags&=-17);e:t:for(t=n;;){for(;t.sibling===null;){if(t.return===null||Yw(t.return)){t=null;break e}t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue t;t.child.return=t,t=t.child}if(!(t.flags&2)){t=t.stateNode;break e}}r?Nv(n,t,e):kv(n,t,e)}function Nv(n,e,t){var r=n.tag,i=r===5||r===6;if(i)n=i?n.stateNode:n.stateNode.instance,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Sf));else if(r!==4&&(n=n.child,n!==null))for(Nv(n,e,t),n=n.sibling;n!==null;)Nv(n,e,t),n=n.sibling}function kv(n,e,t){var r=n.tag,i=r===5||r===6;if(i)n=i?n.stateNode:n.stateNode.instance,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(kv(n,e,t),n=n.sibling;n!==null;)kv(n,e,t),n=n.sibling}function FM(n,e){for(var t=e,r=!1,i,s;;){if(!r){r=t.return;e:for(;;){if(r===null)throw Error(Ee(160));switch(i=r.stateNode,r.tag){case 5:s=!1;break e;case 3:i=i.containerInfo,s=!0;break e;case 4:i=i.containerInfo,s=!0;break e}r=r.return}r=!0}if(t.tag===5||t.tag===6){e:for(var a=n,o=t,l=o;;)if(Ww(a,l),l.child!==null&&l.tag!==4)l.child.return=l,l=l.child;else{if(l===o)break e;for(;l.sibling===null;){if(l.return===null||l.return===o)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}s?(a=i,o=t.stateNode,a.nodeType===8?a.parentNode.removeChild(o):a.removeChild(o)):i.removeChild(t.stateNode)}else if(t.tag===4){if(t.child!==null){i=t.stateNode.containerInfo,s=!0,t.child.return=t,t=t.child;continue}}else if(Ww(n,t),t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return,t.tag===4&&(r=!1)}t.sibling.return=t.return,t=t.sibling}}function Um(n,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var t=e.updateQueue;if(t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do(r.tag&3)===3&&(n=r.destroy,r.destroy=void 0,n!==void 0&&n()),r=r.next;while(r!==t)}return;case 1:return;case 5:if(t=e.stateNode,t!=null){r=e.memoizedProps;var i=n!==null?n.memoizedProps:r;n=e.type;var s=e.updateQueue;if(e.updateQueue=null,s!==null){for(t[Mf]=r,n==="input"&&r.type==="radio"&&r.name!=null&&_S(t,r),pv(n,i),e=pv(n,r),i=0;i<s.length;i+=2){var a=s[i],o=s[i+1];a==="style"?AS(t,o):a==="dangerouslySetInnerHTML"?MS(t,o):a==="children"?Nu(t,o):D0(t,a,o,e)}switch(n){case"input":ov(t,r);break;case"textarea":bS(t,r);break;case"select":n=t._wrapperState.wasMultiple,t._wrapperState.wasMultiple=!!r.multiple,s=r.value,s!=null?pl(t,!!r.multiple,s,!1):n!==!!r.multiple&&(r.defaultValue!=null?pl(t,!!r.multiple,r.defaultValue,!0):pl(t,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(Ee(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:t=e.stateNode,t.hydrate&&(t.hydrate=!1,kS(t.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(vy=Zn(),jw(e.child,!0)),Zw(e);return;case 19:Zw(e);return;case 17:return;case 23:case 24:jw(e,e.memoizedState!==null);return}throw Error(Ee(163))}function Zw(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new jC),e.forEach(function(r){var i=rP.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function YC(n,e){return n!==null&&(n=n.memoizedState,n===null||n.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var $C=Math.ceil,Of=co.ReactCurrentDispatcher,my=co.ReactCurrentOwner,Qe=0,or=null,hn=null,qn=0,no=0,Ov=ba(0),On=0,Tp=null,Kl=0,_d=0,ec=0,gy=0,zv=null,vy=0,Uv=1/0;function tc(){Uv=Zn()+500}var Ue=null,zf=!1,Bv=null,Vi=null,ua=!1,gu=null,Jc=90,Hv=[],Gv=[],fs=null,vu=0,Vv=null,rf=-1,ls=0,sf=0,yu=null,af=!1;function Ir(){return(Qe&48)!==0?Zn():rf!==-1?rf:rf=Zn()}function Js(n){if(n=n.mode,(n&2)===0)return 1;if((n&4)===0)return kl()===99?1:2;if(ls===0&&(ls=Kl),NC.transition!==0){sf!==0&&(sf=zv!==null?zv.pendingLanes:0),n=ls;var e=4186112&~sf;return e&=-e,e===0&&(n=4186112&~n,e=n&-n,e===0&&(e=8192)),e}return n=kl(),(Qe&4)!==0&&n===98?n=_f(12,ls):(n=zT(n),n=_f(n,ls)),n}function Ks(n,e,t){if(50<vu)throw vu=0,Vv=null,Error(Ee(185));if(n=Cp(n,e),n===null)return null;wp(n,e,t),n===or&&(ec|=e,On===4&&wl(n,qn));var r=kl();e===1?(Qe&8)!==0&&(Qe&48)===0?jv(n):(Kr(n,t),Qe===0&&(tc(),Zi())):((Qe&4)===0||r!==98&&r!==99||(fs===null?fs=new Set([n]):fs.add(n)),Kr(n,t)),zv=n}function Cp(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}function Kr(n,e){for(var t=n.callbackNode,r=n.suspendedLanes,i=n.pingedLanes,s=n.expirationTimes,a=n.pendingLanes;0<a;){var o=31-la(a),l=1<<o,c=s[o];if(c===-1){if((l&r)===0||(l&i)!==0){c=e,Zo(l);var u=Ft;s[o]=10<=u?c+250:6<=u?c+5e3:-1}}else c<=e&&(n.expiredLanes|=l);a&=~l}if(r=Uu(n,n===or?qn:0),e=Ft,r===0)t!==null&&(t!==Dm&&Ev(t),n.callbackNode=null,n.callbackPriority=0);else{if(t!==null){if(n.callbackPriority===e)return;t!==Dm&&Ev(t)}e===15?(t=jv.bind(null,n),ss===null?(ss=[t],nf=ry(Ep,dM)):ss.push(t),t=Dm):e===14?t=Vu(99,jv.bind(null,n)):(t=UT(e),t=Vu(t,DM.bind(null,n))),n.callbackPriority=e,n.callbackNode=t}}function DM(n){if(rf=-1,sf=ls=0,(Qe&48)!==0)throw Error(Ee(327));var e=n.callbackNode;if(Sa()&&n.callbackNode!==e)return null;var t=Uu(n,n===or?qn:0);if(t===0)return null;var r=t,i=Qe;Qe|=16;var s=zM();(or!==n||qn!==r)&&(tc(),_l(n,r));do try{QC();break}catch(o){OM(n,o)}while(1);if(iy(),Of.current=s,Qe=i,hn!==null?r=0:(or=null,qn=0,r=On),(Kl&ec)!==0)_l(n,0);else if(r!==0){if(r===2&&(Qe|=64,n.hydrate&&(n.hydrate=!1,ty(n.containerInfo)),t=VS(n),t!==0&&(r=Kc(n,t))),r===1)throw e=Tp,_l(n,0),wl(n,t),Kr(n,Zn()),e;switch(n.finishedWork=n.current.alternate,n.finishedLanes=t,r){case 0:case 1:throw Error(Ee(345));case 2:Da(n);break;case 3:if(wl(n,t),(t&62914560)===t&&(r=vy+500-Zn(),10<r)){if(Uu(n,0)!==0)break;if(i=n.suspendedLanes,(i&t)!==t){Ir(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=gw(Da.bind(null,n),r);break}Da(n);break;case 4:if(wl(n,t),(t&4186112)===t)break;for(r=n.eventTimes,i=-1;0<t;){var a=31-la(t);s=1<<a,a=r[a],a>i&&(i=a),t&=~s}if(t=i,t=Zn()-t,t=(120>t?120:480>t?480:1080>t?1080:1920>t?1920:3e3>t?3e3:4320>t?4320:1960*$C(t/1960))-t,10<t){n.timeoutHandle=gw(Da.bind(null,n),t);break}Da(n);break;case 5:Da(n);break;default:throw Error(Ee(329))}}return Kr(n,Zn()),n.callbackNode===e?DM.bind(null,n):null}function wl(n,e){for(e&=~gy,e&=~ec,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-la(e),r=1<<t;n[t]=-1,e&=~r}}function jv(n){if((Qe&48)!==0)throw Error(Ee(327));if(Sa(),n===or&&(n.expiredLanes&qn)!==0){var e=qn,t=Kc(n,e);(Kl&ec)!==0&&(e=Uu(n,e),t=Kc(n,e))}else e=Uu(n,0),t=Kc(n,e);if(n.tag!==0&&t===2&&(Qe|=64,n.hydrate&&(n.hydrate=!1,ty(n.containerInfo)),e=VS(n),e!==0&&(t=Kc(n,e))),t===1)throw t=Tp,_l(n,0),wl(n,e),Kr(n,Zn()),t;return n.finishedWork=n.current.alternate,n.finishedLanes=e,Da(n),Kr(n,Zn()),null}function ZC(){if(fs!==null){var n=fs;fs=null,n.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,Kr(e,Zn())})}Zi()}function NM(n,e){var t=Qe;Qe|=1;try{return n(e)}finally{Qe=t,Qe===0&&(tc(),Zi())}}function kM(n,e){var t=Qe;Qe&=-2,Qe|=8;try{return n(e)}finally{Qe=t,Qe===0&&(tc(),Zi())}}function eh(n,e){Jt(Ov,no),no|=e,Kl|=e}function yy(){no=Ov.current,zt(Ov)}function _l(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,PC(t)),hn!==null)for(t=hn.return;t!==null;){var r=t;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ef();break;case 3:Ol(),zt(yr),zt(Jn),ly();break;case 5:oy(r);break;case 4:Ol();break;case 13:zt(Qt);break;case 19:zt(Qt);break;case 10:sy(r);break;case 23:case 24:yy()}t=t.return}or=n,hn=da(n.current,null),qn=no=Kl=e,On=0,Tp=null,gy=ec=_d=0}function OM(n,e){do{var t=hn;try{if(iy(),pu.current=kf,Rf){for(var r=on.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Rf=!1}if(Yu=0,Nn=$n=on=null,mu=!1,my.current=null,t===null||t.return===null){On=1,Tp=e,hn=null;break}e:{var s=n,a=t.return,o=t,l=e;if(e=qn,o.flags|=2048,o.firstEffect=o.lastEffect=null,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l;if((o.mode&2)===0){var u=o.alternate;u?(o.updateQueue=u.updateQueue,o.memoizedState=u.memoizedState,o.lanes=u.lanes):(o.updateQueue=null,o.memoizedState=null)}var h=(Qt.current&1)!==0,d=a;do{var f;if(f=d.tag===13){var v=d.memoizedState;if(v!==null)f=v.dehydrated!==null;else{var g=d.memoizedProps;f=g.fallback===void 0?!1:g.unstable_avoidThisFallback!==!0?!0:!h}}if(f){var y=d.updateQueue;if(y===null){var p=new Set;p.add(c),d.updateQueue=p}else y.add(c);if((d.mode&2)===0){if(d.flags|=64,o.flags|=16384,o.flags&=-2981,o.tag===1)if(o.alternate===null)o.tag=17;else{var m=qs(-1,1);m.tag=2,Qs(o,m)}o.lanes|=1;break e}l=void 0,o=e;var x=s.pingCache;if(x===null?(x=s.pingCache=new VC,l=new Set,x.set(c,l)):(l=x.get(c),l===void 0&&(l=new Set,x.set(c,l))),!l.has(o)){l.add(o);var w=nP.bind(null,s,c,o);c.then(w,w)}d.flags|=4096,d.lanes=e;break e}d=d.return}while(d!==null);l=Error((fl(o.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}On!==5&&(On=2),l=py(l,o),d=a;do{switch(d.tag){case 3:s=l,d.flags|=4096,e&=-e,d.lanes|=e;var b=LM(d,s,e);Sw(d,b);break e;case 1:s=l;var C=d.type,A=d.stateNode;if((d.flags&64)===0&&(typeof C.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(Vi===null||!Vi.has(A)))){d.flags|=4096,e&=-e,d.lanes|=e;var F=RM(d,s,e);Sw(d,F);break e}}d=d.return}while(d!==null)}BM(t)}catch(N){e=N,hn===t&&t!==null&&(hn=t=t.return);continue}break}while(1)}function zM(){var n=Of.current;return Of.current=kf,n===null?kf:n}function Kc(n,e){var t=Qe;Qe|=16;var r=zM();or===n&&qn===e||_l(n,e);do try{qC();break}catch(i){OM(n,i)}while(1);if(iy(),Qe=t,Of.current=r,hn!==null)throw Error(Ee(261));return or=null,qn=0,On}function qC(){for(;hn!==null;)UM(hn)}function QC(){for(;hn!==null&&!RC();)UM(hn)}function UM(n){var e=GM(n.alternate,n,no);n.memoizedProps=n.pendingProps,e===null?BM(n):hn=e,my.current=null}function BM(n){var e=n;do{var t=e.alternate;if(n=e.return,(e.flags&2048)===0){if(t=HC(t,e,no),t!==null){hn=t;return}if(t=e,t.tag!==24&&t.tag!==23||t.memoizedState===null||(no&1073741824)!==0||(t.mode&4)===0){for(var r=0,i=t.child;i!==null;)r|=i.lanes|i.childLanes,i=i.sibling;t.childLanes=r}n!==null&&(n.flags&2048)===0&&(n.firstEffect===null&&(n.firstEffect=e.firstEffect),e.lastEffect!==null&&(n.lastEffect!==null&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.flags&&(n.lastEffect!==null?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(t=GC(e),t!==null){t.flags&=2047,hn=t;return}n!==null&&(n.firstEffect=n.lastEffect=null,n.flags|=2048)}if(e=e.sibling,e!==null){hn=e;return}hn=e=n}while(e!==null);On===0&&(On=5)}function Da(n){var e=kl();return to(99,JC.bind(null,n,e)),null}function JC(n,e){do Sa();while(gu!==null);if((Qe&48)!==0)throw Error(Ee(327));var t=n.finishedWork;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Ee(177));n.callbackNode=null;var r=t.lanes|t.childLanes,i=r,s=n.pendingLanes&~i;n.pendingLanes=i,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=i,n.mutableReadLanes&=i,n.entangledLanes&=i,i=n.entanglements;for(var a=n.eventTimes,o=n.expirationTimes;0<s;){var l=31-la(s),c=1<<l;i[l]=0,a[l]=-1,o[l]=-1,s&=~c}if(fs!==null&&(r&24)===0&&fs.has(n)&&fs.delete(n),n===or&&(hn=or=null,qn=0),1<t.flags?t.lastEffect!==null?(t.lastEffect.nextEffect=t,r=t.firstEffect):r=t:r=t.firstEffect,r!==null){if(i=Qe,Qe|=32,my.current=null,Lm=Jh,a=cw(),wv(a)){if("selectionStart"in a)o={start:a.selectionStart,end:a.selectionEnd};else e:if(o=(o=a.ownerDocument)&&o.defaultView||window,(c=o.getSelection&&o.getSelection())&&c.rangeCount!==0){o=c.anchorNode,s=c.anchorOffset,l=c.focusNode,c=c.focusOffset;try{o.nodeType,l.nodeType}catch{o=null;break e}var u=0,h=-1,d=-1,f=0,v=0,g=a,y=null;t:for(;;){for(var p;g!==o||s!==0&&g.nodeType!==3||(h=u+s),g!==l||c!==0&&g.nodeType!==3||(d=u+c),g.nodeType===3&&(u+=g.nodeValue.length),(p=g.firstChild)!==null;)y=g,g=p;for(;;){if(g===a)break t;if(y===o&&++f===s&&(h=u),y===l&&++v===c&&(d=u),(p=g.nextSibling)!==null)break;g=y,y=g.parentNode}g=p}o=h===-1||d===-1?null:{start:h,end:d}}else o=null;o=o||{start:0,end:0}}else o=null;Rm={focusedElem:a,selectionRange:o},Jh=!1,yu=null,af=!1,Ue=r;do try{KC()}catch(N){if(Ue===null)throw Error(Ee(330));ea(Ue,N),Ue=Ue.nextEffect}while(Ue!==null);yu=null,Ue=r;do try{for(a=n;Ue!==null;){var m=Ue.flags;if(m&16&&Nu(Ue.stateNode,""),m&128){var x=Ue.alternate;if(x!==null){var w=x.ref;w!==null&&(typeof w=="function"?w(null):w.current=null)}}switch(m&1038){case 2:$w(Ue),Ue.flags&=-3;break;case 6:$w(Ue),Ue.flags&=-3,Um(Ue.alternate,Ue);break;case 1024:Ue.flags&=-1025;break;case 1028:Ue.flags&=-1025,Um(Ue.alternate,Ue);break;case 4:Um(Ue.alternate,Ue);break;case 8:o=Ue,FM(a,o);var b=o.alternate;Xw(o),b!==null&&Xw(b)}Ue=Ue.nextEffect}}catch(N){if(Ue===null)throw Error(Ee(330));ea(Ue,N),Ue=Ue.nextEffect}while(Ue!==null);if(w=Rm,x=cw(),m=w.focusedElem,a=w.selectionRange,x!==m&&m&&m.ownerDocument&&QS(m.ownerDocument.documentElement,m)){for(a!==null&&wv(m)&&(x=a.start,w=a.end,w===void 0&&(w=x),"selectionStart"in m?(m.selectionStart=x,m.selectionEnd=Math.min(w,m.value.length)):(w=(x=m.ownerDocument||document)&&x.defaultView||window,w.getSelection&&(w=w.getSelection(),o=m.textContent.length,b=Math.min(a.start,o),a=a.end===void 0?b:Math.min(a.end,o),!w.extend&&b>a&&(o=a,a=b,b=o),o=lw(m,b),s=lw(m,a),o&&s&&(w.rangeCount!==1||w.anchorNode!==o.node||w.anchorOffset!==o.offset||w.focusNode!==s.node||w.focusOffset!==s.offset)&&(x=x.createRange(),x.setStart(o.node,o.offset),w.removeAllRanges(),b>a?(w.addRange(x),w.extend(s.node,s.offset)):(x.setEnd(s.node,s.offset),w.addRange(x)))))),x=[],w=m;w=w.parentNode;)w.nodeType===1&&x.push({element:w,left:w.scrollLeft,top:w.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<x.length;m++)w=x[m],w.element.scrollLeft=w.left,w.element.scrollTop=w.top}Jh=!!Lm,Rm=Lm=null,n.current=t,Ue=r;do try{for(m=n;Ue!==null;){var C=Ue.flags;if(C&36&&XC(m,Ue.alternate,Ue),C&128){x=void 0;var A=Ue.ref;if(A!==null){var F=Ue.stateNode;switch(Ue.tag){case 5:x=F;break;default:x=F}typeof A=="function"?A(x):A.current=x}}Ue=Ue.nextEffect}}catch(N){if(Ue===null)throw Error(Ee(330));ea(Ue,N),Ue=Ue.nextEffect}while(Ue!==null);Ue=null,DC(),Qe=i}else n.current=t;if(ua)ua=!1,gu=n,Jc=e;else for(Ue=r;Ue!==null;)e=Ue.nextEffect,Ue.nextEffect=null,Ue.flags&8&&(C=Ue,C.sibling=null,C.stateNode=null),Ue=e;if(r=n.pendingLanes,r===0&&(Vi=null),r===1?n===Vv?vu++:(vu=0,Vv=n):vu=0,t=t.stateNode,Za&&typeof Za.onCommitFiberRoot=="function")try{Za.onCommitFiberRoot(ny,t,void 0,(t.current.flags&64)===64)}catch{}if(Kr(n,Zn()),zf)throw zf=!1,n=Bv,Bv=null,n;return(Qe&8)!==0||Zi(),null}function KC(){for(;Ue!==null;){var n=Ue.alternate;af||yu===null||((Ue.flags&8)!==0?$x(Ue,yu)&&(af=!0):Ue.tag===13&&YC(n,Ue)&&$x(Ue,yu)&&(af=!0));var e=Ue.flags;(e&256)!==0&&WC(n,Ue),(e&512)===0||ua||(ua=!0,Vu(97,function(){return Sa(),null})),Ue=Ue.nextEffect}}function Sa(){if(Jc!==90){var n=97<Jc?97:Jc;return Jc=90,to(n,tP)}return!1}function eP(n,e){Hv.push(e,n),ua||(ua=!0,Vu(97,function(){return Sa(),null}))}function HM(n,e){Gv.push(e,n),ua||(ua=!0,Vu(97,function(){return Sa(),null}))}function tP(){if(gu===null)return!1;var n=gu;if(gu=null,(Qe&48)!==0)throw Error(Ee(331));var e=Qe;Qe|=32;var t=Gv;Gv=[];for(var r=0;r<t.length;r+=2){var i=t[r],s=t[r+1],a=i.destroy;if(i.destroy=void 0,typeof a=="function")try{a()}catch(l){if(s===null)throw Error(Ee(330));ea(s,l)}}for(t=Hv,Hv=[],r=0;r<t.length;r+=2){i=t[r],s=t[r+1];try{var o=i.create;i.destroy=o()}catch(l){if(s===null)throw Error(Ee(330));ea(s,l)}}for(o=n.current.firstEffect;o!==null;)n=o.nextEffect,o.nextEffect=null,o.flags&8&&(o.sibling=null,o.stateNode=null),o=n;return Qe=e,Zi(),!0}function qw(n,e,t){e=py(t,e),e=LM(n,e,1),Qs(n,e),e=Ir(),n=Cp(n,1),n!==null&&(wp(n,1,e),Kr(n,e))}function ea(n,e){if(n.tag===3)qw(n,n,e);else for(var t=n.return;t!==null;){if(t.tag===3){qw(t,n,e);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Vi===null||!Vi.has(r))){n=py(e,n);var i=RM(t,n,1);if(Qs(t,i),i=Ir(),t=Cp(t,1),t!==null)wp(t,1,i),Kr(t,i);else if(typeof r.componentDidCatch=="function"&&(Vi===null||!Vi.has(r)))try{r.componentDidCatch(e,n)}catch{}break}}t=t.return}}function nP(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Ir(),n.pingedLanes|=n.suspendedLanes&t,or===n&&(qn&t)===t&&(On===4||On===3&&(qn&62914560)===qn&&500>Zn()-vy?_l(n,0):gy|=t),Kr(n,e)}function rP(n,e){var t=n.stateNode;t!==null&&t.delete(e),e=0,e===0&&(e=n.mode,(e&2)===0?e=1:(e&4)===0?e=kl()===99?1:2:(ls===0&&(ls=Kl),e=qo(62914560&~ls),e===0&&(e=4194304))),t=Ir(),n=Cp(n,e),n!==null&&(wp(n,e,t),Kr(n,t))}var GM;GM=function(n,e,t){var r=e.lanes;if(n!==null)if(n.memoizedProps!==e.pendingProps||yr.current)wi=!0;else if((t&r)!==0)wi=(n.flags&16384)!==0;else{switch(wi=!1,e.tag){case 3:kw(e),km();break;case 5:Tw(e);break;case 1:xr(e.type)&&tf(e);break;case 4:Cv(e,e.stateNode.containerInfo);break;case 10:r=e.memoizedProps.value;var i=e.type._context;Jt(Af,i._currentValue),i._currentValue=r;break;case 13:if(e.memoizedState!==null)return(t&e.child.childLanes)!==0?Ow(n,e,t):(Jt(Qt,Qt.current&1),e=hs(n,e,t),e!==null?e.sibling:null);Jt(Qt,Qt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,(n.flags&64)!==0){if(r)return Gw(n,e,t);e.flags|=64}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Jt(Qt,Qt.current),r)break;return null;case 23:case 24:return e.lanes=0,Om(n,e,t)}return hs(n,e,t)}else wi=!1;switch(e.lanes=0,e.tag){case 2:if(r=e.type,n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),n=e.pendingProps,i=Nl(e,Jn.current),yl(e,t),i=uy(null,e,r,n,i,t),e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,xr(r)){var s=!0;tf(e)}else s=!1;e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,ay(e);var a=r.getDerivedStateFromProps;typeof a=="function"&&Pf(e,r,a,n),i.updater=Ap,e.stateNode=i,i._reactInternals=e,Tv(e,r,n,t),e=Rv(null,e,r,!0,s,t)}else e.tag=0,pr(null,e,i,t),e=e.child;return e;case 16:i=e.elementType;e:{switch(n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),n=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=sP(i),n=fi(i,n),s){case 0:e=Lv(null,e,i,n,t);break e;case 1:e=Nw(null,e,i,n,t);break e;case 11:e=Fw(null,e,i,n,t);break e;case 14:e=Dw(null,e,i,fi(i.type,n),r,t);break e}throw Error(Ee(306,i,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:fi(r,i),Lv(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:fi(r,i),Nw(n,e,r,i,t);case 3:if(kw(e),r=e.updateQueue,n===null||r===null)throw Error(Ee(282));if(r=e.pendingProps,i=e.memoizedState,i=i!==null?i.element:null,fM(n,e),ju(e,r,null,t),r=e.memoizedState.element,r===i)km(),e=hs(n,e,t);else{if(i=e.stateNode,(s=i.hydrate)&&(js=vl(e.stateNode.containerInfo.firstChild),ds=e,s=Wi=!0),s){if(n=i.mutableSourceEagerHydrationData,n!=null)for(i=0;i<n.length;i+=2)s=n[i],s._workInProgressVersionPrimary=n[i+1],xl.push(s);for(t=vM(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|1024,t=t.sibling}else pr(n,e,r,t),km();e=e.child}return e;case 5:return Tw(e),n===null&&Pv(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,a=i.children,Sv(r,i)?a=null:s!==null&&Sv(r,s)&&(e.flags|=16),TM(n,e),pr(n,e,a,t),e.child;case 6:return n===null&&Pv(e),null;case 13:return Ow(n,e,t);case 4:return Cv(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=If(e,null,r,t):pr(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:fi(r,i),Fw(n,e,r,i,t);case 7:return pr(n,e,e.pendingProps,t),e.child;case 8:return pr(n,e,e.pendingProps.children,t),e.child;case 12:return pr(n,e,e.pendingProps.children,t),e.child;case 10:e:{r=e.type._context,i=e.pendingProps,a=e.memoizedProps,s=i.value;var o=e.type._context;if(Jt(Af,o._currentValue),o._currentValue=s,a!==null)if(o=a.value,s=Yr(o,s)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(o,s):1073741823)|0,s===0){if(a.children===i.children&&!yr.current){e=hs(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var l=o.dependencies;if(l!==null){a=o.child;for(var c=l.firstContext;c!==null;){if(c.context===r&&(c.observedBits&s)!==0){o.tag===1&&(c=qs(-1,t&-t),c.tag=2,Qs(o,c)),o.lanes|=t,c=o.alternate,c!==null&&(c.lanes|=t),hM(o.return,t),l.lanes|=t;break}c=c.next}}else a=o.tag===10&&o.type===e.type?null:o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===e){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}pr(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps,r=s.children,yl(e,t),i=Jr(i,s.unstable_observedBits),r=r(i),e.flags|=1,pr(n,e,r,t),e.child;case 14:return i=e.type,s=fi(i,e.pendingProps),s=fi(i.type,s),Dw(n,e,i,s,r,t);case 15:return AM(n,e,e.type,e.pendingProps,r,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:fi(r,i),n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,xr(r)?(n=!0,tf(e)):n=!1,yl(e,t),mM(e,r,i),Tv(e,r,i,t),Rv(null,e,r,!0,n,t);case 19:return Gw(n,e,t);case 23:return Om(n,e,t);case 24:return Om(n,e,t)}throw Error(Ee(156,e.tag))};function iP(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function $r(n,e,t,r){return new iP(n,e,t,r)}function xy(n){return n=n.prototype,!(!n||!n.isReactComponent)}function sP(n){if(typeof n=="function")return xy(n)?1:0;if(n!=null){if(n=n.$$typeof,n===vp)return 11;if(n===yp)return 14}return 2}function da(n,e){var t=n.alternate;return t===null?(t=$r(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.nextEffect=null,t.firstEffect=null,t.lastEffect=null),t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function of(n,e,t,r,i,s){var a=2;if(r=n,typeof n=="function")xy(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case ks:return bl(t.children,i,s,e);case yS:a=8,i|=16;break;case N0:a=8,i|=1;break;case ou:return n=$r(12,t,e,i|8),n.elementType=ou,n.type=ou,n.lanes=s,n;case lu:return n=$r(13,t,e,i),n.type=lu,n.elementType=lu,n.lanes=s,n;case vf:return n=$r(19,t,e,i),n.elementType=vf,n.lanes=s,n;case H0:return wy(t,i,s,e);case sv:return n=$r(24,t,e,i),n.elementType=sv,n.lanes=s,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case k0:a=10;break e;case O0:a=9;break e;case vp:a=11;break e;case yp:a=14;break e;case z0:a=16,r=null;break e;case U0:a=22;break e}throw Error(Ee(130,n==null?n:typeof n,""))}return e=$r(a,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function bl(n,e,t,r){return n=$r(7,n,r,e),n.lanes=t,n}function wy(n,e,t,r){return n=$r(23,n,r,e),n.elementType=H0,n.lanes=t,n}function Bm(n,e,t){return n=$r(6,n,null,e),n.lanes=t,n}function Hm(n,e,t){return e=$r(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function aP(n,e,t){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=t,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Mm(0),this.expirationTimes=Mm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mm(0),this.mutableSourceEagerHydrationData=null}function oP(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ba,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Uf(n,e,t,r){var i=e.current,s=Ir(),a=Js(i);e:if(t){t=t._reactInternals;t:{if(uo(t)!==t||t.tag!==1)throw Error(Ee(170));var o=t;do{switch(o.tag){case 3:o=o.stateNode.context;break t;case 1:if(xr(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break t}}o=o.return}while(o!==null);throw Error(Ee(171))}if(t.tag===1){var l=t.type;if(xr(l)){t=sM(t,l,o);break e}}t=o}else t=ca;return e.context===null?e.context=t:e.pendingContext=t,e=qs(s,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),Qs(i,e),Ks(i,a,s),a}function Gm(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Qw(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function _y(n,e){Qw(n,e),(n=n.alternate)&&Qw(n,e)}function lP(){return null}function by(n,e,t){var r=t!=null&&t.hydrationOptions!=null&&t.hydrationOptions.mutableSources||null;if(t=new aP(n,e,t!=null&&t.hydrate===!0),e=$r(3,null,null,e===2?7:e===1?3:0),t.current=e,e.stateNode=t,ay(e),n[Jl]=t.current,eM(n.nodeType===8?n.parentNode:n),r)for(n=0;n<r.length;n++){e=r[n];var i=e._getVersion;i=i(e._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[e,i]:t.mutableSourceEagerHydrationData.push(e,i)}this._internalRoot=t}by.prototype.render=function(n){Uf(n,this._internalRoot,null,null)};by.prototype.unmount=function(){var n=this._internalRoot,e=n.containerInfo;Uf(null,n,null,function(){e[Jl]=null})};function bd(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function cP(n,e){if(e||(e=n?n.nodeType===9?n.documentElement:n.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var t;t=n.lastChild;)n.removeChild(t);return new by(n,0,e?{hydrate:!0}:void 0)}function Pp(n,e,t,r,i){var s=t._reactRootContainer;if(s){var a=s._internalRoot;if(typeof i=="function"){var o=i;i=function(){var c=Gm(a);o.call(c)}}Uf(e,a,n,i)}else{if(s=t._reactRootContainer=cP(t,r),a=s._internalRoot,typeof i=="function"){var l=i;i=function(){var c=Gm(a);l.call(c)}}kM(function(){Uf(e,a,n,i)})}return Gm(a)}FS=function(n){if(n.tag===13){var e=Ir();Ks(n,4,e),_y(n,4)}};X0=function(n){if(n.tag===13){var e=Ir();Ks(n,67108864,e),_y(n,67108864)}};DS=function(n){if(n.tag===13){var e=Ir(),t=Js(n);Ks(n,t,e),_y(n,t)}};NS=function(n,e){return e()};mv=function(n,e,t){switch(e){case"input":if(ov(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=Mp(r);if(!i)throw Error(Ee(90));wS(r),ov(r,i)}}}break;case"textarea":bS(n,t);break;case"select":e=t.value,e!=null&&pl(n,!!t.multiple,e,!1)}};V0=NM;PS=function(n,e,t,r,i){var s=Qe;Qe|=4;try{return to(98,n.bind(null,e,t,r,i))}finally{Qe=s,Qe===0&&(tc(),Zi())}};j0=function(){(Qe&49)===0&&(ZC(),Sa())};IS=function(n,e){var t=Qe;Qe|=2;try{return n(e)}finally{Qe=t,Qe===0&&(tc(),Zi())}};function VM(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bd(e))throw Error(Ee(200));return oP(n,e,null,t)}var uP={Events:[xd,tl,Mp,TS,CS,Sa,{current:!1}]},Rc={findFiberByHostInstance:Ga,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},dP={bundleType:Rc.bundleType,version:Rc.version,rendererPackageName:Rc.rendererPackageName,rendererConfig:Rc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:co.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=RS(n),n===null?null:n.stateNode},findFiberByHostInstance:Rc.findFiberByHostInstance||lP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var th=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!th.isDisabled&&th.supportsFiber)try{ny=th.inject(dP),Za=th}catch{}}ri.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uP;ri.createPortal=VM;ri.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Ee(188)):Error(Ee(268,Object.keys(n)));return n=RS(e),n=n===null?null:n.stateNode,n};ri.flushSync=function(n,e){var t=Qe;if((t&48)!==0)return n(e);Qe|=1;try{if(n)return to(99,n.bind(null,e))}finally{Qe=t,Zi()}};ri.hydrate=function(n,e,t){if(!bd(e))throw Error(Ee(200));return Pp(null,n,e,!0,t)};ri.render=function(n,e,t){if(!bd(e))throw Error(Ee(200));return Pp(null,n,e,!1,t)};ri.unmountComponentAtNode=function(n){if(!bd(n))throw Error(Ee(40));return n._reactRootContainer?(kM(function(){Pp(null,null,n,!1,function(){n._reactRootContainer=null,n[Jl]=null})}),!0):!1};ri.unstable_batchedUpdates=NM;ri.unstable_createPortal=function(n,e){return VM(n,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};ri.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!bd(t))throw Error(Ee(200));if(n==null||n._reactInternals===void 0)throw Error(Ee(38));return Pp(n,e,t,!1,r)};ri.version="17.0.2";function jM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jM)}catch(n){console.error(n)}}jM(),aa.exports=ri;var hP=aa.exports,Sy={exports:{}},fP="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",pP=fP,mP=pP;function WM(){}function XM(){}XM.resetWarningCache=WM;var gP=function(){function n(r,i,s,a,o,l){if(l!==mP){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:XM,resetWarningCache:WM};return t.PropTypes=t,t};Sy.exports=gP();var vs=Zr.createContext(null);function vP(n){n()}var YM=vP,yP=function(e){return YM=e},xP=function(){return YM};function wP(){var n=xP(),e=null,t=null;return{clear:function(){e=null,t=null},notify:function(){n(function(){for(var i=e;i;)i.callback(),i=i.next})},get:function(){for(var i=[],s=e;s;)i.push(s),s=s.next;return i},subscribe:function(i){var s=!0,a=t={callback:i,next:null,prev:t};return a.prev?a.prev.next=a:e=a,function(){!s||e===null||(s=!1,a.next?a.next.prev=a.prev:t=a.prev,a.prev?a.prev.next=a.next:e=a.next)}}}}var Jw={notify:function(){},get:function(){return[]}};function My(n,e){var t,r=Jw;function i(h){return l(),r.subscribe(h)}function s(){r.notify()}function a(){u.onStateChange&&u.onStateChange()}function o(){return Boolean(t)}function l(){t||(t=e?e.addNestedSub(a):n.subscribe(a),r=wP())}function c(){t&&(t(),t=void 0,r.clear(),r=Jw)}var u={addNestedSub:i,notifyNestedSubs:s,handleChangeWrapper:a,isSubscribed:o,trySubscribe:l,tryUnsubscribe:c,getListeners:function(){return r}};return u}var Bf=typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement!="undefined"?I.exports.useLayoutEffect:I.exports.useEffect,Ip={exports:{}},Sd={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _P=I.exports,$M=60103;Sd.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var Kw=Symbol.for;$M=Kw("react.element"),Sd.Fragment=Kw("react.fragment")}var bP=_P.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,SP=Object.prototype.hasOwnProperty,MP={key:!0,ref:!0,__self:!0,__source:!0};function ZM(n,e,t){var r,i={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)SP.call(e,r)&&!MP.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:$M,type:n,key:s,ref:a,props:i,_owner:bP.current}}Sd.jsx=ZM;Sd.jsxs=ZM;Ip.exports=Sd;const E=Ip.exports.jsx,fe=Ip.exports.jsxs,Ve=Ip.exports.Fragment;function EP(n){var e=n.store,t=n.context,r=n.children,i=I.exports.useMemo(function(){var o=My(e);return{store:e,subscription:o}},[e]),s=I.exports.useMemo(function(){return e.getState()},[e]);Bf(function(){var o=i.subscription;return o.onStateChange=o.notifyNestedSubs,o.trySubscribe(),s!==e.getState()&&o.notifyNestedSubs(),function(){o.tryUnsubscribe(),o.onStateChange=null}},[i,s]);var a=t||vs;return E(a.Provider,{value:i,children:r})}function zl(){return zl=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},zl.apply(this,arguments)}function Hf(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var qM={exports:{}},Ct={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var An=typeof Symbol=="function"&&Symbol.for,Ey=An?Symbol.for("react.element"):60103,Ay=An?Symbol.for("react.portal"):60106,Lp=An?Symbol.for("react.fragment"):60107,Rp=An?Symbol.for("react.strict_mode"):60108,Fp=An?Symbol.for("react.profiler"):60114,Dp=An?Symbol.for("react.provider"):60109,Np=An?Symbol.for("react.context"):60110,Ty=An?Symbol.for("react.async_mode"):60111,kp=An?Symbol.for("react.concurrent_mode"):60111,Op=An?Symbol.for("react.forward_ref"):60112,zp=An?Symbol.for("react.suspense"):60113,AP=An?Symbol.for("react.suspense_list"):60120,Up=An?Symbol.for("react.memo"):60115,Bp=An?Symbol.for("react.lazy"):60116,TP=An?Symbol.for("react.block"):60121,CP=An?Symbol.for("react.fundamental"):60117,PP=An?Symbol.for("react.responder"):60118,IP=An?Symbol.for("react.scope"):60119;function kr(n){if(typeof n=="object"&&n!==null){var e=n.$$typeof;switch(e){case Ey:switch(n=n.type,n){case Ty:case kp:case Lp:case Fp:case Rp:case zp:return n;default:switch(n=n&&n.$$typeof,n){case Np:case Op:case Bp:case Up:case Dp:return n;default:return e}}case Ay:return e}}}function QM(n){return kr(n)===kp}Ct.AsyncMode=Ty;Ct.ConcurrentMode=kp;Ct.ContextConsumer=Np;Ct.ContextProvider=Dp;Ct.Element=Ey;Ct.ForwardRef=Op;Ct.Fragment=Lp;Ct.Lazy=Bp;Ct.Memo=Up;Ct.Portal=Ay;Ct.Profiler=Fp;Ct.StrictMode=Rp;Ct.Suspense=zp;Ct.isAsyncMode=function(n){return QM(n)||kr(n)===Ty};Ct.isConcurrentMode=QM;Ct.isContextConsumer=function(n){return kr(n)===Np};Ct.isContextProvider=function(n){return kr(n)===Dp};Ct.isElement=function(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ey};Ct.isForwardRef=function(n){return kr(n)===Op};Ct.isFragment=function(n){return kr(n)===Lp};Ct.isLazy=function(n){return kr(n)===Bp};Ct.isMemo=function(n){return kr(n)===Up};Ct.isPortal=function(n){return kr(n)===Ay};Ct.isProfiler=function(n){return kr(n)===Fp};Ct.isStrictMode=function(n){return kr(n)===Rp};Ct.isSuspense=function(n){return kr(n)===zp};Ct.isValidElementType=function(n){return typeof n=="string"||typeof n=="function"||n===Lp||n===kp||n===Fp||n===Rp||n===zp||n===AP||typeof n=="object"&&n!==null&&(n.$$typeof===Bp||n.$$typeof===Up||n.$$typeof===Dp||n.$$typeof===Np||n.$$typeof===Op||n.$$typeof===CP||n.$$typeof===PP||n.$$typeof===IP||n.$$typeof===TP)};Ct.typeOf=kr;qM.exports=Ct;var Cy=qM.exports,LP={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},RP={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},FP={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},JM={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Py={};Py[Cy.ForwardRef]=FP;Py[Cy.Memo]=JM;function e_(n){return Cy.isMemo(n)?JM:Py[n.$$typeof]||LP}var DP=Object.defineProperty,NP=Object.getOwnPropertyNames,t_=Object.getOwnPropertySymbols,kP=Object.getOwnPropertyDescriptor,OP=Object.getPrototypeOf,n_=Object.prototype;function KM(n,e,t){if(typeof e!="string"){if(n_){var r=OP(e);r&&r!==n_&&KM(n,r,t)}var i=NP(e);t_&&(i=i.concat(t_(e)));for(var s=e_(n),a=e_(e),o=0;o<i.length;++o){var l=i[o];if(!RP[l]&&!(t&&t[l])&&!(a&&a[l])&&!(s&&s[l])){var c=kP(e,l);try{DP(n,l,c)}catch{}}}}return n}var r_=KM,eE={exports:{}},Lt={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hp=60103,Gp=60106,Md=60107,Ed=60108,Ad=60114,Td=60109,Cd=60110,Pd=60112,Id=60113,Iy=60120,Ld=60115,Rd=60116,tE=60121,nE=60122,rE=60117,iE=60129,sE=60131;if(typeof Symbol=="function"&&Symbol.for){var Pn=Symbol.for;Hp=Pn("react.element"),Gp=Pn("react.portal"),Md=Pn("react.fragment"),Ed=Pn("react.strict_mode"),Ad=Pn("react.profiler"),Td=Pn("react.provider"),Cd=Pn("react.context"),Pd=Pn("react.forward_ref"),Id=Pn("react.suspense"),Iy=Pn("react.suspense_list"),Ld=Pn("react.memo"),Rd=Pn("react.lazy"),tE=Pn("react.block"),nE=Pn("react.server.block"),rE=Pn("react.fundamental"),iE=Pn("react.debug_trace_mode"),sE=Pn("react.legacy_hidden")}function Ti(n){if(typeof n=="object"&&n!==null){var e=n.$$typeof;switch(e){case Hp:switch(n=n.type,n){case Md:case Ad:case Ed:case Id:case Iy:return n;default:switch(n=n&&n.$$typeof,n){case Cd:case Pd:case Rd:case Ld:case Td:return n;default:return e}}case Gp:return e}}}var zP=Td,UP=Hp,BP=Pd,HP=Md,GP=Rd,VP=Ld,jP=Gp,WP=Ad,XP=Ed,YP=Id;Lt.ContextConsumer=Cd;Lt.ContextProvider=zP;Lt.Element=UP;Lt.ForwardRef=BP;Lt.Fragment=HP;Lt.Lazy=GP;Lt.Memo=VP;Lt.Portal=jP;Lt.Profiler=WP;Lt.StrictMode=XP;Lt.Suspense=YP;Lt.isAsyncMode=function(){return!1};Lt.isConcurrentMode=function(){return!1};Lt.isContextConsumer=function(n){return Ti(n)===Cd};Lt.isContextProvider=function(n){return Ti(n)===Td};Lt.isElement=function(n){return typeof n=="object"&&n!==null&&n.$$typeof===Hp};Lt.isForwardRef=function(n){return Ti(n)===Pd};Lt.isFragment=function(n){return Ti(n)===Md};Lt.isLazy=function(n){return Ti(n)===Rd};Lt.isMemo=function(n){return Ti(n)===Ld};Lt.isPortal=function(n){return Ti(n)===Gp};Lt.isProfiler=function(n){return Ti(n)===Ad};Lt.isStrictMode=function(n){return Ti(n)===Ed};Lt.isSuspense=function(n){return Ti(n)===Id};Lt.isValidElementType=function(n){return typeof n=="string"||typeof n=="function"||n===Md||n===Ad||n===iE||n===Ed||n===Id||n===Iy||n===sE||typeof n=="object"&&n!==null&&(n.$$typeof===Rd||n.$$typeof===Ld||n.$$typeof===Td||n.$$typeof===Cd||n.$$typeof===Pd||n.$$typeof===rE||n.$$typeof===tE||n[0]===nE)};Lt.typeOf=Ti;eE.exports=Lt;var $P=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],ZP=["reactReduxForwardedRef"],qP=[],QP=[null,null];function JP(n,e){var t=n[1];return[e.payload,t+1]}function i_(n,e,t){Bf(function(){return n.apply(void 0,e)},t)}function KP(n,e,t,r,i,s,a){n.current=r,e.current=i,t.current=!1,s.current&&(s.current=null,a())}function e3(n,e,t,r,i,s,a,o,l,c){if(!!n){var u=!1,h=null,d=function(){if(!u){var g=e.getState(),y,p;try{y=r(g,i.current)}catch(m){p=m,h=m}p||(h=null),y===s.current?a.current||l():(s.current=y,o.current=y,a.current=!0,c({type:"STORE_UPDATED",payload:{error:p}}))}};t.onStateChange=d,t.trySubscribe(),d();var f=function(){if(u=!0,t.tryUnsubscribe(),t.onStateChange=null,h)throw h};return f}}var t3=function(){return[null,0]};function n3(n,e){e===void 0&&(e={});var t=e,r=t.getDisplayName,i=r===void 0?function(x){return"ConnectAdvanced("+x+")"}:r,s=t.methodName,a=s===void 0?"connectAdvanced":s,o=t.renderCountProp,l=o===void 0?void 0:o,c=t.shouldHandleStateChanges,u=c===void 0?!0:c,h=t.storeKey,d=h===void 0?"store":h;t.withRef;var f=t.forwardRef,v=f===void 0?!1:f,g=t.context,y=g===void 0?vs:g,p=Hf(t,$P),m=y;return function(w){var b=w.displayName||w.name||"Component",C=i(b),A=zl({},p,{getDisplayName:i,methodName:a,renderCountProp:l,shouldHandleStateChanges:u,storeKey:d,displayName:C,wrappedComponentName:b,WrappedComponent:w}),F=p.pure;function N(_){return n(_.dispatch,A)}var O=F?I.exports.useMemo:function(_){return _()};function H(_){var z=I.exports.useMemo(function(){var B=_.reactReduxForwardedRef,q=Hf(_,ZP);return[_.context,B,q]},[_]),j=z[0],R=z[1],ee=z[2],J=I.exports.useMemo(function(){return j&&j.Consumer&&eE.exports.isContextConsumer(Zr.createElement(j.Consumer,null))?j:m},[j,m]),le=I.exports.useContext(J),k=Boolean(_.store)&&Boolean(_.store.getState)&&Boolean(_.store.dispatch);Boolean(le)&&Boolean(le.store);var V=k?_.store:le.store,$=I.exports.useMemo(function(){return N(V)},[V]),Q=I.exports.useMemo(function(){if(!u)return QP;var B=My(V,k?null:le.subscription),q=B.notifyNestedSubs.bind(B);return[B,q]},[V,k,le]),ie=Q[0],ne=Q[1],Se=I.exports.useMemo(function(){return k?le:zl({},le,{subscription:ie})},[k,le,ie]),_e=I.exports.useReducer(JP,qP,t3),we=_e[0],Me=we[0],ke=_e[1];if(Me&&Me.error)throw Me.error;var de=I.exports.useRef(),xe=I.exports.useRef(ee),M=I.exports.useRef(),te=I.exports.useRef(!1),X=O(function(){return M.current&&ee===xe.current?M.current:$(V.getState(),ee)},[V,Me,ee]);i_(KP,[xe,de,te,ee,X,M,ne]),i_(e3,[u,V,ie,$,xe,de,te,M,ne,ke],[V,ie,$]);var T=I.exports.useMemo(function(){return E(w,{...X,ref:R})},[R,w,X]),S=I.exports.useMemo(function(){return u?E(J.Provider,{value:Se,children:T}):T},[J,T,Se]);return S}var D=F?Zr.memo(H):H;if(D.WrappedComponent=w,D.displayName=H.displayName=C,v){var U=Zr.forwardRef(function(z,j){return E(D,{...z,reactReduxForwardedRef:j})});return U.displayName=C,U.WrappedComponent=w,r_(U,w)}return r_(D,w)}}function s_(n,e){return n===e?n!==0||e!==0||1/n===1/e:n!==n&&e!==e}function Vm(n,e){if(s_(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(var i=0;i<t.length;i++)if(!Object.prototype.hasOwnProperty.call(e,t[i])||!s_(n[t[i]],e[t[i]]))return!1;return!0}function r3(n,e){var t={},r=function(a){var o=n[a];typeof o=="function"&&(t[a]=function(){return e(o.apply(void 0,arguments))})};for(var i in n)r(i);return t}function Ly(n){return function(t,r){var i=n(t,r);function s(){return i}return s.dependsOnOwnProps=!1,s}}function a_(n){return n.dependsOnOwnProps!==null&&n.dependsOnOwnProps!==void 0?Boolean(n.dependsOnOwnProps):n.length!==1}function aE(n,e){return function(r,i){i.displayName;var s=function(o,l){return s.dependsOnOwnProps?s.mapToProps(o,l):s.mapToProps(o)};return s.dependsOnOwnProps=!0,s.mapToProps=function(o,l){s.mapToProps=n,s.dependsOnOwnProps=a_(n);var c=s(o,l);return typeof c=="function"&&(s.mapToProps=c,s.dependsOnOwnProps=a_(c),c=s(o,l)),c},s}}function i3(n){return typeof n=="function"?aE(n):void 0}function s3(n){return n?void 0:Ly(function(e){return{dispatch:e}})}function a3(n){return n&&typeof n=="object"?Ly(function(e){return r3(n,e)}):void 0}var o3=[i3,s3,a3];function l3(n){return typeof n=="function"?aE(n):void 0}function c3(n){return n?void 0:Ly(function(){return{}})}var u3=[l3,c3];function d3(n,e,t){return zl({},t,n,e)}function h3(n){return function(t,r){r.displayName;var i=r.pure,s=r.areMergedPropsEqual,a=!1,o;return function(c,u,h){var d=n(c,u,h);return a?(!i||!s(d,o))&&(o=d):(a=!0,o=d),o}}}function f3(n){return typeof n=="function"?h3(n):void 0}function p3(n){return n?void 0:function(){return d3}}var m3=[f3,p3],g3=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function v3(n,e,t,r){return function(s,a){return t(n(s,a),e(r,a),a)}}function y3(n,e,t,r,i){var s=i.areStatesEqual,a=i.areOwnPropsEqual,o=i.areStatePropsEqual,l=!1,c,u,h,d,f;function v(x,w){return c=x,u=w,h=n(c,u),d=e(r,u),f=t(h,d,u),l=!0,f}function g(){return h=n(c,u),e.dependsOnOwnProps&&(d=e(r,u)),f=t(h,d,u),f}function y(){return n.dependsOnOwnProps&&(h=n(c,u)),e.dependsOnOwnProps&&(d=e(r,u)),f=t(h,d,u),f}function p(){var x=n(c,u),w=!o(x,h);return h=x,w&&(f=t(h,d,u)),f}function m(x,w){var b=!a(w,u),C=!s(x,c);return c=x,u=w,b&&C?g():b?y():C?p():f}return function(w,b){return l?m(w,b):v(w,b)}}function x3(n,e){var t=e.initMapStateToProps,r=e.initMapDispatchToProps,i=e.initMergeProps,s=Hf(e,g3),a=t(n,s),o=r(n,s),l=i(n,s),c=s.pure?y3:v3;return c(a,o,l,n,s)}var w3=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function jm(n,e,t){for(var r=e.length-1;r>=0;r--){var i=e[r](n);if(i)return i}return function(s,a){throw new Error("Invalid value of type "+typeof n+" for "+t+" argument when connecting component "+a.wrappedComponentName+".")}}function _3(n,e){return n===e}function b3(n){var e=n===void 0?{}:n,t=e.connectHOC,r=t===void 0?n3:t,i=e.mapStateToPropsFactories,s=i===void 0?u3:i,a=e.mapDispatchToPropsFactories,o=a===void 0?o3:a,l=e.mergePropsFactories,c=l===void 0?m3:l,u=e.selectorFactory,h=u===void 0?x3:u;return function(f,v,g,y){y===void 0&&(y={});var p=y,m=p.pure,x=m===void 0?!0:m,w=p.areStatesEqual,b=w===void 0?_3:w,C=p.areOwnPropsEqual,A=C===void 0?Vm:C,F=p.areStatePropsEqual,N=F===void 0?Vm:F,O=p.areMergedPropsEqual,H=O===void 0?Vm:O,D=Hf(p,w3),U=jm(f,s,"mapStateToProps"),_=jm(v,o,"mapDispatchToProps"),z=jm(g,c,"mergeProps");return r(h,zl({methodName:"connect",getDisplayName:function(R){return"Connect("+R+")"},shouldHandleStateChanges:Boolean(f),initMapStateToProps:U,initMapDispatchToProps:_,initMergeProps:z,pure:x,areStatesEqual:b,areOwnPropsEqual:A,areStatePropsEqual:N,areMergedPropsEqual:H},D))}}var oE=b3();function lE(){var n=I.exports.useContext(vs);return n}function cE(n){n===void 0&&(n=vs);var e=n===vs?lE:function(){return I.exports.useContext(n)};return function(){var r=e(),i=r.store;return i}}var S3=cE();function M3(n){n===void 0&&(n=vs);var e=n===vs?S3:cE(n);return function(){var r=e();return r.dispatch}}var uE=M3(),E3=function(e,t){return e===t};function A3(n,e,t,r){var i=I.exports.useReducer(function(v){return v+1},0),s=i[1],a=I.exports.useMemo(function(){return My(t,r)},[t,r]),o=I.exports.useRef(),l=I.exports.useRef(),c=I.exports.useRef(),u=I.exports.useRef(),h=t.getState(),d;try{if(n!==l.current||h!==c.current||o.current){var f=n(h);u.current===void 0||!e(f,u.current)?d=f:d=u.current}else d=u.current}catch(v){throw o.current&&(v.message+=`
The error may be correlated with this previous error:
`+o.current.stack+`

`),v}return Bf(function(){l.current=n,c.current=h,u.current=d,o.current=void 0}),Bf(function(){function v(){try{var g=t.getState();if(g===c.current)return;var y=l.current(g);if(e(y,u.current))return;u.current=y,c.current=g}catch(p){o.current=p}s()}return a.onStateChange=v,a.trySubscribe(),v(),function(){return a.tryUnsubscribe()}},[t,a]),d}function T3(n){n===void 0&&(n=vs);var e=n===vs?lE:function(){return I.exports.useContext(n)};return function(r,i){i===void 0&&(i=E3);var s=e(),a=s.store,o=s.subscription,l=A3(r,i,a,o);return I.exports.useDebugValue(l),l}}var C3=T3();yP(aa.exports.unstable_batchedUpdates);function gi(n){for(var e=arguments.length,t=Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Yi(n){return!!n&&!!n[Gt]}function ha(n){return!!n&&(function(e){if(!e||typeof e!="object")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;var r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||typeof r=="function"&&Function.toString.call(r)===k3}(n)||Array.isArray(n)||!!n[f_]||!!n.constructor[f_]||Ry(n)||Fy(n))}function ro(n,e,t){t===void 0&&(t=!1),nc(n)===0?(t?Object.keys:Ml)(n).forEach(function(r){t&&typeof r=="symbol"||e(r,n[r],n)}):n.forEach(function(r,i){return e(i,r,n)})}function nc(n){var e=n[Gt];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:Ry(n)?2:Fy(n)?3:0}function Sl(n,e){return nc(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function P3(n,e){return nc(n)===2?n.get(e):n[e]}function dE(n,e,t){var r=nc(n);r===2?n.set(e,t):r===3?(n.delete(e),n.add(t)):n[e]=t}function hE(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function Ry(n){return D3&&n instanceof Map}function Fy(n){return N3&&n instanceof Set}function Na(n){return n.o||n.t}function Dy(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=mE(n);delete e[Gt];for(var t=Ml(e),r=0;r<t.length;r++){var i=t[r],s=e[i];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),e)}function Ny(n,e){return e===void 0&&(e=!1),ky(n)||Yi(n)||!ha(n)||(nc(n)>1&&(n.set=n.add=n.clear=n.delete=I3),Object.freeze(n),e&&ro(n,function(t,r){return Ny(r,!0)},!0)),n}function I3(){gi(2)}function ky(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function Xi(n){var e=$v[n];return e||gi(18,n),e}function L3(n,e){$v[n]||($v[n]=e)}function Wv(){return $u}function Wm(n,e){e&&(Xi("Patches"),n.u=[],n.s=[],n.v=e)}function Gf(n){Xv(n),n.p.forEach(R3),n.p=null}function Xv(n){n===$u&&($u=n.l)}function o_(n){return $u={p:[],l:$u,h:n,m:!0,_:0}}function R3(n){var e=n[Gt];e.i===0||e.i===1?e.j():e.O=!0}function Xm(n,e){e._=e.p.length;var t=e.p[0],r=n!==void 0&&n!==t;return e.h.g||Xi("ES5").S(e,n,r),r?(t[Gt].P&&(Gf(e),gi(4)),ha(n)&&(n=Vf(e,n),e.l||jf(e,n)),e.u&&Xi("Patches").M(t[Gt].t,n,e.u,e.s)):n=Vf(e,t,[]),Gf(e),e.u&&e.v(e.u,e.s),n!==pE?n:void 0}function Vf(n,e,t){if(ky(e))return e;var r=e[Gt];if(!r)return ro(e,function(s,a){return l_(n,r,e,s,a,t)},!0),e;if(r.A!==n)return e;if(!r.P)return jf(n,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=Dy(r.k):r.o;ro(r.i===3?new Set(i):i,function(s,a){return l_(n,r,i,s,a,t)}),jf(n,i,!1),t&&n.u&&Xi("Patches").R(r,t,n.u,n.s)}return r.o}function l_(n,e,t,r,i,s){if(Yi(i)){var a=Vf(n,i,s&&e&&e.i!==3&&!Sl(e.D,r)?s.concat(r):void 0);if(dE(t,r,a),!Yi(a))return;n.m=!1}if(ha(i)&&!ky(i)){if(!n.h.F&&n._<1)return;Vf(n,i),e&&e.A.l||jf(n,i)}}function jf(n,e,t){t===void 0&&(t=!1),n.h.F&&n.m&&Ny(e,t)}function Ym(n,e){var t=n[Gt];return(t?Na(t):n)[e]}function c_(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=Object.getPrototypeOf(t)}}function Os(n){n.P||(n.P=!0,n.l&&Os(n.l))}function $m(n){n.o||(n.o=Dy(n.t))}function Yv(n,e,t){var r=Ry(e)?Xi("MapSet").N(e,t):Fy(e)?Xi("MapSet").T(e,t):n.g?function(i,s){var a=Array.isArray(i),o={i:a?1:0,A:s?s.A:Wv(),P:!1,I:!1,D:{},l:s,t:i,k:null,o:null,j:null,C:!1},l=o,c=Zu;a&&(l=[o],c=eu);var u=Proxy.revocable(l,c),h=u.revoke,d=u.proxy;return o.k=d,o.j=h,d}(e,t):Xi("ES5").J(e,t);return(t?t.A:Wv()).p.push(r),r}function fE(n){return Yi(n)||gi(22,n),function e(t){if(!ha(t))return t;var r,i=t[Gt],s=nc(t);if(i){if(!i.P&&(i.i<4||!Xi("ES5").K(i)))return i.t;i.I=!0,r=u_(t,s),i.I=!1}else r=u_(t,s);return ro(r,function(a,o){i&&P3(i.t,a)===o||dE(r,a,e(o))}),s===3?new Set(r):r}(n)}function u_(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return Dy(n)}function F3(){function n(s,a){var o=i[s];return o?o.enumerable=a:i[s]=o={configurable:!0,enumerable:a,get:function(){var l=this[Gt];return Zu.get(l,s)},set:function(l){var c=this[Gt];Zu.set(c,s,l)}},o}function e(s){for(var a=s.length-1;a>=0;a--){var o=s[a][Gt];if(!o.P)switch(o.i){case 5:r(o)&&Os(o);break;case 4:t(o)&&Os(o)}}}function t(s){for(var a=s.t,o=s.k,l=Ml(o),c=l.length-1;c>=0;c--){var u=l[c];if(u!==Gt){var h=a[u];if(h===void 0&&!Sl(a,u))return!0;var d=o[u],f=d&&d[Gt];if(f?f.t!==h:!hE(d,h))return!0}}var v=!!a[Gt];return l.length!==Ml(a).length+(v?0:1)}function r(s){var a=s.k;if(a.length!==s.t.length)return!0;var o=Object.getOwnPropertyDescriptor(a,a.length-1);if(o&&!o.get)return!0;for(var l=0;l<a.length;l++)if(!a.hasOwnProperty(l))return!0;return!1}var i={};L3("ES5",{J:function(s,a){var o=Array.isArray(s),l=function(u,h){if(u){for(var d=Array(h.length),f=0;f<h.length;f++)Object.defineProperty(d,""+f,n(f,!0));return d}var v=mE(h);delete v[Gt];for(var g=Ml(v),y=0;y<g.length;y++){var p=g[y];v[p]=n(p,u||!!v[p].enumerable)}return Object.create(Object.getPrototypeOf(h),v)}(o,s),c={i:o?5:4,A:a?a.A:Wv(),P:!1,I:!1,D:{},l:a,t:s,k:l,o:null,O:!1,C:!1};return Object.defineProperty(l,Gt,{value:c,writable:!0}),l},S:function(s,a,o){o?Yi(a)&&a[Gt].A===s&&e(s.p):(s.u&&function l(c){if(c&&typeof c=="object"){var u=c[Gt];if(u){var h=u.t,d=u.k,f=u.D,v=u.i;if(v===4)ro(d,function(x){x!==Gt&&(h[x]!==void 0||Sl(h,x)?f[x]||l(d[x]):(f[x]=!0,Os(u)))}),ro(h,function(x){d[x]!==void 0||Sl(d,x)||(f[x]=!1,Os(u))});else if(v===5){if(r(u)&&(Os(u),f.length=!0),d.length<h.length)for(var g=d.length;g<h.length;g++)f[g]=!1;else for(var y=h.length;y<d.length;y++)f[y]=!0;for(var p=Math.min(d.length,h.length),m=0;m<p;m++)d.hasOwnProperty(m)||(f[m]=!0),f[m]===void 0&&l(d[m])}}}}(s.p[0]),e(s.p))},K:function(s){return s.i===4?t(s):r(s)}})}var d_,$u,Oy=typeof Symbol!="undefined"&&typeof Symbol("x")=="symbol",D3=typeof Map!="undefined",N3=typeof Set!="undefined",h_=typeof Proxy!="undefined"&&Proxy.revocable!==void 0&&typeof Reflect!="undefined",pE=Oy?Symbol.for("immer-nothing"):((d_={})["immer-nothing"]=!0,d_),f_=Oy?Symbol.for("immer-draftable"):"__$immer_draftable",Gt=Oy?Symbol.for("immer-state"):"__$immer_state",k3=""+Object.prototype.constructor,Ml=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,mE=Object.getOwnPropertyDescriptors||function(n){var e={};return Ml(n).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)}),e},$v={},Zu={get:function(n,e){if(e===Gt)return n;var t=Na(n);if(!Sl(t,e))return function(i,s,a){var o,l=c_(s,a);return l?"value"in l?l.value:(o=l.get)===null||o===void 0?void 0:o.call(i.k):void 0}(n,t,e);var r=t[e];return n.I||!ha(r)?r:r===Ym(n.t,e)?($m(n),n.o[e]=Yv(n.A.h,r,n)):r},has:function(n,e){return e in Na(n)},ownKeys:function(n){return Reflect.ownKeys(Na(n))},set:function(n,e,t){var r=c_(Na(n),e);if(r!=null&&r.set)return r.set.call(n.k,t),!0;if(!n.P){var i=Ym(Na(n),e),s=i==null?void 0:i[Gt];if(s&&s.t===t)return n.o[e]=t,n.D[e]=!1,!0;if(hE(t,i)&&(t!==void 0||Sl(n.t,e)))return!0;$m(n),Os(n)}return n.o[e]===t&&typeof t!="number"&&(t!==void 0||e in n.o)||(n.o[e]=t,n.D[e]=!0,!0)},deleteProperty:function(n,e){return Ym(n.t,e)!==void 0||e in n.t?(n.D[e]=!1,$m(n),Os(n)):delete n.D[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=Na(n),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty:function(){gi(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){gi(12)}},eu={};ro(Zu,function(n,e){eu[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),eu.deleteProperty=function(n,e){return eu.set.call(this,n,e,void 0)},eu.set=function(n,e,t){return Zu.set.call(this,n[0],e,t,n[0])};var O3=function(){function n(t){var r=this;this.g=h_,this.F=!0,this.produce=function(i,s,a){if(typeof i=="function"&&typeof s!="function"){var o=s;s=i;var l=r;return function(g){var y=this;g===void 0&&(g=o);for(var p=arguments.length,m=Array(p>1?p-1:0),x=1;x<p;x++)m[x-1]=arguments[x];return l.produce(g,function(w){var b;return(b=s).call.apply(b,[y,w].concat(m))})}}var c;if(typeof s!="function"&&gi(6),a!==void 0&&typeof a!="function"&&gi(7),ha(i)){var u=o_(r),h=Yv(r,i,void 0),d=!0;try{c=s(h),d=!1}finally{d?Gf(u):Xv(u)}return typeof Promise!="undefined"&&c instanceof Promise?c.then(function(g){return Wm(u,a),Xm(g,u)},function(g){throw Gf(u),g}):(Wm(u,a),Xm(c,u))}if(!i||typeof i!="object"){if((c=s(i))===void 0&&(c=i),c===pE&&(c=void 0),r.F&&Ny(c,!0),a){var f=[],v=[];Xi("Patches").M(i,c,f,v),a(f,v)}return c}gi(21,i)},this.produceWithPatches=function(i,s){if(typeof i=="function")return function(c){for(var u=arguments.length,h=Array(u>1?u-1:0),d=1;d<u;d++)h[d-1]=arguments[d];return r.produceWithPatches(c,function(f){return i.apply(void 0,[f].concat(h))})};var a,o,l=r.produce(i,s,function(c,u){a=c,o=u});return typeof Promise!="undefined"&&l instanceof Promise?l.then(function(c){return[c,a,o]}):[l,a,o]},typeof(t==null?void 0:t.useProxies)=="boolean"&&this.setUseProxies(t.useProxies),typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){ha(t)||gi(8),Yi(t)&&(t=fE(t));var r=o_(this),i=Yv(this,t,void 0);return i[Gt].C=!0,Xv(r),i},e.finishDraft=function(t,r){var i=t&&t[Gt],s=i.A;return Wm(s,r),Xm(void 0,s)},e.setAutoFreeze=function(t){this.F=t},e.setUseProxies=function(t){t&&!h_&&gi(20),this.g=t},e.applyPatches=function(t,r){var i;for(i=r.length-1;i>=0;i--){var s=r[i];if(s.path.length===0&&s.op==="replace"){t=s.value;break}}i>-1&&(r=r.slice(i+1));var a=Xi("Patches").$;return Yi(t)?a(t,r):this.produce(t,function(o){return a(o,r)})},n}(),Fr=new O3,z3=Fr.produce;Fr.produceWithPatches.bind(Fr);Fr.setAutoFreeze.bind(Fr);Fr.setUseProxies.bind(Fr);Fr.applyPatches.bind(Fr);Fr.createDraft.bind(Fr);Fr.finishDraft.bind(Fr);var xu=z3;function U3(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function p_(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function m_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?p_(Object(t),!0).forEach(function(r){U3(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):p_(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Yn(n){return"Minified Redux error #"+n+"; visit https://redux.js.org/Errors?code="+n+" for the full message or use the non-minified dev environment for full errors. "}var g_=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),Zm=function(){return Math.random().toString(36).substring(7).split("").join(".")},Wf={INIT:"@@redux/INIT"+Zm(),REPLACE:"@@redux/REPLACE"+Zm(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+Zm()}};function B3(n){if(typeof n!="object"||n===null)return!1;for(var e=n;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}function gE(n,e,t){var r;if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(Yn(0));if(typeof e=="function"&&typeof t=="undefined"&&(t=e,e=void 0),typeof t!="undefined"){if(typeof t!="function")throw new Error(Yn(1));return t(gE)(n,e)}if(typeof n!="function")throw new Error(Yn(2));var i=n,s=e,a=[],o=a,l=!1;function c(){o===a&&(o=a.slice())}function u(){if(l)throw new Error(Yn(3));return s}function h(g){if(typeof g!="function")throw new Error(Yn(4));if(l)throw new Error(Yn(5));var y=!0;return c(),o.push(g),function(){if(!!y){if(l)throw new Error(Yn(6));y=!1,c();var m=o.indexOf(g);o.splice(m,1),a=null}}}function d(g){if(!B3(g))throw new Error(Yn(7));if(typeof g.type=="undefined")throw new Error(Yn(8));if(l)throw new Error(Yn(9));try{l=!0,s=i(s,g)}finally{l=!1}for(var y=a=o,p=0;p<y.length;p++){var m=y[p];m()}return g}function f(g){if(typeof g!="function")throw new Error(Yn(10));i=g,d({type:Wf.REPLACE})}function v(){var g,y=h;return g={subscribe:function(m){if(typeof m!="object"||m===null)throw new Error(Yn(11));function x(){m.next&&m.next(u())}x();var w=y(x);return{unsubscribe:w}}},g[g_]=function(){return this},g}return d({type:Wf.INIT}),r={dispatch:d,subscribe:h,getState:u,replaceReducer:f},r[g_]=v,r}function H3(n){Object.keys(n).forEach(function(e){var t=n[e],r=t(void 0,{type:Wf.INIT});if(typeof r=="undefined")throw new Error(Yn(12));if(typeof t(void 0,{type:Wf.PROBE_UNKNOWN_ACTION()})=="undefined")throw new Error(Yn(13))})}function G3(n){for(var e=Object.keys(n),t={},r=0;r<e.length;r++){var i=e[r];typeof n[i]=="function"&&(t[i]=n[i])}var s=Object.keys(t),a;try{H3(t)}catch(o){a=o}return function(l,c){if(l===void 0&&(l={}),a)throw a;for(var u=!1,h={},d=0;d<s.length;d++){var f=s[d],v=t[f],g=l[f],y=v(g,c);if(typeof y=="undefined")throw c&&c.type,new Error(Yn(14));h[f]=y,u=u||y!==g}return u=u||s.length!==Object.keys(l).length,u?h:l}}function Xf(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return e.length===0?function(r){return r}:e.length===1?e[0]:e.reduce(function(r,i){return function(){return r(i.apply(void 0,arguments))}})}function V3(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(r){return function(){var i=r.apply(void 0,arguments),s=function(){throw new Error(Yn(15))},a={getState:i.getState,dispatch:function(){return s.apply(void 0,arguments)}},o=e.map(function(l){return l(a)});return s=Xf.apply(void 0,o)(i.dispatch),m_(m_({},i),{},{dispatch:s})}}}var Yf="NOT_FOUND";function j3(n){var e;return{get:function(r){return e&&n(e.key,r)?e.value:Yf},put:function(r,i){e={key:r,value:i}},getEntries:function(){return e?[e]:[]},clear:function(){e=void 0}}}function W3(n,e){var t=[];function r(o){var l=t.findIndex(function(u){return e(o,u.key)});if(l>-1){var c=t[l];return l>0&&(t.splice(l,1),t.unshift(c)),c.value}return Yf}function i(o,l){r(o)===Yf&&(t.unshift({key:o,value:l}),t.length>n&&t.pop())}function s(){return t}function a(){t=[]}return{get:r,put:i,getEntries:s,clear:a}}var X3=function(e,t){return e===t};function Y3(n){return function(t,r){if(t===null||r===null||t.length!==r.length)return!1;for(var i=t.length,s=0;s<i;s++)if(!n(t[s],r[s]))return!1;return!0}}function $3(n,e){var t=typeof e=="object"?e:{equalityCheck:e},r=t.equalityCheck,i=r===void 0?X3:r,s=t.maxSize,a=s===void 0?1:s,o=t.resultEqualityCheck,l=Y3(i),c=a===1?j3(l):W3(a,l);function u(){var h=c.get(arguments);if(h===Yf){if(h=n.apply(null,arguments),o){var d=c.getEntries(),f=d.find(function(v){return o(v.value,h)});f&&(h=f.value)}c.put(arguments,h)}return h}return u.clearCache=function(){return c.clear()},u}function Z3(n){var e=Array.isArray(n[0])?n[0]:n;if(!e.every(function(r){return typeof r=="function"})){var t=e.map(function(r){return typeof r=="function"?"function "+(r.name||"unnamed")+"()":typeof r}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return e}function q3(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var i=function(){for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];var c=0,u,h={memoizeOptions:void 0},d=o.pop();if(typeof d=="object"&&(h=d,d=o.pop()),typeof d!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof d+"]");var f=h,v=f.memoizeOptions,g=v===void 0?t:v,y=Array.isArray(g)?g:[g],p=Z3(o),m=n.apply(void 0,[function(){return c++,d.apply(null,arguments)}].concat(y)),x=n(function(){for(var b=[],C=p.length,A=0;A<C;A++)b.push(p[A].apply(null,arguments));return u=m.apply(null,b),u});return Object.assign(x,{resultFunc:d,memoizedResultFunc:m,dependencies:p,lastResult:function(){return u},recomputations:function(){return c},resetRecomputations:function(){return c=0}}),x};return i}var Ne=q3($3);function vE(n){var e=function(r){var i=r.dispatch,s=r.getState;return function(a){return function(o){return typeof o=="function"?o(i,s,n):a(o)}}};return e}var yE=vE();yE.withExtraArgument=vE;var v_=yE,Q3=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();globalThis&&globalThis.__generator;var qu=globalThis&&globalThis.__spreadArray||function(n,e){for(var t=0,r=e.length,i=n.length;t<r;t++,i++)n[i]=e[t];return n},J3=Object.defineProperty,y_=Object.getOwnPropertySymbols,K3=Object.prototype.hasOwnProperty,eI=Object.prototype.propertyIsEnumerable,x_=function(n,e,t){return e in n?J3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t},_i=function(n,e){for(var t in e||(e={}))K3.call(e,t)&&x_(n,t,e[t]);if(y_)for(var r=0,i=y_(e);r<i.length;r++){var t=i[r];eI.call(e,t)&&x_(n,t,e[t])}return n},Ms=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ne.apply(void 0,n),r=function(i){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return t.apply(void 0,qu([Yi(i)?fE(i):i],s))};return r},tI=typeof window!="undefined"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Xf:Xf.apply(null,arguments)};function xE(n){if(typeof n!="object"||n===null)return!1;var e=Object.getPrototypeOf(n);if(e===null)return!0;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return e===t}var nI=function(n){Q3(e,n);function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=n.apply(this,t)||this;return Object.setPrototypeOf(i,e.prototype),i}return Object.defineProperty(e,Symbol.species,{get:function(){return e},enumerable:!1,configurable:!0}),e.prototype.concat=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n.prototype.concat.apply(this,t)},e.prototype.prepend=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.length===1&&Array.isArray(t[0])?new(e.bind.apply(e,qu([void 0],t[0].concat(this)))):new(e.bind.apply(e,qu([void 0],t.concat(this))))},e}(Array);function rI(n){return typeof n=="boolean"}function iI(){return function(e){return sI(e)}}function sI(n){n===void 0&&(n={});var e=n.thunk,t=e===void 0?!0:e;n.immutableCheck,n.serializableCheck;var r=new nI;return t&&(rI(t)?r.push(v_):r.push(v_.withExtraArgument(t.extraArgument))),r}var aI=!0;function oI(n){var e=iI(),t=n||{},r=t.reducer,i=r===void 0?void 0:r,s=t.middleware,a=s===void 0?e():s,o=t.devTools,l=o===void 0?!0:o,c=t.preloadedState,u=c===void 0?void 0:c,h=t.enhancers,d=h===void 0?void 0:h,f;if(typeof i=="function")f=i;else if(xE(i))f=G3(i);else throw new Error('"reducer" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');var v=a;typeof v=="function"&&(v=v(e));var g=V3.apply(void 0,v),y=Xf;l&&(y=tI(_i({trace:!aI},typeof l=="object"&&l)));var p=[g];Array.isArray(d)?p=qu([g],d):typeof d=="function"&&(p=d(p));var m=y.apply(void 0,p);return gE(f,u,m)}function io(n,e){function t(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(e){var s=e.apply(void 0,r);if(!s)throw new Error("prepareAction did not return an object");return _i(_i({type:n,payload:s.payload},"meta"in s&&{meta:s.meta}),"error"in s&&{error:s.error})}return{type:n,payload:r[0]}}return t.toString=function(){return""+n},t.type=n,t.match=function(r){return r.type===n},t}function lI(n){return xE(n)&&typeof n.type=="string"&&Object.keys(n).every(cI)}function cI(n){return["type","payload","error","meta"].indexOf(n)>-1}function wE(n){var e={},t=[],r,i={addCase:function(s,a){var o=typeof s=="string"?s:s.type;if(o in e)throw new Error("addCase cannot be called with two reducers for the same action type");return e[o]=a,i},addMatcher:function(s,a){return t.push({matcher:s,reducer:a}),i},addDefaultCase:function(s){return r=s,i}};return n(i),[e,t,r]}function uI(n){return typeof n=="function"}function dI(n,e,t,r){t===void 0&&(t=[]);var i=typeof e=="function"?wE(e):[e,t,r],s=i[0],a=i[1],o=i[2],l;if(uI(n))l=function(){return xu(n(),function(){})};else{var c=xu(n,function(){});l=function(){return c}}function u(h,d){h===void 0&&(h=l());var f=qu([s[d.type]],a.filter(function(v){var g=v.matcher;return g(d)}).map(function(v){var g=v.reducer;return g}));return f.filter(function(v){return!!v}).length===0&&(f=[o]),f.reduce(function(v,g){if(g)if(Yi(v)){var y=v,p=g(y,d);return typeof p=="undefined"?v:p}else{if(ha(v))return xu(v,function(m){return g(m,d)});var p=g(v,d);if(typeof p=="undefined"){if(v===null)return v;throw Error("A case reducer on a non-draftable value must not return undefined")}return p}return v},h)}return u.getInitialState=l,u}function hI(n,e){return n+"/"+e}function zy(n){var e=n.name;if(!e)throw new Error("`name` is a required option for createSlice");var t=typeof n.initialState=="function"?n.initialState:xu(n.initialState,function(){}),r=n.reducers||{},i=Object.keys(r),s={},a={},o={};i.forEach(function(u){var h=r[u],d=hI(e,u),f,v;"reducer"in h?(f=h.reducer,v=h.prepare):f=h,s[u]=f,a[d]=f,o[u]=v?io(d,v):io(d)});function l(){var u=typeof n.extraReducers=="function"?wE(n.extraReducers):[n.extraReducers],h=u[0],d=h===void 0?{}:h,f=u[1],v=f===void 0?[]:f,g=u[2],y=g===void 0?void 0:g,p=_i(_i({},d),a);return dI(t,p,v,y)}var c;return{name:e,reducer:function(u,h){return c||(c=l()),c(u,h)},actions:o,caseReducers:s,getInitialState:function(){return c||(c=l()),c.getInitialState()}}}function fI(){return{ids:[],entities:{}}}function pI(){function n(e){return e===void 0&&(e={}),Object.assign(fI(),e)}return{getInitialState:n}}function mI(){function n(e){var t=function(c){return c.ids},r=function(c){return c.entities},i=Ms(t,r,function(c,u){return c.map(function(h){return u[h]})}),s=function(c,u){return u},a=function(c,u){return c[u]},o=Ms(t,function(c){return c.length});if(!e)return{selectIds:t,selectEntities:r,selectAll:i,selectTotal:o,selectById:Ms(r,s,a)};var l=Ms(e,r);return{selectIds:Ms(e,t),selectEntities:l,selectAll:Ms(e,i),selectTotal:Ms(e,o),selectById:Ms(l,s,a)}}return{getSelectors:n}}function gI(n){var e=nn(function(t,r){return n(r)});return function(r){return e(r,void 0)}}function nn(n){return function(t,r){function i(a){return lI(a)}var s=function(a){i(r)?n(r.payload,a):n(r,a)};return Yi(t)?(s(t),t):xu(t,s)}}function El(n,e){var t=e(n);return t}function qa(n){return Array.isArray(n)||(n=Object.values(n)),n}function _E(n,e,t){n=qa(n);for(var r=[],i=[],s=0,a=n;s<a.length;s++){var o=a[s],l=El(o,e);l in t.entities?i.push({id:l,changes:o}):r.push(o)}return[r,i]}function bE(n){function e(v,g){var y=El(v,n);y in g.entities||(g.ids.push(y),g.entities[y]=v)}function t(v,g){v=qa(v);for(var y=0,p=v;y<p.length;y++){var m=p[y];e(m,g)}}function r(v,g){var y=El(v,n);y in g.entities||g.ids.push(y),g.entities[y]=v}function i(v,g){v=qa(v);for(var y=0,p=v;y<p.length;y++){var m=p[y];r(m,g)}}function s(v,g){v=qa(v),g.ids=[],g.entities={},t(v,g)}function a(v,g){return o([v],g)}function o(v,g){var y=!1;v.forEach(function(p){p in g.entities&&(delete g.entities[p],y=!0)}),y&&(g.ids=g.ids.filter(function(p){return p in g.entities}))}function l(v){Object.assign(v,{ids:[],entities:{}})}function c(v,g,y){var p=y.entities[g.id],m=Object.assign({},p,g.changes),x=El(m,n),w=x!==g.id;return w&&(v[g.id]=x,delete y.entities[g.id]),y.entities[x]=m,w}function u(v,g){return h([v],g)}function h(v,g){var y={},p={};v.forEach(function(w){w.id in g.entities&&(p[w.id]={id:w.id,changes:_i(_i({},p[w.id]?p[w.id].changes:null),w.changes)})}),v=Object.values(p);var m=v.length>0;if(m){var x=v.filter(function(w){return c(y,w,g)}).length>0;x&&(g.ids=g.ids.map(function(w){return y[w]||w}))}}function d(v,g){return f([v],g)}function f(v,g){var y=_E(v,n,g),p=y[0],m=y[1];h(m,g),t(p,g)}return{removeAll:gI(l),addOne:nn(e),addMany:nn(t),setOne:nn(r),setMany:nn(i),setAll:nn(s),updateOne:nn(u),updateMany:nn(h),upsertOne:nn(d),upsertMany:nn(f),removeOne:nn(a),removeMany:nn(o)}}function vI(n,e){var t=bE(n),r=t.removeOne,i=t.removeMany,s=t.removeAll;function a(m,x){return o([m],x)}function o(m,x){m=qa(m);var w=m.filter(function(b){return!(El(b,n)in x.entities)});w.length!==0&&p(w,x)}function l(m,x){return c([m],x)}function c(m,x){m=qa(m),m.length!==0&&p(m,x)}function u(m,x){m=qa(m),x.entities={},x.ids=[],o(m,x)}function h(m,x){return f([m],x)}function d(m,x,w){if(!(x.id in w.entities))return!1;var b=w.entities[x.id],C=Object.assign({},b,x.changes),A=El(C,n);return delete w.entities[x.id],m.push(C),A!==x.id}function f(m,x){var w=[];m.forEach(function(b){return d(w,b,x)}),w.length!==0&&p(w,x)}function v(m,x){return g([m],x)}function g(m,x){var w=_E(m,n,x),b=w[0],C=w[1];f(C,x),o(b,x)}function y(m,x){if(m.length!==x.length)return!1;for(var w=0;w<m.length&&w<x.length;w++)if(m[w]!==x[w])return!1;return!0}function p(m,x){m.forEach(function(A){x.entities[n(A)]=A});var w=Object.values(x.entities);w.sort(e);var b=w.map(n),C=x.ids;y(C,b)||(x.ids=b)}return{removeOne:r,removeMany:i,removeAll:s,addOne:nn(a),updateOne:nn(h),upsertOne:nn(v),setOne:nn(l),setMany:nn(c),setAll:nn(u),addMany:nn(o),updateMany:nn(f),upsertMany:nn(g)}}function tr(n){n===void 0&&(n={});var e=_i({sortComparer:!1,selectId:function(o){return o.id}},n),t=e.selectId,r=e.sortComparer,i=pI(),s=mI(),a=r?vI(t,r):bE(t);return _i(_i(_i({selectId:t,sortComparer:r},i),s),a)}var Uy="listenerMiddleware";io(Uy+"/add");io(Uy+"/removeAll");io(Uy+"/remove");F3();var Le=(n=>(n[n.None=0]="None",n[n.Translate=1]="Translate",n[n.Rotate=2]="Rotate",n[n.LesEdit=3]="LesEdit",n[n.InsertPosition=4]="InsertPosition",n[n.Measurement=5]="Measurement",n[n.ScaleLeo=6]="ScaleLeo",n[n.EditJoint=7]="EditJoint",n))(Le||{});const zs=tr({selectId:n=>n}),ps=zs.getSelectors(),Tr=tr({selectId:n=>n.index}),ei=Tr.getSelectors(),Dt=tr({selectId:n=>n.id}),sn=Dt.getSelectors();var Nt=(n=>(n[n.None=0]="None",n[n.CreateLeo=1]="CreateLeo",n[n.SelectParts=2]="SelectParts",n[n.SelectFaces=3]="SelectFaces",n[n.EditLesFaces=4]="EditLesFaces",n))(Nt||{});const Wa=tr({selectId:n=>n}),Ul=Wa.getSelectors(),Ds=tr({selectId:n=>n.id}),Qa=Ds.getSelectors();/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const SE="133",wo={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},_o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},yI=0,w_=1,xI=2,ME=1,wI=2,tu=3,Bl=0,un=1,Un=2,EE=1,Qr=0,wu=1,__=2,b_=3,S_=4,_I=5,Qo=100,bI=101,SI=102,M_=103,E_=104,MI=200,EI=201,AI=202,TI=203,AE=204,TE=205,CI=206,PI=207,II=208,LI=209,RI=210,FI=0,DI=1,NI=2,Zv=3,kI=4,OI=5,zI=6,UI=7,Vp=0,BI=1,HI=2,Ja=0,GI=1,VI=2,jI=3,WI=4,XI=5,CE=300,jp=301,Wp=302,qv=303,Qv=304,Xp=306,By=307,$f=1e3,Pr=1001,Jv=1002,xn=1003,A_=1004,T_=1005,_n=1006,YI=1007,Yp=1008,fa=1009,$I=1010,ZI=1011,Zf=1012,qI=1013,lf=1014,Us=1015,Al=1016,QI=1017,JI=1018,KI=1019,_u=1020,eL=1021,Tl=1022,bn=1023,tL=1024,nL=1025,rL=bn,Cl=1026,Qu=1027,iL=1028,sL=1029,aL=1030,oL=1031,lL=1032,cL=1033,C_=33776,P_=33777,I_=33778,L_=33779,R_=35840,F_=35841,D_=35842,N_=35843,uL=36196,k_=37492,O_=37496,dL=37808,hL=37809,fL=37810,pL=37811,mL=37812,gL=37813,vL=37814,yL=37815,xL=37816,wL=37817,_L=37818,bL=37819,SL=37820,ML=37821,EL=36492,AL=37840,TL=37841,CL=37842,PL=37843,IL=37844,LL=37845,RL=37846,FL=37847,DL=37848,NL=37849,kL=37850,OL=37851,zL=37852,UL=37853,BL=2200,HL=2201,GL=2202,qf=2300,Qf=2301,qm=2302,il=2400,sl=2401,Jf=2402,Hy=2500,PE=2501,VL=0,Kn=3e3,fo=3001,Gy=3007,Vy=3002,jL=3003,IE=3004,LE=3005,RE=3006,WL=3200,jy=3201,rc=0,XL=1,Qm=7680,YL=519,Ju=35044,Kf=35048,z_="300 es";class Ma{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,e);e.target=null}}}let nh=1234567;const bu=Math.PI/180,Ku=180/Math.PI,Ln=[];for(let n=0;n<256;n++)Ln[n]=(n<16?"0":"")+n.toString(16);const $L=typeof crypto!="undefined"&&"randomUUID"in crypto;function Ei(){if($L)return crypto.randomUUID().toUpperCase();const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ln[n&255]+Ln[n>>8&255]+Ln[n>>16&255]+Ln[n>>24&255]+"-"+Ln[e&255]+Ln[e>>8&255]+"-"+Ln[e>>16&15|64]+Ln[e>>24&255]+"-"+Ln[t&63|128]+Ln[t>>8&255]+"-"+Ln[t>>16&255]+Ln[t>>24&255]+Ln[r&255]+Ln[r>>8&255]+Ln[r>>16&255]+Ln[r>>24&255]).toUpperCase()}function ir(n,e,t){return Math.max(e,Math.min(t,n))}function Wy(n,e){return(n%e+e)%e}function ZL(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function qL(n,e,t){return n!==e?(t-n)/(e-n):0}function Su(n,e,t){return(1-t)*n+t*e}function QL(n,e,t,r){return Su(n,e,1-Math.exp(-t*r))}function JL(n,e=1){return e-Math.abs(Wy(n,e*2)-e)}function KL(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function eR(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function tR(n,e){return n+Math.floor(Math.random()*(e-n+1))}function nR(n,e){return n+Math.random()*(e-n)}function rR(n){return n*(.5-Math.random())}function iR(n){return n!==void 0&&(nh=n%2147483647),nh=nh*16807%2147483647,(nh-1)/2147483646}function sR(n){return n*bu}function aR(n){return n*Ku}function Kv(n){return(n&n-1)===0&&n!==0}function oR(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function FE(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function lR(n,e,t,r,i){const s=Math.cos,a=Math.sin,o=s(t/2),l=a(t/2),c=s((e+r)/2),u=a((e+r)/2),h=s((e-r)/2),d=a((e-r)/2),f=s((r-e)/2),v=a((r-e)/2);switch(i){case"XYX":n.set(o*u,l*h,l*d,o*c);break;case"YZY":n.set(l*d,o*u,l*h,o*c);break;case"ZXZ":n.set(l*h,l*d,o*u,o*c);break;case"XZX":n.set(o*u,l*v,l*f,o*c);break;case"YXY":n.set(l*f,o*u,l*v,o*c);break;case"ZYZ":n.set(l*v,l*f,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}var st=Object.freeze({__proto__:null,DEG2RAD:bu,RAD2DEG:Ku,generateUUID:Ei,clamp:ir,euclideanModulo:Wy,mapLinear:ZL,inverseLerp:qL,lerp:Su,damp:QL,pingpong:JL,smoothstep:KL,smootherstep:eR,randInt:tR,randFloat:nR,randFloatSpread:rR,seededRandom:iR,degToRad:sR,radToDeg:aR,isPowerOfTwo:Kv,ceilPowerOfTwo:oR,floorPowerOfTwo:FE,setQuaternionFromProperEuler:lR});class oe{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,r){return r!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*r-a*i+e.x,this.y=s*i+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}oe.prototype.isVector2=!0;class zn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,i,s,a,o,l,c){const u=this.elements;return u[0]=e,u[1]=i,u[2]=o,u[3]=t,u[4]=s,u[5]=l,u[6]=r,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,a=r[0],o=r[3],l=r[6],c=r[1],u=r[4],h=r[7],d=r[2],f=r[5],v=r[8],g=i[0],y=i[3],p=i[6],m=i[1],x=i[4],w=i[7],b=i[2],C=i[5],A=i[8];return s[0]=a*g+o*m+l*b,s[3]=a*y+o*x+l*C,s[6]=a*p+o*w+l*A,s[1]=c*g+u*m+h*b,s[4]=c*y+u*x+h*C,s[7]=c*p+u*w+h*A,s[2]=d*g+f*m+v*b,s[5]=d*y+f*x+v*C,s[8]=d*p+f*w+v*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return t*a*u-t*o*c-r*s*u+r*o*l+i*s*c-i*a*l}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=u*a-o*c,d=o*l-u*s,f=c*s-a*l,v=t*h+r*d+i*f;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/v;return e[0]=h*g,e[1]=(i*c-u*r)*g,e[2]=(o*r-i*a)*g,e[3]=d*g,e[4]=(u*t-i*l)*g,e[5]=(i*s-o*t)*g,e[6]=f*g,e[7]=(r*l-c*t)*g,e[8]=(a*t-r*s)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*a+c*o)+a+e,-i*c,i*l,-i*(-c*a+l*o)+o+t,0,0,1),this}scale(e,t){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),i=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],u=i[7];return i[0]=t*s+r*l,i[3]=t*a+r*c,i[6]=t*o+r*u,i[1]=-r*s+t*l,i[4]=-r*a+t*c,i[7]=-r*o+t*u,this}translate(e,t){const r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}zn.prototype.isMatrix3=!0;function DE(n){if(n.length===0)return-1/0;let e=n[0];for(let t=1,r=n.length;t<r;++t)n[t]>e&&(e=n[t]);return e}function $p(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}let bo;class ic{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{bo===void 0&&(bo=$p("canvas")),bo.width=e.width,bo.height=e.height;const r=bo.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=bo}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let cR=0;class Hn extends Ma{constructor(e=Hn.DEFAULT_IMAGE,t=Hn.DEFAULT_MAPPING,r=Pr,i=Pr,s=_n,a=Yp,o=bn,l=fa,c=1,u=Kn){super(),Object.defineProperty(this,"id",{value:cR++}),this.uuid=Ei(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new oe(0,0),this.repeat=new oe(1,1),this.center=new oe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new zn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const i=this.image;if(i.uuid===void 0&&(i.uuid=Ei()),!t&&e.images[i.uuid]===void 0){let s;if(Array.isArray(i)){s=[];for(let a=0,o=i.length;a<o;a++)i[a].isDataTexture?s.push(Jm(i[a].image)):s.push(Jm(i[a]))}else s=Jm(i);e.images[i.uuid]={uuid:i.uuid,url:s}}r.image=i.uuid}return t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==CE)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case $f:e.x=e.x-Math.floor(e.x);break;case Pr:e.x=e.x<0?0:1;break;case Jv:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case $f:e.y=e.y-Math.floor(e.y);break;case Pr:e.y=e.y<0?0:1;break;case Jv:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}Hn.DEFAULT_IMAGE=void 0;Hn.DEFAULT_MAPPING=CE;Hn.prototype.isTexture=!0;function Jm(n){return typeof HTMLImageElement!="undefined"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&n instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&n instanceof ImageBitmap?ic.getDataURL(n):n.data?{data:Array.prototype.slice.call(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Tt{constructor(e=0,t=0,r=0,i=1){this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*s,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*s,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*s,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],f=l[5],v=l[9],g=l[2],y=l[6],p=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-g)<.01&&Math.abs(v-y)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+g)<.1&&Math.abs(v+y)<.1&&Math.abs(c+f+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(c+1)/2,w=(f+1)/2,b=(p+1)/2,C=(u+d)/4,A=(h+g)/4,F=(v+y)/4;return x>w&&x>b?x<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(x),i=C/r,s=A/r):w>b?w<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(w),r=C/i,s=F/i):b<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(b),r=A/s,i=F/s),this.set(r,i,s,t),this}let m=Math.sqrt((y-v)*(y-v)+(h-g)*(h-g)+(d-u)*(d-u));return Math.abs(m)<.001&&(m=1),this.x=(y-v)/m,this.y=(h-g)/m,this.z=(d-u)/m,this.w=Math.acos((c+f+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,r){return r!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Tt.prototype.isVector4=!0;class dn extends Ma{constructor(e,t,r={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Tt(0,0,e,t),this.scissorTest=!1,this.viewport=new Tt(0,0,e,t),this.texture=new Hn(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:_n,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}dn.prototype.isWebGLRenderTarget=!0;class uR extends dn{constructor(e,t,r){super(e,t);const i=this.texture;this.texture=[];for(let s=0;s<r;s++)this.texture[s]=i.clone()}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,s=this.texture.length;i<s;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,r=e.texture.length;t<r;t++)this.texture[t]=e.texture[t].clone();return this}}uR.prototype.isWebGLMultipleRenderTargets=!0;class NE extends dn{constructor(e,t,r){super(e,t,r),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}NE.prototype.isWebGLMultisampleRenderTarget=!0;class qe{constructor(e=0,t=0,r=0,i=1){this._x=e,this._y=t,this._z=r,this._w=i}static slerp(e,t,r,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(e,t,i)}static slerpFlat(e,t,r,i,s,a,o){let l=r[i+0],c=r[i+1],u=r[i+2],h=r[i+3];const d=s[a+0],f=s[a+1],v=s[a+2],g=s[a+3];if(o===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(o===1){e[t+0]=d,e[t+1]=f,e[t+2]=v,e[t+3]=g;return}if(h!==g||l!==d||c!==f||u!==v){let y=1-o;const p=l*d+c*f+u*v+h*g,m=p>=0?1:-1,x=1-p*p;if(x>Number.EPSILON){const b=Math.sqrt(x),C=Math.atan2(b,p*m);y=Math.sin(y*C)/b,o=Math.sin(o*C)/b}const w=o*m;if(l=l*y+d*w,c=c*y+f*w,u=u*y+v*w,h=h*y+g*w,y===1-o){const b=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=b,c*=b,u*=b,h*=b}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,s,a){const o=r[i],l=r[i+1],c=r[i+2],u=r[i+3],h=s[a],d=s[a+1],f=s[a+2],v=s[a+3];return e[t]=o*v+u*h+l*f-c*d,e[t+1]=l*v+u*d+c*h-o*f,e[t+2]=c*v+u*f+o*d-l*h,e[t+3]=u*v-o*h-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const r=e._x,i=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(r/2),u=o(i/2),h=o(s/2),d=l(r/2),f=l(i/2),v=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*f*v,this._y=c*f*h-d*u*v,this._z=c*u*v+d*f*h,this._w=c*u*h-d*f*v;break;case"YXZ":this._x=d*u*h+c*f*v,this._y=c*f*h-d*u*v,this._z=c*u*v-d*f*h,this._w=c*u*h+d*f*v;break;case"ZXY":this._x=d*u*h-c*f*v,this._y=c*f*h+d*u*v,this._z=c*u*v+d*f*h,this._w=c*u*h-d*f*v;break;case"ZYX":this._x=d*u*h-c*f*v,this._y=c*f*h+d*u*v,this._z=c*u*v-d*f*h,this._w=c*u*h+d*f*v;break;case"YZX":this._x=d*u*h+c*f*v,this._y=c*f*h+d*u*v,this._z=c*u*v-d*f*h,this._w=c*u*h-d*f*v;break;case"XZY":this._x=d*u*h-c*f*v,this._y=c*f*h-d*u*v,this._z=c*u*v+d*f*h,this._w=c*u*h+d*f*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],a=t[1],o=t[5],l=t[9],c=t[2],u=t[6],h=t[10],d=r+o+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(a-i)*f}else if(r>o&&r>h){const f=2*Math.sqrt(1+r-o-h);this._w=(u-l)/f,this._x=.25*f,this._y=(i+a)/f,this._z=(s+c)/f}else if(o>h){const f=2*Math.sqrt(1+o-r-h);this._w=(s-c)/f,this._x=(i+a)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-r-o);this._w=(a-i)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ir(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,a=e._w,o=t._x,l=t._y,c=t._z,u=t._w;return this._x=r*u+a*o+i*c-s*l,this._y=i*u+a*l+s*o-r*c,this._z=s*u+a*c+r*l-i*o,this._w=a*u-r*o-i*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,a=this._w;let o=a*e._w+r*e._x+i*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=i,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-t;return this._w=f*a+t*this._w,this._x=f*r+t*this._x,this._y=f*i+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=i*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,r){this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(s),r*Math.cos(s),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}qe.prototype.isQuaternion=!0;class L{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(U_.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(U_.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,a=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*a,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*a,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*a,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,a=e.y,o=e.z,l=e.w,c=l*t+a*i-o*r,u=l*r+o*t-s*i,h=l*i+s*r-a*t,d=-s*t-a*r-o*i;return this.x=c*l+d*-s+u*-o-h*-a,this.y=u*l+d*-a+h*-s-c*-o,this.z=h*l+d*-o+c*-a-u*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,a=t.x,o=t.y,l=t.z;return this.x=i*l-s*o,this.y=s*a-r*l,this.z=r*o-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Km.copy(this).projectOnVector(e),this.sub(Km)}reflect(e){return this.sub(Km.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(ir(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,r){return r!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}L.prototype.isVector3=!0;const Km=new L,U_=new qe;class ur{constructor(e=new L(1/0,1/0,1/0),t=new L(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,r=1/0,i=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,c=e.length;l<c;l+=3){const u=e[l],h=e[l+1],d=e[l+2];u<t&&(t=u),h<r&&(r=h),d<i&&(i=d),u>s&&(s=u),h>a&&(a=h),d>o&&(o=d)}return this.min.set(t,r,i),this.max.set(s,a,o),this}setFromBufferAttribute(e){let t=1/0,r=1/0,i=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,c=e.count;l<c;l++){const u=e.getX(l),h=e.getY(l),d=e.getZ(l);u<t&&(t=u),h<r&&(r=h),d<i&&(i=d),u>s&&(s=u),h>a&&(a=h),d>o&&(o=d)}return this.min.set(t,r,i),this.max.set(s,a,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Fc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),eg.copy(t.boundingBox),eg.applyMatrix4(e.matrixWorld),this.union(eg));const r=e.children;for(let i=0,s=r.length;i<s;i++)this.expandByObject(r[i]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Fc),Fc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Dc),rh.subVectors(this.max,Dc),So.subVectors(e.a,Dc),Mo.subVectors(e.b,Dc),Eo.subVectors(e.c,Dc),Es.subVectors(Mo,So),As.subVectors(Eo,Mo),Ca.subVectors(So,Eo);let t=[0,-Es.z,Es.y,0,-As.z,As.y,0,-Ca.z,Ca.y,Es.z,0,-Es.x,As.z,0,-As.x,Ca.z,0,-Ca.x,-Es.y,Es.x,0,-As.y,As.x,0,-Ca.y,Ca.x,0];return!tg(t,So,Mo,Eo,rh)||(t=[1,0,0,0,1,0,0,0,1],!tg(t,So,Mo,Eo,rh))?!1:(ih.crossVectors(Es,As),t=[ih.x,ih.y,ih.z],tg(t,So,Mo,Eo,rh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Fc.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Fc).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ji[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ji[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ji[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ji[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ji[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ji[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ji[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ji[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ji),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ur.prototype.isBox3=!0;const Ji=[new L,new L,new L,new L,new L,new L,new L,new L],Fc=new L,eg=new ur,So=new L,Mo=new L,Eo=new L,Es=new L,As=new L,Ca=new L,Dc=new L,rh=new L,ih=new L,Pa=new L;function tg(n,e,t,r,i){for(let s=0,a=n.length-3;s<=a;s+=3){Pa.fromArray(n,s);const o=i.x*Math.abs(Pa.x)+i.y*Math.abs(Pa.y)+i.z*Math.abs(Pa.z),l=e.dot(Pa),c=t.dot(Pa),u=r.dot(Pa);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const dR=new ur,B_=new L,ng=new L,rg=new L;class sc{constructor(e=new L,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):dR.setFromPoints(e).getCenter(r);let i=0;for(let s=0,a=e.length;s<a;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){rg.subVectors(e,this.center);const t=rg.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.add(rg.multiplyScalar(i/r)),this.radius+=i}return this}union(e){return ng.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(B_.copy(e.center).add(ng)),this.expandByPoint(B_.copy(e.center).sub(ng)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ki=new L,ig=new L,sh=new L,Ts=new L,sg=new L,ah=new L,ag=new L;class po{constructor(e=new L,t=new L(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ki)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ki.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ki.copy(this.direction).multiplyScalar(t).add(this.origin),Ki.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){ig.copy(e).add(t).multiplyScalar(.5),sh.copy(t).sub(e).normalize(),Ts.copy(this.origin).sub(ig);const s=e.distanceTo(t)*.5,a=-this.direction.dot(sh),o=Ts.dot(this.direction),l=-Ts.dot(sh),c=Ts.lengthSq(),u=Math.abs(1-a*a);let h,d,f,v;if(u>0)if(h=a*l-o,d=a*o-l,v=s*u,h>=0)if(d>=-v)if(d<=v){const g=1/u;h*=g,d*=g,f=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;else d<=-v?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c):d<=v?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;return r&&r.copy(this.direction).multiplyScalar(h).add(this.origin),i&&i.copy(sh).multiplyScalar(d).add(ig),f}intersectSphere(e,t){Ki.subVectors(e.center,this.origin);const r=Ki.dot(this.direction),i=Ki.dot(Ki)-r*r,s=e.radius*e.radius;if(i>s)return null;const a=Math.sqrt(s-i),o=r-a,l=r+a;return o<0&&l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(r=(e.min.x-d.x)*c,i=(e.max.x-d.x)*c):(r=(e.max.x-d.x)*c,i=(e.min.x-d.x)*c),u>=0?(s=(e.min.y-d.y)*u,a=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,a=(e.min.y-d.y)*u),r>a||s>i||((s>r||r!==r)&&(r=s),(a<i||i!==i)&&(i=a),h>=0?(o=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(o=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),r>l||o>i)||((o>r||r!==r)&&(r=o),(l<i||i!==i)&&(i=l),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,Ki)!==null}intersectTriangle(e,t,r,i,s){sg.subVectors(t,e),ah.subVectors(r,e),ag.crossVectors(sg,ah);let a=this.direction.dot(ag),o;if(a>0){if(i)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Ts.subVectors(this.origin,e);const l=o*this.direction.dot(ah.crossVectors(Ts,ah));if(l<0)return null;const c=o*this.direction.dot(sg.cross(Ts));if(c<0||l+c>a)return null;const u=-o*Ts.dot(ag);return u<0?null:this.at(u/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ze{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,i,s,a,o,l,c,u,h,d,f,v,g,y){const p=this.elements;return p[0]=e,p[4]=t,p[8]=r,p[12]=i,p[1]=s,p[5]=a,p[9]=o,p[13]=l,p[2]=c,p[6]=u,p[10]=h,p[14]=d,p[3]=f,p[7]=v,p[11]=g,p[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ze().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Ao.setFromMatrixColumn(e,0).length(),s=1/Ao.setFromMatrixColumn(e,1).length(),a=1/Ao.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,r=e.x,i=e.y,s=e.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(i),c=Math.sin(i),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=a*u,f=a*h,v=o*u,g=o*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=f+v*c,t[5]=d-g*c,t[9]=-o*l,t[2]=g-d*c,t[6]=v+f*c,t[10]=a*l}else if(e.order==="YXZ"){const d=l*u,f=l*h,v=c*u,g=c*h;t[0]=d+g*o,t[4]=v*o-f,t[8]=a*c,t[1]=a*h,t[5]=a*u,t[9]=-o,t[2]=f*o-v,t[6]=g+d*o,t[10]=a*l}else if(e.order==="ZXY"){const d=l*u,f=l*h,v=c*u,g=c*h;t[0]=d-g*o,t[4]=-a*h,t[8]=v+f*o,t[1]=f+v*o,t[5]=a*u,t[9]=g-d*o,t[2]=-a*c,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const d=a*u,f=a*h,v=o*u,g=o*h;t[0]=l*u,t[4]=v*c-f,t[8]=d*c+g,t[1]=l*h,t[5]=g*c+d,t[9]=f*c-v,t[2]=-c,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const d=a*l,f=a*c,v=o*l,g=o*c;t[0]=l*u,t[4]=g-d*h,t[8]=v*h+f,t[1]=h,t[5]=a*u,t[9]=-o*u,t[2]=-c*u,t[6]=f*h+v,t[10]=d-g*h}else if(e.order==="XZY"){const d=a*l,f=a*c,v=o*l,g=o*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=d*h+g,t[5]=a*u,t[9]=f*h-v,t[2]=v*h-f,t[6]=o*u,t[10]=g*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(hR,e,fR)}lookAt(e,t,r){const i=this.elements;return br.subVectors(e,t),br.lengthSq()===0&&(br.z=1),br.normalize(),Cs.crossVectors(r,br),Cs.lengthSq()===0&&(Math.abs(r.z)===1?br.x+=1e-4:br.z+=1e-4,br.normalize(),Cs.crossVectors(r,br)),Cs.normalize(),oh.crossVectors(br,Cs),i[0]=Cs.x,i[4]=oh.x,i[8]=br.x,i[1]=Cs.y,i[5]=oh.y,i[9]=br.y,i[2]=Cs.z,i[6]=oh.z,i[10]=br.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],f=r[13],v=r[2],g=r[6],y=r[10],p=r[14],m=r[3],x=r[7],w=r[11],b=r[15],C=i[0],A=i[4],F=i[8],N=i[12],O=i[1],H=i[5],D=i[9],U=i[13],_=i[2],z=i[6],j=i[10],R=i[14],ee=i[3],J=i[7],le=i[11],k=i[15];return s[0]=a*C+o*O+l*_+c*ee,s[4]=a*A+o*H+l*z+c*J,s[8]=a*F+o*D+l*j+c*le,s[12]=a*N+o*U+l*R+c*k,s[1]=u*C+h*O+d*_+f*ee,s[5]=u*A+h*H+d*z+f*J,s[9]=u*F+h*D+d*j+f*le,s[13]=u*N+h*U+d*R+f*k,s[2]=v*C+g*O+y*_+p*ee,s[6]=v*A+g*H+y*z+p*J,s[10]=v*F+g*D+y*j+p*le,s[14]=v*N+g*U+y*R+p*k,s[3]=m*C+x*O+w*_+b*ee,s[7]=m*A+x*H+w*z+b*J,s[11]=m*F+x*D+w*j+b*le,s[15]=m*N+x*U+w*R+b*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],a=e[1],o=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],f=e[14],v=e[3],g=e[7],y=e[11],p=e[15];return v*(+s*l*h-i*c*h-s*o*d+r*c*d+i*o*f-r*l*f)+g*(+t*l*f-t*c*d+s*a*d-i*a*f+i*c*u-s*l*u)+y*(+t*c*h-t*o*f-s*a*h+r*a*f+s*o*u-r*c*u)+p*(-i*o*u-t*l*h+t*o*d+i*a*h-r*a*d+r*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],v=e[12],g=e[13],y=e[14],p=e[15],m=h*y*c-g*d*c+g*l*f-o*y*f-h*l*p+o*d*p,x=v*d*c-u*y*c-v*l*f+a*y*f+u*l*p-a*d*p,w=u*g*c-v*h*c+v*o*f-a*g*f-u*o*p+a*h*p,b=v*h*l-u*g*l-v*o*d+a*g*d+u*o*y-a*h*y,C=t*m+r*x+i*w+s*b;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/C;return e[0]=m*A,e[1]=(g*d*s-h*y*s-g*i*f+r*y*f+h*i*p-r*d*p)*A,e[2]=(o*y*s-g*l*s+g*i*c-r*y*c-o*i*p+r*l*p)*A,e[3]=(h*l*s-o*d*s-h*i*c+r*d*c+o*i*f-r*l*f)*A,e[4]=x*A,e[5]=(u*y*s-v*d*s+v*i*f-t*y*f-u*i*p+t*d*p)*A,e[6]=(v*l*s-a*y*s-v*i*c+t*y*c+a*i*p-t*l*p)*A,e[7]=(a*d*s-u*l*s+u*i*c-t*d*c-a*i*f+t*l*f)*A,e[8]=w*A,e[9]=(v*h*s-u*g*s-v*r*f+t*g*f+u*r*p-t*h*p)*A,e[10]=(a*g*s-v*o*s+v*r*c-t*g*c-a*r*p+t*o*p)*A,e[11]=(u*o*s-a*h*s-u*r*c+t*h*c+a*r*f-t*o*f)*A,e[12]=b*A,e[13]=(u*g*i-v*h*i+v*r*d-t*g*d-u*r*y+t*h*y)*A,e[14]=(v*o*i-a*g*i-v*r*l+t*g*l+a*r*y-t*o*y)*A,e[15]=(a*h*i-u*o*i+u*r*l-t*h*l-a*r*d+t*o*d)*A,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,a=e.x,o=e.y,l=e.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-i*l,c*l+i*o,0,c*o+i*l,u*o+r,u*l-i*a,0,c*l-i*o,u*l+i*a,s*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,a){return this.set(1,r,s,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,a=t._y,o=t._z,l=t._w,c=s+s,u=a+a,h=o+o,d=s*c,f=s*u,v=s*h,g=a*u,y=a*h,p=o*h,m=l*c,x=l*u,w=l*h,b=r.x,C=r.y,A=r.z;return i[0]=(1-(g+p))*b,i[1]=(f+w)*b,i[2]=(v-x)*b,i[3]=0,i[4]=(f-w)*C,i[5]=(1-(d+p))*C,i[6]=(y+m)*C,i[7]=0,i[8]=(v+x)*A,i[9]=(y-m)*A,i[10]=(1-(d+g))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=Ao.set(i[0],i[1],i[2]).length();const a=Ao.set(i[4],i[5],i[6]).length(),o=Ao.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],oi.copy(this);const c=1/s,u=1/a,h=1/o;return oi.elements[0]*=c,oi.elements[1]*=c,oi.elements[2]*=c,oi.elements[4]*=u,oi.elements[5]*=u,oi.elements[6]*=u,oi.elements[8]*=h,oi.elements[9]*=h,oi.elements[10]*=h,t.setFromRotationMatrix(oi),r.x=s,r.y=a,r.z=o,this}makePerspective(e,t,r,i,s,a){a===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,l=2*s/(t-e),c=2*s/(r-i),u=(t+e)/(t-e),h=(r+i)/(r-i),d=-(a+s)/(a-s),f=-2*a*s/(a-s);return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,r,i,s,a){const o=this.elements,l=1/(t-e),c=1/(r-i),u=1/(a-s),h=(t+e)*l,d=(r+i)*c,f=(a+s)*u;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}ze.prototype.isMatrix4=!0;const Ao=new L,oi=new ze,hR=new L(0,0,0),fR=new L(1,1,1),Cs=new L,oh=new L,br=new L,H_=new ze,G_=new qe;class sr{constructor(e=0,t=0,r=0,i=sr.DefaultOrder){this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,s=i[0],a=i[4],o=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],f=i[10];switch(t){case"XYZ":this._y=Math.asin(ir(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-ir(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(ir(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-ir(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(ir(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-ir(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return H_.makeRotationFromQuaternion(e),this.setFromRotationMatrix(H_,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return G_.setFromEuler(this),this.setFromQuaternion(G_,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new L(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}sr.prototype.isEuler=!0;sr.DefaultOrder="XYZ";sr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ac{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}}let pR=0;const V_=new L,To=new qe,es=new ze,lh=new L,Nc=new L,mR=new L,gR=new qe,j_=new L(1,0,0),W_=new L(0,1,0),X_=new L(0,0,1),vR={type:"added"},Y_={type:"removed"};class ot extends Ma{constructor(){super(),Object.defineProperty(this,"id",{value:pR++}),this.uuid=Ei(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ot.DefaultUp.clone();const e=new L,t=new sr,r=new qe,i=new L(1,1,1);function s(){r.setFromEuler(t,!1)}function a(){t.setFromQuaternion(r,void 0,!1)}t._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ze},normalMatrix:{value:new zn}}),this.matrix=new ze,this.matrixWorld=new ze,this.matrixAutoUpdate=ot.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ac,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return To.setFromAxisAngle(e,t),this.quaternion.multiply(To),this}rotateOnWorldAxis(e,t){return To.setFromAxisAngle(e,t),this.quaternion.premultiply(To),this}rotateX(e){return this.rotateOnAxis(j_,e)}rotateY(e){return this.rotateOnAxis(W_,e)}rotateZ(e){return this.rotateOnAxis(X_,e)}translateOnAxis(e,t){return V_.copy(e).applyQuaternion(this.quaternion),this.position.add(V_.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(j_,e)}translateY(e){return this.translateOnAxis(W_,e)}translateZ(e){return this.translateOnAxis(X_,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(es.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?lh.copy(e):lh.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Nc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?es.lookAt(Nc,lh,this.up):es.lookAt(lh,Nc,this.up),this.quaternion.setFromRotationMatrix(es),i&&(es.extractRotation(i.matrixWorld),To.setFromRotationMatrix(es),this.quaternion.premultiply(To.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(vR)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Y_)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Y_)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),es.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),es.multiply(e.parent.matrixWorld)),e.applyMatrix4(es),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const a=this.children[r].getObjectByProperty(e,t);if(a!==void 0)return a}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Nc,e,mR),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Nc,gR,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(e.materials,this.material[l]));i.material=o}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];i.animations.push(s(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),u=a(e.images),h=a(e.shapes),d=a(e.skeletons),f=a(e.animations);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),f.length>0&&(r.animations=f)}return r.object=i,r;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}ot.DefaultUp=new L(0,1,0);ot.DefaultMatrixAutoUpdate=!0;ot.prototype.isObject3D=!0;const li=new L,ts=new L,og=new L,ns=new L,Co=new L,Po=new L,$_=new L,lg=new L,cg=new L,ug=new L;class cn{constructor(e=new L,t=new L,r=new L){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),li.subVectors(e,t),i.cross(li);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){li.subVectors(i,t),ts.subVectors(r,t),og.subVectors(e,t);const a=li.dot(li),o=li.dot(ts),l=li.dot(og),c=ts.dot(ts),u=ts.dot(og),h=a*c-o*o;if(h===0)return s.set(-2,-1,-1);const d=1/h,f=(c*l-o*u)*d,v=(a*u-o*l)*d;return s.set(1-f-v,v,f)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,ns),ns.x>=0&&ns.y>=0&&ns.x+ns.y<=1}static getUV(e,t,r,i,s,a,o,l){return this.getBarycoord(e,t,r,i,ns),l.set(0,0),l.addScaledVector(s,ns.x),l.addScaledVector(a,ns.y),l.addScaledVector(o,ns.z),l}static isFrontFacing(e,t,r,i){return li.subVectors(r,t),ts.subVectors(e,t),li.cross(ts).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return li.subVectors(this.c,this.b),ts.subVectors(this.a,this.b),li.cross(ts).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return cn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return cn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,s){return cn.getUV(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return cn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return cn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let a,o;Co.subVectors(i,r),Po.subVectors(s,r),lg.subVectors(e,r);const l=Co.dot(lg),c=Po.dot(lg);if(l<=0&&c<=0)return t.copy(r);cg.subVectors(e,i);const u=Co.dot(cg),h=Po.dot(cg);if(u>=0&&h<=u)return t.copy(i);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),t.copy(r).addScaledVector(Co,a);ug.subVectors(e,s);const f=Co.dot(ug),v=Po.dot(ug);if(v>=0&&f<=v)return t.copy(s);const g=f*c-l*v;if(g<=0&&c>=0&&v<=0)return o=c/(c-v),t.copy(r).addScaledVector(Po,o);const y=u*v-f*h;if(y<=0&&h-u>=0&&f-v>=0)return $_.subVectors(s,i),o=(h-u)/(h-u+(f-v)),t.copy(i).addScaledVector($_,o);const p=1/(y+g+d);return a=g*p,o=d*p,t.copy(r).addScaledVector(Co,a).addScaledVector(Po,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let yR=0;class nr extends Ma{constructor(){super(),Object.defineProperty(this,"id",{value:yR++}),this.uuid=Ei(),this.name="",this.type="Material",this.fog=!0,this.blending=wu,this.side=Bl,this.vertexColors=!1,this.opacity=1,this.format=bn,this.transparent=!1,this.blendSrc=AE,this.blendDst=TE,this.blendEquation=Qo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Zv,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=YL,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Qm,this.stencilZFail=Qm,this.stencilZPass=Qm,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===EE;continue}const i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenTint&&this.sheenTint.isColor&&(r.sheenTint=this.sheenTint.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(r.specularTint=this.specularTint.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(r.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationTint!==void 0&&(r.attenuationTint=this.attenuationTint.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==wu&&(r.blending=this.blending),this.side!==Bl&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.format!==bn&&(r.format=this.format),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData);function i(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(t){const s=i(e.textures),a=i(e.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}nr.prototype.isMaterial=!0;const kE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ci={h:0,s:0,l:0},ch={h:0,s:0,l:0};function dg(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}function hg(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function fg(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}class Ce{constructor(e,t,r){return t===void 0&&r===void 0?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,r){return this.r=e,this.g=t,this.b=r,this}setHSL(e,t,r){if(e=Wy(e,1),t=ir(t,0,1),r=ir(r,0,1),t===0)this.r=this.g=this.b=r;else{const i=r<=.5?r*(1+t):r+t-r*t,s=2*r-i;this.r=dg(s,i,e+1/3),this.g=dg(s,i,e),this.b=dg(s,i,e-1/3)}return this}setStyle(e){function t(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let i;const s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const o=parseFloat(i[1])/360,l=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(o,l,c)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=r[1],s=i.length;if(s===3)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(s===6)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=kE[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=hg(e.r),this.g=hg(e.g),this.b=hg(e.b),this}copyLinearToSRGB(e){return this.r=fg(e.r),this.g=fg(e.g),this.b=fg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,r=this.g,i=this.b,s=Math.max(t,r,i),a=Math.min(t,r,i);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const u=s-a;switch(l=c<=.5?u/(s+a):u/(2-s-a),s){case t:o=(r-i)/u+(r<i?6:0);break;case r:o=(i-t)/u+2;break;case i:o=(t-r)/u+4;break}o/=6}return e.h=o,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,r){return this.getHSL(ci),ci.h+=e,ci.s+=t,ci.l+=r,this.setHSL(ci.h,ci.s,ci.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(ci),e.getHSL(ch);const r=Su(ci.h,ch.h,t),i=Su(ci.s,ch.s,t),s=Su(ci.l,ch.l,t);return this.setHSL(r,i,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Ce.NAMES=kE;Ce.prototype.isColor=!0;Ce.prototype.r=1;Ce.prototype.g=1;Ce.prototype.b=1;class Pt extends nr{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Ce(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Vp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Pt.prototype.isMeshBasicMaterial=!0;const Rt=new L,uh=new oe;class Kt{constructor(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r===!0,this.usage=Ju,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let r=0;for(let i=0,s=e.length;i<s;i++){let a=e[i];a===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new Ce),t[r++]=a.r,t[r++]=a.g,t[r++]=a.b}return this}copyVector2sArray(e){const t=this.array;let r=0;for(let i=0,s=e.length;i<s;i++){let a=e[i];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new oe),t[r++]=a.x,t[r++]=a.y}return this}copyVector3sArray(e){const t=this.array;let r=0;for(let i=0,s=e.length;i<s;i++){let a=e[i];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new L),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this}copyVector4sArray(e){const t=this.array;let r=0;for(let i=0,s=e.length;i<s;i++){let a=e[i];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new Tt),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=a.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)uh.fromBufferAttribute(this,t),uh.applyMatrix3(e),this.setXY(t,uh.x,uh.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)Rt.fromBufferAttribute(this,t),Rt.applyMatrix3(e),this.setXYZ(t,Rt.x,Rt.y,Rt.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Rt.x=this.getX(t),Rt.y=this.getY(t),Rt.z=this.getZ(t),Rt.applyMatrix4(e),this.setXYZ(t,Rt.x,Rt.y,Rt.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Rt.x=this.getX(t),Rt.y=this.getY(t),Rt.z=this.getZ(t),Rt.applyNormalMatrix(e),this.setXYZ(t,Rt.x,Rt.y,Rt.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Rt.x=this.getX(t),Rt.y=this.getY(t),Rt.z=this.getZ(t),Rt.transformDirection(e),this.setXYZ(t,Rt.x,Rt.y,Rt.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Ju&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}Kt.prototype.isBufferAttribute=!0;class OE extends Kt{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class zE extends Kt{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class xR extends Kt{constructor(e,t,r){super(new Uint16Array(e),t,r)}}xR.prototype.isFloat16BufferAttribute=!0;class Ye extends Kt{constructor(e,t,r){super(new Float32Array(e),t,r)}}let wR=0;const Br=new ze,pg=new ot,Io=new L,Sr=new ur,kc=new ur,mn=new L;class nt extends Ma{constructor(){super(),Object.defineProperty(this,"id",{value:wR++}),this.uuid=Ei(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(DE(e)>65535?zE:OE)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new zn().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Br.makeRotationFromQuaternion(e),this.applyMatrix4(Br),this}rotateX(e){return Br.makeRotationX(e),this.applyMatrix4(Br),this}rotateY(e){return Br.makeRotationY(e),this.applyMatrix4(Br),this}rotateZ(e){return Br.makeRotationZ(e),this.applyMatrix4(Br),this}translate(e,t,r){return Br.makeTranslation(e,t,r),this.applyMatrix4(Br),this}scale(e,t,r){return Br.makeScale(e,t,r),this.applyMatrix4(Br),this}lookAt(e){return pg.lookAt(e),pg.updateMatrix(),this.applyMatrix4(pg.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Io).negate(),this.translate(Io.x,Io.y,Io.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const s=e[r];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Ye(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ur);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new L(-1/0,-1/0,-1/0),new L(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const s=t[r];Sr.setFromBufferAttribute(s),this.morphTargetsRelative?(mn.addVectors(this.boundingBox.min,Sr.min),this.boundingBox.expandByPoint(mn),mn.addVectors(this.boundingBox.max,Sr.max),this.boundingBox.expandByPoint(mn)):(this.boundingBox.expandByPoint(Sr.min),this.boundingBox.expandByPoint(Sr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new sc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new L,1/0);return}if(e){const r=this.boundingSphere.center;if(Sr.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];kc.setFromBufferAttribute(o),this.morphTargetsRelative?(mn.addVectors(Sr.min,kc.min),Sr.expandByPoint(mn),mn.addVectors(Sr.max,kc.max),Sr.expandByPoint(mn)):(Sr.expandByPoint(kc.min),Sr.expandByPoint(kc.max))}Sr.getCenter(r);let i=0;for(let s=0,a=e.count;s<a;s++)mn.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(mn));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)mn.fromBufferAttribute(o,c),l&&(Io.fromBufferAttribute(e,c),mn.add(Io)),i=Math.max(i,r.distanceToSquared(mn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=e.array,i=t.position.array,s=t.normal.array,a=t.uv.array,o=i.length/3;t.tangent===void 0&&this.setAttribute("tangent",new Kt(new Float32Array(4*o),4));const l=t.tangent.array,c=[],u=[];for(let O=0;O<o;O++)c[O]=new L,u[O]=new L;const h=new L,d=new L,f=new L,v=new oe,g=new oe,y=new oe,p=new L,m=new L;function x(O,H,D){h.fromArray(i,O*3),d.fromArray(i,H*3),f.fromArray(i,D*3),v.fromArray(a,O*2),g.fromArray(a,H*2),y.fromArray(a,D*2),d.sub(h),f.sub(h),g.sub(v),y.sub(v);const U=1/(g.x*y.y-y.x*g.y);!isFinite(U)||(p.copy(d).multiplyScalar(y.y).addScaledVector(f,-g.y).multiplyScalar(U),m.copy(f).multiplyScalar(g.x).addScaledVector(d,-y.x).multiplyScalar(U),c[O].add(p),c[H].add(p),c[D].add(p),u[O].add(m),u[H].add(m),u[D].add(m))}let w=this.groups;w.length===0&&(w=[{start:0,count:r.length}]);for(let O=0,H=w.length;O<H;++O){const D=w[O],U=D.start,_=D.count;for(let z=U,j=U+_;z<j;z+=3)x(r[z+0],r[z+1],r[z+2])}const b=new L,C=new L,A=new L,F=new L;function N(O){A.fromArray(s,O*3),F.copy(A);const H=c[O];b.copy(H),b.sub(A.multiplyScalar(A.dot(H))).normalize(),C.crossVectors(F,H);const U=C.dot(u[O])<0?-1:1;l[O*4]=b.x,l[O*4+1]=b.y,l[O*4+2]=b.z,l[O*4+3]=U}for(let O=0,H=w.length;O<H;++O){const D=w[O],U=D.start,_=D.count;for(let z=U,j=U+_;z<j;z+=3)N(r[z+0]),N(r[z+1]),N(r[z+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Kt(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let d=0,f=r.count;d<f;d++)r.setXYZ(d,0,0,0);const i=new L,s=new L,a=new L,o=new L,l=new L,c=new L,u=new L,h=new L;if(e)for(let d=0,f=e.count;d<f;d+=3){const v=e.getX(d+0),g=e.getX(d+1),y=e.getX(d+2);i.fromBufferAttribute(t,v),s.fromBufferAttribute(t,g),a.fromBufferAttribute(t,y),u.subVectors(a,s),h.subVectors(i,s),u.cross(h),o.fromBufferAttribute(r,v),l.fromBufferAttribute(r,g),c.fromBufferAttribute(r,y),o.add(u),l.add(u),c.add(u),r.setXYZ(v,o.x,o.y,o.z),r.setXYZ(g,l.x,l.y,l.z),r.setXYZ(y,c.x,c.y,c.z)}else for(let d=0,f=t.count;d<f;d+=3)i.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),a.fromBufferAttribute(t,d+2),u.subVectors(a,s),h.subVectors(i,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const r=this.attributes;for(const i in r){if(e.attributes[i]===void 0)continue;const a=r[i].array,o=e.attributes[i],l=o.array,c=o.itemSize*t,u=Math.min(l.length,a.length-c);for(let h=0,d=c;h<u;h++,d++)a[d]=l[h]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)mn.fromBufferAttribute(e,t),mn.normalize(),e.setXYZ(t,mn.x,mn.y,mn.z)}toNonIndexed(){function e(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let f=0,v=0;for(let g=0,y=l.length;g<y;g++){o.isInterleavedBufferAttribute?f=l[g]*o.data.stride+o.offset:f=l[g]*u;for(let p=0;p<u;p++)d[v++]=c[f++]}return new Kt(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new nt,r=this.index.array,i=this.attributes;for(const o in i){const l=i[o],c=e(l,r);t.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],f=e(d,r);l.push(f)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const i={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h];u.push(f.toJSON(e.data))}u.length>0&&(i[l]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const i=e.attributes;for(const c in i){const u=i[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}nt.prototype.isBufferGeometry=!0;const Z_=new ze,Lo=new po,mg=new sc,Ps=new L,Is=new L,Ls=new L,gg=new L,vg=new L,yg=new L,dh=new L,hh=new L,fh=new L,ph=new oe,mh=new oe,gh=new oe,xg=new L,vh=new L;class be extends ot{constructor(e=new nt,t=new Pt){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const r=this.geometry,i=this.material,s=this.matrixWorld;if(i===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),mg.copy(r.boundingSphere),mg.applyMatrix4(s),e.ray.intersectsSphere(mg)===!1)||(Z_.copy(s).invert(),Lo.copy(e.ray).applyMatrix4(Z_),r.boundingBox!==null&&Lo.intersectsBox(r.boundingBox)===!1))return;let a;if(r.isBufferGeometry){const o=r.index,l=r.attributes.position,c=r.morphAttributes.position,u=r.morphTargetsRelative,h=r.attributes.uv,d=r.attributes.uv2,f=r.groups,v=r.drawRange;if(o!==null)if(Array.isArray(i))for(let g=0,y=f.length;g<y;g++){const p=f[g],m=i[p.materialIndex],x=Math.max(p.start,v.start),w=Math.min(o.count,Math.min(p.start+p.count,v.start+v.count));for(let b=x,C=w;b<C;b+=3){const A=o.getX(b),F=o.getX(b+1),N=o.getX(b+2);a=yh(this,m,e,Lo,l,c,u,h,d,A,F,N),a&&(a.faceIndex=Math.floor(b/3),a.face.materialIndex=p.materialIndex,t.push(a))}}else{const g=Math.max(0,v.start),y=Math.min(o.count,v.start+v.count);for(let p=g,m=y;p<m;p+=3){const x=o.getX(p),w=o.getX(p+1),b=o.getX(p+2);a=yh(this,i,e,Lo,l,c,u,h,d,x,w,b),a&&(a.faceIndex=Math.floor(p/3),t.push(a))}}else if(l!==void 0)if(Array.isArray(i))for(let g=0,y=f.length;g<y;g++){const p=f[g],m=i[p.materialIndex],x=Math.max(p.start,v.start),w=Math.min(l.count,Math.min(p.start+p.count,v.start+v.count));for(let b=x,C=w;b<C;b+=3){const A=b,F=b+1,N=b+2;a=yh(this,m,e,Lo,l,c,u,h,d,A,F,N),a&&(a.faceIndex=Math.floor(b/3),a.face.materialIndex=p.materialIndex,t.push(a))}}else{const g=Math.max(0,v.start),y=Math.min(l.count,v.start+v.count);for(let p=g,m=y;p<m;p+=3){const x=p,w=p+1,b=p+2;a=yh(this,i,e,Lo,l,c,u,h,d,x,w,b),a&&(a.faceIndex=Math.floor(p/3),t.push(a))}}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}be.prototype.isMesh=!0;function _R(n,e,t,r,i,s,a,o){let l;if(e.side===un?l=r.intersectTriangle(a,s,i,!0,o):l=r.intersectTriangle(i,s,a,e.side!==Un,o),l===null)return null;vh.copy(o),vh.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(vh);return c<t.near||c>t.far?null:{distance:c,point:vh.clone(),object:n}}function yh(n,e,t,r,i,s,a,o,l,c,u,h){Ps.fromBufferAttribute(i,c),Is.fromBufferAttribute(i,u),Ls.fromBufferAttribute(i,h);const d=n.morphTargetInfluences;if(s&&d){dh.set(0,0,0),hh.set(0,0,0),fh.set(0,0,0);for(let v=0,g=s.length;v<g;v++){const y=d[v],p=s[v];y!==0&&(gg.fromBufferAttribute(p,c),vg.fromBufferAttribute(p,u),yg.fromBufferAttribute(p,h),a?(dh.addScaledVector(gg,y),hh.addScaledVector(vg,y),fh.addScaledVector(yg,y)):(dh.addScaledVector(gg.sub(Ps),y),hh.addScaledVector(vg.sub(Is),y),fh.addScaledVector(yg.sub(Ls),y)))}Ps.add(dh),Is.add(hh),Ls.add(fh)}n.isSkinnedMesh&&(n.boneTransform(c,Ps),n.boneTransform(u,Is),n.boneTransform(h,Ls));const f=_R(n,e,t,r,Ps,Is,Ls,xg);if(f){o&&(ph.fromBufferAttribute(o,c),mh.fromBufferAttribute(o,u),gh.fromBufferAttribute(o,h),f.uv=cn.getUV(xg,Ps,Is,Ls,ph,mh,gh,new oe)),l&&(ph.fromBufferAttribute(l,c),mh.fromBufferAttribute(l,u),gh.fromBufferAttribute(l,h),f.uv2=cn.getUV(xg,Ps,Is,Ls,ph,mh,gh,new oe));const v={a:c,b:u,c:h,normal:new L,materialIndex:0};cn.getNormal(Ps,Is,Ls,v.normal),f.face=v}return f}class ln extends nt{constructor(e=1,t=1,r=1,i=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:a};const o=this;i=Math.floor(i),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,f=0;v("z","y","x",-1,-1,r,t,e,a,s,0),v("z","y","x",1,-1,r,t,-e,a,s,1),v("x","z","y",1,1,e,r,t,i,a,2),v("x","z","y",1,-1,e,r,-t,i,a,3),v("x","y","z",1,-1,e,t,r,i,s,4),v("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(l),this.setAttribute("position",new Ye(c,3)),this.setAttribute("normal",new Ye(u,3)),this.setAttribute("uv",new Ye(h,2));function v(g,y,p,m,x,w,b,C,A,F,N){const O=w/A,H=b/F,D=w/2,U=b/2,_=C/2,z=A+1,j=F+1;let R=0,ee=0;const J=new L;for(let le=0;le<j;le++){const k=le*H-U;for(let V=0;V<z;V++){const $=V*O-D;J[g]=$*m,J[y]=k*x,J[p]=_,c.push(J.x,J.y,J.z),J[g]=0,J[y]=0,J[p]=C>0?1:-1,u.push(J.x,J.y,J.z),h.push(V/A),h.push(1-le/F),R+=1}}for(let le=0;le<F;le++)for(let k=0;k<A;k++){const V=d+k+z*le,$=d+k+z*(le+1),Q=d+(k+1)+z*(le+1),ie=d+(k+1)+z*le;l.push(V,$,ie),l.push($,Q,ie),ee+=6}o.addGroup(f,ee,N),f+=ee,d+=R}}static fromJSON(e){return new ln(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Hl(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function Wn(n){const e={};for(let t=0;t<n.length;t++){const r=Hl(n[t]);for(const i in r)e[i]=r[i]}return e}const Zp={clone:Hl,merge:Wn};var bR=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,SR=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class wn extends nr{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=bR,this.fragmentShader=SR,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Hl(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}wn.prototype.isShaderMaterial=!0;class Xy extends ot{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new ze,this.projectionMatrix=new ze,this.projectionMatrixInverse=new ze}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}Xy.prototype.isCamera=!0;class rn extends Xy{constructor(e=50,t=1,r=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Ku*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(bu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Ku*2*Math.atan(Math.tan(bu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(bu*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*i/l,t-=a.offsetY*r/c,i*=a.width/l,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}rn.prototype.isPerspectiveCamera=!0;const Ro=90,Fo=1;class Yy extends ot{constructor(e,t,r){if(super(),this.type="CubeCamera",r.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=r;const i=new rn(Ro,Fo,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new L(1,0,0)),this.add(i);const s=new rn(Ro,Fo,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new L(-1,0,0)),this.add(s);const a=new rn(Ro,Fo,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new L(0,1,0)),this.add(a);const o=new rn(Ro,Fo,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new L(0,-1,0)),this.add(o);const l=new rn(Ro,Fo,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new L(0,0,1)),this.add(l);const c=new rn(Ro,Fo,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new L(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const r=this.renderTarget,[i,s,a,o,l,c]=this.children,u=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;const d=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,s),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,o),e.setRenderTarget(r,4),e.render(t,l),r.texture.generateMipmaps=d,e.setRenderTarget(r,5),e.render(t,c),e.setRenderTarget(h),e.xr.enabled=u}}class qp extends Hn{constructor(e,t,r,i,s,a,o,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:jp,super(e,t,r,i,s,a,o,l,c,u),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}qp.prototype.isCubeTexture=!0;class UE extends dn{constructor(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),super(e,e,t),t=t||{},this.texture=new qp(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:_n,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=bn,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new ln(5,5,5),s=new wn({name:"CubemapFromEquirect",uniforms:Hl(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:un,blending:Qr});s.uniforms.tEquirect.value=t;const a=new be(i,s),o=t.minFilter;return t.minFilter===Yp&&(t.minFilter=_n),new Yy(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,r,i){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,r,i);e.setRenderTarget(s)}}UE.prototype.isWebGLCubeRenderTarget=!0;const wg=new L,MR=new L,ER=new zn;class Cr{constructor(e=new L(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=wg.subVectors(r,t).cross(MR.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const r=e.delta(wg),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(r).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||ER.getNormalMatrix(e),i=this.coplanarPoint(wg).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}Cr.prototype.isPlane=!0;const Do=new sc,xh=new L;class Qp{constructor(e=new Cr,t=new Cr,r=new Cr,i=new Cr,s=new Cr,a=new Cr){this.planes=[e,t,r,i,s,a]}set(e,t,r,i,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){const t=this.planes,r=e.elements,i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],f=r[9],v=r[10],g=r[11],y=r[12],p=r[13],m=r[14],x=r[15];return t[0].setComponents(o-i,h-l,g-d,x-y).normalize(),t[1].setComponents(o+i,h+l,g+d,x+y).normalize(),t[2].setComponents(o+s,h+c,g+f,x+p).normalize(),t[3].setComponents(o-s,h-c,g-f,x-p).normalize(),t[4].setComponents(o-a,h-u,g-v,x-m).normalize(),t[5].setComponents(o+a,h+u,g+v,x+m).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Do.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Do)}intersectsSprite(e){return Do.center.set(0,0,0),Do.radius=.7071067811865476,Do.applyMatrix4(e.matrixWorld),this.intersectsSphere(Do)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(xh.x=i.normal.x>0?e.max.x:e.min.x,xh.y=i.normal.y>0?e.max.y:e.min.y,xh.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(xh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function BE(){let n=null,e=!1,t=null,r=null;function i(s,a){t(s,a),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function AR(n,e){const t=e.isWebGL2,r=new WeakMap;function i(c,u){const h=c.array,d=c.usage,f=n.createBuffer();n.bindBuffer(u,f),n.bufferData(u,h,d),c.onUploadCallback();let v=5126;return h instanceof Float32Array?v=5126:h instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):h instanceof Uint16Array?c.isFloat16BufferAttribute?t?v=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):v=5123:h instanceof Int16Array?v=5122:h instanceof Uint32Array?v=5125:h instanceof Int32Array?v=5124:h instanceof Int8Array?v=5120:(h instanceof Uint8Array||h instanceof Uint8ClampedArray)&&(v=5121),{buffer:f,type:v,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){const d=u.array,f=u.updateRange;n.bindBuffer(h,c),f.count===-1?n.bufferSubData(h,0,d):(t?n.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):n.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1)}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=r.get(c);u&&(n.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=r.get(c);h===void 0?r.set(c,i(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}class oc extends nt{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,a=t/2,o=Math.floor(r),l=Math.floor(i),c=o+1,u=l+1,h=e/o,d=t/l,f=[],v=[],g=[],y=[];for(let p=0;p<u;p++){const m=p*d-a;for(let x=0;x<c;x++){const w=x*h-s;v.push(w,-m,0),g.push(0,0,1),y.push(x/o),y.push(1-p/l)}}for(let p=0;p<l;p++)for(let m=0;m<o;m++){const x=m+c*p,w=m+c*(p+1),b=m+1+c*(p+1),C=m+1+c*p;f.push(x,w,C),f.push(w,b,C)}this.setIndex(f),this.setAttribute("position",new Ye(v,3)),this.setAttribute("normal",new Ye(g,3)),this.setAttribute("uv",new Ye(y,2))}static fromJSON(e){return new oc(e.width,e.height,e.widthSegments,e.heightSegments)}}var TR=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,CR=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,PR=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,IR=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,LR=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,RR=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,FR="vec3 transformed = vec3( position );",DR=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,NR=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenTint, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenTint * ( D * V );
}
#endif`,kR=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,OR=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,zR=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,UR=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,BR=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,HR=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,GR=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,VR=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,jR=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,WR=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,XR=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,YR=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,$R=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,ZR=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,qR=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,QR=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,JR="gl_FragColor = linearToOutputTexel( gl_FragColor );",KR=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,eF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,tF=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,nF=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,rF=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,iF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,sF=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,aF=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,oF=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,lF=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,cF=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,uF=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,dF=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,hF=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,fF=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,pF=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,mF=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,gF=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,vF=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,yF=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,xF=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularTintFactor = specularTint;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARTINTMAP
			specularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularTintFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenTint = sheenTint;
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
#endif`,wF=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenTint;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenTint, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,_F=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,bF=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,SF=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,MF=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,EF=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,AF=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,TF=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,CF=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,PF=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,IF=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,LF=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,RF=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,FF=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,DF=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,NF=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {
			float texelIndex = float( vertexIndex * stride + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV ).xyz;
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,kF=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			#ifndef USE_MORPHNORMALS
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];
			#else
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];
			#endif
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,OF=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,zF=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,UF=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,BF=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,HF=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,GF=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,VF=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,jF=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,WF=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,XF=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,YF=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,$F=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,ZF=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,qF=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,QF=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,JF=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,KF=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,eD=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,tD=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,nD=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,rD=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,iD=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,sD=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,aD=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,oD=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,lD=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,cD=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,uD=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,dD=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,hD=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationTint, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,fD=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationTint;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,pD=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,mD=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,gD=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,vD=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,yD=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,xD=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,wD=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const _D=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,bD=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,SD=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,MD=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ED=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,AD=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,TD=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,CD=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,PD=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,ID=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,LD=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,RD=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,FD=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,DD=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ND=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kD=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OD=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,zD=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,UD=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,BD=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,HD=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,GD=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VD=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,jD=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularTint;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARTINTMAP
		uniform sampler2D specularTintMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenTint;
	uniform float sheenRoughness;
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WD=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,XD=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,YD=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,$D=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ZD=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qD=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,QD=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,JD=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ct={alphamap_fragment:TR,alphamap_pars_fragment:CR,alphatest_fragment:PR,alphatest_pars_fragment:IR,aomap_fragment:LR,aomap_pars_fragment:RR,begin_vertex:FR,beginnormal_vertex:DR,bsdfs:NR,bumpmap_pars_fragment:kR,clipping_planes_fragment:OR,clipping_planes_pars_fragment:zR,clipping_planes_pars_vertex:UR,clipping_planes_vertex:BR,color_fragment:HR,color_pars_fragment:GR,color_pars_vertex:VR,color_vertex:jR,common:WR,cube_uv_reflection_fragment:XR,defaultnormal_vertex:YR,displacementmap_pars_vertex:$R,displacementmap_vertex:ZR,emissivemap_fragment:qR,emissivemap_pars_fragment:QR,encodings_fragment:JR,encodings_pars_fragment:KR,envmap_fragment:eF,envmap_common_pars_fragment:tF,envmap_pars_fragment:nF,envmap_pars_vertex:rF,envmap_physical_pars_fragment:pF,envmap_vertex:iF,fog_vertex:sF,fog_pars_vertex:aF,fog_fragment:oF,fog_pars_fragment:lF,gradientmap_pars_fragment:cF,lightmap_fragment:uF,lightmap_pars_fragment:dF,lights_lambert_vertex:hF,lights_pars_begin:fF,lights_toon_fragment:mF,lights_toon_pars_fragment:gF,lights_phong_fragment:vF,lights_phong_pars_fragment:yF,lights_physical_fragment:xF,lights_physical_pars_fragment:wF,lights_fragment_begin:_F,lights_fragment_maps:bF,lights_fragment_end:SF,logdepthbuf_fragment:MF,logdepthbuf_pars_fragment:EF,logdepthbuf_pars_vertex:AF,logdepthbuf_vertex:TF,map_fragment:CF,map_pars_fragment:PF,map_particle_fragment:IF,map_particle_pars_fragment:LF,metalnessmap_fragment:RF,metalnessmap_pars_fragment:FF,morphnormal_vertex:DF,morphtarget_pars_vertex:NF,morphtarget_vertex:kF,normal_fragment_begin:OF,normal_fragment_maps:zF,normal_pars_fragment:UF,normal_pars_vertex:BF,normal_vertex:HF,normalmap_pars_fragment:GF,clearcoat_normal_fragment_begin:VF,clearcoat_normal_fragment_maps:jF,clearcoat_pars_fragment:WF,output_fragment:XF,packing:YF,premultiplied_alpha_fragment:$F,project_vertex:ZF,dithering_fragment:qF,dithering_pars_fragment:QF,roughnessmap_fragment:JF,roughnessmap_pars_fragment:KF,shadowmap_pars_fragment:eD,shadowmap_pars_vertex:tD,shadowmap_vertex:nD,shadowmask_pars_fragment:rD,skinbase_vertex:iD,skinning_pars_vertex:sD,skinning_vertex:aD,skinnormal_vertex:oD,specularmap_fragment:lD,specularmap_pars_fragment:cD,tonemapping_fragment:uD,tonemapping_pars_fragment:dD,transmission_fragment:hD,transmission_pars_fragment:fD,uv_pars_fragment:pD,uv_pars_vertex:mD,uv_vertex:gD,uv2_pars_fragment:vD,uv2_pars_vertex:yD,uv2_vertex:xD,worldpos_vertex:wD,background_vert:_D,background_frag:bD,cube_vert:SD,cube_frag:MD,depth_vert:ED,depth_frag:AD,distanceRGBA_vert:TD,distanceRGBA_frag:CD,equirect_vert:PD,equirect_frag:ID,linedashed_vert:LD,linedashed_frag:RD,meshbasic_vert:FD,meshbasic_frag:DD,meshlambert_vert:ND,meshlambert_frag:kD,meshmatcap_vert:OD,meshmatcap_frag:zD,meshnormal_vert:UD,meshnormal_frag:BD,meshphong_vert:HD,meshphong_frag:GD,meshphysical_vert:VD,meshphysical_frag:jD,meshtoon_vert:WD,meshtoon_frag:XD,points_vert:YD,points_frag:$D,shadow_vert:ZD,shadow_frag:qD,sprite_vert:QD,sprite_frag:JD},Ie={common:{diffuse:{value:new Ce(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new zn},uv2Transform:{value:new zn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new oe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ce(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ce(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new zn}},sprite:{diffuse:{value:new Ce(16777215)},opacity:{value:1},center:{value:new oe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new zn}}},Oi={basic:{uniforms:Wn([Ie.common,Ie.specularmap,Ie.envmap,Ie.aomap,Ie.lightmap,Ie.fog]),vertexShader:ct.meshbasic_vert,fragmentShader:ct.meshbasic_frag},lambert:{uniforms:Wn([Ie.common,Ie.specularmap,Ie.envmap,Ie.aomap,Ie.lightmap,Ie.emissivemap,Ie.fog,Ie.lights,{emissive:{value:new Ce(0)}}]),vertexShader:ct.meshlambert_vert,fragmentShader:ct.meshlambert_frag},phong:{uniforms:Wn([Ie.common,Ie.specularmap,Ie.envmap,Ie.aomap,Ie.lightmap,Ie.emissivemap,Ie.bumpmap,Ie.normalmap,Ie.displacementmap,Ie.fog,Ie.lights,{emissive:{value:new Ce(0)},specular:{value:new Ce(1118481)},shininess:{value:30}}]),vertexShader:ct.meshphong_vert,fragmentShader:ct.meshphong_frag},standard:{uniforms:Wn([Ie.common,Ie.envmap,Ie.aomap,Ie.lightmap,Ie.emissivemap,Ie.bumpmap,Ie.normalmap,Ie.displacementmap,Ie.roughnessmap,Ie.metalnessmap,Ie.fog,Ie.lights,{emissive:{value:new Ce(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ct.meshphysical_vert,fragmentShader:ct.meshphysical_frag},toon:{uniforms:Wn([Ie.common,Ie.aomap,Ie.lightmap,Ie.emissivemap,Ie.bumpmap,Ie.normalmap,Ie.displacementmap,Ie.gradientmap,Ie.fog,Ie.lights,{emissive:{value:new Ce(0)}}]),vertexShader:ct.meshtoon_vert,fragmentShader:ct.meshtoon_frag},matcap:{uniforms:Wn([Ie.common,Ie.bumpmap,Ie.normalmap,Ie.displacementmap,Ie.fog,{matcap:{value:null}}]),vertexShader:ct.meshmatcap_vert,fragmentShader:ct.meshmatcap_frag},points:{uniforms:Wn([Ie.points,Ie.fog]),vertexShader:ct.points_vert,fragmentShader:ct.points_frag},dashed:{uniforms:Wn([Ie.common,Ie.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ct.linedashed_vert,fragmentShader:ct.linedashed_frag},depth:{uniforms:Wn([Ie.common,Ie.displacementmap]),vertexShader:ct.depth_vert,fragmentShader:ct.depth_frag},normal:{uniforms:Wn([Ie.common,Ie.bumpmap,Ie.normalmap,Ie.displacementmap,{opacity:{value:1}}]),vertexShader:ct.meshnormal_vert,fragmentShader:ct.meshnormal_frag},sprite:{uniforms:Wn([Ie.sprite,Ie.fog]),vertexShader:ct.sprite_vert,fragmentShader:ct.sprite_frag},background:{uniforms:{uvTransform:{value:new zn},t2D:{value:null}},vertexShader:ct.background_vert,fragmentShader:ct.background_frag},cube:{uniforms:Wn([Ie.envmap,{opacity:{value:1}}]),vertexShader:ct.cube_vert,fragmentShader:ct.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ct.equirect_vert,fragmentShader:ct.equirect_frag},distanceRGBA:{uniforms:Wn([Ie.common,Ie.displacementmap,{referencePosition:{value:new L},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ct.distanceRGBA_vert,fragmentShader:ct.distanceRGBA_frag},shadow:{uniforms:Wn([Ie.lights,Ie.fog,{color:{value:new Ce(0)},opacity:{value:1}}]),vertexShader:ct.shadow_vert,fragmentShader:ct.shadow_frag}};Oi.physical={uniforms:Wn([Oi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new oe(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenTint:{value:new Ce(0)},sheenRoughness:{value:0},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new oe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new Ce(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new Ce(1,1,1)},specularTintMap:{value:null}}]),vertexShader:ct.meshphysical_vert,fragmentShader:ct.meshphysical_frag};function KD(n,e,t,r,i){const s=new Ce(0);let a=0,o,l,c=null,u=0,h=null;function d(v,g){let y=!1,p=g.isScene===!0?g.background:null;p&&p.isTexture&&(p=e.get(p));const m=n.xr,x=m.getSession&&m.getSession();x&&x.environmentBlendMode==="additive"&&(p=null),p===null?f(s,a):p&&p.isColor&&(f(p,1),y=!0),(n.autoClear||y)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),p&&(p.isCubeTexture||p.mapping===Xp)?(l===void 0&&(l=new be(new ln(1,1,1),new wn({name:"BackgroundCubeMaterial",uniforms:Hl(Oi.cube.uniforms),vertexShader:Oi.cube.vertexShader,fragmentShader:Oi.cube.fragmentShader,side:un,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(w,b,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=p,l.material.uniforms.flipEnvMap.value=p.isCubeTexture&&p.isRenderTargetTexture===!1?-1:1,(c!==p||u!==p.version||h!==n.toneMapping)&&(l.material.needsUpdate=!0,c=p,u=p.version,h=n.toneMapping),v.unshift(l,l.geometry,l.material,0,0,null)):p&&p.isTexture&&(o===void 0&&(o=new be(new oc(2,2),new wn({name:"BackgroundMaterial",uniforms:Hl(Oi.background.uniforms),vertexShader:Oi.background.vertexShader,fragmentShader:Oi.background.fragmentShader,side:Bl,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=p,p.matrixAutoUpdate===!0&&p.updateMatrix(),o.material.uniforms.uvTransform.value.copy(p.matrix),(c!==p||u!==p.version||h!==n.toneMapping)&&(o.material.needsUpdate=!0,c=p,u=p.version,h=n.toneMapping),v.unshift(o,o.geometry,o.material,0,0,null))}function f(v,g){t.buffers.color.setClear(v.r,v.g,v.b,g,i)}return{getClearColor:function(){return s},setClearColor:function(v,g=1){s.set(v),a=g,f(s,a)},getClearAlpha:function(){return a},setClearAlpha:function(v){a=v,f(s,a)},render:d}}function eN(n,e,t,r){const i=n.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=g(null);let c=l;function u(U,_,z,j,R){let ee=!1;if(a){const J=v(j,z,_);c!==J&&(c=J,d(c.object)),ee=y(j,R),ee&&p(j,R)}else{const J=_.wireframe===!0;(c.geometry!==j.id||c.program!==z.id||c.wireframe!==J)&&(c.geometry=j.id,c.program=z.id,c.wireframe=J,ee=!0)}U.isInstancedMesh===!0&&(ee=!0),R!==null&&t.update(R,34963),ee&&(A(U,_,z,j),R!==null&&n.bindBuffer(34963,t.get(R).buffer))}function h(){return r.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}function d(U){return r.isWebGL2?n.bindVertexArray(U):s.bindVertexArrayOES(U)}function f(U){return r.isWebGL2?n.deleteVertexArray(U):s.deleteVertexArrayOES(U)}function v(U,_,z){const j=z.wireframe===!0;let R=o[U.id];R===void 0&&(R={},o[U.id]=R);let ee=R[_.id];ee===void 0&&(ee={},R[_.id]=ee);let J=ee[j];return J===void 0&&(J=g(h()),ee[j]=J),J}function g(U){const _=[],z=[],j=[];for(let R=0;R<i;R++)_[R]=0,z[R]=0,j[R]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:_,enabledAttributes:z,attributeDivisors:j,object:U,attributes:{},index:null}}function y(U,_){const z=c.attributes,j=U.attributes;let R=0;for(const ee in j){const J=z[ee],le=j[ee];if(J===void 0||J.attribute!==le||J.data!==le.data)return!0;R++}return c.attributesNum!==R||c.index!==_}function p(U,_){const z={},j=U.attributes;let R=0;for(const ee in j){const J=j[ee],le={};le.attribute=J,J.data&&(le.data=J.data),z[ee]=le,R++}c.attributes=z,c.attributesNum=R,c.index=_}function m(){const U=c.newAttributes;for(let _=0,z=U.length;_<z;_++)U[_]=0}function x(U){w(U,0)}function w(U,_){const z=c.newAttributes,j=c.enabledAttributes,R=c.attributeDivisors;z[U]=1,j[U]===0&&(n.enableVertexAttribArray(U),j[U]=1),R[U]!==_&&((r.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](U,_),R[U]=_)}function b(){const U=c.newAttributes,_=c.enabledAttributes;for(let z=0,j=_.length;z<j;z++)_[z]!==U[z]&&(n.disableVertexAttribArray(z),_[z]=0)}function C(U,_,z,j,R,ee){r.isWebGL2===!0&&(z===5124||z===5125)?n.vertexAttribIPointer(U,_,z,R,ee):n.vertexAttribPointer(U,_,z,j,R,ee)}function A(U,_,z,j){if(r.isWebGL2===!1&&(U.isInstancedMesh||j.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;m();const R=j.attributes,ee=z.getAttributes(),J=_.defaultAttributeValues;for(const le in ee){const k=ee[le];if(k.location>=0){let V=R[le];if(V===void 0&&(le==="instanceMatrix"&&U.instanceMatrix&&(V=U.instanceMatrix),le==="instanceColor"&&U.instanceColor&&(V=U.instanceColor)),V!==void 0){const $=V.normalized,Q=V.itemSize,ie=t.get(V);if(ie===void 0)continue;const ne=ie.buffer,Se=ie.type,_e=ie.bytesPerElement;if(V.isInterleavedBufferAttribute){const we=V.data,Me=we.stride,ke=V.offset;if(we&&we.isInstancedInterleavedBuffer){for(let de=0;de<k.locationSize;de++)w(k.location+de,we.meshPerAttribute);U.isInstancedMesh!==!0&&j._maxInstanceCount===void 0&&(j._maxInstanceCount=we.meshPerAttribute*we.count)}else for(let de=0;de<k.locationSize;de++)x(k.location+de);n.bindBuffer(34962,ne);for(let de=0;de<k.locationSize;de++)C(k.location+de,Q/k.locationSize,Se,$,Me*_e,(ke+Q/k.locationSize*de)*_e)}else{if(V.isInstancedBufferAttribute){for(let we=0;we<k.locationSize;we++)w(k.location+we,V.meshPerAttribute);U.isInstancedMesh!==!0&&j._maxInstanceCount===void 0&&(j._maxInstanceCount=V.meshPerAttribute*V.count)}else for(let we=0;we<k.locationSize;we++)x(k.location+we);n.bindBuffer(34962,ne);for(let we=0;we<k.locationSize;we++)C(k.location+we,Q/k.locationSize,Se,$,Q*_e,Q/k.locationSize*we*_e)}}else if(J!==void 0){const $=J[le];if($!==void 0)switch($.length){case 2:n.vertexAttrib2fv(k.location,$);break;case 3:n.vertexAttrib3fv(k.location,$);break;case 4:n.vertexAttrib4fv(k.location,$);break;default:n.vertexAttrib1fv(k.location,$)}}}}b()}function F(){H();for(const U in o){const _=o[U];for(const z in _){const j=_[z];for(const R in j)f(j[R].object),delete j[R];delete _[z]}delete o[U]}}function N(U){if(o[U.id]===void 0)return;const _=o[U.id];for(const z in _){const j=_[z];for(const R in j)f(j[R].object),delete j[R];delete _[z]}delete o[U.id]}function O(U){for(const _ in o){const z=o[_];if(z[U.id]===void 0)continue;const j=z[U.id];for(const R in j)f(j[R].object),delete j[R];delete z[U.id]}}function H(){D(),c!==l&&(c=l,d(c.object))}function D(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:H,resetDefaultState:D,dispose:F,releaseStatesOfGeometry:N,releaseStatesOfProgram:O,initAttributes:m,enableAttribute:x,disableUnusedAttributes:b}}function tN(n,e,t,r){const i=r.isWebGL2;let s;function a(c){s=c}function o(c,u){n.drawArrays(s,c,u),t.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,f;if(i)d=n,f="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](s,c,u,h),t.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function nN(n,e,t){let r;function i(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const A=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(A){if(A==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return A==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext!="undefined"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&n instanceof WebGL2ComputeRenderingContext;let o=t.precision!==void 0?t.precision:"highp";const l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const c=a||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=n.getParameter(34930),d=n.getParameter(35660),f=n.getParameter(3379),v=n.getParameter(34076),g=n.getParameter(34921),y=n.getParameter(36347),p=n.getParameter(36348),m=n.getParameter(36349),x=d>0,w=a||e.has("OES_texture_float"),b=x&&w,C=a?n.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:i,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:v,maxAttributes:g,maxVertexUniforms:y,maxVaryings:p,maxFragmentUniforms:m,vertexTextures:x,floatFragmentTextures:w,floatVertexTextures:b,maxSamples:C}}function rN(n){const e=this;let t=null,r=0,i=!1,s=!1;const a=new Cr,o=new zn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d,f){const v=h.length!==0||d||r!==0||i;return i=d,t=u(h,f,0),r=h.length,v},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(h,d,f){const v=h.clippingPlanes,g=h.clipIntersection,y=h.clipShadows,p=n.get(h);if(!i||v===null||v.length===0||s&&!y)s?u(null):c();else{const m=s?0:r,x=m*4;let w=p.clippingState||null;l.value=w,w=u(v,d,x,f);for(let b=0;b!==x;++b)w[b]=t[b];p.clippingState=w,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=m}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,d,f,v){const g=h!==null?h.length:0;let y=null;if(g!==0){if(y=l.value,v!==!0||y===null){const p=f+g*4,m=d.matrixWorldInverse;o.getNormalMatrix(m),(y===null||y.length<p)&&(y=new Float32Array(p));for(let x=0,w=f;x!==g;++x,w+=4)a.copy(h[x]).applyMatrix4(m,o),a.normal.toArray(y,w),y[w+3]=a.constant}l.value=y,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,y}}function iN(n){let e=new WeakMap;function t(a,o){return o===qv?a.mapping=jp:o===Qv&&(a.mapping=Wp),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const o=a.mapping;if(o===qv||o===Qv)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=n.getRenderTarget(),u=new UE(l.height/2);return u.fromEquirectangularTexture(n,a),e.set(a,u),n.setRenderTarget(c),a.addEventListener("dispose",i),t(u.texture,a.mapping)}else return null}}return a}function i(a){const o=a.target;o.removeEventListener("dispose",i);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}class Qn extends Xy{constructor(e=-1,t=1,r=1,i=-1,s=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,a=r+e,o=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}Qn.prototype.isOrthographicCamera=!0;class Jp extends wn{constructor(e){super(e),this.type="RawShaderMaterial"}}Jp.prototype.isRawShaderMaterial=!0;const Pl=4,ta=8,Ni=Math.pow(2,ta),HE=[.125,.215,.35,.446,.526,.582],GE=ta-Pl+1+HE.length,No=20,pa={[Kn]:0,[fo]:1,[Vy]:2,[IE]:3,[LE]:4,[RE]:5,[Gy]:6},_g=new Qn,{_lodPlanes:Oc,_sizeLods:q_,_sigmas:wh}=oN(),Q_=new Ce;let bg=null;const ka=(1+Math.sqrt(5))/2,ko=1/ka,J_=[new L(1,1,1),new L(-1,1,1),new L(1,1,-1),new L(-1,1,-1),new L(0,ka,ko),new L(0,ka,-ko),new L(ko,0,ka),new L(-ko,0,ka),new L(ka,ko,0),new L(-ka,ko,0)];class sN{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=lN(No),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){bg=this._renderer.getRenderTarget();const s=this._allocateTargets();return this._sceneToCubeUV(e,r,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=t1(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=e1(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<Oc.length;e++)Oc[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(bg),e.scissorTest=!1,_h(e,0,0,e.width,e.height)}_fromTexture(e){bg=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:xn,minFilter:xn,generateMipmaps:!1,type:fa,format:rL,encoding:aN(e)?e.encoding:Vy,depthBuffer:!1},r=K_(t);return r.depthBuffer=!e,this._pingPongRenderTarget=K_(t),r}_compileMaterial(e){const t=new be(Oc[0],e);this._renderer.compile(t,_g)}_sceneToCubeUV(e,t,r,i){const o=new rn(90,1,t,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.outputEncoding,f=u.toneMapping;u.getClearColor(Q_),u.toneMapping=Ja,u.outputEncoding=Kn,u.autoClear=!1;const v=new Pt({name:"PMREM.Background",side:un,depthWrite:!1,depthTest:!1}),g=new be(new ln,v);let y=!1;const p=e.background;p?p.isColor&&(v.color.copy(p),e.background=null,y=!0):(v.color.copy(Q_),y=!0);for(let m=0;m<6;m++){const x=m%3;x==0?(o.up.set(0,l[m],0),o.lookAt(c[m],0,0)):x==1?(o.up.set(0,0,l[m]),o.lookAt(0,c[m],0)):(o.up.set(0,l[m],0),o.lookAt(0,0,c[m])),_h(i,x*Ni,m>2?Ni:0,Ni,Ni),u.setRenderTarget(i),y&&u.render(g,o),u.render(e,o)}g.geometry.dispose(),g.material.dispose(),u.toneMapping=f,u.outputEncoding=d,u.autoClear=h,e.background=p}_setEncoding(e,t){this._renderer.capabilities.isWebGL2===!0&&t.format===bn&&t.type===fa&&t.encoding===fo?e.value=pa[Kn]:e.value=pa[t.encoding]}_textureToCubeUV(e,t){const r=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=t1()):this._equirectShader==null&&(this._equirectShader=e1());const i=e.isCubeTexture?this._cubemapShader:this._equirectShader,s=new be(Oc[0],i),a=i.uniforms;a.envMap.value=e,e.isCubeTexture||a.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(a.inputEncoding,e),this._setEncoding(a.outputEncoding,t.texture),_h(t,0,0,3*Ni,2*Ni),r.setRenderTarget(t),r.render(s,_g)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<GE;i++){const s=Math.sqrt(wh[i]*wh[i]-wh[i-1]*wh[i-1]),a=J_[(i-1)%J_.length];this._blur(e,i-1,i,s,a)}t.autoClear=r}_blur(e,t,r,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",s),this._halfBlur(a,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new be(Oc[i],c),d=c.uniforms,f=q_[r]-1,v=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*No-1),g=s/v,y=isFinite(s)?1+Math.floor(u*g):No;y>No&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${No}`);const p=[];let m=0;for(let C=0;C<No;++C){const A=C/g,F=Math.exp(-A*A/2);p.push(F),C==0?m+=F:C<y&&(m+=2*F)}for(let C=0;C<p.length;C++)p[C]=p[C]/m;d.envMap.value=e.texture,d.samples.value=y,d.weights.value=p,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o),d.dTheta.value=v,d.mipInt.value=ta-r,this._setEncoding(d.inputEncoding,e.texture),this._setEncoding(d.outputEncoding,e.texture);const x=q_[i],w=3*Math.max(0,Ni-2*x),b=(i===0?0:2*Ni)+2*x*(i>ta-Pl?i-ta+Pl:0);_h(t,w,b,3*x,2*x),l.setRenderTarget(t),l.render(h,_g)}}function aN(n){return n===void 0||n.type!==fa?!1:n.encoding===Kn||n.encoding===fo||n.encoding===Gy}function oN(){const n=[],e=[],t=[];let r=ta;for(let i=0;i<GE;i++){const s=Math.pow(2,r);e.push(s);let a=1/s;i>ta-Pl?a=HE[i-ta+Pl-1]:i==0&&(a=0),t.push(a);const o=1/(s-1),l=-o/2,c=1+o/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,f=3,v=2,g=1,y=new Float32Array(f*d*h),p=new Float32Array(v*d*h),m=new Float32Array(g*d*h);for(let w=0;w<h;w++){const b=w%3*2/3-1,C=w>2?0:-1,A=[b,C,0,b+2/3,C,0,b+2/3,C+1,0,b,C,0,b+2/3,C+1,0,b,C+1,0];y.set(A,f*d*w),p.set(u,v*d*w);const F=[w,w,w,w,w,w];m.set(F,g*d*w)}const x=new nt;x.setAttribute("position",new Kt(y,f)),x.setAttribute("uv",new Kt(p,v)),x.setAttribute("faceIndex",new Kt(m,g)),n.push(x),r>Pl&&r--}return{_lodPlanes:n,_sizeLods:e,_sigmas:t}}function K_(n){const e=new dn(3*Ni,3*Ni,n);return e.texture.mapping=Xp,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function _h(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function lN(n){const e=new Float32Array(n),t=new L(0,1,0);return new Jp({name:"SphericalGaussianBlur",defines:{n},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:pa[Kn]},outputEncoding:{value:pa[Kn]}},vertexShader:$y(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${Zy()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Qr,depthTest:!1,depthWrite:!1})}function e1(){const n=new oe(1,1);return new Jp({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:n},inputEncoding:{value:pa[Kn]},outputEncoding:{value:pa[Kn]}},vertexShader:$y(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${Zy()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Qr,depthTest:!1,depthWrite:!1})}function t1(){return new Jp({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:pa[Kn]},outputEncoding:{value:pa[Kn]}},vertexShader:$y(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${Zy()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Qr,depthTest:!1,depthWrite:!1})}function $y(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Zy(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function cN(n){let e=new WeakMap,t=null;function r(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const l=o.mapping,c=l===qv||l===Qv,u=l===jp||l===Wp;if(c||u){if(e.has(o))return e.get(o).texture;{const h=o.image;if(c&&h&&h.height>0||u&&h&&i(h)){const d=n.getRenderTarget();t===null&&(t=new sN(n));const f=c?t.fromEquirectangular(o):t.fromCubemap(o);return e.set(o,f),n.setRenderTarget(d),o.addEventListener("dispose",s),f.texture}else return null}}}return o}function i(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:a}}function uN(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(r){r.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(r){const i=t(r);return i===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function dN(n,e,t,r){const i={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const v in d.attributes)e.remove(d.attributes[v]);d.removeEventListener("dispose",a),delete i[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function o(h,d){return i[d.id]===!0||(d.addEventListener("dispose",a),i[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const v in d)e.update(d[v],34962);const f=h.morphAttributes;for(const v in f){const g=f[v];for(let y=0,p=g.length;y<p;y++)e.update(g[y],34962)}}function c(h){const d=[],f=h.index,v=h.attributes.position;let g=0;if(f!==null){const m=f.array;g=f.version;for(let x=0,w=m.length;x<w;x+=3){const b=m[x+0],C=m[x+1],A=m[x+2];d.push(b,C,C,A,A,b)}}else{const m=v.array;g=v.version;for(let x=0,w=m.length/3-1;x<w;x+=3){const b=x+0,C=x+1,A=x+2;d.push(b,C,C,A,A,b)}}const y=new(DE(d)>65535?zE:OE)(d,1);y.version=g;const p=s.get(h);p&&e.remove(p),s.set(h,y)}function u(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function hN(n,e,t,r){const i=r.isWebGL2;let s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,f){n.drawElements(s,f,o,d*l),t.update(f,s,1)}function h(d,f,v){if(v===0)return;let g,y;if(i)g=n,y="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[y](s,f,o,d*l,v),t.update(f,s,v)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function fN(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(t.calls++,a){case 4:t.triangles+=o*(s/3);break;case 1:t.lines+=o*(s/2);break;case 3:t.lines+=o*(s-1);break;case 2:t.lines+=o*s;break;case 0:t.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}class qy extends Hn{constructor(e=null,t=1,r=1,i=1){super(null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=xn,this.minFilter=xn,this.wrapR=Pr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}qy.prototype.isDataTexture2DArray=!0;function pN(n,e){return n[0]-e[0]}function mN(n,e){return Math.abs(e[1])-Math.abs(n[1])}function n1(n,e){let t=1;const r=e.isInterleavedBufferAttribute?e.data.array:e.array;r instanceof Int8Array?t=127:r instanceof Int16Array?t=32767:r instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),n.divideScalar(t)}function gN(n,e,t){const r={},i=new Float32Array(8),s=new WeakMap,a=new L,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){const f=c.morphTargetInfluences;if(e.isWebGL2===!0){const v=u.morphAttributes.position.length;let g=s.get(u);if(g===void 0||g.count!==v){g!==void 0&&g.texture.dispose();const m=u.morphAttributes.normal!==void 0,x=u.morphAttributes.position,w=u.morphAttributes.normal||[],b=u.attributes.position.count,C=m===!0?2:1;let A=b*C,F=1;A>e.maxTextureSize&&(F=Math.ceil(A/e.maxTextureSize),A=e.maxTextureSize);const N=new Float32Array(A*F*4*v),O=new qy(N,A,F,v);O.format=bn,O.type=Us;const H=C*4;for(let D=0;D<v;D++){const U=x[D],_=w[D],z=A*F*4*D;for(let j=0;j<U.count;j++){a.fromBufferAttribute(U,j),U.normalized===!0&&n1(a,U);const R=j*H;N[z+R+0]=a.x,N[z+R+1]=a.y,N[z+R+2]=a.z,N[z+R+3]=0,m===!0&&(a.fromBufferAttribute(_,j),_.normalized===!0&&n1(a,_),N[z+R+4]=a.x,N[z+R+5]=a.y,N[z+R+6]=a.z,N[z+R+7]=0)}}g={count:v,texture:O,size:new oe(A,F)},s.set(u,g)}let y=0;for(let m=0;m<f.length;m++)y+=f[m];const p=u.morphTargetsRelative?1:1-y;d.getUniforms().setValue(n,"morphTargetBaseInfluence",p),d.getUniforms().setValue(n,"morphTargetInfluences",f),d.getUniforms().setValue(n,"morphTargetsTexture",g.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",g.size)}else{const v=f===void 0?0:f.length;let g=r[u.id];if(g===void 0||g.length!==v){g=[];for(let w=0;w<v;w++)g[w]=[w,0];r[u.id]=g}for(let w=0;w<v;w++){const b=g[w];b[0]=w,b[1]=f[w]}g.sort(mN);for(let w=0;w<8;w++)w<v&&g[w][1]?(o[w][0]=g[w][0],o[w][1]=g[w][1]):(o[w][0]=Number.MAX_SAFE_INTEGER,o[w][1]=0);o.sort(pN);const y=u.morphAttributes.position,p=u.morphAttributes.normal;let m=0;for(let w=0;w<8;w++){const b=o[w],C=b[0],A=b[1];C!==Number.MAX_SAFE_INTEGER&&A?(y&&u.getAttribute("morphTarget"+w)!==y[C]&&u.setAttribute("morphTarget"+w,y[C]),p&&u.getAttribute("morphNormal"+w)!==p[C]&&u.setAttribute("morphNormal"+w,p[C]),i[w]=A,m+=A):(y&&u.hasAttribute("morphTarget"+w)===!0&&u.deleteAttribute("morphTarget"+w),p&&u.hasAttribute("morphNormal"+w)===!0&&u.deleteAttribute("morphNormal"+w),i[w]=0)}const x=u.morphTargetsRelative?1:1-m;d.getUniforms().setValue(n,"morphTargetBaseInfluence",x),d.getUniforms().setValue(n,"morphTargetInfluences",i)}}return{update:l}}function vN(n,e,t,r){let i=new WeakMap;function s(l){const c=r.render.frame,u=l.geometry,h=e.get(l,u);return i.get(h)!==c&&(e.update(h),i.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),h}function a(){i=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:a}}class VE extends Hn{constructor(e=null,t=1,r=1,i=1){super(null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=xn,this.minFilter=xn,this.wrapR=Pr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}VE.prototype.isDataTexture3D=!0;const jE=new Hn,yN=new qy,xN=new VE,WE=new qp,r1=[],i1=[],s1=new Float32Array(16),a1=new Float32Array(9),o1=new Float32Array(4);function lc(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=r1[i];if(s===void 0&&(s=new Float32Array(i),r1[i]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,n[a].toArray(s,o)}return s}function lr(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function er(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function XE(n,e){let t=i1[e];t===void 0&&(t=new Int32Array(e),i1[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function wN(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function _N(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(lr(t,e))return;n.uniform2fv(this.addr,e),er(t,e)}}function bN(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(lr(t,e))return;n.uniform3fv(this.addr,e),er(t,e)}}function SN(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(lr(t,e))return;n.uniform4fv(this.addr,e),er(t,e)}}function MN(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(lr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),er(t,e)}else{if(lr(t,r))return;o1.set(r),n.uniformMatrix2fv(this.addr,!1,o1),er(t,r)}}function EN(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(lr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),er(t,e)}else{if(lr(t,r))return;a1.set(r),n.uniformMatrix3fv(this.addr,!1,a1),er(t,r)}}function AN(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(lr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),er(t,e)}else{if(lr(t,r))return;s1.set(r),n.uniformMatrix4fv(this.addr,!1,s1),er(t,r)}}function TN(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function CN(n,e){const t=this.cache;lr(t,e)||(n.uniform2iv(this.addr,e),er(t,e))}function PN(n,e){const t=this.cache;lr(t,e)||(n.uniform3iv(this.addr,e),er(t,e))}function IN(n,e){const t=this.cache;lr(t,e)||(n.uniform4iv(this.addr,e),er(t,e))}function LN(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function RN(n,e){const t=this.cache;lr(t,e)||(n.uniform2uiv(this.addr,e),er(t,e))}function FN(n,e){const t=this.cache;lr(t,e)||(n.uniform3uiv(this.addr,e),er(t,e))}function DN(n,e){const t=this.cache;lr(t,e)||(n.uniform4uiv(this.addr,e),er(t,e))}function NN(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.safeSetTexture2D(e||jE,i)}function kN(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||xN,i)}function ON(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.safeSetTextureCube(e||WE,i)}function zN(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||yN,i)}function UN(n){switch(n){case 5126:return wN;case 35664:return _N;case 35665:return bN;case 35666:return SN;case 35674:return MN;case 35675:return EN;case 35676:return AN;case 5124:case 35670:return TN;case 35667:case 35671:return CN;case 35668:case 35672:return PN;case 35669:case 35673:return IN;case 5125:return LN;case 36294:return RN;case 36295:return FN;case 36296:return DN;case 35678:case 36198:case 36298:case 36306:case 35682:return NN;case 35679:case 36299:case 36307:return kN;case 35680:case 36300:case 36308:case 36293:return ON;case 36289:case 36303:case 36311:case 36292:return zN}}function BN(n,e){n.uniform1fv(this.addr,e)}function HN(n,e){const t=lc(e,this.size,2);n.uniform2fv(this.addr,t)}function GN(n,e){const t=lc(e,this.size,3);n.uniform3fv(this.addr,t)}function VN(n,e){const t=lc(e,this.size,4);n.uniform4fv(this.addr,t)}function jN(n,e){const t=lc(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function WN(n,e){const t=lc(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function XN(n,e){const t=lc(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function YN(n,e){n.uniform1iv(this.addr,e)}function $N(n,e){n.uniform2iv(this.addr,e)}function ZN(n,e){n.uniform3iv(this.addr,e)}function qN(n,e){n.uniform4iv(this.addr,e)}function QN(n,e){n.uniform1uiv(this.addr,e)}function JN(n,e){n.uniform2uiv(this.addr,e)}function KN(n,e){n.uniform3uiv(this.addr,e)}function ek(n,e){n.uniform4uiv(this.addr,e)}function tk(n,e,t){const r=e.length,i=XE(t,r);n.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)t.safeSetTexture2D(e[s]||jE,i[s])}function nk(n,e,t){const r=e.length,i=XE(t,r);n.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)t.safeSetTextureCube(e[s]||WE,i[s])}function rk(n){switch(n){case 5126:return BN;case 35664:return HN;case 35665:return GN;case 35666:return VN;case 35674:return jN;case 35675:return WN;case 35676:return XN;case 5124:case 35670:return YN;case 35667:case 35671:return $N;case 35668:case 35672:return ZN;case 35669:case 35673:return qN;case 5125:return QN;case 36294:return JN;case 36295:return KN;case 36296:return ek;case 35678:case 36198:case 36298:case 36306:case 35682:return tk;case 35680:case 36300:case 36308:case 36293:return nk}}function ik(n,e,t){this.id=n,this.addr=t,this.cache=[],this.setValue=UN(e.type)}function YE(n,e,t){this.id=n,this.addr=t,this.cache=[],this.size=e.size,this.setValue=rk(e.type)}YE.prototype.updateCache=function(n){const e=this.cache;n instanceof Float32Array&&e.length!==n.length&&(this.cache=new Float32Array(n.length)),er(e,n)};function $E(n){this.id=n,this.seq=[],this.map={}}$E.prototype.setValue=function(n,e,t){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const a=r[i];a.setValue(n,e[a.id],t)}};const Sg=/(\w+)(\])?(\[|\.)?/g;function l1(n,e){n.seq.push(e),n.map[e.id]=e}function sk(n,e,t){const r=n.name,i=r.length;for(Sg.lastIndex=0;;){const s=Sg.exec(r),a=Sg.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===i){l1(t,c===void 0?new ik(o,n,e):new YE(o,n,e));break}else{let h=t.map[o];h===void 0&&(h=new $E(o),l1(t,h)),t=h}}}function na(n,e){this.seq=[],this.map={};const t=n.getProgramParameter(e,35718);for(let r=0;r<t;++r){const i=n.getActiveUniform(e,r),s=n.getUniformLocation(e,i.name);sk(i,s,this)}}na.prototype.setValue=function(n,e,t,r){const i=this.map[e];i!==void 0&&i.setValue(n,t,r)};na.prototype.setOptional=function(n,e,t){const r=e[t];r!==void 0&&this.setValue(n,t,r)};na.upload=function(n,e,t,r){for(let i=0,s=e.length;i!==s;++i){const a=e[i],o=t[a.id];o.needsUpdate!==!1&&a.setValue(n,o.value,r)}};na.seqWithValue=function(n,e){const t=[];for(let r=0,i=n.length;r!==i;++r){const s=n[r];s.id in e&&t.push(s)}return t};function c1(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}let ak=0;function ok(n){const e=n.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function ZE(n){switch(n){case Kn:return["Linear","( value )"];case fo:return["sRGB","( value )"];case Vy:return["RGBE","( value )"];case IE:return["RGBM","( value, 7.0 )"];case LE:return["RGBM","( value, 16.0 )"];case RE:return["RGBD","( value, 256.0 )"];case Gy:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case jL:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}function u1(n,e,t){const r=n.getShaderParameter(e,35713),i=n.getShaderInfoLog(e).trim();return r&&i===""?"":t.toUpperCase()+`

`+i+`

`+ok(n.getShaderSource(e))}function Oo(n,e){const t=ZE(e);return"vec4 "+n+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function lk(n,e){const t=ZE(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function ck(n,e){let t;switch(e){case GI:t="Linear";break;case VI:t="Reinhard";break;case jI:t="OptimizedCineon";break;case WI:t="ACESFilmic";break;case XI:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function uk(n){return[n.extensionDerivatives||n.envMapCubeUV||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(nu).join(`
`)}function dk(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function hk(n,e){const t={},r=n.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),a=s.name;let o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),t[a]={type:s.type,location:n.getAttribLocation(e,a),locationSize:o}}return t}function nu(n){return n!==""}function d1(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function h1(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const fk=/^[ \t]*#include +<([\w\d./]+)>/gm;function e0(n){return n.replace(fk,pk)}function pk(n,e){const t=ct[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return e0(t)}const mk=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,gk=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function f1(n){return n.replace(gk,qE).replace(mk,vk)}function vk(n,e,t,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),qE(n,e,t,r)}function qE(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function p1(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function yk(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===ME?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===wI?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===tu&&(e="SHADOWMAP_TYPE_VSM"),e}function xk(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case jp:case Wp:e="ENVMAP_TYPE_CUBE";break;case Xp:case By:e="ENVMAP_TYPE_CUBE_UV";break}return e}function wk(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Wp:case By:e="ENVMAP_MODE_REFRACTION";break}return e}function _k(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Vp:e="ENVMAP_BLENDING_MULTIPLY";break;case BI:e="ENVMAP_BLENDING_MIX";break;case HI:e="ENVMAP_BLENDING_ADD";break}return e}function bk(n,e,t,r){const i=n.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=yk(t),c=xk(t),u=wk(t),h=_k(t),d=n.gammaFactor>0?n.gammaFactor:1,f=t.isWebGL2?"":uk(t),v=dk(s),g=i.createProgram();let y,p,m=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=[v].filter(nu).join(`
`),y.length>0&&(y+=`
`),p=[f,v].filter(nu).join(`
`),p.length>0&&(p+=`
`)):(y=[p1(t),"#define SHADER_NAME "+t.shaderName,v,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(nu).join(`
`),p=[f,p1(t),"#define SHADER_NAME "+t.shaderName,v,"#define GAMMA_FACTOR "+d,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ja?"#define TONE_MAPPING":"",t.toneMapping!==Ja?ct.tonemapping_pars_fragment:"",t.toneMapping!==Ja?ck("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.format===Tl?"#define OPAQUE":"",ct.encodings_pars_fragment,t.map?Oo("mapTexelToLinear",t.mapEncoding):"",t.matcap?Oo("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?Oo("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?Oo("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularTintMap?Oo("specularTintMapTexelToLinear",t.specularTintMapEncoding):"",t.lightMap?Oo("lightMapTexelToLinear",t.lightMapEncoding):"",lk("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(nu).join(`
`)),a=e0(a),a=d1(a,t),a=h1(a,t),o=e0(o),o=d1(o,t),o=h1(o,t),a=f1(a),o=f1(o),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(m=`#version 300 es
`,y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,p=["#define varying in",t.glslVersion===z_?"":"out highp vec4 pc_fragColor;",t.glslVersion===z_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const x=m+y+a,w=m+p+o,b=c1(i,35633,x),C=c1(i,35632,w);if(i.attachShader(g,b),i.attachShader(g,C),t.index0AttributeName!==void 0?i.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g),n.debug.checkShaderErrors){const N=i.getProgramInfoLog(g).trim(),O=i.getShaderInfoLog(b).trim(),H=i.getShaderInfoLog(C).trim();let D=!0,U=!0;if(i.getProgramParameter(g,35714)===!1){D=!1;const _=u1(i,b,"vertex"),z=u1(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,35715)+`

Program Info Log: `+N+`
`+_+`
`+z)}else N!==""?console.warn("THREE.WebGLProgram: Program Info Log:",N):(O===""||H==="")&&(U=!1);U&&(this.diagnostics={runnable:D,programLog:N,vertexShader:{log:O,prefix:y},fragmentShader:{log:H,prefix:p}})}i.deleteShader(b),i.deleteShader(C);let A;this.getUniforms=function(){return A===void 0&&(A=new na(i,g)),A};let F;return this.getAttributes=function(){return F===void 0&&(F=hk(i,g)),F},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.name=t.shaderName,this.id=ak++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=b,this.fragmentShader=C,this}function Sk(n,e,t,r,i,s,a){const o=[],l=i.isWebGL2,c=i.logarithmicDepthBuffer,u=i.floatVertexTextures,h=i.maxVertexUniforms,d=i.vertexTextures;let f=i.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},g=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheen","transmission","transmissionMap","thicknessMap"];function y(A){const N=A.skeleton.bones;if(u)return 1024;{const H=Math.floor((h-20)/4),D=Math.min(H,N.length);return D<N.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+N.length+" bones. This GPU supports "+D+"."),0):D}}function p(A){let F;return A&&A.isTexture?F=A.encoding:A&&A.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),F=A.texture.encoding):F=Kn,l&&A&&A.isTexture&&A.format===bn&&A.type===fa&&A.encoding===fo&&(F=Kn),F}function m(A,F,N,O,H){const D=O.fog,U=A.isMeshStandardMaterial?O.environment:null,_=(A.isMeshStandardMaterial?t:e).get(A.envMap||U),z=v[A.type],j=H.isSkinnedMesh?y(H):0;A.precision!==null&&(f=i.getMaxPrecision(A.precision),f!==A.precision&&console.warn("THREE.WebGLProgram.getParameters:",A.precision,"not supported, using",f,"instead."));let R,ee;if(z){const $=Oi[z];R=$.vertexShader,ee=$.fragmentShader}else R=A.vertexShader,ee=A.fragmentShader;const J=n.getRenderTarget(),le=A.alphaTest>0,k=A.clearcoat>0;return{isWebGL2:l,shaderID:z,shaderName:A.type,vertexShader:R,fragmentShader:ee,defines:A.defines,isRawShaderMaterial:A.isRawShaderMaterial===!0,glslVersion:A.glslVersion,precision:f,instancing:H.isInstancedMesh===!0,instancingColor:H.isInstancedMesh===!0&&H.instanceColor!==null,supportsVertexTextures:d,outputEncoding:J!==null?p(J.texture):n.outputEncoding,map:!!A.map,mapEncoding:p(A.map),matcap:!!A.matcap,matcapEncoding:p(A.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:p(_),envMapCubeUV:!!_&&(_.mapping===Xp||_.mapping===By),lightMap:!!A.lightMap,lightMapEncoding:p(A.lightMap),aoMap:!!A.aoMap,emissiveMap:!!A.emissiveMap,emissiveMapEncoding:p(A.emissiveMap),bumpMap:!!A.bumpMap,normalMap:!!A.normalMap,objectSpaceNormalMap:A.normalMapType===XL,tangentSpaceNormalMap:A.normalMapType===rc,clearcoat:k,clearcoatMap:k&&!!A.clearcoatMap,clearcoatRoughnessMap:k&&!!A.clearcoatRoughnessMap,clearcoatNormalMap:k&&!!A.clearcoatNormalMap,displacementMap:!!A.displacementMap,roughnessMap:!!A.roughnessMap,metalnessMap:!!A.metalnessMap,specularMap:!!A.specularMap,specularIntensityMap:!!A.specularIntensityMap,specularTintMap:!!A.specularTintMap,specularTintMapEncoding:p(A.specularTintMap),alphaMap:!!A.alphaMap,alphaTest:le,gradientMap:!!A.gradientMap,sheen:A.sheen>0,transmission:A.transmission>0,transmissionMap:!!A.transmissionMap,thicknessMap:!!A.thicknessMap,combine:A.combine,vertexTangents:!!A.normalMap&&!!H.geometry&&!!H.geometry.attributes.tangent,vertexColors:A.vertexColors,vertexAlphas:A.vertexColors===!0&&!!H.geometry&&!!H.geometry.attributes.color&&H.geometry.attributes.color.itemSize===4,vertexUvs:!!A.map||!!A.bumpMap||!!A.normalMap||!!A.specularMap||!!A.alphaMap||!!A.emissiveMap||!!A.roughnessMap||!!A.metalnessMap||!!A.clearcoatMap||!!A.clearcoatRoughnessMap||!!A.clearcoatNormalMap||!!A.displacementMap||!!A.transmissionMap||!!A.thicknessMap||!!A.specularIntensityMap||!!A.specularTintMap,uvsVertexOnly:!(!!A.map||!!A.bumpMap||!!A.normalMap||!!A.specularMap||!!A.alphaMap||!!A.emissiveMap||!!A.roughnessMap||!!A.metalnessMap||!!A.clearcoatNormalMap||A.transmission>0||!!A.transmissionMap||!!A.thicknessMap||!!A.specularIntensityMap||!!A.specularTintMap)&&!!A.displacementMap,fog:!!D,useFog:A.fog,fogExp2:D&&D.isFogExp2,flatShading:!!A.flatShading,sizeAttenuation:A.sizeAttenuation,logarithmicDepthBuffer:c,skinning:H.isSkinnedMesh===!0&&j>0,maxBones:j,useVertexTexture:u,morphTargets:!!H.geometry&&!!H.geometry.morphAttributes.position,morphNormals:!!H.geometry&&!!H.geometry.morphAttributes.normal,morphTargetsCount:!!H.geometry&&!!H.geometry.morphAttributes.position?H.geometry.morphAttributes.position.length:0,numDirLights:F.directional.length,numPointLights:F.point.length,numSpotLights:F.spot.length,numRectAreaLights:F.rectArea.length,numHemiLights:F.hemi.length,numDirLightShadows:F.directionalShadowMap.length,numPointLightShadows:F.pointShadowMap.length,numSpotLightShadows:F.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,format:A.format,dithering:A.dithering,shadowMapEnabled:n.shadowMap.enabled&&N.length>0,shadowMapType:n.shadowMap.type,toneMapping:A.toneMapped?n.toneMapping:Ja,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:A.premultipliedAlpha,doubleSided:A.side===Un,flipSided:A.side===un,depthPacking:A.depthPacking!==void 0?A.depthPacking:!1,index0AttributeName:A.index0AttributeName,extensionDerivatives:A.extensions&&A.extensions.derivatives,extensionFragDepth:A.extensions&&A.extensions.fragDepth,extensionDrawBuffers:A.extensions&&A.extensions.drawBuffers,extensionShaderTextureLOD:A.extensions&&A.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:A.customProgramCacheKey()}}function x(A){const F=[];if(A.shaderID?F.push(A.shaderID):(F.push(A.fragmentShader),F.push(A.vertexShader)),A.defines!==void 0)for(const N in A.defines)F.push(N),F.push(A.defines[N]);if(A.isRawShaderMaterial===!1){for(let N=0;N<g.length;N++)F.push(A[g[N]]);F.push(n.outputEncoding),F.push(n.gammaFactor)}return F.push(A.customProgramCacheKey),F.join()}function w(A){const F=v[A.type];let N;if(F){const O=Oi[F];N=Zp.clone(O.uniforms)}else N=A.uniforms;return N}function b(A,F){let N;for(let O=0,H=o.length;O<H;O++){const D=o[O];if(D.cacheKey===F){N=D,++N.usedTimes;break}}return N===void 0&&(N=new bk(n,F,A,s),o.push(N)),N}function C(A){if(--A.usedTimes===0){const F=o.indexOf(A);o[F]=o[o.length-1],o.pop(),A.destroy()}}return{getParameters:m,getProgramCacheKey:x,getUniforms:w,acquireProgram:b,releaseProgram:C,programs:o}}function Mk(){let n=new WeakMap;function e(s){let a=n.get(s);return a===void 0&&(a={},n.set(s,a)),a}function t(s){n.delete(s)}function r(s,a,o){n.get(s)[a]=o}function i(){n=new WeakMap}return{get:e,remove:t,update:r,dispose:i}}function Ek(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.program!==e.program?n.program.id-e.program.id:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function m1(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function g1(n){const e=[];let t=0;const r=[],i=[],s=[],a={id:-1};function o(){t=0,r.length=0,i.length=0,s.length=0}function l(f,v,g,y,p,m){let x=e[t];const w=n.get(g);return x===void 0?(x={id:f.id,object:f,geometry:v,material:g,program:w.program||a,groupOrder:y,renderOrder:f.renderOrder,z:p,group:m},e[t]=x):(x.id=f.id,x.object=f,x.geometry=v,x.material=g,x.program=w.program||a,x.groupOrder=y,x.renderOrder=f.renderOrder,x.z=p,x.group=m),t++,x}function c(f,v,g,y,p,m){const x=l(f,v,g,y,p,m);g.transmission>0?i.push(x):g.transparent===!0?s.push(x):r.push(x)}function u(f,v,g,y,p,m){const x=l(f,v,g,y,p,m);g.transmission>0?i.unshift(x):g.transparent===!0?s.unshift(x):r.unshift(x)}function h(f,v){r.length>1&&r.sort(f||Ek),i.length>1&&i.sort(v||m1),s.length>1&&s.sort(v||m1)}function d(){for(let f=t,v=e.length;f<v;f++){const g=e[f];if(g.id===null)break;g.id=null,g.object=null,g.geometry=null,g.material=null,g.program=null,g.group=null}}return{opaque:r,transmissive:i,transparent:s,init:o,push:c,unshift:u,finish:d,sort:h}}function Ak(n){let e=new WeakMap;function t(i,s){let a;return e.has(i)===!1?(a=new g1(n),e.set(i,[a])):s>=e.get(i).length?(a=new g1(n),e.get(i).push(a)):a=e.get(i)[s],a}function r(){e=new WeakMap}return{get:t,dispose:r}}function Tk(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new L,color:new Ce};break;case"SpotLight":t={position:new L,direction:new L,color:new Ce,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new L,color:new Ce,distance:0,decay:0};break;case"HemisphereLight":t={direction:new L,skyColor:new Ce,groundColor:new Ce};break;case"RectAreaLight":t={color:new Ce,position:new L,halfWidth:new L,halfHeight:new L};break}return n[e.id]=t,t}}}function Ck(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oe};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oe,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let Pk=0;function Ik(n,e){return(e.castShadow?1:0)-(n.castShadow?1:0)}function Lk(n,e){const t=new Tk,r=Ck(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)i.probe.push(new L);const s=new L,a=new ze,o=new ze;function l(u,h){let d=0,f=0,v=0;for(let N=0;N<9;N++)i.probe[N].set(0,0,0);let g=0,y=0,p=0,m=0,x=0,w=0,b=0,C=0;u.sort(Ik);const A=h!==!0?Math.PI:1;for(let N=0,O=u.length;N<O;N++){const H=u[N],D=H.color,U=H.intensity,_=H.distance,z=H.shadow&&H.shadow.map?H.shadow.map.texture:null;if(H.isAmbientLight)d+=D.r*U*A,f+=D.g*U*A,v+=D.b*U*A;else if(H.isLightProbe)for(let j=0;j<9;j++)i.probe[j].addScaledVector(H.sh.coefficients[j],U);else if(H.isDirectionalLight){const j=t.get(H);if(j.color.copy(H.color).multiplyScalar(H.intensity*A),H.castShadow){const R=H.shadow,ee=r.get(H);ee.shadowBias=R.bias,ee.shadowNormalBias=R.normalBias,ee.shadowRadius=R.radius,ee.shadowMapSize=R.mapSize,i.directionalShadow[g]=ee,i.directionalShadowMap[g]=z,i.directionalShadowMatrix[g]=H.shadow.matrix,w++}i.directional[g]=j,g++}else if(H.isSpotLight){const j=t.get(H);if(j.position.setFromMatrixPosition(H.matrixWorld),j.color.copy(D).multiplyScalar(U*A),j.distance=_,j.coneCos=Math.cos(H.angle),j.penumbraCos=Math.cos(H.angle*(1-H.penumbra)),j.decay=H.decay,H.castShadow){const R=H.shadow,ee=r.get(H);ee.shadowBias=R.bias,ee.shadowNormalBias=R.normalBias,ee.shadowRadius=R.radius,ee.shadowMapSize=R.mapSize,i.spotShadow[p]=ee,i.spotShadowMap[p]=z,i.spotShadowMatrix[p]=H.shadow.matrix,C++}i.spot[p]=j,p++}else if(H.isRectAreaLight){const j=t.get(H);j.color.copy(D).multiplyScalar(U),j.halfWidth.set(H.width*.5,0,0),j.halfHeight.set(0,H.height*.5,0),i.rectArea[m]=j,m++}else if(H.isPointLight){const j=t.get(H);if(j.color.copy(H.color).multiplyScalar(H.intensity*A),j.distance=H.distance,j.decay=H.decay,H.castShadow){const R=H.shadow,ee=r.get(H);ee.shadowBias=R.bias,ee.shadowNormalBias=R.normalBias,ee.shadowRadius=R.radius,ee.shadowMapSize=R.mapSize,ee.shadowCameraNear=R.camera.near,ee.shadowCameraFar=R.camera.far,i.pointShadow[y]=ee,i.pointShadowMap[y]=z,i.pointShadowMatrix[y]=H.shadow.matrix,b++}i.point[y]=j,y++}else if(H.isHemisphereLight){const j=t.get(H);j.skyColor.copy(H.color).multiplyScalar(U*A),j.groundColor.copy(H.groundColor).multiplyScalar(U*A),i.hemi[x]=j,x++}}m>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ie.LTC_FLOAT_1,i.rectAreaLTC2=Ie.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=Ie.LTC_HALF_1,i.rectAreaLTC2=Ie.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=d,i.ambient[1]=f,i.ambient[2]=v;const F=i.hash;(F.directionalLength!==g||F.pointLength!==y||F.spotLength!==p||F.rectAreaLength!==m||F.hemiLength!==x||F.numDirectionalShadows!==w||F.numPointShadows!==b||F.numSpotShadows!==C)&&(i.directional.length=g,i.spot.length=p,i.rectArea.length=m,i.point.length=y,i.hemi.length=x,i.directionalShadow.length=w,i.directionalShadowMap.length=w,i.pointShadow.length=b,i.pointShadowMap.length=b,i.spotShadow.length=C,i.spotShadowMap.length=C,i.directionalShadowMatrix.length=w,i.pointShadowMatrix.length=b,i.spotShadowMatrix.length=C,F.directionalLength=g,F.pointLength=y,F.spotLength=p,F.rectAreaLength=m,F.hemiLength=x,F.numDirectionalShadows=w,F.numPointShadows=b,F.numSpotShadows=C,i.version=Pk++)}function c(u,h){let d=0,f=0,v=0,g=0,y=0;const p=h.matrixWorldInverse;for(let m=0,x=u.length;m<x;m++){const w=u[m];if(w.isDirectionalLight){const b=i.directional[d];b.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),b.direction.sub(s),b.direction.transformDirection(p),d++}else if(w.isSpotLight){const b=i.spot[v];b.position.setFromMatrixPosition(w.matrixWorld),b.position.applyMatrix4(p),b.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),b.direction.sub(s),b.direction.transformDirection(p),v++}else if(w.isRectAreaLight){const b=i.rectArea[g];b.position.setFromMatrixPosition(w.matrixWorld),b.position.applyMatrix4(p),o.identity(),a.copy(w.matrixWorld),a.premultiply(p),o.extractRotation(a),b.halfWidth.set(w.width*.5,0,0),b.halfHeight.set(0,w.height*.5,0),b.halfWidth.applyMatrix4(o),b.halfHeight.applyMatrix4(o),g++}else if(w.isPointLight){const b=i.point[f];b.position.setFromMatrixPosition(w.matrixWorld),b.position.applyMatrix4(p),f++}else if(w.isHemisphereLight){const b=i.hemi[y];b.direction.setFromMatrixPosition(w.matrixWorld),b.direction.transformDirection(p),b.direction.normalize(),y++}}}return{setup:l,setupView:c,state:i}}function v1(n,e){const t=new Lk(n,e),r=[],i=[];function s(){r.length=0,i.length=0}function a(h){r.push(h)}function o(h){i.push(h)}function l(h){t.setup(r,h)}function c(h){t.setupView(r,h)}return{init:s,state:{lightsArray:r,shadowsArray:i,lights:t},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function Rk(n,e){let t=new WeakMap;function r(s,a=0){let o;return t.has(s)===!1?(o=new v1(n,e),t.set(s,[o])):a>=t.get(s).length?(o=new v1(n,e),t.get(s).push(o)):o=t.get(s)[a],o}function i(){t=new WeakMap}return{get:r,dispose:i}}class Kp extends nr{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=WL,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Kp.prototype.isMeshDepthMaterial=!0;class QE extends nr{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new L,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}QE.prototype.isMeshDistanceMaterial=!0;const Fk=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Dk=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
uniform float samples;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function JE(n,e,t){let r=new Qp;const i=new oe,s=new oe,a=new Tt,o=new Kp({depthPacking:jy}),l=new QE,c={},u=t.maxTextureSize,h={0:un,1:Bl,2:Un},d=new wn({uniforms:{shadow_pass:{value:null},resolution:{value:new oe},radius:{value:4},samples:{value:8}},vertexShader:Fk,fragmentShader:Dk}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const v=new nt;v.setAttribute("position",new Kt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new be(v,d),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ME,this.render=function(w,b,C){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||w.length===0)return;const A=n.getRenderTarget(),F=n.getActiveCubeFace(),N=n.getActiveMipmapLevel(),O=n.state;O.setBlending(Qr),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);for(let H=0,D=w.length;H<D;H++){const U=w[H],_=U.shadow;if(_===void 0){console.warn("THREE.WebGLShadowMap:",U,"has no shadow.");continue}if(_.autoUpdate===!1&&_.needsUpdate===!1)continue;i.copy(_.mapSize);const z=_.getFrameExtents();if(i.multiply(z),s.copy(_.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/z.x),i.x=s.x*z.x,_.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/z.y),i.y=s.y*z.y,_.mapSize.y=s.y)),_.map===null&&!_.isPointLightShadow&&this.type===tu){const R={minFilter:_n,magFilter:_n,format:bn};_.map=new dn(i.x,i.y,R),_.map.texture.name=U.name+".shadowMap",_.mapPass=new dn(i.x,i.y,R),_.camera.updateProjectionMatrix()}if(_.map===null){const R={minFilter:xn,magFilter:xn,format:bn};_.map=new dn(i.x,i.y,R),_.map.texture.name=U.name+".shadowMap",_.camera.updateProjectionMatrix()}n.setRenderTarget(_.map),n.clear();const j=_.getViewportCount();for(let R=0;R<j;R++){const ee=_.getViewport(R);a.set(s.x*ee.x,s.y*ee.y,s.x*ee.z,s.y*ee.w),O.viewport(a),_.updateMatrices(U,R),r=_.getFrustum(),x(b,C,_.camera,U,this.type)}!_.isPointLightShadow&&this.type===tu&&p(_,C),_.needsUpdate=!1}y.needsUpdate=!1,n.setRenderTarget(A,F,N)};function p(w,b){const C=e.update(g);d.uniforms.shadow_pass.value=w.map.texture,d.uniforms.resolution.value=w.mapSize,d.uniforms.radius.value=w.radius,d.uniforms.samples.value=w.blurSamples,n.setRenderTarget(w.mapPass),n.clear(),n.renderBufferDirect(b,null,C,d,g,null),f.uniforms.shadow_pass.value=w.mapPass.texture,f.uniforms.resolution.value=w.mapSize,f.uniforms.radius.value=w.radius,f.uniforms.samples.value=w.blurSamples,n.setRenderTarget(w.map),n.clear(),n.renderBufferDirect(b,null,C,f,g,null)}function m(w,b,C,A,F,N,O){let H=null;const D=A.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(D!==void 0?H=D:H=A.isPointLight===!0?l:o,n.localClippingEnabled&&C.clipShadows===!0&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0){const U=H.uuid,_=C.uuid;let z=c[U];z===void 0&&(z={},c[U]=z);let j=z[_];j===void 0&&(j=H.clone(),z[_]=j),H=j}return H.visible=C.visible,H.wireframe=C.wireframe,O===tu?H.side=C.shadowSide!==null?C.shadowSide:C.side:H.side=C.shadowSide!==null?C.shadowSide:h[C.side],H.alphaMap=C.alphaMap,H.alphaTest=C.alphaTest,H.clipShadows=C.clipShadows,H.clippingPlanes=C.clippingPlanes,H.clipIntersection=C.clipIntersection,H.displacementMap=C.displacementMap,H.displacementScale=C.displacementScale,H.displacementBias=C.displacementBias,H.wireframeLinewidth=C.wireframeLinewidth,H.linewidth=C.linewidth,A.isPointLight===!0&&H.isMeshDistanceMaterial===!0&&(H.referencePosition.setFromMatrixPosition(A.matrixWorld),H.nearDistance=F,H.farDistance=N),H}function x(w,b,C,A,F){if(w.visible===!1)return;if(w.layers.test(b.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&F===tu)&&(!w.frustumCulled||r.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,w.matrixWorld);const H=e.update(w),D=w.material;if(Array.isArray(D)){const U=H.groups;for(let _=0,z=U.length;_<z;_++){const j=U[_],R=D[j.materialIndex];if(R&&R.visible){const ee=m(w,H,R,A,C.near,C.far,F);n.renderBufferDirect(C,null,H,ee,w,j)}}}else if(D.visible){const U=m(w,H,D,A,C.near,C.far,F);n.renderBufferDirect(C,null,H,U,w,null)}}const O=w.children;for(let H=0,D=O.length;H<D;H++)x(O[H],b,C,A,F)}}function Nk(n,e,t){const r=t.isWebGL2;function i(){let Z=!1;const ye=new Tt;let ge=null;const Re=new Tt(0,0,0,0);return{setMask:function(Fe){ge!==Fe&&!Z&&(n.colorMask(Fe,Fe,Fe,Fe),ge=Fe)},setLocked:function(Fe){Z=Fe},setClear:function(Fe,Ze,lt,kt,jn){jn===!0&&(Fe*=kt,Ze*=kt,lt*=kt),ye.set(Fe,Ze,lt,kt),Re.equals(ye)===!1&&(n.clearColor(Fe,Ze,lt,kt),Re.copy(ye))},reset:function(){Z=!1,ge=null,Re.set(-1,0,0,0)}}}function s(){let Z=!1,ye=null,ge=null,Re=null;return{setTest:function(Fe){Fe?Q(2929):ie(2929)},setMask:function(Fe){ye!==Fe&&!Z&&(n.depthMask(Fe),ye=Fe)},setFunc:function(Fe){if(ge!==Fe){if(Fe)switch(Fe){case FI:n.depthFunc(512);break;case DI:n.depthFunc(519);break;case NI:n.depthFunc(513);break;case Zv:n.depthFunc(515);break;case kI:n.depthFunc(514);break;case OI:n.depthFunc(518);break;case zI:n.depthFunc(516);break;case UI:n.depthFunc(517);break;default:n.depthFunc(515)}else n.depthFunc(515);ge=Fe}},setLocked:function(Fe){Z=Fe},setClear:function(Fe){Re!==Fe&&(n.clearDepth(Fe),Re=Fe)},reset:function(){Z=!1,ye=null,ge=null,Re=null}}}function a(){let Z=!1,ye=null,ge=null,Re=null,Fe=null,Ze=null,lt=null,kt=null,jn=null;return{setTest:function(rt){Z||(rt?Q(2960):ie(2960))},setMask:function(rt){ye!==rt&&!Z&&(n.stencilMask(rt),ye=rt)},setFunc:function(rt,Tn,Wt){(ge!==rt||Re!==Tn||Fe!==Wt)&&(n.stencilFunc(rt,Tn,Wt),ge=rt,Re=Tn,Fe=Wt)},setOp:function(rt,Tn,Wt){(Ze!==rt||lt!==Tn||kt!==Wt)&&(n.stencilOp(rt,Tn,Wt),Ze=rt,lt=Tn,kt=Wt)},setLocked:function(rt){Z=rt},setClear:function(rt){jn!==rt&&(n.clearStencil(rt),jn=rt)},reset:function(){Z=!1,ye=null,ge=null,Re=null,Fe=null,Ze=null,lt=null,kt=null,jn=null}}}const o=new i,l=new s,c=new a;let u={},h=null,d={},f=null,v=!1,g=null,y=null,p=null,m=null,x=null,w=null,b=null,C=!1,A=null,F=null,N=null,O=null,H=null;const D=n.getParameter(35661);let U=!1,_=0;const z=n.getParameter(7938);z.indexOf("WebGL")!==-1?(_=parseFloat(/^WebGL (\d)/.exec(z)[1]),U=_>=1):z.indexOf("OpenGL ES")!==-1&&(_=parseFloat(/^OpenGL ES (\d)/.exec(z)[1]),U=_>=2);let j=null,R={};const ee=n.getParameter(3088),J=n.getParameter(2978),le=new Tt().fromArray(ee),k=new Tt().fromArray(J);function V(Z,ye,ge){const Re=new Uint8Array(4),Fe=n.createTexture();n.bindTexture(Z,Fe),n.texParameteri(Z,10241,9728),n.texParameteri(Z,10240,9728);for(let Ze=0;Ze<ge;Ze++)n.texImage2D(ye+Ze,0,6408,1,1,0,6408,5121,Re);return Fe}const $={};$[3553]=V(3553,3553,1),$[34067]=V(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Q(2929),l.setFunc(Zv),xe(!1),M(w_),Q(2884),ke(Qr);function Q(Z){u[Z]!==!0&&(n.enable(Z),u[Z]=!0)}function ie(Z){u[Z]!==!1&&(n.disable(Z),u[Z]=!1)}function ne(Z){Z!==h&&(n.bindFramebuffer(36160,Z),h=Z)}function Se(Z,ye){return ye===null&&h!==null&&(ye=h),d[Z]!==ye?(n.bindFramebuffer(Z,ye),d[Z]=ye,r&&(Z===36009&&(d[36160]=ye),Z===36160&&(d[36009]=ye)),!0):!1}function _e(Z){return f!==Z?(n.useProgram(Z),f=Z,!0):!1}const we={[Qo]:32774,[bI]:32778,[SI]:32779};if(r)we[M_]=32775,we[E_]=32776;else{const Z=e.get("EXT_blend_minmax");Z!==null&&(we[M_]=Z.MIN_EXT,we[E_]=Z.MAX_EXT)}const Me={[MI]:0,[EI]:1,[AI]:768,[AE]:770,[RI]:776,[II]:774,[CI]:772,[TI]:769,[TE]:771,[LI]:775,[PI]:773};function ke(Z,ye,ge,Re,Fe,Ze,lt,kt){if(Z===Qr){v===!0&&(ie(3042),v=!1);return}if(v===!1&&(Q(3042),v=!0),Z!==_I){if(Z!==g||kt!==C){if((y!==Qo||x!==Qo)&&(n.blendEquation(32774),y=Qo,x=Qo),kt)switch(Z){case wu:n.blendFuncSeparate(1,771,1,771);break;case __:n.blendFunc(1,1);break;case b_:n.blendFuncSeparate(0,0,769,771);break;case S_:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}else switch(Z){case wu:n.blendFuncSeparate(770,771,1,771);break;case __:n.blendFunc(770,1);break;case b_:n.blendFunc(0,769);break;case S_:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}p=null,m=null,w=null,b=null,g=Z,C=kt}return}Fe=Fe||ye,Ze=Ze||ge,lt=lt||Re,(ye!==y||Fe!==x)&&(n.blendEquationSeparate(we[ye],we[Fe]),y=ye,x=Fe),(ge!==p||Re!==m||Ze!==w||lt!==b)&&(n.blendFuncSeparate(Me[ge],Me[Re],Me[Ze],Me[lt]),p=ge,m=Re,w=Ze,b=lt),g=Z,C=null}function de(Z,ye){Z.side===Un?ie(2884):Q(2884);let ge=Z.side===un;ye&&(ge=!ge),xe(ge),Z.blending===wu&&Z.transparent===!1?ke(Qr):ke(Z.blending,Z.blendEquation,Z.blendSrc,Z.blendDst,Z.blendEquationAlpha,Z.blendSrcAlpha,Z.blendDstAlpha,Z.premultipliedAlpha),l.setFunc(Z.depthFunc),l.setTest(Z.depthTest),l.setMask(Z.depthWrite),o.setMask(Z.colorWrite);const Re=Z.stencilWrite;c.setTest(Re),Re&&(c.setMask(Z.stencilWriteMask),c.setFunc(Z.stencilFunc,Z.stencilRef,Z.stencilFuncMask),c.setOp(Z.stencilFail,Z.stencilZFail,Z.stencilZPass)),X(Z.polygonOffset,Z.polygonOffsetFactor,Z.polygonOffsetUnits),Z.alphaToCoverage===!0?Q(32926):ie(32926)}function xe(Z){A!==Z&&(Z?n.frontFace(2304):n.frontFace(2305),A=Z)}function M(Z){Z!==yI?(Q(2884),Z!==F&&(Z===w_?n.cullFace(1029):Z===xI?n.cullFace(1028):n.cullFace(1032))):ie(2884),F=Z}function te(Z){Z!==N&&(U&&n.lineWidth(Z),N=Z)}function X(Z,ye,ge){Z?(Q(32823),(O!==ye||H!==ge)&&(n.polygonOffset(ye,ge),O=ye,H=ge)):ie(32823)}function T(Z){Z?Q(3089):ie(3089)}function S(Z){Z===void 0&&(Z=33984+D-1),j!==Z&&(n.activeTexture(Z),j=Z)}function B(Z,ye){j===null&&S();let ge=R[j];ge===void 0&&(ge={type:void 0,texture:void 0},R[j]=ge),(ge.type!==Z||ge.texture!==ye)&&(n.bindTexture(Z,ye||$[Z]),ge.type=Z,ge.texture=ye)}function q(){const Z=R[j];Z!==void 0&&Z.type!==void 0&&(n.bindTexture(Z.type,null),Z.type=void 0,Z.texture=void 0)}function K(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function W(){try{n.texImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ce(){try{n.texImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function pe(Z){le.equals(Z)===!1&&(n.scissor(Z.x,Z.y,Z.z,Z.w),le.copy(Z))}function ue(Z){k.equals(Z)===!1&&(n.viewport(Z.x,Z.y,Z.z,Z.w),k.copy(Z))}function ve(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),r===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},j=null,R={},h=null,d={},f=null,v=!1,g=null,y=null,p=null,m=null,x=null,w=null,b=null,C=!1,A=null,F=null,N=null,O=null,H=null,le.set(0,0,n.canvas.width,n.canvas.height),k.set(0,0,n.canvas.width,n.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:Q,disable:ie,bindFramebuffer:Se,bindXRFramebuffer:ne,useProgram:_e,setBlending:ke,setMaterial:de,setFlipSided:xe,setCullFace:M,setLineWidth:te,setPolygonOffset:X,setScissorTest:T,activeTexture:S,bindTexture:B,unbindTexture:q,compressedTexImage2D:K,texImage2D:W,texImage3D:ce,scissor:pe,viewport:ue,reset:ve}}function kk(n,e,t,r,i,s,a){const o=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=new WeakMap;let f,v=!1;try{v=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function g(T,S){return v?new OffscreenCanvas(T,S):$p("canvas")}function y(T,S,B,q){let K=1;if((T.width>q||T.height>q)&&(K=q/Math.max(T.width,T.height)),K<1||S===!0)if(typeof HTMLImageElement!="undefined"&&T instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&T instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&T instanceof ImageBitmap){const W=S?FE:Math.floor,ce=W(K*T.width),pe=W(K*T.height);f===void 0&&(f=g(ce,pe));const ue=B?g(ce,pe):f;return ue.width=ce,ue.height=pe,ue.getContext("2d").drawImage(T,0,0,ce,pe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+T.width+"x"+T.height+") to ("+ce+"x"+pe+")."),ue}else return"data"in T&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+T.width+"x"+T.height+")."),T;return T}function p(T){return Kv(T.width)&&Kv(T.height)}function m(T){return o?!1:T.wrapS!==Pr||T.wrapT!==Pr||T.minFilter!==xn&&T.minFilter!==_n}function x(T,S){return T.generateMipmaps&&S&&T.minFilter!==xn&&T.minFilter!==_n}function w(T,S,B,q,K=1){n.generateMipmap(T);const W=r.get(S);W.__maxMipLevel=Math.log2(Math.max(B,q,K))}function b(T,S,B,q){if(o===!1)return S;if(T!==null){if(n[T]!==void 0)return n[T];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+T+"'")}let K=S;return S===6403&&(B===5126&&(K=33326),B===5131&&(K=33325),B===5121&&(K=33321)),S===6407&&(B===5126&&(K=34837),B===5131&&(K=34843),B===5121&&(K=32849)),S===6408&&(B===5126&&(K=34836),B===5131&&(K=34842),B===5121&&(K=q===fo?35907:32856)),(K===33325||K===33326||K===34842||K===34836)&&e.get("EXT_color_buffer_float"),K}function C(T){return T===xn||T===A_||T===T_?9728:9729}function A(T){const S=T.target;S.removeEventListener("dispose",A),N(S),S.isVideoTexture&&d.delete(S),a.memory.textures--}function F(T){const S=T.target;S.removeEventListener("dispose",F),O(S)}function N(T){const S=r.get(T);S.__webglInit!==void 0&&(n.deleteTexture(S.__webglTexture),r.remove(T))}function O(T){const S=T.texture,B=r.get(T),q=r.get(S);if(!!T){if(q.__webglTexture!==void 0&&(n.deleteTexture(q.__webglTexture),a.memory.textures--),T.depthTexture&&T.depthTexture.dispose(),T.isWebGLCubeRenderTarget)for(let K=0;K<6;K++)n.deleteFramebuffer(B.__webglFramebuffer[K]),B.__webglDepthbuffer&&n.deleteRenderbuffer(B.__webglDepthbuffer[K]);else n.deleteFramebuffer(B.__webglFramebuffer),B.__webglDepthbuffer&&n.deleteRenderbuffer(B.__webglDepthbuffer),B.__webglMultisampledFramebuffer&&n.deleteFramebuffer(B.__webglMultisampledFramebuffer),B.__webglColorRenderbuffer&&n.deleteRenderbuffer(B.__webglColorRenderbuffer),B.__webglDepthRenderbuffer&&n.deleteRenderbuffer(B.__webglDepthRenderbuffer);if(T.isWebGLMultipleRenderTargets)for(let K=0,W=S.length;K<W;K++){const ce=r.get(S[K]);ce.__webglTexture&&(n.deleteTexture(ce.__webglTexture),a.memory.textures--),r.remove(S[K])}r.remove(S),r.remove(T)}}let H=0;function D(){H=0}function U(){const T=H;return T>=l&&console.warn("THREE.WebGLTextures: Trying to use "+T+" texture units while this GPU supports only "+l),H+=1,T}function _(T,S){const B=r.get(T);if(T.isVideoTexture&&de(T),T.version>0&&B.__version!==T.version){const q=T.image;if(q===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(q.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{V(B,T,S);return}}t.activeTexture(33984+S),t.bindTexture(3553,B.__webglTexture)}function z(T,S){const B=r.get(T);if(T.version>0&&B.__version!==T.version){V(B,T,S);return}t.activeTexture(33984+S),t.bindTexture(35866,B.__webglTexture)}function j(T,S){const B=r.get(T);if(T.version>0&&B.__version!==T.version){V(B,T,S);return}t.activeTexture(33984+S),t.bindTexture(32879,B.__webglTexture)}function R(T,S){const B=r.get(T);if(T.version>0&&B.__version!==T.version){$(B,T,S);return}t.activeTexture(33984+S),t.bindTexture(34067,B.__webglTexture)}const ee={[$f]:10497,[Pr]:33071,[Jv]:33648},J={[xn]:9728,[A_]:9984,[T_]:9986,[_n]:9729,[YI]:9985,[Yp]:9987};function le(T,S,B){if(B?(n.texParameteri(T,10242,ee[S.wrapS]),n.texParameteri(T,10243,ee[S.wrapT]),(T===32879||T===35866)&&n.texParameteri(T,32882,ee[S.wrapR]),n.texParameteri(T,10240,J[S.magFilter]),n.texParameteri(T,10241,J[S.minFilter])):(n.texParameteri(T,10242,33071),n.texParameteri(T,10243,33071),(T===32879||T===35866)&&n.texParameteri(T,32882,33071),(S.wrapS!==Pr||S.wrapT!==Pr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(T,10240,C(S.magFilter)),n.texParameteri(T,10241,C(S.minFilter)),S.minFilter!==xn&&S.minFilter!==_n&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const q=e.get("EXT_texture_filter_anisotropic");if(S.type===Us&&e.has("OES_texture_float_linear")===!1||o===!1&&S.type===Al&&e.has("OES_texture_half_float_linear")===!1)return;(S.anisotropy>1||r.get(S).__currentAnisotropy)&&(n.texParameterf(T,q.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(S.anisotropy,i.getMaxAnisotropy())),r.get(S).__currentAnisotropy=S.anisotropy)}}function k(T,S){T.__webglInit===void 0&&(T.__webglInit=!0,S.addEventListener("dispose",A),T.__webglTexture=n.createTexture(),a.memory.textures++)}function V(T,S,B){let q=3553;S.isDataTexture2DArray&&(q=35866),S.isDataTexture3D&&(q=32879),k(T,S),t.activeTexture(33984+B),t.bindTexture(q,T.__webglTexture),n.pixelStorei(37440,S.flipY),n.pixelStorei(37441,S.premultiplyAlpha),n.pixelStorei(3317,S.unpackAlignment),n.pixelStorei(37443,0);const K=m(S)&&p(S.image)===!1,W=y(S.image,K,!1,u),ce=p(W)||o,pe=s.convert(S.format);let ue=s.convert(S.type),ve=b(S.internalFormat,pe,ue,S.encoding);le(q,S,ce);let Z;const ye=S.mipmaps;if(S.isDepthTexture)ve=6402,o?S.type===Us?ve=36012:S.type===lf?ve=33190:S.type===_u?ve=35056:ve=33189:S.type===Us&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),S.format===Cl&&ve===6402&&S.type!==Zf&&S.type!==lf&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),S.type=Zf,ue=s.convert(S.type)),S.format===Qu&&ve===6402&&(ve=34041,S.type!==_u&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),S.type=_u,ue=s.convert(S.type))),t.texImage2D(3553,0,ve,W.width,W.height,0,pe,ue,null);else if(S.isDataTexture)if(ye.length>0&&ce){for(let ge=0,Re=ye.length;ge<Re;ge++)Z=ye[ge],t.texImage2D(3553,ge,ve,Z.width,Z.height,0,pe,ue,Z.data);S.generateMipmaps=!1,T.__maxMipLevel=ye.length-1}else t.texImage2D(3553,0,ve,W.width,W.height,0,pe,ue,W.data),T.__maxMipLevel=0;else if(S.isCompressedTexture){for(let ge=0,Re=ye.length;ge<Re;ge++)Z=ye[ge],S.format!==bn&&S.format!==Tl?pe!==null?t.compressedTexImage2D(3553,ge,ve,Z.width,Z.height,0,Z.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,ge,ve,Z.width,Z.height,0,pe,ue,Z.data);T.__maxMipLevel=ye.length-1}else if(S.isDataTexture2DArray)t.texImage3D(35866,0,ve,W.width,W.height,W.depth,0,pe,ue,W.data),T.__maxMipLevel=0;else if(S.isDataTexture3D)t.texImage3D(32879,0,ve,W.width,W.height,W.depth,0,pe,ue,W.data),T.__maxMipLevel=0;else if(ye.length>0&&ce){for(let ge=0,Re=ye.length;ge<Re;ge++)Z=ye[ge],t.texImage2D(3553,ge,ve,pe,ue,Z);S.generateMipmaps=!1,T.__maxMipLevel=ye.length-1}else t.texImage2D(3553,0,ve,pe,ue,W),T.__maxMipLevel=0;x(S,ce)&&w(q,S,W.width,W.height),T.__version=S.version,S.onUpdate&&S.onUpdate(S)}function $(T,S,B){if(S.image.length!==6)return;k(T,S),t.activeTexture(33984+B),t.bindTexture(34067,T.__webglTexture),n.pixelStorei(37440,S.flipY),n.pixelStorei(37441,S.premultiplyAlpha),n.pixelStorei(3317,S.unpackAlignment),n.pixelStorei(37443,0);const q=S&&(S.isCompressedTexture||S.image[0].isCompressedTexture),K=S.image[0]&&S.image[0].isDataTexture,W=[];for(let ge=0;ge<6;ge++)!q&&!K?W[ge]=y(S.image[ge],!1,!0,c):W[ge]=K?S.image[ge].image:S.image[ge];const ce=W[0],pe=p(ce)||o,ue=s.convert(S.format),ve=s.convert(S.type),Z=b(S.internalFormat,ue,ve,S.encoding);le(34067,S,pe);let ye;if(q){for(let ge=0;ge<6;ge++){ye=W[ge].mipmaps;for(let Re=0;Re<ye.length;Re++){const Fe=ye[Re];S.format!==bn&&S.format!==Tl?ue!==null?t.compressedTexImage2D(34069+ge,Re,Z,Fe.width,Fe.height,0,Fe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+ge,Re,Z,Fe.width,Fe.height,0,ue,ve,Fe.data)}}T.__maxMipLevel=ye.length-1}else{ye=S.mipmaps;for(let ge=0;ge<6;ge++)if(K){t.texImage2D(34069+ge,0,Z,W[ge].width,W[ge].height,0,ue,ve,W[ge].data);for(let Re=0;Re<ye.length;Re++){const Ze=ye[Re].image[ge].image;t.texImage2D(34069+ge,Re+1,Z,Ze.width,Ze.height,0,ue,ve,Ze.data)}}else{t.texImage2D(34069+ge,0,Z,ue,ve,W[ge]);for(let Re=0;Re<ye.length;Re++){const Fe=ye[Re];t.texImage2D(34069+ge,Re+1,Z,ue,ve,Fe.image[ge])}}T.__maxMipLevel=ye.length}x(S,pe)&&w(34067,S,ce.width,ce.height),T.__version=S.version,S.onUpdate&&S.onUpdate(S)}function Q(T,S,B,q,K){const W=s.convert(B.format),ce=s.convert(B.type),pe=b(B.internalFormat,W,ce,B.encoding);K===32879||K===35866?t.texImage3D(K,0,pe,S.width,S.height,S.depth,0,W,ce,null):t.texImage2D(K,0,pe,S.width,S.height,0,W,ce,null),t.bindFramebuffer(36160,T),n.framebufferTexture2D(36160,q,K,r.get(B).__webglTexture,0),t.bindFramebuffer(36160,null)}function ie(T,S,B){if(n.bindRenderbuffer(36161,T),S.depthBuffer&&!S.stencilBuffer){let q=33189;if(B){const K=S.depthTexture;K&&K.isDepthTexture&&(K.type===Us?q=36012:K.type===lf&&(q=33190));const W=ke(S);n.renderbufferStorageMultisample(36161,W,q,S.width,S.height)}else n.renderbufferStorage(36161,q,S.width,S.height);n.framebufferRenderbuffer(36160,36096,36161,T)}else if(S.depthBuffer&&S.stencilBuffer){if(B){const q=ke(S);n.renderbufferStorageMultisample(36161,q,35056,S.width,S.height)}else n.renderbufferStorage(36161,34041,S.width,S.height);n.framebufferRenderbuffer(36160,33306,36161,T)}else{const q=S.isWebGLMultipleRenderTargets===!0?S.texture[0]:S.texture,K=s.convert(q.format),W=s.convert(q.type),ce=b(q.internalFormat,K,W,q.encoding);if(B){const pe=ke(S);n.renderbufferStorageMultisample(36161,pe,ce,S.width,S.height)}else n.renderbufferStorage(36161,ce,S.width,S.height)}n.bindRenderbuffer(36161,null)}function ne(T,S){if(S&&S.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,T),!(S.depthTexture&&S.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(S.depthTexture).__webglTexture||S.depthTexture.image.width!==S.width||S.depthTexture.image.height!==S.height)&&(S.depthTexture.image.width=S.width,S.depthTexture.image.height=S.height,S.depthTexture.needsUpdate=!0),_(S.depthTexture,0);const q=r.get(S.depthTexture).__webglTexture;if(S.depthTexture.format===Cl)n.framebufferTexture2D(36160,36096,3553,q,0);else if(S.depthTexture.format===Qu)n.framebufferTexture2D(36160,33306,3553,q,0);else throw new Error("Unknown depthTexture format")}function Se(T){const S=r.get(T),B=T.isWebGLCubeRenderTarget===!0;if(T.depthTexture){if(B)throw new Error("target.depthTexture not supported in Cube render targets");ne(S.__webglFramebuffer,T)}else if(B){S.__webglDepthbuffer=[];for(let q=0;q<6;q++)t.bindFramebuffer(36160,S.__webglFramebuffer[q]),S.__webglDepthbuffer[q]=n.createRenderbuffer(),ie(S.__webglDepthbuffer[q],T,!1)}else t.bindFramebuffer(36160,S.__webglFramebuffer),S.__webglDepthbuffer=n.createRenderbuffer(),ie(S.__webglDepthbuffer,T,!1);t.bindFramebuffer(36160,null)}function _e(T){const S=T.texture,B=r.get(T),q=r.get(S);T.addEventListener("dispose",F),T.isWebGLMultipleRenderTargets!==!0&&(q.__webglTexture=n.createTexture(),q.__version=S.version,a.memory.textures++);const K=T.isWebGLCubeRenderTarget===!0,W=T.isWebGLMultipleRenderTargets===!0,ce=T.isWebGLMultisampleRenderTarget===!0,pe=S.isDataTexture3D||S.isDataTexture2DArray,ue=p(T)||o;if(o&&S.format===Tl&&(S.type===Us||S.type===Al)&&(S.format=bn,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),K){B.__webglFramebuffer=[];for(let ve=0;ve<6;ve++)B.__webglFramebuffer[ve]=n.createFramebuffer()}else if(B.__webglFramebuffer=n.createFramebuffer(),W)if(i.drawBuffers){const ve=T.texture;for(let Z=0,ye=ve.length;Z<ye;Z++){const ge=r.get(ve[Z]);ge.__webglTexture===void 0&&(ge.__webglTexture=n.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(ce)if(o){B.__webglMultisampledFramebuffer=n.createFramebuffer(),B.__webglColorRenderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(36161,B.__webglColorRenderbuffer);const ve=s.convert(S.format),Z=s.convert(S.type),ye=b(S.internalFormat,ve,Z,S.encoding),ge=ke(T);n.renderbufferStorageMultisample(36161,ge,ye,T.width,T.height),t.bindFramebuffer(36160,B.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064,36161,B.__webglColorRenderbuffer),n.bindRenderbuffer(36161,null),T.depthBuffer&&(B.__webglDepthRenderbuffer=n.createRenderbuffer(),ie(B.__webglDepthRenderbuffer,T,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(K){t.bindTexture(34067,q.__webglTexture),le(34067,S,ue);for(let ve=0;ve<6;ve++)Q(B.__webglFramebuffer[ve],T,S,36064,34069+ve);x(S,ue)&&w(34067,S,T.width,T.height),t.unbindTexture()}else if(W){const ve=T.texture;for(let Z=0,ye=ve.length;Z<ye;Z++){const ge=ve[Z],Re=r.get(ge);t.bindTexture(3553,Re.__webglTexture),le(3553,ge,ue),Q(B.__webglFramebuffer,T,ge,36064+Z,3553),x(ge,ue)&&w(3553,ge,T.width,T.height)}t.unbindTexture()}else{let ve=3553;pe&&(o?ve=S.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(ve,q.__webglTexture),le(ve,S,ue),Q(B.__webglFramebuffer,T,S,36064,ve),x(S,ue)&&w(ve,S,T.width,T.height,T.depth),t.unbindTexture()}T.depthBuffer&&Se(T)}function we(T){const S=p(T)||o,B=T.isWebGLMultipleRenderTargets===!0?T.texture:[T.texture];for(let q=0,K=B.length;q<K;q++){const W=B[q];if(x(W,S)){const ce=T.isWebGLCubeRenderTarget?34067:3553,pe=r.get(W).__webglTexture;t.bindTexture(ce,pe),w(ce,W,T.width,T.height),t.unbindTexture()}}}function Me(T){if(T.isWebGLMultisampleRenderTarget)if(o){const S=T.width,B=T.height;let q=16384;T.depthBuffer&&(q|=256),T.stencilBuffer&&(q|=1024);const K=r.get(T);t.bindFramebuffer(36008,K.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,K.__webglFramebuffer),n.blitFramebuffer(0,0,S,B,0,0,S,B,q,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,K.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function ke(T){return o&&T.isWebGLMultisampleRenderTarget?Math.min(h,T.samples):0}function de(T){const S=a.render.frame;d.get(T)!==S&&(d.set(T,S),T.update())}let xe=!1,M=!1;function te(T,S){T&&T.isWebGLRenderTarget&&(xe===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),xe=!0),T=T.texture),_(T,S)}function X(T,S){T&&T.isWebGLCubeRenderTarget&&(M===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),M=!0),T=T.texture),R(T,S)}this.allocateTextureUnit=U,this.resetTextureUnits=D,this.setTexture2D=_,this.setTexture2DArray=z,this.setTexture3D=j,this.setTextureCube=R,this.setupRenderTarget=_e,this.updateRenderTargetMipmap=we,this.updateMultisampleRenderTarget=Me,this.safeSetTexture2D=te,this.safeSetTextureCube=X}function Ok(n,e,t){const r=t.isWebGL2;function i(s){let a;if(s===fa)return 5121;if(s===QI)return 32819;if(s===JI)return 32820;if(s===KI)return 33635;if(s===$I)return 5120;if(s===ZI)return 5122;if(s===Zf)return 5123;if(s===qI)return 5124;if(s===lf)return 5125;if(s===Us)return 5126;if(s===Al)return r?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===eL)return 6406;if(s===Tl)return 6407;if(s===bn)return 6408;if(s===tL)return 6409;if(s===nL)return 6410;if(s===Cl)return 6402;if(s===Qu)return 34041;if(s===iL)return 6403;if(s===sL)return 36244;if(s===aL)return 33319;if(s===oL)return 33320;if(s===lL)return 36248;if(s===cL)return 36249;if(s===C_||s===P_||s===I_||s===L_)if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===C_)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===P_)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===I_)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===L_)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===R_||s===F_||s===D_||s===N_)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===R_)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===F_)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===D_)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===N_)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===uL)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if((s===k_||s===O_)&&(a=e.get("WEBGL_compressed_texture_etc"),a!==null)){if(s===k_)return a.COMPRESSED_RGB8_ETC2;if(s===O_)return a.COMPRESSED_RGBA8_ETC2_EAC}if(s===dL||s===hL||s===fL||s===pL||s===mL||s===gL||s===vL||s===yL||s===xL||s===wL||s===_L||s===bL||s===SL||s===ML||s===AL||s===TL||s===CL||s===PL||s===IL||s===LL||s===RL||s===FL||s===DL||s===NL||s===kL||s===OL||s===zL||s===UL)return a=e.get("WEBGL_compressed_texture_astc"),a!==null?s:null;if(s===EL)return a=e.get("EXT_texture_compression_bptc"),a!==null?s:null;if(s===_u)return r?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:i}}class KE extends rn{constructor(e=[]){super(),this.cameras=e}}KE.prototype.isArrayCamera=!0;class bi extends ot{constructor(){super(),this.type="Group"}}bi.prototype.isGroup=!0;const zk={type:"move"};class Mg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new bi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new bi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new L,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new L),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new bi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new L,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new L),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(o!==null&&(i=t.getPose(e.targetRaySpace,r),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(zk))),c&&e.hand){a=!0;for(const g of e.hand.values()){const y=t.getJointPose(g,r);if(c.joints[g.jointName]===void 0){const m=new bi;m.matrixAutoUpdate=!1,m.visible=!1,c.joints[g.jointName]=m,c.add(m)}const p=c.joints[g.jointName];y!==null&&(p.matrix.fromArray(y.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=y.radius),p.visible=y!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),f=.02,v=.005;c.inputState.pinching&&d>f+v?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=f-v&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));return o!==null&&(o.visible=i!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}}class Uk extends Ma{constructor(e,t){super();const r=this,i=e.state;let s=null,a=1,o=null,l="local-floor",c=null,u=null,h=null,d=null,f=null,v=!1,g=null,y=null,p=null,m=null,x=null,w=null;const b=[],C=new Map,A=new rn;A.layers.enable(1),A.viewport=new Tt;const F=new rn;F.layers.enable(2),F.viewport=new Tt;const N=[A,F],O=new KE;O.layers.enable(1),O.layers.enable(2);let H=null,D=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function($){let Q=b[$];return Q===void 0&&(Q=new Mg,b[$]=Q),Q.getTargetRaySpace()},this.getControllerGrip=function($){let Q=b[$];return Q===void 0&&(Q=new Mg,b[$]=Q),Q.getGripSpace()},this.getHand=function($){let Q=b[$];return Q===void 0&&(Q=new Mg,b[$]=Q),Q.getHandSpace()};function U($){const Q=C.get($.inputSource);Q&&Q.dispatchEvent({type:$.type,data:$.inputSource})}function _(){C.forEach(function($,Q){$.disconnect(Q)}),C.clear(),H=null,D=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),h&&t.deleteFramebuffer(h),g&&t.deleteFramebuffer(g),y&&t.deleteRenderbuffer(y),p&&t.deleteRenderbuffer(p),h=null,g=null,y=null,p=null,f=null,d=null,u=null,s=null,V.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function($){a=$,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function($){l=$,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return u},this.getFrame=function(){return m},this.getSession=function(){return s},this.setSession=async function($){if(s=$,s!==null){s.addEventListener("select",U),s.addEventListener("selectstart",U),s.addEventListener("selectend",U),s.addEventListener("squeeze",U),s.addEventListener("squeezestart",U),s.addEventListener("squeezeend",U),s.addEventListener("end",_),s.addEventListener("inputsourceschange",z);const Q=t.getContextAttributes();if(Q.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0){const ie={antialias:Q.antialias,alpha:Q.alpha,depth:Q.depth,stencil:Q.stencil,framebufferScaleFactor:a};f=new XRWebGLLayer(s,t,ie),s.updateRenderState({baseLayer:f})}else if(t instanceof WebGLRenderingContext){const ie={antialias:!0,alpha:Q.alpha,depth:Q.depth,stencil:Q.stencil,framebufferScaleFactor:a};f=new XRWebGLLayer(s,t,ie),s.updateRenderState({layers:[f]})}else{v=Q.antialias;let ie=null;Q.depth&&(w=256,Q.stencil&&(w|=1024),x=Q.stencil?33306:36096,ie=Q.stencil?35056:33190);const ne={colorFormat:Q.alpha?32856:32849,depthFormat:ie,scaleFactor:a};u=new XRWebGLBinding(s,t),d=u.createProjectionLayer(ne),h=t.createFramebuffer(),s.updateRenderState({layers:[d]}),v&&(g=t.createFramebuffer(),y=t.createRenderbuffer(),t.bindRenderbuffer(36161,y),t.renderbufferStorageMultisample(36161,4,32856,d.textureWidth,d.textureHeight),i.bindFramebuffer(36160,g),t.framebufferRenderbuffer(36160,36064,36161,y),t.bindRenderbuffer(36161,null),ie!==null&&(p=t.createRenderbuffer(),t.bindRenderbuffer(36161,p),t.renderbufferStorageMultisample(36161,4,ie,d.textureWidth,d.textureHeight),t.framebufferRenderbuffer(36160,x,36161,p),t.bindRenderbuffer(36161,null)),i.bindFramebuffer(36160,null))}o=await s.requestReferenceSpace(l),V.setContext(s),V.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};function z($){const Q=s.inputSources;for(let ie=0;ie<b.length;ie++)C.set(Q[ie],b[ie]);for(let ie=0;ie<$.removed.length;ie++){const ne=$.removed[ie],Se=C.get(ne);Se&&(Se.dispatchEvent({type:"disconnected",data:ne}),C.delete(ne))}for(let ie=0;ie<$.added.length;ie++){const ne=$.added[ie],Se=C.get(ne);Se&&Se.dispatchEvent({type:"connected",data:ne})}}const j=new L,R=new L;function ee($,Q,ie){j.setFromMatrixPosition(Q.matrixWorld),R.setFromMatrixPosition(ie.matrixWorld);const ne=j.distanceTo(R),Se=Q.projectionMatrix.elements,_e=ie.projectionMatrix.elements,we=Se[14]/(Se[10]-1),Me=Se[14]/(Se[10]+1),ke=(Se[9]+1)/Se[5],de=(Se[9]-1)/Se[5],xe=(Se[8]-1)/Se[0],M=(_e[8]+1)/_e[0],te=we*xe,X=we*M,T=ne/(-xe+M),S=T*-xe;Q.matrixWorld.decompose($.position,$.quaternion,$.scale),$.translateX(S),$.translateZ(T),$.matrixWorld.compose($.position,$.quaternion,$.scale),$.matrixWorldInverse.copy($.matrixWorld).invert();const B=we+T,q=Me+T,K=te-S,W=X+(ne-S),ce=ke*Me/q*B,pe=de*Me/q*B;$.projectionMatrix.makePerspective(K,W,ce,pe,B,q)}function J($,Q){Q===null?$.matrixWorld.copy($.matrix):$.matrixWorld.multiplyMatrices(Q.matrixWorld,$.matrix),$.matrixWorldInverse.copy($.matrixWorld).invert()}this.updateCamera=function($){if(s===null)return;O.near=F.near=A.near=$.near,O.far=F.far=A.far=$.far,(H!==O.near||D!==O.far)&&(s.updateRenderState({depthNear:O.near,depthFar:O.far}),H=O.near,D=O.far);const Q=$.parent,ie=O.cameras;J(O,Q);for(let Se=0;Se<ie.length;Se++)J(ie[Se],Q);O.matrixWorld.decompose(O.position,O.quaternion,O.scale),$.position.copy(O.position),$.quaternion.copy(O.quaternion),$.scale.copy(O.scale),$.matrix.copy(O.matrix),$.matrixWorld.copy(O.matrixWorld);const ne=$.children;for(let Se=0,_e=ne.length;Se<_e;Se++)ne[Se].updateMatrixWorld(!0);ie.length===2?ee(O,A,F):O.projectionMatrix.copy(A.projectionMatrix)},this.getCamera=function(){return O},this.getFoveation=function(){if(d!==null)return d.fixedFoveation;if(f!==null)return f.fixedFoveation},this.setFoveation=function($){d!==null&&(d.fixedFoveation=$),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=$)};let le=null;function k($,Q){if(c=Q.getViewerPose(o),m=Q,c!==null){const ne=c.views;f!==null&&i.bindXRFramebuffer(f.framebuffer);let Se=!1;ne.length!==O.cameras.length&&(O.cameras.length=0,Se=!0);for(let _e=0;_e<ne.length;_e++){const we=ne[_e];let Me=null;if(f!==null)Me=f.getViewport(we);else{const de=u.getViewSubImage(d,we);i.bindXRFramebuffer(h),de.depthStencilTexture!==void 0&&t.framebufferTexture2D(36160,x,3553,de.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,de.colorTexture,0),Me=de.viewport}const ke=N[_e];ke.matrix.fromArray(we.transform.matrix),ke.projectionMatrix.fromArray(we.projectionMatrix),ke.viewport.set(Me.x,Me.y,Me.width,Me.height),_e===0&&O.matrix.copy(ke.matrix),Se===!0&&O.cameras.push(ke)}v&&(i.bindXRFramebuffer(g),w!==null&&t.clear(w))}const ie=s.inputSources;for(let ne=0;ne<b.length;ne++){const Se=b[ne],_e=ie[ne];Se.update(_e,Q,o)}if(le&&le($,Q),v){const ne=d.textureWidth,Se=d.textureHeight;i.bindFramebuffer(36008,g),i.bindFramebuffer(36009,h),t.invalidateFramebuffer(36008,[x]),t.invalidateFramebuffer(36009,[x]),t.blitFramebuffer(0,0,ne,Se,0,0,ne,Se,16384,9728),t.invalidateFramebuffer(36008,[36064]),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),i.bindFramebuffer(36160,g)}m=null}const V=new BE;V.setAnimationLoop(k),this.setAnimationLoop=function($){le=$},this.dispose=function(){}}}function Bk(n){function e(p,m){p.fogColor.value.copy(m.color),m.isFog?(p.fogNear.value=m.near,p.fogFar.value=m.far):m.isFogExp2&&(p.fogDensity.value=m.density)}function t(p,m,x,w,b){m.isMeshBasicMaterial?r(p,m):m.isMeshLambertMaterial?(r(p,m),l(p,m)):m.isMeshToonMaterial?(r(p,m),u(p,m)):m.isMeshPhongMaterial?(r(p,m),c(p,m)):m.isMeshStandardMaterial?(r(p,m),m.isMeshPhysicalMaterial?d(p,m,b):h(p,m)):m.isMeshMatcapMaterial?(r(p,m),f(p,m)):m.isMeshDepthMaterial?(r(p,m),v(p,m)):m.isMeshDistanceMaterial?(r(p,m),g(p,m)):m.isMeshNormalMaterial?(r(p,m),y(p,m)):m.isLineBasicMaterial?(i(p,m),m.isLineDashedMaterial&&s(p,m)):m.isPointsMaterial?a(p,m,x,w):m.isSpriteMaterial?o(p,m):m.isShadowMaterial?(p.color.value.copy(m.color),p.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function r(p,m){p.opacity.value=m.opacity,m.color&&p.diffuse.value.copy(m.color),m.emissive&&p.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(p.map.value=m.map),m.alphaMap&&(p.alphaMap.value=m.alphaMap),m.specularMap&&(p.specularMap.value=m.specularMap),m.alphaTest>0&&(p.alphaTest.value=m.alphaTest);const x=n.get(m).envMap;if(x){p.envMap.value=x,p.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,p.reflectivity.value=m.reflectivity,p.ior.value=m.ior,p.refractionRatio.value=m.refractionRatio;const C=n.get(x).__maxMipLevel;C!==void 0&&(p.maxMipLevel.value=C)}m.lightMap&&(p.lightMap.value=m.lightMap,p.lightMapIntensity.value=m.lightMapIntensity),m.aoMap&&(p.aoMap.value=m.aoMap,p.aoMapIntensity.value=m.aoMapIntensity);let w;m.map?w=m.map:m.specularMap?w=m.specularMap:m.displacementMap?w=m.displacementMap:m.normalMap?w=m.normalMap:m.bumpMap?w=m.bumpMap:m.roughnessMap?w=m.roughnessMap:m.metalnessMap?w=m.metalnessMap:m.alphaMap?w=m.alphaMap:m.emissiveMap?w=m.emissiveMap:m.clearcoatMap?w=m.clearcoatMap:m.clearcoatNormalMap?w=m.clearcoatNormalMap:m.clearcoatRoughnessMap?w=m.clearcoatRoughnessMap:m.specularIntensityMap?w=m.specularIntensityMap:m.specularTintMap?w=m.specularTintMap:m.transmissionMap?w=m.transmissionMap:m.thicknessMap&&(w=m.thicknessMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),p.uvTransform.value.copy(w.matrix));let b;m.aoMap?b=m.aoMap:m.lightMap&&(b=m.lightMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),p.uv2Transform.value.copy(b.matrix))}function i(p,m){p.diffuse.value.copy(m.color),p.opacity.value=m.opacity}function s(p,m){p.dashSize.value=m.dashSize,p.totalSize.value=m.dashSize+m.gapSize,p.scale.value=m.scale}function a(p,m,x,w){p.diffuse.value.copy(m.color),p.opacity.value=m.opacity,p.size.value=m.size*x,p.scale.value=w*.5,m.map&&(p.map.value=m.map),m.alphaMap&&(p.alphaMap.value=m.alphaMap),m.alphaTest>0&&(p.alphaTest.value=m.alphaTest);let b;m.map?b=m.map:m.alphaMap&&(b=m.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),p.uvTransform.value.copy(b.matrix))}function o(p,m){p.diffuse.value.copy(m.color),p.opacity.value=m.opacity,p.rotation.value=m.rotation,m.map&&(p.map.value=m.map),m.alphaMap&&(p.alphaMap.value=m.alphaMap),m.alphaTest>0&&(p.alphaTest.value=m.alphaTest);let x;m.map?x=m.map:m.alphaMap&&(x=m.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),p.uvTransform.value.copy(x.matrix))}function l(p,m){m.emissiveMap&&(p.emissiveMap.value=m.emissiveMap)}function c(p,m){p.specular.value.copy(m.specular),p.shininess.value=Math.max(m.shininess,1e-4),m.emissiveMap&&(p.emissiveMap.value=m.emissiveMap),m.bumpMap&&(p.bumpMap.value=m.bumpMap,p.bumpScale.value=m.bumpScale,m.side===un&&(p.bumpScale.value*=-1)),m.normalMap&&(p.normalMap.value=m.normalMap,p.normalScale.value.copy(m.normalScale),m.side===un&&p.normalScale.value.negate()),m.displacementMap&&(p.displacementMap.value=m.displacementMap,p.displacementScale.value=m.displacementScale,p.displacementBias.value=m.displacementBias)}function u(p,m){m.gradientMap&&(p.gradientMap.value=m.gradientMap),m.emissiveMap&&(p.emissiveMap.value=m.emissiveMap),m.bumpMap&&(p.bumpMap.value=m.bumpMap,p.bumpScale.value=m.bumpScale,m.side===un&&(p.bumpScale.value*=-1)),m.normalMap&&(p.normalMap.value=m.normalMap,p.normalScale.value.copy(m.normalScale),m.side===un&&p.normalScale.value.negate()),m.displacementMap&&(p.displacementMap.value=m.displacementMap,p.displacementScale.value=m.displacementScale,p.displacementBias.value=m.displacementBias)}function h(p,m){p.roughness.value=m.roughness,p.metalness.value=m.metalness,m.roughnessMap&&(p.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(p.metalnessMap.value=m.metalnessMap),m.emissiveMap&&(p.emissiveMap.value=m.emissiveMap),m.bumpMap&&(p.bumpMap.value=m.bumpMap,p.bumpScale.value=m.bumpScale,m.side===un&&(p.bumpScale.value*=-1)),m.normalMap&&(p.normalMap.value=m.normalMap,p.normalScale.value.copy(m.normalScale),m.side===un&&p.normalScale.value.negate()),m.displacementMap&&(p.displacementMap.value=m.displacementMap,p.displacementScale.value=m.displacementScale,p.displacementBias.value=m.displacementBias),n.get(m).envMap&&(p.envMapIntensity.value=m.envMapIntensity)}function d(p,m,x){h(p,m),p.ior.value=m.ior,m.sheen>0&&(p.sheenTint.value.copy(m.sheenTint).multiplyScalar(m.sheen),p.sheenRoughness.value=m.sheenRoughness),m.clearcoat>0&&(p.clearcoat.value=m.clearcoat,p.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(p.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(p.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(p.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),p.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===un&&p.clearcoatNormalScale.value.negate())),m.transmission>0&&(p.transmission.value=m.transmission,p.transmissionSamplerMap.value=x.texture,p.transmissionSamplerSize.value.set(x.width,x.height),m.transmissionMap&&(p.transmissionMap.value=m.transmissionMap),p.thickness.value=m.thickness,m.thicknessMap&&(p.thicknessMap.value=m.thicknessMap),p.attenuationDistance.value=m.attenuationDistance,p.attenuationTint.value.copy(m.attenuationTint)),p.specularIntensity.value=m.specularIntensity,p.specularTint.value.copy(m.specularTint),m.specularIntensityMap&&(p.specularIntensityMap.value=m.specularIntensityMap),m.specularTintMap&&(p.specularTintMap.value=m.specularTintMap)}function f(p,m){m.matcap&&(p.matcap.value=m.matcap),m.bumpMap&&(p.bumpMap.value=m.bumpMap,p.bumpScale.value=m.bumpScale,m.side===un&&(p.bumpScale.value*=-1)),m.normalMap&&(p.normalMap.value=m.normalMap,p.normalScale.value.copy(m.normalScale),m.side===un&&p.normalScale.value.negate()),m.displacementMap&&(p.displacementMap.value=m.displacementMap,p.displacementScale.value=m.displacementScale,p.displacementBias.value=m.displacementBias)}function v(p,m){m.displacementMap&&(p.displacementMap.value=m.displacementMap,p.displacementScale.value=m.displacementScale,p.displacementBias.value=m.displacementBias)}function g(p,m){m.displacementMap&&(p.displacementMap.value=m.displacementMap,p.displacementScale.value=m.displacementScale,p.displacementBias.value=m.displacementBias),p.referencePosition.value.copy(m.referencePosition),p.nearDistance.value=m.nearDistance,p.farDistance.value=m.farDistance}function y(p,m){m.bumpMap&&(p.bumpMap.value=m.bumpMap,p.bumpScale.value=m.bumpScale,m.side===un&&(p.bumpScale.value*=-1)),m.normalMap&&(p.normalMap.value=m.normalMap,p.normalScale.value.copy(m.normalScale),m.side===un&&p.normalScale.value.negate()),m.displacementMap&&(p.displacementMap.value=m.displacementMap,p.displacementScale.value=m.displacementScale,p.displacementBias.value=m.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function Hk(){const n=$p("canvas");return n.style.display="block",n}function St(n={}){const e=n.canvas!==void 0?n.canvas:Hk(),t=n.context!==void 0?n.context:null,r=n.alpha!==void 0?n.alpha:!1,i=n.depth!==void 0?n.depth:!0,s=n.stencil!==void 0?n.stencil:!0,a=n.antialias!==void 0?n.antialias:!1,o=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,l=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,c=n.powerPreference!==void 0?n.powerPreference:"default",u=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let h=null,d=null;const f=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Kn,this.physicallyCorrectLights=!1,this.toneMapping=Ja,this.toneMappingExposure=1;const g=this;let y=!1,p=0,m=0,x=null,w=-1,b=null;const C=new Tt,A=new Tt;let F=null,N=e.width,O=e.height,H=1,D=null,U=null;const _=new Tt(0,0,N,O),z=new Tt(0,0,N,O);let j=!1;const R=[],ee=new Qp;let J=!1,le=!1,k=null;const V=new ze,$=new L,Q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ie(){return x===null?H:1}let ne=t;function Se(G,ae){for(let se=0;se<G.length;se++){const re=G[se],he=e.getContext(re,ae);if(he!==null)return he}return null}try{const G={alpha:r,depth:i,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",lt,!1),e.addEventListener("webglcontextrestored",kt,!1),ne===null){const ae=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&ae.shift(),ne=Se(ae,G),ne===null)throw Se(ae)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ne.getShaderPrecisionFormat===void 0&&(ne.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(G){throw console.error("THREE.WebGLRenderer: "+G.message),G}let _e,we,Me,ke,de,xe,M,te,X,T,S,B,q,K,W,ce,pe,ue,ve,Z,ye,ge,Re;function Fe(){_e=new uN(ne),we=new nN(ne,_e,n),_e.init(we),ge=new Ok(ne,_e,we),Me=new Nk(ne,_e,we),R[0]=1029,ke=new fN,de=new Mk,xe=new kk(ne,_e,Me,de,we,ge,ke),M=new iN(g),te=new cN(g),X=new AR(ne,we),Re=new eN(ne,_e,X,we),T=new dN(ne,X,ke,Re),S=new vN(ne,T,X,ke),ve=new gN(ne,we,xe),ce=new rN(de),B=new Sk(g,M,te,_e,we,Re,ce),q=new Bk(de),K=new Ak(de),W=new Rk(_e,we),ue=new KD(g,M,Me,S,o),pe=new JE(g,S,we),Z=new tN(ne,_e,ke,we),ye=new hN(ne,_e,ke,we),ke.programs=B.programs,g.capabilities=we,g.extensions=_e,g.properties=de,g.renderLists=K,g.shadowMap=pe,g.state=Me,g.info=ke}Fe();const Ze=new Uk(g,ne);this.xr=Ze,this.getContext=function(){return ne},this.getContextAttributes=function(){return ne.getContextAttributes()},this.forceContextLoss=function(){const G=_e.get("WEBGL_lose_context");G&&G.loseContext()},this.forceContextRestore=function(){const G=_e.get("WEBGL_lose_context");G&&G.restoreContext()},this.getPixelRatio=function(){return H},this.setPixelRatio=function(G){G!==void 0&&(H=G,this.setSize(N,O,!1))},this.getSize=function(G){return G.set(N,O)},this.setSize=function(G,ae,se){if(Ze.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}N=G,O=ae,e.width=Math.floor(G*H),e.height=Math.floor(ae*H),se!==!1&&(e.style.width=G+"px",e.style.height=ae+"px"),this.setViewport(0,0,G,ae)},this.getDrawingBufferSize=function(G){return G.set(N*H,O*H).floor()},this.setDrawingBufferSize=function(G,ae,se){N=G,O=ae,H=se,e.width=Math.floor(G*se),e.height=Math.floor(ae*se),this.setViewport(0,0,G,ae)},this.getCurrentViewport=function(G){return G.copy(C)},this.getViewport=function(G){return G.copy(_)},this.setViewport=function(G,ae,se,re){G.isVector4?_.set(G.x,G.y,G.z,G.w):_.set(G,ae,se,re),Me.viewport(C.copy(_).multiplyScalar(H).floor())},this.getScissor=function(G){return G.copy(z)},this.setScissor=function(G,ae,se,re){G.isVector4?z.set(G.x,G.y,G.z,G.w):z.set(G,ae,se,re),Me.scissor(A.copy(z).multiplyScalar(H).floor())},this.getScissorTest=function(){return j},this.setScissorTest=function(G){Me.setScissorTest(j=G)},this.setOpaqueSort=function(G){D=G},this.setTransparentSort=function(G){U=G},this.getClearColor=function(G){return G.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(G,ae,se){let re=0;(G===void 0||G)&&(re|=16384),(ae===void 0||ae)&&(re|=256),(se===void 0||se)&&(re|=1024),ne.clear(re)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",lt,!1),e.removeEventListener("webglcontextrestored",kt,!1),K.dispose(),W.dispose(),de.dispose(),M.dispose(),te.dispose(),S.dispose(),Re.dispose(),Ze.dispose(),Ze.removeEventListener("sessionstart",Cn),Ze.removeEventListener("sessionend",Ii),k&&(k.dispose(),k=null),dr.stop()};function lt(G){G.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function kt(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const G=ke.autoReset,ae=pe.enabled,se=pe.autoUpdate,re=pe.needsUpdate,he=pe.type;Fe(),ke.autoReset=G,pe.enabled=ae,pe.autoUpdate=se,pe.needsUpdate=re,pe.type=he}function jn(G){const ae=G.target;ae.removeEventListener("dispose",jn),rt(ae)}function rt(G){Tn(G),de.remove(G)}function Tn(G){const ae=de.get(G).programs;ae!==void 0&&ae.forEach(function(se){B.releaseProgram(se)})}function Wt(G,ae){G.render(function(se){g.renderBufferImmediate(se,ae)})}this.renderBufferImmediate=function(G,ae){Re.initAttributes();const se=de.get(G);G.hasPositions&&!se.position&&(se.position=ne.createBuffer()),G.hasNormals&&!se.normal&&(se.normal=ne.createBuffer()),G.hasUvs&&!se.uv&&(se.uv=ne.createBuffer()),G.hasColors&&!se.color&&(se.color=ne.createBuffer());const re=ae.getAttributes();G.hasPositions&&(ne.bindBuffer(34962,se.position),ne.bufferData(34962,G.positionArray,35048),Re.enableAttribute(re.position.location),ne.vertexAttribPointer(re.position.location,3,5126,!1,0,0)),G.hasNormals&&(ne.bindBuffer(34962,se.normal),ne.bufferData(34962,G.normalArray,35048),Re.enableAttribute(re.normal.location),ne.vertexAttribPointer(re.normal.location,3,5126,!1,0,0)),G.hasUvs&&(ne.bindBuffer(34962,se.uv),ne.bufferData(34962,G.uvArray,35048),Re.enableAttribute(re.uv.location),ne.vertexAttribPointer(re.uv.location,2,5126,!1,0,0)),G.hasColors&&(ne.bindBuffer(34962,se.color),ne.bufferData(34962,G.colorArray,35048),Re.enableAttribute(re.color.location),ne.vertexAttribPointer(re.color.location,3,5126,!1,0,0)),Re.disableUnusedAttributes(),ne.drawArrays(4,0,G.count),G.count=0},this.renderBufferDirect=function(G,ae,se,re,he,We){ae===null&&(ae=Q);const Be=he.isMesh&&he.matrixWorld.determinant()<0,Ge=Gd(G,ae,se,re,he);Me.setMaterial(re,Be);let Ke=se.index;const ht=se.attributes.position;if(Ke===null){if(ht===void 0||ht.count===0)return}else if(Ke.count===0)return;let it=1;re.wireframe===!0&&(Ke=T.getWireframeAttribute(se),it=2),Re.setup(he,re,Ge,se,Ke);let ft,_t=Z;Ke!==null&&(ft=X.get(Ke),_t=ye,_t.setIndex(ft));const Or=Ke!==null?Ke.count:ht.count,yt=se.drawRange.start*it,zr=se.drawRange.count*it,Et=We!==null?We.start*it:0,Ri=We!==null?We.count*it:1/0,Ur=Math.max(yt,Et),_r=Math.min(Or,yt+zr,Et+Ri)-1,Ss=Math.max(0,_r-Ur+1);if(Ss!==0){if(he.isMesh)re.wireframe===!0?(Me.setLineWidth(re.wireframeLinewidth*ie()),_t.setMode(1)):_t.setMode(4);else if(he.isLine){let Zt=re.linewidth;Zt===void 0&&(Zt=1),Me.setLineWidth(Zt*ie()),he.isLineSegments?_t.setMode(1):he.isLineLoop?_t.setMode(2):_t.setMode(3)}else he.isPoints?_t.setMode(0):he.isSprite&&_t.setMode(4);if(he.isInstancedMesh)_t.renderInstances(Ur,Ss,he.count);else if(se.isInstancedBufferGeometry){const Zt=Math.min(se.instanceCount,se._maxInstanceCount);_t.renderInstances(Ur,Ss,Zt)}else _t.render(Ur,Ss)}},this.compile=function(G,ae){d=W.get(G),d.init(),v.push(d),G.traverseVisible(function(se){se.isLight&&se.layers.test(ae.layers)&&(d.pushLight(se),se.castShadow&&d.pushShadow(se))}),d.setupLights(g.physicallyCorrectLights),G.traverse(function(se){const re=se.material;if(re)if(Array.isArray(re))for(let he=0;he<re.length;he++){const We=re[he];Ta(We,G,se)}else Ta(re,G,se)}),v.pop(),d=null};let bs=null;function vo(G){bs&&bs(G)}function Cn(){dr.stop()}function Ii(){dr.start()}const dr=new BE;dr.setAnimationLoop(vo),typeof window!="undefined"&&dr.setContext(window),this.setAnimationLoop=function(G){bs=G,Ze.setAnimationLoop(G),G===null?dr.stop():dr.start()},Ze.addEventListener("sessionstart",Cn),Ze.addEventListener("sessionend",Ii),this.render=function(G,ae){if(ae!==void 0&&ae.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;G.autoUpdate===!0&&G.updateMatrixWorld(),ae.parent===null&&ae.updateMatrixWorld(),Ze.enabled===!0&&Ze.isPresenting===!0&&(Ze.cameraAutoUpdate===!0&&Ze.updateCamera(ae),ae=Ze.getCamera()),G.isScene===!0&&G.onBeforeRender(g,G,ae,x),d=W.get(G,v.length),d.init(),v.push(d),V.multiplyMatrices(ae.projectionMatrix,ae.matrixWorldInverse),ee.setFromProjectionMatrix(V),le=this.localClippingEnabled,J=ce.init(this.clippingPlanes,le,ae),h=K.get(G,f.length),h.init(),f.push(h),Li(G,ae,0,g.sortObjects),h.finish(),g.sortObjects===!0&&h.sort(D,U),J===!0&&ce.beginShadows();const se=d.state.shadowsArray;if(pe.render(se,G,ae),J===!0&&ce.endShadows(),this.info.autoReset===!0&&this.info.reset(),ue.render(h,G),d.setupLights(g.physicallyCorrectLights),ae.isArrayCamera){const re=ae.cameras;for(let he=0,We=re.length;he<We;he++){const Be=re[he];yc(h,G,Be,Be.viewport)}}else yc(h,G,ae);x!==null&&(xe.updateMultisampleRenderTarget(x),xe.updateRenderTargetMipmap(x)),G.isScene===!0&&G.onAfterRender(g,G,ae),Me.buffers.depth.setTest(!0),Me.buffers.depth.setMask(!0),Me.buffers.color.setMask(!0),Me.setPolygonOffset(!1),Re.resetDefaultState(),w=-1,b=null,v.pop(),v.length>0?d=v[v.length-1]:d=null,f.pop(),f.length>0?h=f[f.length-1]:h=null};function Li(G,ae,se,re){if(G.visible===!1)return;if(G.layers.test(ae.layers)){if(G.isGroup)se=G.renderOrder;else if(G.isLOD)G.autoUpdate===!0&&G.update(ae);else if(G.isLight)d.pushLight(G),G.castShadow&&d.pushShadow(G);else if(G.isSprite){if(!G.frustumCulled||ee.intersectsSprite(G)){re&&$.setFromMatrixPosition(G.matrixWorld).applyMatrix4(V);const Be=S.update(G),Ge=G.material;Ge.visible&&h.push(G,Be,Ge,se,$.z,null)}}else if(G.isImmediateRenderObject)re&&$.setFromMatrixPosition(G.matrixWorld).applyMatrix4(V),h.push(G,null,G.material,se,$.z,null);else if((G.isMesh||G.isLine||G.isPoints)&&(G.isSkinnedMesh&&G.skeleton.frame!==ke.render.frame&&(G.skeleton.update(),G.skeleton.frame=ke.render.frame),!G.frustumCulled||ee.intersectsObject(G))){re&&$.setFromMatrixPosition(G.matrixWorld).applyMatrix4(V);const Be=S.update(G),Ge=G.material;if(Array.isArray(Ge)){const Ke=Be.groups;for(let ht=0,it=Ke.length;ht<it;ht++){const ft=Ke[ht],_t=Ge[ft.materialIndex];_t&&_t.visible&&h.push(G,Be,_t,se,$.z,ft)}}else Ge.visible&&h.push(G,Be,Ge,se,$.z,null)}}const We=G.children;for(let Be=0,Ge=We.length;Be<Ge;Be++)Li(We[Be],ae,se,re)}function yc(G,ae,se,re){const he=G.opaque,We=G.transmissive,Be=G.transparent;d.setupLightsView(se),We.length>0&&Bd(he,ae,se),re&&Me.viewport(C.copy(re)),he.length>0&&yo(he,ae,se),We.length>0&&yo(We,ae,se),Be.length>0&&yo(Be,ae,se)}function Bd(G,ae,se){if(k===null){const Be=a===!0&&we.isWebGL2===!0?NE:dn;k=new Be(1024,1024,{generateMipmaps:!0,type:ge.convert(Al)!==null?Al:fa,minFilter:Yp,magFilter:xn,wrapS:Pr,wrapT:Pr})}const re=g.getRenderTarget();g.setRenderTarget(k),g.clear();const he=g.toneMapping;g.toneMapping=Ja,yo(G,ae,se),g.toneMapping=he,xe.updateMultisampleRenderTarget(k),xe.updateRenderTargetMipmap(k),g.setRenderTarget(re)}function yo(G,ae,se){const re=ae.isScene===!0?ae.overrideMaterial:null;for(let he=0,We=G.length;he<We;he++){const Be=G[he],Ge=Be.object,Ke=Be.geometry,ht=re===null?Be.material:re,it=Be.group;Ge.layers.test(se.layers)&&xc(Ge,ae,se,Ke,ht,it)}}function xc(G,ae,se,re,he,We){if(G.onBeforeRender(g,ae,se,re,he,We),G.modelViewMatrix.multiplyMatrices(se.matrixWorldInverse,G.matrixWorld),G.normalMatrix.getNormalMatrix(G.modelViewMatrix),he.onBeforeRender(g,ae,se,re,G,We),G.isImmediateRenderObject){const Be=Gd(se,ae,re,he,G);Me.setMaterial(he),Re.reset(),Wt(G,Be)}else he.transparent===!0&&he.side===Un?(he.side=un,he.needsUpdate=!0,g.renderBufferDirect(se,ae,re,he,G,We),he.side=Bl,he.needsUpdate=!0,g.renderBufferDirect(se,ae,re,he,G,We),he.side=Un):g.renderBufferDirect(se,ae,re,he,G,We);G.onAfterRender(g,ae,se,re,he,We)}function Ta(G,ae,se){ae.isScene!==!0&&(ae=Q);const re=de.get(G),he=d.state.lights,We=d.state.shadowsArray,Be=he.state.version,Ge=B.getParameters(G,he.state,We,ae,se),Ke=B.getProgramCacheKey(Ge);let ht=re.programs;re.environment=G.isMeshStandardMaterial?ae.environment:null,re.fog=ae.fog,re.envMap=(G.isMeshStandardMaterial?te:M).get(G.envMap||re.environment),ht===void 0&&(G.addEventListener("dispose",jn),ht=new Map,re.programs=ht);let it=ht.get(Ke);if(it!==void 0){if(re.currentProgram===it&&re.lightsStateVersion===Be)return Hd(G,Ge),it}else Ge.uniforms=B.getUniforms(G),G.onBuild(Ge,g),G.onBeforeCompile(Ge,g),it=B.acquireProgram(Ge,Ke),ht.set(Ke,it),re.uniforms=Ge.uniforms;const ft=re.uniforms;(!G.isShaderMaterial&&!G.isRawShaderMaterial||G.clipping===!0)&&(ft.clippingPlanes=ce.uniform),Hd(G,Ge),re.needsLights=ym(G),re.lightsStateVersion=Be,re.needsLights&&(ft.ambientLightColor.value=he.state.ambient,ft.lightProbe.value=he.state.probe,ft.directionalLights.value=he.state.directional,ft.directionalLightShadows.value=he.state.directionalShadow,ft.spotLights.value=he.state.spot,ft.spotLightShadows.value=he.state.spotShadow,ft.rectAreaLights.value=he.state.rectArea,ft.ltc_1.value=he.state.rectAreaLTC1,ft.ltc_2.value=he.state.rectAreaLTC2,ft.pointLights.value=he.state.point,ft.pointLightShadows.value=he.state.pointShadow,ft.hemisphereLights.value=he.state.hemi,ft.directionalShadowMap.value=he.state.directionalShadowMap,ft.directionalShadowMatrix.value=he.state.directionalShadowMatrix,ft.spotShadowMap.value=he.state.spotShadowMap,ft.spotShadowMatrix.value=he.state.spotShadowMatrix,ft.pointShadowMap.value=he.state.pointShadowMap,ft.pointShadowMatrix.value=he.state.pointShadowMatrix);const _t=it.getUniforms(),Or=na.seqWithValue(_t.seq,ft);return re.currentProgram=it,re.uniformsList=Or,it}function Hd(G,ae){const se=de.get(G);se.outputEncoding=ae.outputEncoding,se.instancing=ae.instancing,se.skinning=ae.skinning,se.morphTargets=ae.morphTargets,se.morphNormals=ae.morphNormals,se.morphTargetsCount=ae.morphTargetsCount,se.numClippingPlanes=ae.numClippingPlanes,se.numIntersection=ae.numClipIntersection,se.vertexAlphas=ae.vertexAlphas,se.vertexTangents=ae.vertexTangents}function Gd(G,ae,se,re,he){ae.isScene!==!0&&(ae=Q),xe.resetTextureUnits();const We=ae.fog,Be=re.isMeshStandardMaterial?ae.environment:null,Ge=x===null?g.outputEncoding:x.texture.encoding,Ke=(re.isMeshStandardMaterial?te:M).get(re.envMap||Be),ht=re.vertexColors===!0&&!!se&&!!se.attributes.color&&se.attributes.color.itemSize===4,it=!!re.normalMap&&!!se&&!!se.attributes.tangent,ft=!!se&&!!se.morphAttributes.position,_t=!!se&&!!se.morphAttributes.normal,Or=!!se&&!!se.morphAttributes.position?se.morphAttributes.position.length:0,yt=de.get(re),zr=d.state.lights;if(J===!0&&(le===!0||G!==b)){const si=G===b&&re.id===w;ce.setState(re,G,si)}let Et=!1;re.version===yt.__version?(yt.needsLights&&yt.lightsStateVersion!==zr.state.version||yt.outputEncoding!==Ge||he.isInstancedMesh&&yt.instancing===!1||!he.isInstancedMesh&&yt.instancing===!0||he.isSkinnedMesh&&yt.skinning===!1||!he.isSkinnedMesh&&yt.skinning===!0||yt.envMap!==Ke||re.fog&&yt.fog!==We||yt.numClippingPlanes!==void 0&&(yt.numClippingPlanes!==ce.numPlanes||yt.numIntersection!==ce.numIntersection)||yt.vertexAlphas!==ht||yt.vertexTangents!==it||yt.morphTargets!==ft||yt.morphNormals!==_t||we.isWebGL2===!0&&yt.morphTargetsCount!==Or)&&(Et=!0):(Et=!0,yt.__version=re.version);let Ri=yt.currentProgram;Et===!0&&(Ri=Ta(re,ae,he));let Ur=!1,_r=!1,Ss=!1;const Zt=Ri.getUniforms(),wc=yt.uniforms;if(Me.useProgram(Ri.program)&&(Ur=!0,_r=!0,Ss=!0),re.id!==w&&(w=re.id,_r=!0),Ur||b!==G){if(Zt.setValue(ne,"projectionMatrix",G.projectionMatrix),we.logarithmicDepthBuffer&&Zt.setValue(ne,"logDepthBufFC",2/(Math.log(G.far+1)/Math.LN2)),b!==G&&(b=G,_r=!0,Ss=!0),re.isShaderMaterial||re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshStandardMaterial||re.envMap){const si=Zt.map.cameraPosition;si!==void 0&&si.setValue(ne,$.setFromMatrixPosition(G.matrixWorld))}(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial)&&Zt.setValue(ne,"isOrthographic",G.isOrthographicCamera===!0),(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial||re.isShadowMaterial||he.isSkinnedMesh)&&Zt.setValue(ne,"viewMatrix",G.matrixWorldInverse)}if(he.isSkinnedMesh){Zt.setOptional(ne,he,"bindMatrix"),Zt.setOptional(ne,he,"bindMatrixInverse");const si=he.skeleton;si&&(we.floatVertexTextures?(si.boneTexture===null&&si.computeBoneTexture(),Zt.setValue(ne,"boneTexture",si.boneTexture,xe),Zt.setValue(ne,"boneTextureSize",si.boneTextureSize)):Zt.setOptional(ne,si,"boneMatrices"))}return!!se&&(se.morphAttributes.position!==void 0||se.morphAttributes.normal!==void 0)&&ve.update(he,se,re,Ri),(_r||yt.receiveShadow!==he.receiveShadow)&&(yt.receiveShadow=he.receiveShadow,Zt.setValue(ne,"receiveShadow",he.receiveShadow)),_r&&(Zt.setValue(ne,"toneMappingExposure",g.toneMappingExposure),yt.needsLights&&vm(wc,Ss),We&&re.fog&&q.refreshFogUniforms(wc,We),q.refreshMaterialUniforms(wc,re,H,O,k),na.upload(ne,yt.uniformsList,wc,xe)),re.isShaderMaterial&&re.uniformsNeedUpdate===!0&&(na.upload(ne,yt.uniformsList,wc,xe),re.uniformsNeedUpdate=!1),re.isSpriteMaterial&&Zt.setValue(ne,"center",he.center),Zt.setValue(ne,"modelViewMatrix",he.modelViewMatrix),Zt.setValue(ne,"normalMatrix",he.normalMatrix),Zt.setValue(ne,"modelMatrix",he.matrixWorld),Ri}function vm(G,ae){G.ambientLightColor.needsUpdate=ae,G.lightProbe.needsUpdate=ae,G.directionalLights.needsUpdate=ae,G.directionalLightShadows.needsUpdate=ae,G.pointLights.needsUpdate=ae,G.pointLightShadows.needsUpdate=ae,G.spotLights.needsUpdate=ae,G.spotLightShadows.needsUpdate=ae,G.rectAreaLights.needsUpdate=ae,G.hemisphereLights.needsUpdate=ae}function ym(G){return G.isMeshLambertMaterial||G.isMeshToonMaterial||G.isMeshPhongMaterial||G.isMeshStandardMaterial||G.isShadowMaterial||G.isShaderMaterial&&G.lights===!0}this.getActiveCubeFace=function(){return p},this.getActiveMipmapLevel=function(){return m},this.getRenderTarget=function(){return x},this.setRenderTarget=function(G,ae=0,se=0){x=G,p=ae,m=se,G&&de.get(G).__webglFramebuffer===void 0&&xe.setupRenderTarget(G);let re=null,he=!1,We=!1;if(G){const Ge=G.texture;(Ge.isDataTexture3D||Ge.isDataTexture2DArray)&&(We=!0);const Ke=de.get(G).__webglFramebuffer;G.isWebGLCubeRenderTarget?(re=Ke[ae],he=!0):G.isWebGLMultisampleRenderTarget?re=de.get(G).__webglMultisampledFramebuffer:re=Ke,C.copy(G.viewport),A.copy(G.scissor),F=G.scissorTest}else C.copy(_).multiplyScalar(H).floor(),A.copy(z).multiplyScalar(H).floor(),F=j;if(Me.bindFramebuffer(36160,re)&&we.drawBuffers){let Ge=!1;if(G)if(G.isWebGLMultipleRenderTargets){const Ke=G.texture;if(R.length!==Ke.length||R[0]!==36064){for(let ht=0,it=Ke.length;ht<it;ht++)R[ht]=36064+ht;R.length=Ke.length,Ge=!0}}else(R.length!==1||R[0]!==36064)&&(R[0]=36064,R.length=1,Ge=!0);else(R.length!==1||R[0]!==1029)&&(R[0]=1029,R.length=1,Ge=!0);Ge&&(we.isWebGL2?ne.drawBuffers(R):_e.get("WEBGL_draw_buffers").drawBuffersWEBGL(R))}if(Me.viewport(C),Me.scissor(A),Me.setScissorTest(F),he){const Ge=de.get(G.texture);ne.framebufferTexture2D(36160,36064,34069+ae,Ge.__webglTexture,se)}else if(We){const Ge=de.get(G.texture),Ke=ae||0;ne.framebufferTextureLayer(36160,36064,Ge.__webglTexture,se||0,Ke)}w=-1},this.readRenderTargetPixels=function(G,ae,se,re,he,We,Be){if(!(G&&G.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ge=de.get(G).__webglFramebuffer;if(G.isWebGLCubeRenderTarget&&Be!==void 0&&(Ge=Ge[Be]),Ge){Me.bindFramebuffer(36160,Ge);try{const Ke=G.texture,ht=Ke.format,it=Ke.type;if(ht!==bn&&ge.convert(ht)!==ne.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ft=it===Al&&(_e.has("EXT_color_buffer_half_float")||we.isWebGL2&&_e.has("EXT_color_buffer_float"));if(it!==fa&&ge.convert(it)!==ne.getParameter(35738)&&!(it===Us&&(we.isWebGL2||_e.has("OES_texture_float")||_e.has("WEBGL_color_buffer_float")))&&!ft){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ne.checkFramebufferStatus(36160)===36053?ae>=0&&ae<=G.width-re&&se>=0&&se<=G.height-he&&ne.readPixels(ae,se,re,he,ge.convert(ht),ge.convert(it),We):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const Ke=x!==null?de.get(x).__webglFramebuffer:null;Me.bindFramebuffer(36160,Ke)}}},this.copyFramebufferToTexture=function(G,ae,se=0){const re=Math.pow(2,-se),he=Math.floor(ae.image.width*re),We=Math.floor(ae.image.height*re);let Be=ge.convert(ae.format);we.isWebGL2&&(Be===6407&&(Be=32849),Be===6408&&(Be=32856)),xe.setTexture2D(ae,0),ne.copyTexImage2D(3553,se,Be,G.x,G.y,he,We,0),Me.unbindTexture()},this.copyTextureToTexture=function(G,ae,se,re=0){const he=ae.image.width,We=ae.image.height,Be=ge.convert(se.format),Ge=ge.convert(se.type);xe.setTexture2D(se,0),ne.pixelStorei(37440,se.flipY),ne.pixelStorei(37441,se.premultiplyAlpha),ne.pixelStorei(3317,se.unpackAlignment),ae.isDataTexture?ne.texSubImage2D(3553,re,G.x,G.y,he,We,Be,Ge,ae.image.data):ae.isCompressedTexture?ne.compressedTexSubImage2D(3553,re,G.x,G.y,ae.mipmaps[0].width,ae.mipmaps[0].height,Be,ae.mipmaps[0].data):ne.texSubImage2D(3553,re,G.x,G.y,Be,Ge,ae.image),re===0&&se.generateMipmaps&&ne.generateMipmap(3553),Me.unbindTexture()},this.copyTextureToTexture3D=function(G,ae,se,re,he=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const We=G.max.x-G.min.x+1,Be=G.max.y-G.min.y+1,Ge=G.max.z-G.min.z+1,Ke=ge.convert(re.format),ht=ge.convert(re.type);let it;if(re.isDataTexture3D)xe.setTexture3D(re,0),it=32879;else if(re.isDataTexture2DArray)xe.setTexture2DArray(re,0),it=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ne.pixelStorei(37440,re.flipY),ne.pixelStorei(37441,re.premultiplyAlpha),ne.pixelStorei(3317,re.unpackAlignment);const ft=ne.getParameter(3314),_t=ne.getParameter(32878),Or=ne.getParameter(3316),yt=ne.getParameter(3315),zr=ne.getParameter(32877),Et=se.isCompressedTexture?se.mipmaps[0]:se.image;ne.pixelStorei(3314,Et.width),ne.pixelStorei(32878,Et.height),ne.pixelStorei(3316,G.min.x),ne.pixelStorei(3315,G.min.y),ne.pixelStorei(32877,G.min.z),se.isDataTexture||se.isDataTexture3D?ne.texSubImage3D(it,he,ae.x,ae.y,ae.z,We,Be,Ge,Ke,ht,Et.data):se.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ne.compressedTexSubImage3D(it,he,ae.x,ae.y,ae.z,We,Be,Ge,Ke,Et.data)):ne.texSubImage3D(it,he,ae.x,ae.y,ae.z,We,Be,Ge,Ke,ht,Et),ne.pixelStorei(3314,ft),ne.pixelStorei(32878,_t),ne.pixelStorei(3316,Or),ne.pixelStorei(3315,yt),ne.pixelStorei(32877,zr),he===0&&re.generateMipmaps&&ne.generateMipmap(it),Me.unbindTexture()},this.initTexture=function(G){xe.setTexture2D(G,0),Me.unbindTexture()},this.resetState=function(){p=0,m=0,x=null,Me.reset(),Re.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Gk extends St{}Gk.prototype.isWebGL1Renderer=!0;class Ea extends ot{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}Ea.prototype.isScene=!0;class Fd{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Ju,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ei()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ei()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ei()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Fd.prototype.isInterleavedBuffer=!0;const en=new L;class ed{constructor(e,t,r,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)en.x=this.getX(t),en.y=this.getY(t),en.z=this.getZ(t),en.applyMatrix4(e),this.setXYZ(t,en.x,en.y,en.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)en.x=this.getX(t),en.y=this.getY(t),en.z=this.getZ(t),en.applyNormalMatrix(e),this.setXYZ(t,en.x,en.y,en.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)en.x=this.getX(t),en.y=this.getY(t),en.z=this.getZ(t),en.transformDirection(e),this.setXYZ(t,en.x,en.y,en.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new Kt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ed(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ed.prototype.isInterleavedBufferAttribute=!0;class em extends nr{constructor(e){super(),this.type="SpriteMaterial",this.color=new Ce(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}em.prototype.isSpriteMaterial=!0;let zo;const zc=new L,Uo=new L,Bo=new L,Ho=new oe,Uc=new oe,eA=new ze,bh=new L,Bc=new L,Sh=new L,y1=new oe,Eg=new oe,x1=new oe;class Qy extends ot{constructor(e){if(super(),this.type="Sprite",zo===void 0){zo=new nt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new Fd(t,5);zo.setIndex([0,1,2,0,2,3]),zo.setAttribute("position",new ed(r,3,0,!1)),zo.setAttribute("uv",new ed(r,2,3,!1))}this.geometry=zo,this.material=e!==void 0?e:new em,this.center=new oe(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Uo.setFromMatrixScale(this.matrixWorld),eA.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Bo.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Uo.multiplyScalar(-Bo.z);const r=this.material.rotation;let i,s;r!==0&&(s=Math.cos(r),i=Math.sin(r));const a=this.center;Mh(bh.set(-.5,-.5,0),Bo,a,Uo,i,s),Mh(Bc.set(.5,-.5,0),Bo,a,Uo,i,s),Mh(Sh.set(.5,.5,0),Bo,a,Uo,i,s),y1.set(0,0),Eg.set(1,0),x1.set(1,1);let o=e.ray.intersectTriangle(bh,Bc,Sh,!1,zc);if(o===null&&(Mh(Bc.set(-.5,.5,0),Bo,a,Uo,i,s),Eg.set(0,1),o=e.ray.intersectTriangle(bh,Sh,Bc,!1,zc),o===null))return;const l=e.ray.origin.distanceTo(zc);l<e.near||l>e.far||t.push({distance:l,point:zc.clone(),uv:cn.getUV(zc,bh,Bc,Sh,y1,Eg,x1,new oe),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}Qy.prototype.isSprite=!0;function Mh(n,e,t,r,i,s){Ho.subVectors(n,t).addScalar(.5).multiply(r),i!==void 0?(Uc.x=s*Ho.x-i*Ho.y,Uc.y=i*Ho.x+s*Ho.y):Uc.copy(Ho),n.copy(e),n.x+=Uc.x,n.y+=Uc.y,n.applyMatrix4(eA)}const w1=new L,_1=new Tt,b1=new Tt,Vk=new L,S1=new ze;class tA extends be{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ze,this.bindMatrixInverse=new ze}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Tt,t=this.geometry.attributes.skinWeight;for(let r=0,i=t.count;r<i;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const r=this.skeleton,i=this.geometry;_1.fromBufferAttribute(i.attributes.skinIndex,e),b1.fromBufferAttribute(i.attributes.skinWeight,e),w1.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=b1.getComponent(s);if(a!==0){const o=_1.getComponent(s);S1.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),t.addScaledVector(Vk.copy(w1).applyMatrix4(S1),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}tA.prototype.isSkinnedMesh=!0;class jk extends ot{constructor(){super(),this.type="Bone"}}jk.prototype.isBone=!0;class Wk extends Hn{constructor(e=null,t=1,r=1,i,s,a,o,l,c=xn,u=xn,h,d){super(null,a,o,l,c,u,i,s,h,d),this.image={data:e,width:t,height:r},this.magFilter=c,this.minFilter=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Wk.prototype.isDataTexture=!0;class t0 extends Kt{constructor(e,t,r,i=1){typeof r=="number"&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,r),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}t0.prototype.isInstancedBufferAttribute=!0;const M1=new ze,E1=new ze,Eh=[],Hc=new be;class Xk extends be{constructor(e,t,r){super(e,t),this.instanceMatrix=new t0(new Float32Array(r*16),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const r=this.matrixWorld,i=this.count;if(Hc.geometry=this.geometry,Hc.material=this.material,Hc.material!==void 0)for(let s=0;s<i;s++){this.getMatrixAt(s,M1),E1.multiplyMatrices(r,M1),Hc.matrixWorld=E1,Hc.raycast(e,Eh);for(let a=0,o=Eh.length;a<o;a++){const l=Eh[a];l.instanceId=s,l.object=this,t.push(l)}Eh.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new t0(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Xk.prototype.isInstancedMesh=!0;class Gn extends nr{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Ce(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Gn.prototype.isLineBasicMaterial=!0;const A1=new L,T1=new L,C1=new ze,Ag=new po,Ah=new sc;class gn extends ot{constructor(e=new nt,t=new Gn){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,r=[0];for(let i=1,s=t.count;i<s;i++)A1.fromBufferAttribute(t,i-1),T1.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=A1.distanceTo(T1);e.setAttribute("lineDistance",new Ye(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Ah.copy(r.boundingSphere),Ah.applyMatrix4(i),Ah.radius+=s,e.ray.intersectsSphere(Ah)===!1)return;C1.copy(i).invert(),Ag.copy(e.ray).applyMatrix4(C1);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=new L,u=new L,h=new L,d=new L,f=this.isLineSegments?2:1;if(r.isBufferGeometry){const v=r.index,y=r.attributes.position;if(v!==null){const p=Math.max(0,a.start),m=Math.min(v.count,a.start+a.count);for(let x=p,w=m-1;x<w;x+=f){const b=v.getX(x),C=v.getX(x+1);if(c.fromBufferAttribute(y,b),u.fromBufferAttribute(y,C),Ag.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const F=e.ray.origin.distanceTo(d);F<e.near||F>e.far||t.push({distance:F,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{const p=Math.max(0,a.start),m=Math.min(y.count,a.start+a.count);for(let x=p,w=m-1;x<w;x+=f){if(c.fromBufferAttribute(y,x),u.fromBufferAttribute(y,x+1),Ag.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const C=e.ray.origin.distanceTo(d);C<e.near||C>e.far||t.push({distance:C,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else r.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}gn.prototype.isLine=!0;const P1=new L,I1=new L;class ys extends gn{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,r=[];for(let i=0,s=t.count;i<s;i+=2)P1.fromBufferAttribute(t,i),I1.fromBufferAttribute(t,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+P1.distanceTo(I1);e.setAttribute("lineDistance",new Ye(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ys.prototype.isLineSegments=!0;class Yk extends gn{constructor(e,t){super(e,t),this.type="LineLoop"}}Yk.prototype.isLineLoop=!0;class ep extends nr{constructor(e){super(),this.type="PointsMaterial",this.color=new Ce(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}ep.prototype.isPointsMaterial=!0;const L1=new ze,n0=new po,Th=new sc,Ch=new L;class cf extends ot{constructor(e=new nt,t=new ep){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Th.copy(r.boundingSphere),Th.applyMatrix4(i),Th.radius+=s,e.ray.intersectsSphere(Th)===!1)return;L1.copy(i).invert(),n0.copy(e.ray).applyMatrix4(L1);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o;if(r.isBufferGeometry){const c=r.index,h=r.attributes.position;if(c!==null){const d=Math.max(0,a.start),f=Math.min(c.count,a.start+a.count);for(let v=d,g=f;v<g;v++){const y=c.getX(v);Ch.fromBufferAttribute(h,y),R1(Ch,y,l,i,e,t,this)}}else{const d=Math.max(0,a.start),f=Math.min(h.count,a.start+a.count);for(let v=d,g=f;v<g;v++)Ch.fromBufferAttribute(h,v),R1(Ch,v,l,i,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}cf.prototype.isPoints=!0;function R1(n,e,t,r,i,s,a){const o=n0.distanceSqToPoint(n);if(o<t){const l=new L;n0.closestPointToPoint(n,l),l.applyMatrix4(r);const c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,object:a})}}class $k extends Hn{constructor(e,t,r,i,s,a,o,l,c){super(e,t,r,i,s,a,o,l,c),this.format=o!==void 0?o:Tl,this.minFilter=a!==void 0?a:_n,this.magFilter=s!==void 0?s:_n,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}$k.prototype.isVideoTexture=!0;class Zk extends Hn{constructor(e,t,r,i,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,i,s,h,d),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}Zk.prototype.isCompressedTexture=!0;class qk extends Hn{constructor(e,t,r,i,s,a,o,l,c){super(e,t,r,i,s,a,o,l,c),this.needsUpdate=!0}}qk.prototype.isCanvasTexture=!0;class Qk extends Hn{constructor(e,t,r,i,s,a,o,l,c,u){if(u=u!==void 0?u:Cl,u!==Cl&&u!==Qu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===Cl&&(r=Zf),r===void 0&&u===Qu&&(r=_u),super(null,i,s,a,o,l,u,r,c),this.image={width:e,height:t},this.magFilter=o!==void 0?o:xn,this.minFilter=l!==void 0?l:xn,this.flipY=!1,this.generateMipmaps=!1}}Qk.prototype.isDepthTexture=!0;class Jy extends nt{constructor(e=1,t=8,r=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},t=Math.max(3,t);const s=[],a=[],o=[],l=[],c=new L,u=new oe;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=t;h++,d+=3){const f=r+h/t*i;c.x=e*Math.cos(f),c.y=e*Math.sin(f),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/e+1)/2,u.y=(a[d+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=t;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Ye(a,3)),this.setAttribute("normal",new Ye(o,3)),this.setAttribute("uv",new Ye(l,2))}static fromJSON(e){return new Jy(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Fn extends nt{constructor(e=1,t=1,r=1,i=8,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;i=Math.floor(i),s=Math.floor(s);const u=[],h=[],d=[],f=[];let v=0;const g=[],y=r/2;let p=0;m(),a===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new Ye(h,3)),this.setAttribute("normal",new Ye(d,3)),this.setAttribute("uv",new Ye(f,2));function m(){const w=new L,b=new L;let C=0;const A=(t-e)/r;for(let F=0;F<=s;F++){const N=[],O=F/s,H=O*(t-e)+e;for(let D=0;D<=i;D++){const U=D/i,_=U*l+o,z=Math.sin(_),j=Math.cos(_);b.x=H*z,b.y=-O*r+y,b.z=H*j,h.push(b.x,b.y,b.z),w.set(z,A,j).normalize(),d.push(w.x,w.y,w.z),f.push(U,1-O),N.push(v++)}g.push(N)}for(let F=0;F<i;F++)for(let N=0;N<s;N++){const O=g[N][F],H=g[N+1][F],D=g[N+1][F+1],U=g[N][F+1];u.push(O,H,U),u.push(H,D,U),C+=6}c.addGroup(p,C,0),p+=C}function x(w){const b=v,C=new oe,A=new L;let F=0;const N=w===!0?e:t,O=w===!0?1:-1;for(let D=1;D<=i;D++)h.push(0,y*O,0),d.push(0,O,0),f.push(.5,.5),v++;const H=v;for(let D=0;D<=i;D++){const _=D/i*l+o,z=Math.cos(_),j=Math.sin(_);A.x=N*j,A.y=y*O,A.z=N*z,h.push(A.x,A.y,A.z),d.push(0,O,0),C.x=z*.5+.5,C.y=j*.5*O+.5,f.push(C.x,C.y),v++}for(let D=0;D<i;D++){const U=b+D,_=H+D;w===!0?u.push(_,_+1,U):u.push(_+1,_,U),F+=3}c.addGroup(p,F,w===!0?1:2),p+=F}}static fromJSON(e){return new Fn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ky extends nt{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};const s=[],a=[];o(i),c(r),u(),this.setAttribute("position",new Ye(s,3)),this.setAttribute("normal",new Ye(s.slice(),3)),this.setAttribute("uv",new Ye(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(m){const x=new L,w=new L,b=new L;for(let C=0;C<t.length;C+=3)f(t[C+0],x),f(t[C+1],w),f(t[C+2],b),l(x,w,b,m)}function l(m,x,w,b){const C=b+1,A=[];for(let F=0;F<=C;F++){A[F]=[];const N=m.clone().lerp(w,F/C),O=x.clone().lerp(w,F/C),H=C-F;for(let D=0;D<=H;D++)D===0&&F===C?A[F][D]=N:A[F][D]=N.clone().lerp(O,D/H)}for(let F=0;F<C;F++)for(let N=0;N<2*(C-F)-1;N++){const O=Math.floor(N/2);N%2===0?(d(A[F][O+1]),d(A[F+1][O]),d(A[F][O])):(d(A[F][O+1]),d(A[F+1][O+1]),d(A[F+1][O]))}}function c(m){const x=new L;for(let w=0;w<s.length;w+=3)x.x=s[w+0],x.y=s[w+1],x.z=s[w+2],x.normalize().multiplyScalar(m),s[w+0]=x.x,s[w+1]=x.y,s[w+2]=x.z}function u(){const m=new L;for(let x=0;x<s.length;x+=3){m.x=s[x+0],m.y=s[x+1],m.z=s[x+2];const w=y(m)/2/Math.PI+.5,b=p(m)/Math.PI+.5;a.push(w,1-b)}v(),h()}function h(){for(let m=0;m<a.length;m+=6){const x=a[m+0],w=a[m+2],b=a[m+4],C=Math.max(x,w,b),A=Math.min(x,w,b);C>.9&&A<.1&&(x<.2&&(a[m+0]+=1),w<.2&&(a[m+2]+=1),b<.2&&(a[m+4]+=1))}}function d(m){s.push(m.x,m.y,m.z)}function f(m,x){const w=m*3;x.x=e[w+0],x.y=e[w+1],x.z=e[w+2]}function v(){const m=new L,x=new L,w=new L,b=new L,C=new oe,A=new oe,F=new oe;for(let N=0,O=0;N<s.length;N+=9,O+=6){m.set(s[N+0],s[N+1],s[N+2]),x.set(s[N+3],s[N+4],s[N+5]),w.set(s[N+6],s[N+7],s[N+8]),C.set(a[O+0],a[O+1]),A.set(a[O+2],a[O+3]),F.set(a[O+4],a[O+5]),b.copy(m).add(x).add(w).divideScalar(3);const H=y(b);g(C,O+0,m,H),g(A,O+2,x,H),g(F,O+4,w,H)}}function g(m,x,w,b){b<0&&m.x===1&&(a[x]=m.x-1),w.x===0&&w.z===0&&(a[x]=b/2/Math.PI+.5)}function y(m){return Math.atan2(m.z,-m.x)}function p(m){return Math.atan2(-m.y,Math.sqrt(m.x*m.x+m.z*m.z))}}static fromJSON(e){return new Ky(e.vertices,e.indices,e.radius,e.details)}}new L;new L;new L;new cn;class ti{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,i=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),s+=r.distanceTo(i),t.push(s),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let i=0;const s=r.length;let a;t?a=t:a=e*r[s-1];let o=0,l=s-1,c;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),c=r[i]-a,c<0)o=i+1;else if(c>0)l=i-1;else{l=i;break}if(i=l,r[i]===a)return i/(s-1);const u=r[i],d=r[i+1]-u,f=(a-u)/d;return(i+f)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const a=this.getPoint(i),o=this.getPoint(s),l=t||(a.isVector2?new oe:new L);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new L,i=[],s=[],a=[],o=new L,l=new ze;for(let f=0;f<=e;f++){const v=f/e;i[f]=this.getTangentAt(v,new L)}s[0]=new L,a[0]=new L;let c=Number.MAX_VALUE;const u=Math.abs(i[0].x),h=Math.abs(i[0].y),d=Math.abs(i[0].z);u<=c&&(c=u,r.set(1,0,0)),h<=c&&(c=h,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],o),a[0].crossVectors(i[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(i[f-1],i[f]),o.length()>Number.EPSILON){o.normalize();const v=Math.acos(ir(i[f-1].dot(i[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(o,v))}a[f].crossVectors(i[f],s[f])}if(t===!0){let f=Math.acos(ir(s[0].dot(s[e]),-1,1));f/=e,i[0].dot(o.crossVectors(s[0],s[e]))>0&&(f=-f);for(let v=1;v<=e;v++)s[v].applyMatrix4(l.makeRotationAxis(i[v],f*v)),a[v].crossVectors(i[v],s[v])}return{tangents:i,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class tm extends ti{constructor(e=0,t=0,r=1,i=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,t){const r=t||new oe,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(a?s=0:s=i),this.aClockwise===!0&&!a&&(s===i?s=-i:s=s-i);const o=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*u-f*h+this.aX,c=d*h+f*u+this.aY}return r.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}tm.prototype.isEllipseCurve=!0;class nA extends tm{constructor(e,t,r,i,s,a){super(e,t,r,r,i,s,a),this.type="ArcCurve"}}nA.prototype.isArcCurve=!0;function ex(){let n=0,e=0,t=0,r=0;function i(s,a,o,l){n=s,e=o,t=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){i(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,f=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,f*=u,i(a,o,d,f)},calc:function(s){const a=s*s,o=a*s;return n+e*s+t*a+r*o}}}const Ph=new L,Tg=new ex,Cg=new ex,Pg=new ex;class tp extends ti{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new L){const r=t,i=this.points,s=i.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=i[(o-1)%s]:(Ph.subVectors(i[0],i[1]).add(i[0]),c=Ph);const h=i[o%s],d=i[(o+1)%s];if(this.closed||o+2<s?u=i[(o+2)%s]:(Ph.subVectors(i[s-1],i[s-2]).add(i[s-1]),u=Ph),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let v=Math.pow(c.distanceToSquared(h),f),g=Math.pow(h.distanceToSquared(d),f),y=Math.pow(d.distanceToSquared(u),f);g<1e-4&&(g=1),v<1e-4&&(v=g),y<1e-4&&(y=g),Tg.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,v,g,y),Cg.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,v,g,y),Pg.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,v,g,y)}else this.curveType==="catmullrom"&&(Tg.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),Cg.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),Pg.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return r.set(Tg.calc(l),Cg.calc(l),Pg.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new L().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}tp.prototype.isCatmullRomCurve3=!0;function F1(n,e,t,r,i){const s=(r-e)*.5,a=(i-t)*.5,o=n*n,l=n*o;return(2*t-2*r+s+a)*l+(-3*t+3*r-2*s-a)*o+s*n+t}function Jk(n,e){const t=1-n;return t*t*e}function Kk(n,e){return 2*(1-n)*n*e}function eO(n,e){return n*n*e}function Mu(n,e,t,r){return Jk(n,e)+Kk(n,t)+eO(n,r)}function tO(n,e){const t=1-n;return t*t*t*e}function nO(n,e){const t=1-n;return 3*t*t*n*e}function rO(n,e){return 3*(1-n)*n*n*e}function iO(n,e){return n*n*n*e}function Eu(n,e,t,r,i){return tO(n,e)+nO(n,t)+rO(n,r)+iO(n,i)}class tx extends ti{constructor(e=new oe,t=new oe,r=new oe,i=new oe){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new oe){const r=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(Eu(e,i.x,s.x,a.x,o.x),Eu(e,i.y,s.y,a.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}tx.prototype.isCubicBezierCurve=!0;class rA extends ti{constructor(e=new L,t=new L,r=new L,i=new L){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new L){const r=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(Eu(e,i.x,s.x,a.x,o.x),Eu(e,i.y,s.y,a.y,o.y),Eu(e,i.z,s.z,a.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}rA.prototype.isCubicBezierCurve3=!0;class nm extends ti{constructor(e=new oe,t=new oe){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new oe){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const r=t||new oe;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}nm.prototype.isLineCurve=!0;class sO extends ti{constructor(e=new L,t=new L){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new L){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class nx extends ti{constructor(e=new oe,t=new oe,r=new oe){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new oe){const r=t,i=this.v0,s=this.v1,a=this.v2;return r.set(Mu(e,i.x,s.x,a.x),Mu(e,i.y,s.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}nx.prototype.isQuadraticBezierCurve=!0;class rx extends ti{constructor(e=new L,t=new L,r=new L){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new L){const r=t,i=this.v0,s=this.v1,a=this.v2;return r.set(Mu(e,i.x,s.x,a.x),Mu(e,i.y,s.y,a.y),Mu(e,i.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}rx.prototype.isQuadraticBezierCurve3=!0;class ix extends ti{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new oe){const r=t,i=this.points,s=(i.length-1)*e,a=Math.floor(s),o=s-a,l=i[a===0?a:a-1],c=i[a],u=i[a>i.length-2?i.length-1:a+1],h=i[a>i.length-3?i.length-1:a+2];return r.set(F1(o,l.x,c.x,u.x,h.x),F1(o,l.y,c.y,u.y,h.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new oe().fromArray(i))}return this}}ix.prototype.isSplineCurve=!0;var sx=Object.freeze({__proto__:null,ArcCurve:nA,CatmullRomCurve3:tp,CubicBezierCurve:tx,CubicBezierCurve3:rA,EllipseCurve:tm,LineCurve:nm,LineCurve3:sO,QuadraticBezierCurve:nx,QuadraticBezierCurve3:rx,SplineCurve:ix});class aO extends ti{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new nm(t,e))}getPoint(e,t){const r=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=r){const a=i[s]-r,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let i=0,s=this.curves;i<s.length;i++){const a=s[i],o=a&&a.isEllipseCurve?e*2:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(t.push(u),r=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push(new sx[i.type]().fromJSON(i))}return this}}class r0 extends aO{constructor(e){super(),this.type="Path",this.currentPoint=new oe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new nm(this.currentPoint.clone(),new oe(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){const s=new nx(this.currentPoint.clone(),new oe(e,t),new oe(r,i));return this.curves.push(s),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,s,a){const o=new tx(this.currentPoint.clone(),new oe(e,t),new oe(r,i),new oe(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new ix(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,r,i,s,a),this}absarc(e,t,r,i,s,a){return this.absellipse(e,t,r,r,i,s,a),this}ellipse(e,t,r,i,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,r,i,s,a,o,l),this}absellipse(e,t,r,i,s,a,o,l){const c=new tm(e,t,r,i,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Dd extends r0{constructor(e){super(e),this.uuid=Ei(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push(new r0().fromJSON(i))}return this}}const oO={triangulate:function(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let s=iA(n,0,i,t,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,f;if(r&&(s=hO(n,e,s,t)),n.length>80*t){o=c=n[0],l=u=n[1];for(let v=t;v<i;v+=t)h=n[v],d=n[v+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-o,u-l),f=f!==0?1/f:0}return td(s,a,t,o,l,f),a}};function iA(n,e,t,r,i){let s,a;if(i===SO(n,e,t,r)>0)for(s=e;s<t;s+=r)a=D1(s,n[s],n[s+1],a);else for(s=t-r;s>=e;s-=r)a=D1(s,n[s],n[s+1],a);return a&&rm(a,a.next)&&(rd(a),a=a.next),a}function ma(n,e){if(!n)return n;e||(e=n);let t=n,r;do if(r=!1,!t.steiner&&(rm(t,t.next)||Yt(t.prev,t,t.next)===0)){if(rd(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function td(n,e,t,r,i,s,a){if(!n)return;!a&&s&&vO(n,r,i,s);let o=n,l,c;for(;n.prev!==n.next;){if(l=n.prev,c=n.next,s?cO(n,r,i,s):lO(n)){e.push(l.i/t),e.push(n.i/t),e.push(c.i/t),rd(n),n=c.next,o=c.next;continue}if(n=c,n===o){a?a===1?(n=uO(ma(n),e,t),td(n,e,t,r,i,s,2)):a===2&&dO(n,e,t,r,i,s):td(ma(n),e,t,r,i,s,1);break}}}function lO(n){const e=n.prev,t=n,r=n.next;if(Yt(e,t,r)>=0)return!1;let i=n.next.next;for(;i!==n.prev;){if(al(e.x,e.y,t.x,t.y,r.x,r.y,i.x,i.y)&&Yt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function cO(n,e,t,r){const i=n.prev,s=n,a=n.next;if(Yt(i,s,a)>=0)return!1;const o=i.x<s.x?i.x<a.x?i.x:a.x:s.x<a.x?s.x:a.x,l=i.y<s.y?i.y<a.y?i.y:a.y:s.y<a.y?s.y:a.y,c=i.x>s.x?i.x>a.x?i.x:a.x:s.x>a.x?s.x:a.x,u=i.y>s.y?i.y>a.y?i.y:a.y:s.y>a.y?s.y:a.y,h=i0(o,l,e,t,r),d=i0(c,u,e,t,r);let f=n.prevZ,v=n.nextZ;for(;f&&f.z>=h&&v&&v.z<=d;){if(f!==n.prev&&f!==n.next&&al(i.x,i.y,s.x,s.y,a.x,a.y,f.x,f.y)&&Yt(f.prev,f,f.next)>=0||(f=f.prevZ,v!==n.prev&&v!==n.next&&al(i.x,i.y,s.x,s.y,a.x,a.y,v.x,v.y)&&Yt(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;f&&f.z>=h;){if(f!==n.prev&&f!==n.next&&al(i.x,i.y,s.x,s.y,a.x,a.y,f.x,f.y)&&Yt(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=d;){if(v!==n.prev&&v!==n.next&&al(i.x,i.y,s.x,s.y,a.x,a.y,v.x,v.y)&&Yt(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function uO(n,e,t){let r=n;do{const i=r.prev,s=r.next.next;!rm(i,s)&&sA(i,r,r.next,s)&&nd(i,s)&&nd(s,i)&&(e.push(i.i/t),e.push(r.i/t),e.push(s.i/t),rd(r),rd(r.next),r=n=s),r=r.next}while(r!==n);return ma(r)}function dO(n,e,t,r,i,s){let a=n;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&wO(a,o)){let l=aA(a,o);a=ma(a,a.next),l=ma(l,l.next),td(a,e,t,r,i,s),td(l,e,t,r,i,s);return}o=o.next}a=a.next}while(a!==n)}function hO(n,e,t,r){const i=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*r,l=s<a-1?e[s+1]*r:n.length,c=iA(n,o,l,r,!1),c===c.next&&(c.steiner=!0),i.push(xO(c));for(i.sort(fO),s=0;s<i.length;s++)pO(i[s],t),t=ma(t,t.next);return t}function fO(n,e){return n.x-e.x}function pO(n,e){if(e=mO(n,e),e){const t=aA(e,n);ma(e,e.next),ma(t,t.next)}}function mO(n,e){let t=e;const r=n.x,i=n.y;let s=-1/0,a;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const d=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=r&&d>s){if(s=d,d===r){if(i===t.y)return t;if(i===t.next.y)return t.next}a=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!a)return null;if(r===s)return a;const o=a,l=a.x,c=a.y;let u=1/0,h;t=a;do r>=t.x&&t.x>=l&&r!==t.x&&al(i<c?r:s,i,l,c,i<c?s:r,i,t.x,t.y)&&(h=Math.abs(i-t.y)/(r-t.x),nd(t,n)&&(h<u||h===u&&(t.x>a.x||t.x===a.x&&gO(a,t)))&&(a=t,u=h)),t=t.next;while(t!==o);return a}function gO(n,e){return Yt(n.prev,n,e.prev)<0&&Yt(e.next,n,n.next)<0}function vO(n,e,t,r){let i=n;do i.z===null&&(i.z=i0(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,yO(i)}function yO(n){let e,t,r,i,s,a,o,l,c=1;do{for(t=n,n=null,s=null,a=0;t;){for(a++,r=t,o=0,e=0;e<c&&(o++,r=r.nextZ,!!r);e++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||t.z<=r.z)?(i=t,t=t.nextZ,o--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;t=r}s.nextZ=null,c*=2}while(a>1);return n}function i0(n,e,t,r,i){return n=32767*(n-t)*i,e=32767*(e-r)*i,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function xO(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function al(n,e,t,r,i,s,a,o){return(i-a)*(e-o)-(n-a)*(s-o)>=0&&(n-a)*(r-o)-(t-a)*(e-o)>=0&&(t-a)*(s-o)-(i-a)*(r-o)>=0}function wO(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!_O(n,e)&&(nd(n,e)&&nd(e,n)&&bO(n,e)&&(Yt(n.prev,n,e.prev)||Yt(n,e.prev,e))||rm(n,e)&&Yt(n.prev,n,n.next)>0&&Yt(e.prev,e,e.next)>0)}function Yt(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function rm(n,e){return n.x===e.x&&n.y===e.y}function sA(n,e,t,r){const i=Lh(Yt(n,e,t)),s=Lh(Yt(n,e,r)),a=Lh(Yt(t,r,n)),o=Lh(Yt(t,r,e));return!!(i!==s&&a!==o||i===0&&Ih(n,t,e)||s===0&&Ih(n,r,e)||a===0&&Ih(t,n,r)||o===0&&Ih(t,e,r))}function Ih(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Lh(n){return n>0?1:n<0?-1:0}function _O(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&sA(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function nd(n,e){return Yt(n.prev,n,n.next)<0?Yt(n,e,n.next)>=0&&Yt(n,n.prev,e)>=0:Yt(n,e,n.prev)<0||Yt(n,n.next,e)<0}function bO(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function aA(n,e){const t=new s0(n.i,n.x,n.y),r=new s0(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function D1(n,e,t,r){const i=new s0(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function rd(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function s0(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function SO(n,e,t,r){let i=0;for(let s=e,a=t-r;s<t;s+=r)i+=(n[a]-n[s])*(n[s+1]+n[a+1]),a=s;return i}class ra{static area(e){const t=e.length;let r=0;for(let i=t-1,s=0;s<t;i=s++)r+=e[i].x*e[s].y-e[s].x*e[i].y;return r*.5}static isClockWise(e){return ra.area(e)<0}static triangulateShape(e,t){const r=[],i=[],s=[];N1(e),k1(r,e);let a=e.length;t.forEach(N1);for(let l=0;l<t.length;l++)i.push(a),a+=t[l].length,k1(r,t[l]);const o=oO.triangulate(r,i);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function N1(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function k1(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class cc extends nt{constructor(e=new Dd([new oe(.5,.5),new oe(-.5,.5),new oe(-.5,-.5),new oe(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,i=[],s=[];for(let o=0,l=e.length;o<l;o++){const c=e[o];a(c)}this.setAttribute("position",new Ye(i,3)),this.setAttribute("uv",new Ye(s,2)),this.computeVertexNormals();function a(o){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1;let h=t.depth!==void 0?t.depth:1,d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:.2,v=t.bevelSize!==void 0?t.bevelSize:f-.1,g=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const p=t.extrudePath,m=t.UVGenerator!==void 0?t.UVGenerator:MO;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),h=t.amount);let x,w=!1,b,C,A,F;p&&(x=p.getSpacedPoints(u),w=!0,d=!1,b=p.computeFrenetFrames(u,!1),C=new L,A=new L,F=new L),d||(y=0,f=0,v=0,g=0);const N=o.extractPoints(c);let O=N.shape;const H=N.holes;if(!ra.isClockWise(O)){O=O.reverse();for(let de=0,xe=H.length;de<xe;de++){const M=H[de];ra.isClockWise(M)&&(H[de]=M.reverse())}}const U=ra.triangulateShape(O,H),_=O;for(let de=0,xe=H.length;de<xe;de++){const M=H[de];O=O.concat(M)}function z(de,xe,M){return xe||console.error("THREE.ExtrudeGeometry: vec does not exist"),xe.clone().multiplyScalar(M).add(de)}const j=O.length,R=U.length;function ee(de,xe,M){let te,X,T;const S=de.x-xe.x,B=de.y-xe.y,q=M.x-de.x,K=M.y-de.y,W=S*S+B*B,ce=S*K-B*q;if(Math.abs(ce)>Number.EPSILON){const pe=Math.sqrt(W),ue=Math.sqrt(q*q+K*K),ve=xe.x-B/pe,Z=xe.y+S/pe,ye=M.x-K/ue,ge=M.y+q/ue,Re=((ye-ve)*K-(ge-Z)*q)/(S*K-B*q);te=ve+S*Re-de.x,X=Z+B*Re-de.y;const Fe=te*te+X*X;if(Fe<=2)return new oe(te,X);T=Math.sqrt(Fe/2)}else{let pe=!1;S>Number.EPSILON?q>Number.EPSILON&&(pe=!0):S<-Number.EPSILON?q<-Number.EPSILON&&(pe=!0):Math.sign(B)===Math.sign(K)&&(pe=!0),pe?(te=-B,X=S,T=Math.sqrt(W)):(te=S,X=B,T=Math.sqrt(W/2))}return new oe(te/T,X/T)}const J=[];for(let de=0,xe=_.length,M=xe-1,te=de+1;de<xe;de++,M++,te++)M===xe&&(M=0),te===xe&&(te=0),J[de]=ee(_[de],_[M],_[te]);const le=[];let k,V=J.concat();for(let de=0,xe=H.length;de<xe;de++){const M=H[de];k=[];for(let te=0,X=M.length,T=X-1,S=te+1;te<X;te++,T++,S++)T===X&&(T=0),S===X&&(S=0),k[te]=ee(M[te],M[T],M[S]);le.push(k),V=V.concat(k)}for(let de=0;de<y;de++){const xe=de/y,M=f*Math.cos(xe*Math.PI/2),te=v*Math.sin(xe*Math.PI/2)+g;for(let X=0,T=_.length;X<T;X++){const S=z(_[X],J[X],te);Se(S.x,S.y,-M)}for(let X=0,T=H.length;X<T;X++){const S=H[X];k=le[X];for(let B=0,q=S.length;B<q;B++){const K=z(S[B],k[B],te);Se(K.x,K.y,-M)}}}const $=v+g;for(let de=0;de<j;de++){const xe=d?z(O[de],V[de],$):O[de];w?(A.copy(b.normals[0]).multiplyScalar(xe.x),C.copy(b.binormals[0]).multiplyScalar(xe.y),F.copy(x[0]).add(A).add(C),Se(F.x,F.y,F.z)):Se(xe.x,xe.y,0)}for(let de=1;de<=u;de++)for(let xe=0;xe<j;xe++){const M=d?z(O[xe],V[xe],$):O[xe];w?(A.copy(b.normals[de]).multiplyScalar(M.x),C.copy(b.binormals[de]).multiplyScalar(M.y),F.copy(x[de]).add(A).add(C),Se(F.x,F.y,F.z)):Se(M.x,M.y,h/u*de)}for(let de=y-1;de>=0;de--){const xe=de/y,M=f*Math.cos(xe*Math.PI/2),te=v*Math.sin(xe*Math.PI/2)+g;for(let X=0,T=_.length;X<T;X++){const S=z(_[X],J[X],te);Se(S.x,S.y,h+M)}for(let X=0,T=H.length;X<T;X++){const S=H[X];k=le[X];for(let B=0,q=S.length;B<q;B++){const K=z(S[B],k[B],te);w?Se(K.x,K.y+x[u-1].y,x[u-1].x+M):Se(K.x,K.y,h+M)}}}Q(),ie();function Q(){const de=i.length/3;if(d){let xe=0,M=j*xe;for(let te=0;te<R;te++){const X=U[te];_e(X[2]+M,X[1]+M,X[0]+M)}xe=u+y*2,M=j*xe;for(let te=0;te<R;te++){const X=U[te];_e(X[0]+M,X[1]+M,X[2]+M)}}else{for(let xe=0;xe<R;xe++){const M=U[xe];_e(M[2],M[1],M[0])}for(let xe=0;xe<R;xe++){const M=U[xe];_e(M[0]+j*u,M[1]+j*u,M[2]+j*u)}}r.addGroup(de,i.length/3-de,0)}function ie(){const de=i.length/3;let xe=0;ne(_,xe),xe+=_.length;for(let M=0,te=H.length;M<te;M++){const X=H[M];ne(X,xe),xe+=X.length}r.addGroup(de,i.length/3-de,1)}function ne(de,xe){let M=de.length;for(;--M>=0;){const te=M;let X=M-1;X<0&&(X=de.length-1);for(let T=0,S=u+y*2;T<S;T++){const B=j*T,q=j*(T+1),K=xe+te+B,W=xe+X+B,ce=xe+X+q,pe=xe+te+q;we(K,W,ce,pe)}}}function Se(de,xe,M){l.push(de),l.push(xe),l.push(M)}function _e(de,xe,M){Me(de),Me(xe),Me(M);const te=i.length/3,X=m.generateTopUV(r,i,te-3,te-2,te-1);ke(X[0]),ke(X[1]),ke(X[2])}function we(de,xe,M,te){Me(de),Me(xe),Me(te),Me(xe),Me(M),Me(te);const X=i.length/3,T=m.generateSideWallUV(r,i,X-6,X-3,X-2,X-1);ke(T[0]),ke(T[1]),ke(T[3]),ke(T[1]),ke(T[2]),ke(T[3])}function Me(de){i.push(l[de*3+0]),i.push(l[de*3+1]),i.push(l[de*3+2])}function ke(de){s.push(de.x),s.push(de.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,r=this.parameters.options;return EO(t,r,e)}static fromJSON(e,t){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=t[e.shapes[s]];r.push(o)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new sx[i.type]().fromJSON(i)),new cc(r,e.options)}}const MO={generateTopUV:function(n,e,t,r,i){const s=e[t*3],a=e[t*3+1],o=e[r*3],l=e[r*3+1],c=e[i*3],u=e[i*3+1];return[new oe(s,a),new oe(o,l),new oe(c,u)]},generateSideWallUV:function(n,e,t,r,i,s){const a=e[t*3],o=e[t*3+1],l=e[t*3+2],c=e[r*3],u=e[r*3+1],h=e[r*3+2],d=e[i*3],f=e[i*3+1],v=e[i*3+2],g=e[s*3],y=e[s*3+1],p=e[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new oe(a,1-l),new oe(c,1-h),new oe(d,1-v),new oe(g,1-p)]:[new oe(o,1-l),new oe(u,1-h),new oe(f,1-v),new oe(y,1-p)]}};function EO(n,e,t){if(t.shapes=[],Array.isArray(n))for(let r=0,i=n.length;r<i;r++){const s=n[r];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class ol extends Ky{constructor(e=1,t=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ol(e.radius,e.detail)}}class ax extends nt{constructor(e=new Dd([new oe(0,.5),new oe(-.5,-.5),new oe(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],i=[],s=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new Ye(i,3)),this.setAttribute("normal",new Ye(s,3)),this.setAttribute("uv",new Ye(a,2));function c(u){const h=i.length/3,d=u.extractPoints(t);let f=d.shape;const v=d.holes;ra.isClockWise(f)===!1&&(f=f.reverse());for(let y=0,p=v.length;y<p;y++){const m=v[y];ra.isClockWise(m)===!0&&(v[y]=m.reverse())}const g=ra.triangulateShape(f,v);for(let y=0,p=v.length;y<p;y++){const m=v[y];f=f.concat(m)}for(let y=0,p=f.length;y<p;y++){const m=f[y];i.push(m.x,m.y,0),s.push(0,0,1),a.push(m.x,m.y)}for(let y=0,p=g.length;y<p;y++){const m=g[y],x=m[0]+h,w=m[1]+h,b=m[2]+h;r.push(x,w,b),l+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return AO(t,e)}static fromJSON(e,t){const r=[];for(let i=0,s=e.shapes.length;i<s;i++){const a=t[e.shapes[i]];r.push(a)}return new ax(r,e.curveSegments)}}function AO(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const i=n[t];e.shapes.push(i.uuid)}else e.shapes.push(n.uuid);return e}class ws extends nt{constructor(e=1,t=32,r=16,i=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:s,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new L,d=new L,f=[],v=[],g=[],y=[];for(let p=0;p<=r;p++){const m=[],x=p/r;let w=0;p==0&&a==0?w=.5/t:p==r&&l==Math.PI&&(w=-.5/t);for(let b=0;b<=t;b++){const C=b/t;h.x=-e*Math.cos(i+C*s)*Math.sin(a+x*o),h.y=e*Math.cos(a+x*o),h.z=e*Math.sin(i+C*s)*Math.sin(a+x*o),v.push(h.x,h.y,h.z),d.copy(h).normalize(),g.push(d.x,d.y,d.z),y.push(C+w,1-x),m.push(c++)}u.push(m)}for(let p=0;p<r;p++)for(let m=0;m<t;m++){const x=u[p][m+1],w=u[p][m],b=u[p+1][m],C=u[p+1][m+1];(p!==0||a>0)&&f.push(x,w,C),(p!==r-1||l<Math.PI)&&f.push(w,b,C)}this.setIndex(f),this.setAttribute("position",new Ye(v,3)),this.setAttribute("normal",new Ye(g,3)),this.setAttribute("uv",new Ye(y,2))}static fromJSON(e){return new ws(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class ll extends nt{constructor(e=1,t=.4,r=8,i=6,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:s},r=Math.floor(r),i=Math.floor(i);const a=[],o=[],l=[],c=[],u=new L,h=new L,d=new L;for(let f=0;f<=r;f++)for(let v=0;v<=i;v++){const g=v/i*s,y=f/r*Math.PI*2;h.x=(e+t*Math.cos(y))*Math.cos(g),h.y=(e+t*Math.cos(y))*Math.sin(g),h.z=t*Math.sin(y),o.push(h.x,h.y,h.z),u.x=e*Math.cos(g),u.y=e*Math.sin(g),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(v/i),c.push(f/r)}for(let f=1;f<=r;f++)for(let v=1;v<=i;v++){const g=(i+1)*f+v-1,y=(i+1)*(f-1)+v-1,p=(i+1)*(f-1)+v,m=(i+1)*f+v;a.push(g,y,m),a.push(y,p,m)}this.setIndex(a),this.setAttribute("position",new Ye(o,3)),this.setAttribute("normal",new Ye(l,3)),this.setAttribute("uv",new Ye(c,2))}static fromJSON(e){return new ll(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class np extends nt{constructor(e=new rx(new L(-1,-1,0),new L(-1,1,0),new L(1,1,0)),t=64,r=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new L,l=new L,c=new oe;let u=new L;const h=[],d=[],f=[],v=[];g(),this.setIndex(v),this.setAttribute("position",new Ye(h,3)),this.setAttribute("normal",new Ye(d,3)),this.setAttribute("uv",new Ye(f,2));function g(){for(let x=0;x<t;x++)y(x);y(s===!1?t:0),m(),p()}function y(x){u=e.getPointAt(x/t,u);const w=a.normals[x],b=a.binormals[x];for(let C=0;C<=i;C++){const A=C/i*Math.PI*2,F=Math.sin(A),N=-Math.cos(A);l.x=N*w.x+F*b.x,l.y=N*w.y+F*b.y,l.z=N*w.z+F*b.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+r*l.x,o.y=u.y+r*l.y,o.z=u.z+r*l.z,h.push(o.x,o.y,o.z)}}function p(){for(let x=1;x<=t;x++)for(let w=1;w<=i;w++){const b=(i+1)*(x-1)+(w-1),C=(i+1)*x+(w-1),A=(i+1)*x+w,F=(i+1)*(x-1)+w;v.push(b,C,F),v.push(C,A,F)}}function m(){for(let x=0;x<=t;x++)for(let w=0;w<=i;w++)c.x=x/t,c.y=w/i,f.push(c.x,c.y)}}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new np(new sx[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class TO extends nr{constructor(e){super(),this.type="ShadowMaterial",this.color=new Ce(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}TO.prototype.isShadowMaterial=!0;class oA extends nr{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ce(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ce(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=rc,this.normalScale=new oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}oA.prototype.isMeshStandardMaterial=!0;class CO extends oA{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new oe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ir(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenTint=new Ce(0),this.sheenRoughness=1,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new Ce(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new Ce(1,1,1),this.specularTintMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenTint.copy(e.sheenTint),this.sheenRoughness=e.sheenRoughness,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}CO.prototype.isMeshPhysicalMaterial=!0;class ox extends nr{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Ce(16777215),this.specular=new Ce(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ce(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=rc,this.normalScale=new oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Vp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}ox.prototype.isMeshPhongMaterial=!0;class PO extends nr{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ce(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ce(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=rc,this.normalScale=new oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}PO.prototype.isMeshToonMaterial=!0;class IO extends nr{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=rc,this.normalScale=new oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}IO.prototype.isMeshNormalMaterial=!0;class LO extends nr{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Ce(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ce(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Vp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}LO.prototype.isMeshLambertMaterial=!0;class RO extends nr{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ce(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=rc,this.normalScale=new oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}RO.prototype.isMeshMatcapMaterial=!0;class FO extends Gn{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}FO.prototype.isLineDashedMaterial=!0;const Ht={arraySlice:function(n,e,t){return Ht.isTypedArray(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)},convertArray:function(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)},isTypedArray:function(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)},getKeyframeOrder:function(n){function e(i,s){return n[i]-n[s]}const t=n.length,r=new Array(t);for(let i=0;i!==t;++i)r[i]=i;return r.sort(e),r},sortedArray:function(n,e,t){const r=n.length,i=new n.constructor(r);for(let s=0,a=0;a!==r;++s){const o=t[s]*e;for(let l=0;l!==e;++l)i[a++]=n[o+l]}return i},flattenJSON:function(n,e,t,r){let i=1,s=n[0];for(;s!==void 0&&s[r]===void 0;)s=n[i++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),t.push.apply(t,a)),s=n[i++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=n[i++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),t.push(a)),s=n[i++];while(s!==void 0)},subclip:function(n,e,t,r,i=30){const s=n.clone();s.name=e;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let f=0;f<c.times.length;++f){const v=c.times[f]*i;if(!(v<t||v>=r)){h.push(c.times[f]);for(let g=0;g<u;++g)d.push(c.values[f*u+g])}}h.length!==0&&(c.times=Ht.convertArray(h,c.times.constructor),c.values=Ht.convertArray(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(n,e=0,t=n,r=30){r<=0&&(r=30);const i=t.tracks.length,s=e/r;for(let a=0;a<i;++a){const o=t.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=n.tracks.find(function(p){return p.name===o.name&&p.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const v=o.times.length-1;let g;if(s<=o.times[0]){const p=u,m=h-u;g=Ht.arraySlice(o.values,p,m)}else if(s>=o.times[v]){const p=v*h+u,m=p+h-u;g=Ht.arraySlice(o.values,p,m)}else{const p=o.createInterpolant(),m=u,x=h-u;p.evaluate(s),g=Ht.arraySlice(p.resultBuffer,m,x)}l==="quaternion"&&new qe().fromArray(g).normalize().conjugate().toArray(g);const y=c.times.length;for(let p=0;p<y;++p){const m=p*f+d;if(l==="quaternion")qe.multiplyQuaternionsFlat(c.values,m,g,0,c.values,m);else{const x=f-d*2;for(let w=0;w<x;++w)c.values[m+w]-=g[w]}}}return n.blendMode=PE,n}};class ga{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,i=t[r],s=t[r-1];e:{t:{let a;n:{r:if(!(e<i)){for(let o=r+2;;){if(i===void 0){if(e<s)break r;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,s)}if(r===o)break;if(s=i,i=t[++r],e<i)break t}a=t.length;break n}if(!(e>=s)){const o=t[1];e<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===l)break;if(i=s,s=t[--r-1],e>=s)break t}a=r,r=0;break n}break e}for(;r<a;){const o=r+a>>>1;e<t[o]?a=o:r=o+1}if(i=t[r],s=t[r-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,s,e)}this._cachedIndex=r,this.intervalChanged_(r,s,i)}return this.interpolate_(r,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i;for(let a=0;a!==i;++a)t[a]=r[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}ga.prototype.beforeStart_=ga.prototype.copySampleValue_;ga.prototype.afterEnd_=ga.prototype.copySampleValue_;class DO extends ga{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:il,endingEnd:il}}intervalChanged_(e,t,r){const i=this.parameterPositions;let s=e-2,a=e+1,o=i[s],l=i[a];if(o===void 0)switch(this.getSettings_().endingStart){case sl:s=e,o=2*t-r;break;case Jf:s=i.length-2,o=t+i[s]-i[s+1];break;default:s=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case sl:a=e,l=2*r-t;break;case Jf:a=1,l=r+i[1]-i[0];break;default:a=e-1,l=t}const c=(r-t)*.5,u=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-r),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,f=this._weightNext,v=(r-t)/(i-t),g=v*v,y=g*v,p=-d*y+2*d*g-d*v,m=(1+d)*y+(-1.5-2*d)*g+(-.5+d)*v+1,x=(-1-f)*y+(1.5+f)*g+.5*v,w=f*y-f*g;for(let b=0;b!==o;++b)s[b]=p*a[u+b]+m*a[c+b]+x*a[l+b]+w*a[h+b];return s}}class lA extends ga{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=(r-t)/(i-t),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class NO extends ga{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class qi{constructor(e,t,r,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ht.convertArray(t,this.TimeBufferType),this.values=Ht.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:Ht.convertArray(e.times,Array),values:Ht.convertArray(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new NO(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new lA(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new DO(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case qf:t=this.InterpolantFactoryMethodDiscrete;break;case Qf:t=this.InterpolantFactoryMethodLinear;break;case qm:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return qf;case this.InterpolantFactoryMethodLinear:return Qf;case this.InterpolantFactoryMethodSmooth:return qm}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){const r=this.times,i=r.length;let s=0,a=i-1;for(;s!==i&&r[s]<e;)++s;for(;a!==-1&&r[a]>t;)--a;if(++a,s!==0||a!==i){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=Ht.arraySlice(r,s,a),this.values=Ht.arraySlice(this.values,s*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(i!==void 0&&Ht.isTypedArray(i))for(let o=0,l=i.length;o!==l;++o){const c=i[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=Ht.arraySlice(this.times),t=Ht.arraySlice(this.values),r=this.getValueSize(),i=this.getInterpolation()===qm,s=e.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=e[o],u=e[o+1];if(c!==u&&(o!==1||c!==e[0]))if(i)l=!0;else{const h=o*r,d=h-r,f=h+r;for(let v=0;v!==r;++v){const g=t[h+v];if(g!==t[d+v]||g!==t[f+v]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const h=o*r,d=a*r;for(let f=0;f!==r;++f)t[d+f]=t[h+f]}++a}}if(s>0){e[a]=e[s];for(let o=s*r,l=a*r,c=0;c!==r;++c)t[l+c]=t[o+c];++a}return a!==e.length?(this.times=Ht.arraySlice(e,0,a),this.values=Ht.arraySlice(t,0,a*r)):(this.times=e,this.values=t),this}clone(){const e=Ht.arraySlice(this.times,0),t=Ht.arraySlice(this.values,0),r=this.constructor,i=new r(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}qi.prototype.TimeBufferType=Float32Array;qi.prototype.ValueBufferType=Float32Array;qi.prototype.DefaultInterpolation=Qf;class uc extends qi{}uc.prototype.ValueTypeName="bool";uc.prototype.ValueBufferType=Array;uc.prototype.DefaultInterpolation=qf;uc.prototype.InterpolantFactoryMethodLinear=void 0;uc.prototype.InterpolantFactoryMethodSmooth=void 0;class cA extends qi{}cA.prototype.ValueTypeName="color";class rp extends qi{}rp.prototype.ValueTypeName="number";class kO extends ga{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-t)/(i-t);let c=e*o;for(let u=c+o;c!==u;c+=4)qe.slerpFlat(s,0,a,c-o,a,c,l);return s}}class Nd extends qi{InterpolantFactoryMethodLinear(e){return new kO(this.times,this.values,this.getValueSize(),e)}}Nd.prototype.ValueTypeName="quaternion";Nd.prototype.DefaultInterpolation=Qf;Nd.prototype.InterpolantFactoryMethodSmooth=void 0;class dc extends qi{}dc.prototype.ValueTypeName="string";dc.prototype.ValueBufferType=Array;dc.prototype.DefaultInterpolation=qf;dc.prototype.InterpolantFactoryMethodLinear=void 0;dc.prototype.InterpolantFactoryMethodSmooth=void 0;class ip extends qi{}ip.prototype.ValueTypeName="vector";class O1{constructor(e,t=-1,r,i=Hy){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=Ei(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,i=1/(e.fps||1);for(let a=0,o=r.length;a!==o;++a)t.push(zO(r[a]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,a=r.length;s!==a;++s)t.push(qi.toJSON(r[s]));return i}static CreateFromMorphTargetSequence(e,t,r,i){const s=t.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=Ht.getKeyframeOrder(l);l=Ht.sortedArray(l,1,u),c=Ht.sortedArray(c,1,u),!i&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new rp(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/r))}return new this(e,-1,a)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const i=e;r=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const i={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=i[h];d||(i[h]=d=[]),d.push(c)}}const a=[];for(const o in i)a.push(this.CreateFromMorphTargetSequence(o,i[o],t,r));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,f,v,g){if(f.length!==0){const y=[],p=[];Ht.flattenJSON(f,y,p,v),y.length!==0&&g.push(new h(d,y,p))}},i=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let v;for(v=0;v<d.length;v++)if(d[v].morphTargets)for(let g=0;g<d[v].morphTargets.length;g++)f[d[v].morphTargets[g]]=-1;for(const g in f){const y=[],p=[];for(let m=0;m!==d[v].morphTargets.length;++m){const x=d[v];y.push(x.time),p.push(x.morphTarget===g?1:0)}i.push(new rp(".morphTargetInfluence["+g+"]",y,p))}l=f.length*(a||1)}else{const f=".bones["+t[h].name+"]";r(ip,f+".position",d,"pos",i),r(Nd,f+".quaternion",d,"rot",i),r(ip,f+".scale",d,"scl",i)}}return i.length===0?null:new this(s,l,i,o)}resetDuration(){const e=this.tracks;let t=0;for(let r=0,i=e.length;r!==i;++r){const s=this.tracks[r];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function OO(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return rp;case"vector":case"vector2":case"vector3":case"vector4":return ip;case"color":return cA;case"quaternion":return Nd;case"bool":case"boolean":return uc;case"string":return dc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function zO(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=OO(n.type);if(n.times===void 0){const t=[],r=[];Ht.flattenJSON(n.keys,t,r,"value"),n.times=t,n.values=r}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Gl={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class UO{constructor(e,t,r){const i=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){o++,s===!1&&i.onStart!==void 0&&i.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,i.onProgress!==void 0&&i.onProgress(u,a,o),a===o&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const f=c[h],v=c[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return v}return null}}}const uA=new UO;class Qi{constructor(e){this.manager=e!==void 0?e:uA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,s){r.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const ui={};class lx extends Qi{constructor(e){super(e)}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Gl.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;if(ui[e]!==void 0){ui[e].push({onLoad:t,onProgress:r,onError:i});return}const o=/^data:(.*?)(;base64)?,(.*)$/,l=e.match(o);let c;if(l){const u=l[1],h=!!l[2];let d=l[3];d=decodeURIComponent(d),h&&(d=atob(d));try{let f;const v=(this.responseType||"").toLowerCase();switch(v){case"arraybuffer":case"blob":const g=new Uint8Array(d.length);for(let p=0;p<d.length;p++)g[p]=d.charCodeAt(p);v==="blob"?f=new Blob([g.buffer],{type:u}):f=g.buffer;break;case"document":f=new DOMParser().parseFromString(d,u);break;case"json":f=JSON.parse(d);break;default:f=d;break}setTimeout(function(){t&&t(f),s.manager.itemEnd(e)},0)}catch(f){setTimeout(function(){i&&i(f),s.manager.itemError(e),s.manager.itemEnd(e)},0)}}else{ui[e]=[],ui[e].push({onLoad:t,onProgress:r,onError:i}),c=new XMLHttpRequest,c.open("GET",e,!0),c.addEventListener("load",function(u){const h=this.response,d=ui[e];if(delete ui[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Gl.add(e,h);for(let f=0,v=d.length;f<v;f++){const g=d[f];g.onLoad&&g.onLoad(h)}s.manager.itemEnd(e)}else{for(let f=0,v=d.length;f<v;f++){const g=d[f];g.onError&&g.onError(u)}s.manager.itemError(e),s.manager.itemEnd(e)}},!1),c.addEventListener("progress",function(u){const h=ui[e];for(let d=0,f=h.length;d<f;d++){const v=h[d];v.onProgress&&v.onProgress(u)}},!1),c.addEventListener("error",function(u){const h=ui[e];delete ui[e];for(let d=0,f=h.length;d<f;d++){const v=h[d];v.onError&&v.onError(u)}s.manager.itemError(e),s.manager.itemEnd(e)},!1),c.addEventListener("abort",function(u){const h=ui[e];delete ui[e];for(let d=0,f=h.length;d<f;d++){const v=h[d];v.onError&&v.onError(u)}s.manager.itemError(e),s.manager.itemEnd(e)},!1),this.responseType!==void 0&&(c.responseType=this.responseType),this.withCredentials!==void 0&&(c.withCredentials=this.withCredentials),c.overrideMimeType&&c.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const u in this.requestHeader)c.setRequestHeader(u,this.requestHeader[u]);c.send(null)}return s.manager.itemStart(e),c}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class dA extends Qi{constructor(e){super(e)}load(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Gl.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;const o=$p("img");function l(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1),Gl.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(u){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1),i&&i(u),s.manager.itemError(e),s.manager.itemEnd(e)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class BO extends Qi{constructor(e){super(e)}load(e,t,r,i){const s=new qp,a=new dA(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(e[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let c=0;c<e.length;++c)l(c);return s}}class im extends Qi{constructor(e){super(e)}load(e,t,r,i){const s=new Hn,a=new dA(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},r,i),s}}class $i extends ot{constructor(e,t=1){super(),this.type="Light",this.color=new Ce(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}$i.prototype.isLight=!0;class HO extends $i{constructor(e,t,r){super(e,r),this.type="HemisphereLight",this.position.copy(ot.DefaultUp),this.updateMatrix(),this.groundColor=new Ce(t)}copy(e){return $i.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}HO.prototype.isHemisphereLight=!0;const z1=new ze,U1=new L,B1=new L;class cx{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new oe(512,512),this.map=null,this.mapPass=null,this.matrix=new ze,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Qp,this._frameExtents=new oe(1,1),this._viewportCount=1,this._viewports=[new Tt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;U1.setFromMatrixPosition(e.matrixWorld),t.position.copy(U1),B1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(B1),t.updateMatrixWorld(),z1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(z1),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class hA extends cx{constructor(){super(new rn(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,r=Ku*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(r!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=r,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}hA.prototype.isSpotLightShadow=!0;class GO extends $i{constructor(e,t,r=0,i=Math.PI/3,s=0,a=1){super(e,t),this.type="SpotLight",this.position.copy(ot.DefaultUp),this.updateMatrix(),this.target=new ot,this.distance=r,this.angle=i,this.penumbra=s,this.decay=a,this.shadow=new hA}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}GO.prototype.isSpotLight=!0;const H1=new ze,Gc=new L,Ig=new L;class fA extends cx{constructor(){super(new rn(90,1,.5,500)),this._frameExtents=new oe(4,2),this._viewportCount=6,this._viewports=[new Tt(2,1,1,1),new Tt(0,1,1,1),new Tt(3,1,1,1),new Tt(1,1,1,1),new Tt(3,0,1,1),new Tt(1,0,1,1)],this._cubeDirections=[new L(1,0,0),new L(-1,0,0),new L(0,0,1),new L(0,0,-1),new L(0,1,0),new L(0,-1,0)],this._cubeUps=[new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,0,1),new L(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),Gc.setFromMatrixPosition(e.matrixWorld),r.position.copy(Gc),Ig.copy(r.position),Ig.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(Ig),r.updateMatrixWorld(),i.makeTranslation(-Gc.x,-Gc.y,-Gc.z),H1.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(H1)}}fA.prototype.isPointLightShadow=!0;class VO extends $i{constructor(e,t,r=0,i=1){super(e,t),this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new fA}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}VO.prototype.isPointLight=!0;class pA extends cx{constructor(){super(new Qn(-5,5,5,-5,.5,500))}}pA.prototype.isDirectionalLightShadow=!0;class jO extends $i{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(ot.DefaultUp),this.updateMatrix(),this.target=new ot,this.shadow=new pA}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}jO.prototype.isDirectionalLight=!0;class WO extends $i{constructor(e,t){super(e,t),this.type="AmbientLight"}}WO.prototype.isAmbientLight=!0;class XO extends $i{constructor(e,t,r=10,i=10){super(e,t),this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}XO.prototype.isRectAreaLight=!0;class mA{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new L)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*r),t.addScaledVector(a[4],1.092548*(r*i)),t.addScaledVector(a[5],1.092548*(i*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(r*s)),t.addScaledVector(a[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*i),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*r),t.addScaledVector(a[4],2*.429043*r*i),t.addScaledVector(a[5],2*.429043*i*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*r*s),t.addScaledVector(a[8],.429043*(r*r-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const r=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*r*s,t[8]=.546274*(r*r-i*i)}}mA.prototype.isSphericalHarmonics3=!0;class ux extends $i{constructor(e=new mA,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}ux.prototype.isLightProbe=!0;class gA{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}}class YO extends nt{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}YO.prototype.isInstancedBufferGeometry=!0;class $O extends Qi{constructor(e){super(e),typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Gl.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){Gl.add(e,l),t&&t(l),s.manager.itemEnd(e)}).catch(function(l){i&&i(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}$O.prototype.isImageBitmapLoader=!0;let Rh;const ZO={getContext:function(){return Rh===void 0&&(Rh=new(window.AudioContext||window.webkitAudioContext)),Rh},setContext:function(n){Rh=n}};class qO extends Qi{constructor(e){super(e)}load(e,t,r,i){const s=this,a=new lx(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{const l=o.slice(0);ZO.getContext().decodeAudioData(l,function(u){t(u)})}catch(l){i?i(l):console.error(l),s.manager.itemError(e)}},r,i)}}class QO extends ux{constructor(e,t,r=1){super(void 0,r);const i=new Ce().set(e),s=new Ce().set(t),a=new L(i.r,i.g,i.b),o=new L(s.r,s.g,s.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(l),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(c)}}QO.prototype.isHemisphereLightProbe=!0;class JO extends ux{constructor(e,t=1){super(void 0,t);const r=new Ce().set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}JO.prototype.isAmbientLightProbe=!0;class KO{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=G1(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=G1();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function G1(){return(typeof performance=="undefined"?Date:performance).now()}class e4 extends ot{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}class t4{constructor(e,t,r){this.binding=e,this.valueSize=r;let i,s,a;switch(t){case"quaternion":i=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:i=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,i=this.valueSize,s=e*i+i;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==i;++o)r[s+o]=r[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(r,s,0,o,i)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,i=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,i=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(r,i,l,1-s,t)}a>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(r[l]!==r[l+t]){o.setValue(r,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(t,i);for(let s=r,a=i;s!==a;++s)t[s]=t[i+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,i,s){if(i>=.5)for(let a=0;a!==s;++a)e[t+a]=e[r+a]}_slerp(e,t,r,i){qe.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,s){const a=this._workIndex*s;qe.multiplyQuaternionsFlat(e,a,e,t,e,r),qe.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,r,i,s){const a=1-i;for(let o=0;o!==s;++o){const l=t+o;e[l]=e[l]*a+e[r+o]*i}}_lerpAdditive(e,t,r,i,s){for(let a=0;a!==s;++a){const o=t+a;e[o]=e[o]+e[r+a]*i}}}const dx="\\[\\]\\.:\\/",n4=new RegExp("["+dx+"]","g"),hx="[^"+dx+"]",r4="[^"+dx.replace("\\.","")+"]",i4=/((?:WC+[\/:])*)/.source.replace("WC",hx),s4=/(WCOD+)?/.source.replace("WCOD",r4),a4=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",hx),o4=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",hx),l4=new RegExp("^"+i4+s4+a4+o4+"$"),c4=["material","materials","bones"];class u4{constructor(e,t,r){const i=r||At.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=r.length;i!==s;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class At{constructor(e,t,r){this.path=t,this.parsedPath=r||At.parseTrackName(t),this.node=At.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new At.Composite(e,t,r):new At(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(n4,"")}static parseTrackName(e){const t=l4.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=r.nodeName.substring(i+1);c4.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===t||o.uuid===t)return o;const l=r(o.children);if(l)return l}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=At.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){let c=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[i];if(a===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}At.Composite=u4;At.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};At.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};At.prototype.GetterByBindingType=[At.prototype._getValue_direct,At.prototype._getValue_array,At.prototype._getValue_arrayElement,At.prototype._getValue_toArray];At.prototype.SetterByBindingTypeAndVersioning=[[At.prototype._setValue_direct,At.prototype._setValue_direct_setNeedsUpdate,At.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[At.prototype._setValue_array,At.prototype._setValue_array_setNeedsUpdate,At.prototype._setValue_array_setMatrixWorldNeedsUpdate],[At.prototype._setValue_arrayElement,At.prototype._setValue_arrayElement_setNeedsUpdate,At.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[At.prototype._setValue_fromArray,At.prototype._setValue_fromArray_setNeedsUpdate,At.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class d4{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;const s=t.tracks,a=s.length,o=new Array(a),l={endingStart:il,endingEnd:il};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=HL,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const i=this._clip.duration,s=e._clip.duration,a=s/i,o=i/s;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const i=this._mixer,s=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+r,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*r;if(l<0||r===0)return;this._startTime=null,t=r*l}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case PE:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case Hy:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(i,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(r!==null){const i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;r!==null&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let i=this.time+e,s=this._loopCount;const a=r===GL;if(e===0)return s===-1?i:a&&(s&1)===1?t-i:i;if(r===BL){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),i>=t||i<0){const o=Math.floor(i/t);i-=t*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&(s&1)===1)return t-i}return i}_setEndings(e,t,r){const i=this._interpolantSettings;r?(i.endingStart=sl,i.endingEnd=sl):(e?i.endingStart=this.zeroSlopeAtStart?sl:il:i.endingStart=Jf,t?i.endingEnd=this.zeroSlopeAtEnd?sl:il:i.endingEnd=Jf)}_scheduleFading(e,t,r){const i=this._mixer,s=i.time;let a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=t,o[1]=s+e,l[1]=r,this}}class h4 extends Ma{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,i=e._clip.tracks,s=i.length,a=e._propertyBindings,o=e._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=i[h],f=d.name;let v=u[f];if(v!==void 0)a[h]=v;else{if(v=a[h],v!==void 0){v._cacheIndex===null&&(++v.referenceCount,this._addInactiveBinding(v,l,f));continue}const g=t&&t._propertyBindings[h].binding.parsedPath;v=new t4(At.create(r,f,g),d.ValueTypeName,d.getValueSize()),++v.referenceCount,this._addInactiveBinding(v,l,f),a[h]=v}o[h].resultBuffer=v.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,r)}const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){const i=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=o.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_addInactiveBinding(e,t,r){const i=this._bindingsByRootAndName,s=this._bindings;let a=i[t];a===void 0&&(a={},i[t]=a),a[r]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,i=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[i],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete o[s],Object.keys(o).length===0&&delete a[i]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return r===void 0&&(r=new lA(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=r,t[r]=s}clipAction(e,t,r){const i=t||this._root,s=i.uuid;let a=typeof e=="string"?O1.findByName(i,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=Hy),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new d4(this,a,t,r);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(e,t){const r=t||this._root,i=r.uuid,s=typeof e=="string"?O1.findByName(r,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let r=t-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,i=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==r;++c)t[c]._update(i,e,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,i=this._actionsByClip,s=i[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}h4.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class f4 extends Fd{constructor(e,t,r=1){super(e,t),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}f4.prototype.isInstancedInterleavedBuffer=!0;class va{constructor(e,t,r=0,i=1/0){this.ray=new po(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new ac,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return a0(e,this,r,t),r.sort(V1),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)a0(e[i],this,r,t);return r.sort(V1),r}}function V1(n,e){return n.distance-e.distance}function a0(n,e,t,r){if(n.layers.test(e.layers)&&n.raycast(e,t),r===!0){const i=n.children;for(let s=0,a=i.length;s<a;s++)a0(i[s],e,t,!0)}}class j1{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(ir(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const W1=new oe;class hc{constructor(e=new oe(1/0,1/0),t=new oe(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=W1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return W1.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}hc.prototype.isBox2=!0;class p4 extends ot{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}p4.prototype.isImmediateRenderObject=!0;const Rs=new L,Fh=new ze,Lg=new ze;class m4 extends ys{constructor(e){const t=vA(e),r=new nt,i=[],s=[],a=new Ce(0,0,1),o=new Ce(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new Ye(i,3)),r.setAttribute("color",new Ye(s,3));const l=new Gn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,r=this.geometry,i=r.getAttribute("position");Lg.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const o=t[s];o.parent&&o.parent.isBone&&(Fh.multiplyMatrices(Lg,o.matrixWorld),Rs.setFromMatrixPosition(Fh),i.setXYZ(a,Rs.x,Rs.y,Rs.z),Fh.multiplyMatrices(Lg,o.parent.matrixWorld),Rs.setFromMatrixPosition(Fh),i.setXYZ(a+1,Rs.x,Rs.y,Rs.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function vA(n){const e=[];n&&n.isBone&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,vA(n.children[t]));return e}class g4 extends ys{constructor(e=10,t=10,r=4473924,i=8947848){r=new Ce(r),i=new Ce(i);const s=t/2,a=e/t,o=e/2,l=[],c=[];for(let d=0,f=0,v=-o;d<=t;d++,v+=a){l.push(-o,0,v,o,0,v),l.push(v,0,-o,v,0,o);const g=d===s?r:i;g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3}const u=new nt;u.setAttribute("position",new Ye(l,3)),u.setAttribute("color",new Ye(c,3));const h=new Gn({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}}const X1=new L;let Dh,Rg;class Fg extends ot{constructor(e=new L(0,0,1),t=new L(0,0,0),r=1,i=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",Dh===void 0&&(Dh=new nt,Dh.setAttribute("position",new Ye([0,0,0,0,1,0],3)),Rg=new Fn(0,.5,1,5,1),Rg.translate(0,-.5,0)),this.position.copy(t),this.line=new gn(Dh,new Gn({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new be(Rg,new Pt({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{X1.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(X1,t)}}setLength(e,t=e*.2,r=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}const v4=new Float32Array(1);new Int32Array(v4.buffer);ti.create=function(n,e){return console.log("THREE.Curve.create() has been deprecated"),n.prototype=Object.create(ti.prototype),n.prototype.constructor=n,n.prototype.getPoint=e,n};r0.prototype.fromPoints=function(n){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(n)};g4.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};m4.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Qi.prototype.extractUrlBase=function(n){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),gA.extractUrlBase(n)};Qi.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};hc.prototype.center=function(n){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(n)};hc.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};hc.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};hc.prototype.size=function(n){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(n)};ur.prototype.center=function(n){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(n)};ur.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};ur.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};ur.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};ur.prototype.size=function(n){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(n)};sc.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Qp.prototype.setFromMatrix=function(n){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(n)};zn.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};zn.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};zn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};zn.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};zn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};zn.prototype.getInverse=function(n){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};ze.prototype.extractPosition=function(n){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(n)};ze.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};ze.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new L().setFromMatrixColumn(this,3)};ze.prototype.setRotationFromQuaternion=function(n){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(n)};ze.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};ze.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};ze.prototype.multiplyVector4=function(n){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};ze.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};ze.prototype.rotateAxis=function(n){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),n.transformDirection(this)};ze.prototype.crossVector=function(n){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};ze.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};ze.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};ze.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};ze.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};ze.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};ze.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};ze.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};ze.prototype.makeFrustum=function(n,e,t,r,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(n,e,r,t,i,s)};ze.prototype.getInverse=function(n){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};Cr.prototype.isIntersectionLine=function(n){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(n)};qe.prototype.multiplyVector3=function(n){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),n.applyQuaternion(this)};qe.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};po.prototype.isIntersectionBox=function(n){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};po.prototype.isIntersectionPlane=function(n){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(n)};po.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};cn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};cn.prototype.barycoordFromPoint=function(n,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(n,e)};cn.prototype.midpoint=function(n){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(n)};cn.prototypenormal=function(n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(n)};cn.prototype.plane=function(n){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(n)};cn.barycoordFromPoint=function(n,e,t,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),cn.getBarycoord(n,e,t,r,i)};cn.normal=function(n,e,t,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),cn.getNormal(n,e,t,r)};Dd.prototype.extractAllPoints=function(n){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(n)};Dd.prototype.extrude=function(n){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new cc(this,n)};Dd.prototype.makeGeometry=function(n){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ax(this,n)};oe.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};oe.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};oe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};L.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};L.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};L.prototype.getPositionFromMatrix=function(n){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(n)};L.prototype.getScaleFromMatrix=function(n){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(n)};L.prototype.getColumnFromMatrix=function(n,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,n)};L.prototype.applyProjection=function(n){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(n)};L.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};L.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};L.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Tt.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};Tt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};ot.prototype.getChildByName=function(n){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(n)};ot.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};ot.prototype.translate=function(n,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,n)};ot.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};ot.prototype.applyMatrix=function(n){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties(ot.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(n){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=n}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});be.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(be.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),VL},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});tA.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};rn.prototype.setLens=function(n,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(n)};Object.defineProperties($i.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(n){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=n}},shadowCameraLeft:{set:function(n){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=n}},shadowCameraRight:{set:function(n){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=n}},shadowCameraTop:{set:function(n){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=n}},shadowCameraBottom:{set:function(n){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=n}},shadowCameraNear:{set:function(n){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=n}},shadowCameraFar:{set:function(n){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=n}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(n){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=n}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(n){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=n}},shadowMapHeight:{set:function(n){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=n}}});Object.defineProperties(Kt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Kf},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Kf)}}});Kt.prototype.setDynamic=function(n){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?Kf:Ju),this};Kt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Kt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};nt.prototype.addIndex=function(n){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(n)};nt.prototype.addAttribute=function(n,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(n,new Kt(arguments[1],arguments[2]))):n==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(n,e)};nt.prototype.addDrawCall=function(n,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(n,e)};nt.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};nt.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};nt.prototype.removeAttribute=function(n){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(n)};nt.prototype.applyMatrix=function(n){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties(nt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Fd.prototype.setDynamic=function(n){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?Kf:Ju),this};Fd.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};cc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};cc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};cc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Ea.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(nr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ce}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===EE}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(n){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=n}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(wn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(n){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=n}}});St.prototype.clearTarget=function(n,e,t,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(n),this.clear(e,t,r)};St.prototype.animate=function(n){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(n)};St.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};St.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};St.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};St.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};St.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};St.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};St.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};St.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};St.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};St.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};St.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};St.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};St.prototype.enableScissorTest=function(n){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(n)};St.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};St.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};St.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};St.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};St.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};St.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};St.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};St.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};St.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};St.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(St.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=n}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=n}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(n){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=n===!0?fo:Kn}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(JE.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(dn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=n}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=n}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=n}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=n}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(n){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=n}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(n){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=n}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(n){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=n}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(n){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=n}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(n){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=n}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(n){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=n}}});e4.prototype.load=function(n){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new qO().load(n,function(r){e.setBuffer(r)}),this};Yy.prototype.updateCubeMap=function(n,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(n,e)};Yy.prototype.clear=function(n,e,t,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(n,e,t,r)};ic.crossOrigin=void 0;ic.loadTexture=function(n,e,t,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new im;i.setCrossOrigin(this.crossOrigin);const s=i.load(n,t,void 0,r);return e&&(s.mapping=e),s};ic.loadTextureCube=function(n,e,t,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new BO;i.setCrossOrigin(this.crossOrigin);const s=i.load(n,t,void 0,r);return e&&(s.mapping=e),s};ic.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};ic.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:SE}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=SE);var kn=(n=>(n[n.Single=0]="Single",n[n.Range=1]="Range",n))(kn||{});const ms=tr({selectId:n=>n.id}),Il=ms.getSelectors();var Oe=(n=>(n[n.Rectangle=0]="Rectangle",n[n.Circle=1]="Circle",n))(Oe||{});const Bs=tr({selectId:n=>n.lightEmittingObjectId}),id=Bs.getSelectors(),gt=tr({selectId:n=>n.id}),at=gt.getSelectors(),as=tr({selectId:n=>n.name}),sd=as.getSelectors(),ki=tr({selectId:n=>n.name}),ad=ki.getSelectors(),Xa=tr({selectId:n=>n.id}),yA=Xa.getSelectors(),rr=tr({selectId:n=>n.id}),qt=rr.getSelectors();var mr=(n=>(n[n.m=0]="m",n[n.dm=1]="dm",n[n.cm=2]="cm",n[n.mm=3]="mm",n[n.yard=4]="yard",n[n.foot=5]="foot",n[n.inch=6]="inch",n))(mr||{}),xt=(n=>(n[n.X=0]="X",n[n.Y=1]="Y",n[n.Z=2]="Z",n))(xt||{}),Y=(n=>(n[n.Geometry=0]="Geometry",n[n.Joint=1]="Joint",n[n.LightEmittingObject=2]="LightEmittingObject",n[n.PendulumConnector=3]="PendulumConnector",n[n.ElectricalConnector=4]="ElectricalConnector",n[n.Sensor=5]="Sensor",n[n.LightEmittingSurface=6]="LightEmittingSurface",n))(Y||{});class Ws{removeParts(e,t){let r=at.selectAll(e);const i=t.map(s=>r.find(a=>a.id==s)).filter(s=>!!s).map(s=>s);for(;i.length;){const s=i.pop();s!=null&&r.includes(s)&&(gt.removeOne(e,s.id),i.push(...this.getChildParts(r,s.id)),i.push(...this.findDependingParts(r,s)),r=at.selectAll(e))}}offsetRootParts(e,t){const r=at.selectAll(e).filter(a=>a.parentId==0),i=new L(t.x,t.y,t.z),s=new L;r.forEach(a=>{s.set(a.position.x,a.position.y,a.position.z),s.add(i),gt.updateOne(e,{id:a.id,changes:{position:{x:s.x,y:s.y,z:s.z}}})})}getChildParts(e,t){return e.filter(i=>i.parentId==t).filter(i=>!!i).map(i=>i)}findDependingParts(e,t){return t.type==Y.LightEmittingObject?e.filter(s=>s.type==Y.LightEmittingSurface).map(s=>s).filter(s=>id.selectAll(s.lightEmittingObjects).filter(a=>a.lightEmittingObjectId==t.id).length):[]}setTransformWithLockedChildren(e,t,r){const i=at.selectById(e,t);if(!i)return;const s=vt.matrixFromPart(i);gt.updateOne(e,{id:t,changes:r});const a=at.selectById(e,t),o=vt.matrixFromPart(a),l=new ze().multiplyMatrices(o.clone().invert(),s),c=at.selectAll(e).filter(h=>h.parentId==t),u=new ze;if(i.type==Y.Joint){const{defaultRotation:h}=new Ws().getDefaultJointRotation(i);u.compose(new L,h,new L(1,1,1))}for(const h of c){if(h.type==Y.LightEmittingObject)continue;const d=vt.matrixFromPart(h),f=u.clone().invert().multiply(l).multiply(u).multiply(d),v=new L,g=new qe,y=new L;f.decompose(v,g,y);const p={x:v.x,y:v.y,z:v.z},m=new sr().reorder("ZXY").setFromQuaternion(g),x={x:st.radToDeg(m.x),y:st.radToDeg(m.y),z:st.radToDeg(m.z)};gt.updateOne(e,{id:h.id,changes:{position:tt.vector(p),rotation:tt.angleVector(x)}})}}getDefaultJointRotation(e){const t=e.xAxis.isRotatable?st.degToRad(e.xAxis.default):0,r=e.yAxis.isRotatable?st.degToRad(e.yAxis.default):0,i=e.zAxis.isRotatable?st.degToRad(e.zAxis.default):0,s=new qe().setFromAxisAngle(new L(1,0,0),t),a=new qe().setFromAxisAngle(new L(0,1,0),r),o=new qe().setFromAxisAngle(new L(0,0,1),i);return{defaultRotation:new qe().multiply(o).multiply(s).multiply(a),xRotation:s,yRotation:a,zRotation:o}}}const Au=tr({selectId:n=>n.id}),y4=Au.getSelectors(),od=tr({selectId:n=>n.id}),x4=od.getSelectors();var Ns=(n=>(n[n.NewItem=0]="NewItem",n[n.ExistingPart=1]="ExistingPart",n))(Ns||{}),kd=(n=>(n[n.Geometry=0]="Geometry",n))(kd||{}),$e=(n=>(n[n.Pers=0]="Pers",n[n.XZ=1]="XZ",n[n.YZ=2]="YZ",n[n.XY=3]="XY",n))($e||{});const sp=tr({selectId:n=>n.id}),xA=sp.getSelectors();var gr=(n=>(n[n.Cookies=0]="Cookies",n[n.Settings=1]="Settings",n[n.ReloadRequest=2]="ReloadRequest",n[n.ModelCatalog=3]="ModelCatalog",n[n.Progress=4]="Progress",n))(gr||{});const cl=tr({selectId:n=>n.id}),wA=cl.getSelectors(),Y1=new L;class vt{static getScale(e,t){return e*vt.getScaleFactor(t)}static getScaleFactor(e){switch(e){case mr.mm:return .001;case mr.cm:return .01;case mr.dm:return .1;case mr.inch:return .0254;case mr.foot:return .3048;case mr.yard:return .9144}return 1}static round(e){return Math.round((e+Number.EPSILON)*1e3)/1e3}static getScaledVector(e,t){const r=this.getScaleFactor(t);return{x:e.x*r,y:e.y*r,z:e.z*r}}static modulo(e,t){return(e%t+t)%t}static rotationFromNormal(e){const t=new qe().setFromUnitVectors(new L(0,0,-1),e);return new sr().reorder("ZXY").setFromQuaternion(t)}static quaternionFromRotation(e){const t=new sr(st.degToRad(e.x),st.degToRad(e.y),st.degToRad(e.z),"ZXY");return new qe().setFromEuler(t)}static matrixFromPart(e){const t=new L(e.position.x,e.position.y,e.position.z),r=vt.quaternionFromRotation(e.rotation);return new ze().compose(t,r,new L(1,1,1))}static getDistanceFromCameraPosition(e,t){return e.getWorldPosition(Y1),t.distanceTo(Y1)}static getZoomScale(e,t){return t.type==$e.Pers?this.getDistanceFromCameraPosition(e,t.position):2/t.zoom}static getJointAxisRotations(e){const{xRotation:t,zRotation:r}=new Ws().getDefaultJointRotation(e),i=r.clone().multiply(new qe().setFromEuler(new sr(Math.PI/2,Math.PI/2,0))),s=r.clone().multiply(t).multiply(new qe().setFromEuler(new sr(-Math.PI/2,0,Math.PI/2)));return{xAxis:i,yAxis:s,zAxis:new qe().setFromEuler(new sr(0,0,Math.PI/2))}}}const jr=class{static valueInMinMaxRange(e,t,r){return e<t?t:e>r?r:e}static anglePlusMinus180(e){return e<-180?-180:e>180?180:e}static positiveValue(e){return e>0?jr.fixedValue(e):0}static value(e){return Math.round((e+Number.EPSILON)*1e3)/1e3}static vector(e){return{x:jr.value(e.x),y:jr.value(e.y),z:jr.value(e.z)}}static angle(e){return e+=180,e=vt.modulo(e,360),e-=180,e}static angleVector(e){return{x:jr.value(jr.angle(e.x)),y:jr.value(jr.angle(e.y)),z:jr.value(jr.angle(e.z))}}};let tt=jr;P(tt,"fixedValue",e=>Math.round((e+Number.EPSILON)*1e3)/1e3);const Xe={GeometryDefinitionNotAvailable_Create:1,NoGeometryPartCreated:2,UnknownMeshUrl:3,GeometryDefinitionNotAvailable_Update:4,InvalidDataTypeInGeometryUpdate:5,InvalidPartTypeOnGeometryPartUpdate:6,GeometryPartObjectNotInitialized:7,ImportedChildOfGeometryPartObjectMustBeOfTypeMesh:8,ImportedGeometryMustBeOfTypeMappedBufferGeometry:9,ImportedWireframeMustBeOfTypeLineSegments:10,InvalidToolDataTypeLesEditToolDataUpdate:11,UnknownLesToolMode:12,TransformToolTransformControlShouldBeDeactivatedByNow:13,CantTransformMultiSelection:14,InvalidStateInTransformTool:15,UnkwnoModeInTransformTool:16,ImportError:17,LightEmittingSurfacePassReliesOnCopyShader:18,OutlinePassReliesOnCopyShader:19,PassRenderMustBeImplementedInDerivedPass:20,ObjLoadError:21,AttachedObjectIsNotPartOfScene:22,EditJointToolTransformControlShouldBeDeactivatedByNow:23,InsertPositionToolTransformControlShouldBeDeactivatedByNow:24,ScaleLeoToolTransformControlShouldBeDeactivatedByNow:25,ImportWarning:26,UnexpectedToolTypeInLesEditToolProperties:27,UnexpectedToolModeInLesEditToolProperties:28,RemovedPartObjectStillHasChildParts:29,RemovedPartObjectStillHasAParent:30,RemovedPartObjectStillHasAParent2:31,UnknownAxisInJointObject:32,NoGroupMeshWithGivenIndex:33,GroupMeshHasNoGeometry:34,GroupMeshGeometryHasNoFace:35,LightEmittingSurfaceRangeIsNotValid:36,LightEmittingSurfaceRangeStartIsInvalid:37,PartObjectAddUsed:38,PartObjectRemoveUsed:39,PartIsNotOftypeLightEmittingSurface:40,InvalidPartIdForLightEmittingSurface:41,UnknownLesAssignmentType:42,InvalidLightEmittingAssignment:43,ReadObjectsInternalFailed:44,ScreenshotAfterTextureFailed:45,ScreenshotAfterMaterialFailed:46,ReadObjectsFailed:47,ScreenshotAfterMeshFailed:48,NoLightEmittingPartWithIdAvailable:49,UnknownLightEmittingShapeType:50,UnknownDtoType:51},Go={TRACK_EVENT:"trackEvent",TRACK_LINK:"trackLink",TRACK_SEARCH:"trackSiteSearch",TRACK_VIEW:"trackPageView",TRACK_ECOMMERCE_ORDER:"trackEcommerceOrder",TRACK_ECOMMERCE_CART_UPDATE:"trackEcommerceCartUpdate"};var $1=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};class w4{constructor(e){if(!e.urlBase)throw new Error("Matomo urlBase is required.");if(!e.siteId)throw new Error("Matomo siteId is required.");this.initialize(e)}initialize({urlBase:e,siteId:t,userId:r,trackerUrl:i,srcUrl:s,disabled:a,heartBeat:o,linkTracking:l=!0,configurations:c={}}){var u;const h=e[e.length-1]!=="/"?`${e}/`:e;if(typeof window=="undefined"||(window._paq=window._paq||[],window._paq.length!==0)||a)return;this.pushInstruction("setTrackerUrl",i!=null?i:`${h}matomo.php`),this.pushInstruction("setSiteId",t),r&&this.pushInstruction("setUserId",r),Object.entries(c).forEach(([g,y])=>{y instanceof Array?this.pushInstruction(g,...y):this.pushInstruction(g,y)}),(!o||o&&o.active)&&this.enableHeartBeatTimer((u=o&&o.seconds)!==null&&u!==void 0?u:15),this.enableLinkTracking(l);const d=document,f=d.createElement("script"),v=d.getElementsByTagName("script")[0];f.type="text/javascript",f.async=!0,f.defer=!0,f.src=s||`${h}matomo.js`,v&&v.parentNode&&v.parentNode.insertBefore(f,v)}enableHeartBeatTimer(e){this.pushInstruction("enableHeartBeatTimer",e)}enableLinkTracking(e){this.pushInstruction("enableLinkTracking",e)}trackEventsForElements(e){e.length&&e.forEach(t=>{t.addEventListener("click",()=>{const{matomoCategory:r,matomoAction:i,matomoName:s,matomoValue:a}=t.dataset;if(r&&i)this.trackEvent({category:r,action:i,name:s,value:Number(a)});else throw new Error("Error: data-matomo-category and data-matomo-action are required.")})})}trackEvents(){const e='[data-matomo-event="click"]';let t=!1;if(this.mutationObserver||(t=!0,this.mutationObserver=new MutationObserver(r=>{r.forEach(i=>{i.addedNodes.forEach(s=>{if(!(s instanceof HTMLElement))return;s.matches(e)&&this.trackEventsForElements([s]);const a=Array.from(s.querySelectorAll(e));this.trackEventsForElements(a)})})})),this.mutationObserver.observe(document,{childList:!0,subtree:!0}),t){const r=Array.from(document.querySelectorAll(e));this.trackEventsForElements(r)}}stopObserving(){this.mutationObserver&&this.mutationObserver.disconnect()}trackEvent(e){var{category:t,action:r,name:i,value:s}=e,a=$1(e,["category","action","name","value"]);if(t&&r)this.track(Object.assign({data:[Go.TRACK_EVENT,t,r,i,s]},a));else throw new Error("Error: category and action are required.")}trackSiteSearch(e){var{keyword:t,category:r,count:i}=e,s=$1(e,["keyword","category","count"]);if(t)this.track(Object.assign({data:[Go.TRACK_SEARCH,t,r,i]},s));else throw new Error("Error: keyword is required.")}trackLink({href:e,linkType:t="link"}){this.pushInstruction(Go.TRACK_LINK,e,t)}trackPageView(e){this.track(Object.assign({data:[Go.TRACK_VIEW]},e))}addEcommerceItem({sku:e,productName:t,productCategory:r,productPrice:i=0,productQuantity:s=1}){this.pushInstruction("addEcommerceItem",e,t,r,i,s)}removeEcommerceItem({sku:e}){this.pushInstruction("removeEcommerceItem",e)}clearEcommerceCart(){this.pushInstruction("clearEcommerceCart")}trackEcommerceOrder({orderId:e,orderRevenue:t,orderSubTotal:r,taxAmount:i,shippingAmount:s,discountOffered:a=!1}){this.track({data:[Go.TRACK_ECOMMERCE_ORDER,e,t,r,i,s,a]})}trackEcommerceCartUpdate(e){this.pushInstruction(Go.TRACK_ECOMMERCE_CART_UPDATE,e)}setEcommerceView({sku:e,productName:t,productCategory:r,productPrice:i}){this.pushInstruction("setEcommerceView",e,t,r,i)}setEcommerceCategoryView(e){this.setEcommerceView({productCategory:e,productName:!1,sku:!1})}track({data:e=[],documentTitle:t=window.document.title,href:r,customDimensions:i=!1}){e.length&&(i&&Array.isArray(i)&&i.length&&i.map(s=>this.pushInstruction("setCustomDimension",s.id,s.value)),this.pushInstruction("setCustomUrl",r!=null?r:window.location.href),this.pushInstruction("setDocumentTitle",t),this.pushInstruction(...e))}pushInstruction(e,...t){return typeof window!="undefined"&&window._paq.push([e,...t]),this}}var _4=w4;class b4{constructor(){P(this,"instance",null)}start(){this.instance||(this.instance=new _4({urlBase:"https://stats.dial.de",siteId:20,linkTracking:!1,heartBeat:{active:!0,seconds:15},disabled:!1,configurations:{setSecureCookie:!0,setRequestMethod:"POST"}}),this.instance.trackPageView())}trackEvent(e,t,r,i){!this.instance||this.instance.trackEvent({category:e,action:t,name:r,value:i})}trackSaved(){if(!this.instance)return;const e=this.getMetadata();this.instance.trackEvent({category:"l3d_saved",action:"FaceCount",value:e.faceCount}),this.instance.trackEvent({category:"l3d_saved",action:"GeometryCount",value:e.geomCount}),this.instance.trackEvent({category:"l3d_saved",action:"JointCount",value:e.jointCount}),this.instance.trackEvent({category:"l3d_saved",action:"LEOCount",value:e.leoCount}),this.instance.trackEvent({category:"l3d_saved",action:"LESCount",value:e.lesCount}),this.instance.trackEvent({category:"l3d_saved",action:"SensorCount",value:e.sensorCount}),this.instance.trackEvent({category:"l3d_saved",action:"ElectricalConnectorCount",value:e.electricalConCount}),this.instance.trackEvent({category:"l3d_saved",action:"PendulumConnectorCount",value:e.pendulumConCount})}trackLoaded(){if(!this.instance)return;const e=this.getMetadata();this.instance.trackEvent({category:"l3d_loaded",action:"FaceCount",value:e.faceCount}),this.instance.trackEvent({category:"l3d_loaded",action:"GeometryCount",value:e.geomCount}),this.instance.trackEvent({category:"l3d_loaded",action:"JointCount",value:e.jointCount}),this.instance.trackEvent({category:"l3d_loaded",action:"LEOCount",value:e.leoCount}),this.instance.trackEvent({category:"l3d_loaded",action:"LESCount",value:e.lesCount}),this.instance.trackEvent({category:"l3d_loaded",action:"SensorCount",value:e.sensorCount}),this.instance.trackEvent({category:"l3d_loaded",action:"ElectricalConnectorCount",value:e.electricalConCount}),this.instance.trackEvent({category:"l3d_loaded",action:"PendulumConnectorCount",value:e.pendulumConCount})}trackWarning(e,t){!this.instance||this.instance.trackEvent({category:"l3d_warning",action:`warning_${e}`})}trackError(e,t){!this.instance||this.instance.trackEvent({category:"l3d_error",action:`error_${e}`})}getMetadata(){const e=me.getState(),t=e.luminaire.totalFaceCount,r=at.selectAll(e.luminaire.parts);let i=0,s=0,a=0,o=0,l=0,c=0,u=0;for(const h of r)switch(h.type){case Y.Geometry:i++;break;case Y.Joint:s++;break;case Y.LightEmittingObject:a++;break;case Y.LightEmittingSurface:o++;break;case Y.Sensor:l++;break;case Y.ElectricalConnector:c++;break;case Y.PendulumConnector:u++;break}return{faceCount:t,geomCount:i,jointCount:s,leoCount:a,lesCount:o,sensorCount:l,electricalConCount:c,pendulumConCount:u}}}const so=new b4;class He{static debug(e){}static info(e){console.log(e)}static warn(e,t){console.warn(t),so.trackWarning(e,t)}static error(e,t){console.error(t),so.trackError(e,t)}static throw(e,t){throw He.error(e,t),new Error(t)}}class Tu{addFaces(e,t){this.updateGroupFaces(e,t,(r,i)=>{i.forEach(s=>r.add(s))})}expand(e){const t=new Map,r=i=>{const s=t.get(i);if(s!=null)return s;const a=new Array;return t.set(i,a),a};return Il.selectAll(e).forEach(i=>{const s=i.groupId,a=r(s);if(i.type==kn.Single)a.push(i.faceId);else if(i.type==kn.Range){const o=Array.from({length:i.endFaceId-i.startFaceId+1},(l,c)=>c+i.startFaceId);a.push(...o)}}),Array.from(t).map(i=>({groupId:i[0],faces:i[1]}))}getFaceCount(e){let t=0;return Il.selectAll(e.faceAssignments).forEach(r=>{r.type==kn.Single?t++:r.type==kn.Range&&(t+=r.endFaceId-r.startFaceId+1)}),t}createValidGroups(e){const t=new Map;return e.forEach(r=>{let i=t.get(r.groupId);i||(i=new Set,t.set(r.groupId,i)),r.faces.forEach(s=>i.add(s))}),t}updateGroupFaces(e,t,r){if(!t.length)return;const i=Il.selectAll(e.faceAssignments);this.createValidGroups(t).forEach((s,a)=>{const o=i.filter(u=>u.groupId==a),l=o.map(u=>u.id);ms.removeMany(e.faceAssignments,l);const c=this.expandGroup(o);r(c,s),this.collapseGroup(e,a,c)})}expandGroup(e){const t=new Set;return e.length&&e.forEach(r=>{if(r.type==kn.Single){const i=r.faceId;t.add(i)}else if(r.type==kn.Range)if(r.endFaceId<r.startFaceId)He.warn(Xe.InvalidLightEmittingAssignment,`Invalid les range assignment: endFaceId (${r.endFaceId}) lower than startFaceId (${r.startFaceId})!`);else for(let i=r.startFaceId;i<=r.endFaceId;i++)t.add(i);else He.warn(Xe.UnknownLesAssignmentType,`Unknown les assignment type: ${r.type}`)}),t}addLesAssignment(e,t,r,i){r==i?e.faceAssignments=ms.addOne(e.faceAssignments,{id:e.nextFaceAssignmentId++,type:kn.Single,groupId:t,faceId:r}):e.faceAssignments=ms.addOne(e.faceAssignments,{id:e.nextFaceAssignmentId++,type:kn.Range,groupId:t,startFaceId:r,endFaceId:i})}collapseGroup(e,t,r){if(!r.size)return;const s=Array.from(r.values()).sort((l,c)=>l-c);let a=s[0],o=s[0];for(let l=0;l<s.length-1;l++){const c=s[l+1];c==o+1?o++:(this.addLesAssignment(e,t,a,o),a=o=c)}this.addLesAssignment(e,t,a,o)}}class Lr{static isBiggerThan2Meters(e){return e.x>2||e.y>2||e.z>2}static isBiggerThan10Meters(e){return e.x>10||e.y>10||e.z>10}static isSmallerThan1CentiMeters(e){return e.x<.01||e.y<.01||e.z<.01}static isSizeUnrealistic(e){return this.isBiggerThan2Meters(e)||this.isSmallerThan1CentiMeters(e)}}P(Lr,"partNameRe",/^[A-Za-z][\w\.\-]{2,}$/),P(Lr,"startsWithLetterRe",/^[A-Za-a].*/),P(Lr,"allInvalidChars",/\W+/g);const Vc={name:"New Luminaire",description:"Some Description",meshes:rr.getInitialState(),parts:gt.getInitialState(),nextMeshId:1,nextPartId:1,totalFaceCount:0},rs=(n,e)=>{let t=null;for(;!t||fx(n,t);)t=e+"_"+Math.random().toString(36).substring(2,6);return t},Dg=(n,e)=>{e=e.toLowerCase().endsWith(".obj")?e.substring(0,e.length-4):e,e.match(Lr.partNameRe)||(e.match(Lr.startsWithLetterRe)||(e=`P_${e}`),e=e.replaceAll(Lr.allInvalidChars,"_"));let t=1,r="";for(;fx(n,e+r);)r="_"+(t++).toString();return e+r},fx=(n,e)=>!!at.selectAll(n.parts).filter(r=>r.name==e).length,Ng=n=>{if(n.type==Oe.Rectangle)return{type:Oe.Rectangle,sizeX:tt.value(n.sizeX),sizeY:tt.value(n.sizeY)};if(n.type==Oe.Circle)return{type:Oe.Circle,diameter:tt.value(n.diameter)};throw new Error("Unknown shape: "+n)},Vo=()=>({isRotatable:!1,min:-90,default:0,max:90,step:1}),kg=n=>{let e=tt.anglePlusMinus180(n.min);const t=tt.anglePlusMinus180(n.max);e>t&&(e=t);const r=tt.valueInMinMaxRange(n.default,e,t),i=tt.valueInMinMaxRange(n.step,0,180);return{isRotatable:n.isRotatable,min:e,default:r,max:t,step:i}},_A=zy({name:"luminaire",initialState:Vc,reducers:{reset(n){n.name=Vc.name,n.description=Vc.description,n.meshes=rr.getInitialState(),n.parts=gt.getInitialState(),n.nextMeshId=Vc.nextMeshId,n.nextPartId=Vc.nextPartId},loaded(n,e){n.name=e.payload.name,n.description=e.payload.description,n.meshes=e.payload.meshes,n.parts=e.payload.parts,n.nextMeshId=e.payload.nextMeshId,n.nextPartId=e.payload.nextPartId},luminaireNameSet(n,e){n.name=e.payload},luminaireDescriptionSet(n,e){n.description=e.payload},objectsImported(n,e){e.payload.meshes.forEach(t=>{const r=n.nextMeshId++,i=as.addMany(as.getInitialState(),t.materialLibraries),s=ki.addMany(ki.getInitialState(),t.textures),a=vt.getScaledVector(t.size,e.payload.unit);rr.addOne(n.meshes,{id:r,name:t.name,meshUrl:t.url,units:e.payload.unit,material:{libraries:i,textures:s},groups:Xa.addMany(Xa.getInitialState(),t.groups.map(o=>({id:o.index,name:o.name,faceCount:o.faceCount}))),size:t.size,faceCount:t.faceCount,ignoredSize:!1,scaledSize:a,previewUrl:t.previewUrl})})},removeMesh(n,e){!qt.selectById(n.meshes,e.payload)||at.selectAll(n.parts).filter(r=>r.type==Y.Geometry&&r.meshId==e.payload).length>0||rr.removeOne(n.meshes,e.payload)},materialLibrariesUpdated(n,e){const t=e.payload.meshId,r=qt.selectById(n.meshes,t);if(r==null)return;const i=new Array;sd.selectAll(r.material.libraries).forEach(o=>{const l=e.payload.materialLibraries.find(c=>c.name==o.name);l!=null&&i.push({id:l.name,changes:{url:l.url}})});const s=as.updateMany(r.material.libraries,i),a=ki.upsertMany(r.material.textures,e.payload.textures);rr.updateOne(n.meshes,{id:t,changes:{material:{libraries:s,textures:a},previewUrl:e.payload.previewUrl}})},sizelIgnored(n,e){const t=e.payload.meshId;qt.selectById(n.meshes,t)!=null&&rr.updateOne(n.meshes,{id:t,changes:{ignoredSize:!0}})},materialIgnored(n,e){const t=e.payload.meshId,r=qt.selectById(n.meshes,t);if(r==null)return;const i=sd.selectById(r.material.libraries,e.payload.materialName);if(i==null)return;const s=as.updateOne(r.material.libraries,{id:i.name,changes:{ignored:!0}});rr.updateOne(n.meshes,{id:t,changes:{material:{libraries:s,textures:r.material.textures}}})},textureIgnored(n,e){const t=e.payload.meshId,r=qt.selectById(n.meshes,t);if(r==null)return;const i=ad.selectById(r.material.textures,e.payload.textureName);if(i==null)return;const s=ki.updateOne(r.material.textures,{id:i.name,changes:{ignored:!0}});rr.updateOne(n.meshes,{id:t,changes:{material:{libraries:r.material.libraries,textures:s}}})},texturesUpdated(n,e){const t=e.payload.meshId,r=qt.selectById(n.meshes,t);if(r==null)return;const i=new Array;ad.selectAll(r.material.textures).forEach(a=>{const o=e.payload.textures.find(l=>l.name==a.name);o!=null&&i.push({id:o.name,changes:{url:o.url}})});const s=ki.updateMany(r.material.textures,i);rr.updateOne(n.meshes,{id:t,changes:{material:{libraries:r.material.libraries,textures:s},previewUrl:e.payload.previewUrl}})},geometryPartAdded(n,e){var i,s,a;const r={id:n.nextPartId++,type:Y.Geometry,parentId:(i=e.payload.parentId)!=null?i:0,name:Dg(n,(a=(s=qt.selectById(n.meshes,e.payload.meshId))==null?void 0:s.name)!=null?a:"mesh"),meshId:e.payload.meshId,position:tt.vector(e.payload.position),rotation:{x:0,y:0,z:0},includedInMeasurement:!0};gt.addOne(n.parts,r)},geometryMeshesAndPartsAdded(n,e){e.payload.meshes.forEach(t=>{var c;const r=n.nextMeshId++,i=as.addMany(as.getInitialState(),t.materialLibraries),s=ki.addMany(ki.getInitialState(),t.textures),a=vt.getScaledVector(t.size,e.payload.unit);rr.addOne(n.meshes,{id:r,name:t.name,meshUrl:t.url,units:e.payload.unit,material:{libraries:i,textures:s},groups:Xa.addMany(Xa.getInitialState(),t.groups.map(u=>({id:u.index,name:u.name,faceCount:u.faceCount}))),size:t.size,faceCount:t.faceCount,ignoredSize:!1,scaledSize:a,previewUrl:t.previewUrl});const l={id:n.nextPartId++,type:Y.Geometry,parentId:(c=e.payload.parentId)!=null?c:0,name:Dg(n,t.name),meshId:r,position:tt.vector(e.payload.position),rotation:{x:0,y:0,z:0},includedInMeasurement:!0};gt.addOne(n.parts,l)})},geometryPartWithAutoJointAdded(n,e){var a,o;const t=n.nextPartId++,r=n.nextPartId++,i={id:t,type:Y.Joint,parentId:e.payload.parentId,name:rs(n,"joint"),position:tt.vector(e.payload.position),rotation:{x:0,y:0,z:0},xAxis:Vo(),yAxis:Vo(),zAxis:Vo()},s={id:r,type:Y.Geometry,parentId:t,name:Dg(n,(o=(a=qt.selectById(n.meshes,e.payload.meshId))==null?void 0:a.name)!=null?o:"mesh"),meshId:e.payload.meshId,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},includedInMeasurement:!0};gt.addMany(n.parts,[s,i])},partNameSet(n,e){gt.updateOne(n.parts,{id:e.payload.partId,changes:{name:e.payload.name}})},partPositionSet(n,e){e.payload.lockChildren?new Ws().setTransformWithLockedChildren(n.parts,e.payload.partId,{position:tt.vector(e.payload.position)}):gt.updateOne(n.parts,{id:e.payload.partId,changes:{position:tt.vector(e.payload.position)}})},partRotationSet(n,e){e.payload.lockChildren?new Ws().setTransformWithLockedChildren(n.parts,e.payload.partId,{rotation:tt.angleVector(e.payload.rotation)}):gt.updateOne(n.parts,{id:e.payload.partId,changes:{rotation:tt.angleVector(e.payload.rotation)}})},rotateLeoPart(n,e){const t=at.selectById(n.parts,e.payload.partId);if(!t||t.type!=Y.LightEmittingObject)return;const r=new sr(st.degToRad(t.rotation.x),st.degToRad(t.rotation.y),st.degToRad(t.rotation.z),"ZXY"),i=new qe().setFromEuler(r).multiply(new qe().setFromAxisAngle(new L(0,0,1),st.degToRad(90))).normalize();if(r.setFromQuaternion(i),t.shape.type==Oe.Rectangle){const s={type:Oe.Rectangle,sizeX:t.shape.sizeY,sizeY:t.shape.sizeX};gt.updateOne(n.parts,{id:e.payload.partId,changes:{rotation:tt.angleVector({x:st.radToDeg(r.x),y:st.radToDeg(r.y),z:st.radToDeg(r.z)}),shape:s}})}else gt.updateOne(n.parts,{id:e.payload.partId,changes:{rotation:tt.angleVector({x:st.radToDeg(r.x),y:st.radToDeg(r.y),z:st.radToDeg(r.z)})}})},partParentChanged(n,e){gt.updateOne(n.parts,{id:e.payload.partId,changes:{parentId:e.payload.parentId}})},meshUnitsChanged(n,e){const t=qt.selectById(n.meshes,e.payload.meshId);if(!t)return;const r=vt.getScaledVector(t.size,e.payload.units);rr.updateOne(n.meshes,{id:e.payload.meshId,changes:{units:e.payload.units,scaledSize:r}})},jointPartAdded(n,e){const r={id:n.nextPartId++,type:Y.Joint,parentId:e.payload.parentId,name:rs(n,"joint"),position:e.payload.position?tt.vector(e.payload.position):{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},xAxis:Vo(),yAxis:Vo(),zAxis:Vo()};gt.addOne(n.parts,r)},jointPartXAxisChanged(n,e){gt.updateOne(n.parts,{id:e.payload.partId,changes:{xAxis:kg(e.payload.axis)}})},jointPartYAxisChanged(n,e){gt.updateOne(n.parts,{id:e.payload.partId,changes:{yAxis:kg(e.payload.axis)}})},jointPartZAxisChanged(n,e){gt.updateOne(n.parts,{id:e.payload.partId,changes:{zAxis:kg(e.payload.axis)}})},lightEmittingPartAdded(n,e){const r={id:n.nextPartId++,type:Y.LightEmittingObject,name:rs(n,"leo"),parentId:e.payload.parentId,position:tt.vector(e.payload.position),rotation:tt.angleVector(e.payload.rotation),shape:Ng(e.payload.shape),luminousHeights:{c0:0,c90:0,c180:0,c270:0}};gt.addOne(n.parts,r)},lightEmittingPartWithSurfacesAdded(n,e){const t=e.payload.leo,r=e.payload.les,i=n.nextPartId++,s={id:i,type:Y.LightEmittingObject,name:rs(n,"leo"),parentId:e.payload.parentId,position:tt.vector(t.position),rotation:tt.angleVector(t.rotation),shape:Ng(t.shape),luminousHeights:{c0:0,c90:0,c180:0,c270:0}};gt.addOne(n.parts,s);const o={id:n.nextPartId++,type:Y.LightEmittingSurface,name:rs(n,"les"),parentId:e.payload.parentId,lightEmittingObjects:Bs.addOne(Bs.getInitialState(),{lightEmittingObjectId:i,intensity:1}),faceAssignments:ms.getInitialState(),nextFaceAssignmentId:1,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}};new Tu().addFaces(o,r.faceGroups),gt.addOne(n.parts,o)},lightEmittingPartShapeChanged(n,e){const t={id:e.payload.partId,changes:{shape:Ng(e.payload.shape)}};e.payload.position&&(t.changes.position=e.payload.position),gt.updateOne(n.parts,t)},lightEmittingPartLuminousHeightsChanged(n,e){const t={id:e.payload.partId,changes:{luminousHeights:{c0:tt.positiveValue(e.payload.luminousHeights.c0),c90:tt.positiveValue(e.payload.luminousHeights.c90),c180:tt.positiveValue(e.payload.luminousHeights.c180),c270:tt.positiveValue(e.payload.luminousHeights.c270)}}};gt.updateOne(n.parts,t)},sensorPartAdded(n,e){const t=n.nextPartId++,r={type:Y.Sensor,id:t,name:rs(n,"sensor"),parentId:e.payload.parentId,position:tt.vector(e.payload.position),rotation:tt.angleVector(e.payload.rotation)};gt.addOne(n.parts,r)},pendulumConnectorPartAdded(n,e){const t=n.nextPartId++,r={type:Y.PendulumConnector,id:t,name:rs(n,"pendulum"),parentId:e.payload.parentId,position:tt.vector(e.payload.position),rotation:{x:0,y:0,z:0}};gt.addOne(n.parts,r)},electricalConnectorPartAdded(n,e){const t=n.nextPartId++,r={type:Y.ElectricalConnector,id:t,name:rs(n,"electrical"),parentId:e.payload.parentId,position:tt.vector(e.payload.position),rotation:{x:0,y:0,z:0}};gt.addOne(n.parts,r)},partsDeleted(n,e){new Ws().removeParts(n.parts,e.payload)},lesCreated(n,e){const t=Bs.addOne(Bs.getInitialState(),{lightEmittingObjectId:e.payload.lightEmittingPartId,intensity:1}),i={id:n.nextPartId++,type:Y.LightEmittingSurface,name:rs(n,"les"),parentId:e.payload.geometryPartId,lightEmittingObjects:t,faceAssignments:ms.getInitialState(),nextFaceAssignmentId:1,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}};new Tu().addFaces(i,e.payload.faceGroups),gt.addOne(n.parts,i)},lesUpdated(n,e){const t=at.selectById(n.parts,e.payload.id);if(!t||t.type!=Y.LightEmittingSurface)return;const r={...t,faceAssignments:ms.getInitialState()};new Tu().addFaces(r,e.payload.faceGroups),gt.updateOne(n.parts,{id:e.payload.id,changes:{faceAssignments:r.faceAssignments,nextFaceAssignmentId:r.nextFaceAssignmentId}})},lesLeoAssignmentIntensityChanged(n,e){const t=at.selectById(n.parts,e.payload.lesId);if(!t){He.warn(Xe.InvalidPartIdForLightEmittingSurface,`Invalid id (${e.payload.lesId}) for light emitting surface part!`);return}if(t.type!=Y.LightEmittingSurface){He.warn(Xe.PartIsNotOftypeLightEmittingSurface,`Part with id (${e.payload.lesId}) is not of type light emitting surface!`);return}const r=Bs.updateOne(t.lightEmittingObjects,{id:e.payload.leoId,changes:{intensity:e.payload.intensity}});gt.updateOne(n.parts,{id:e.payload.lesId,changes:{lightEmittingObjects:r}})},storePreviewImage(n,e){!qt.selectById(n.meshes,e.payload.meshId)||rr.updateOne(n.meshes,{id:e.payload.meshId,changes:{previewUrl:e.payload.data}})},geometryPartIncludedInMeasurementChanged(n,e){const t=at.selectById(n.parts,e.payload.partId);!t||t.type!=Y.Geometry||gt.updateOne(n.parts,{id:e.payload.partId,changes:{includedInMeasurement:e.payload.included}})},moveRootPartsByOffset(n,e){new Ws().offsetRootParts(n.parts,e.payload)}}}),wr=n=>n.luminaire,S4=Ne(wr,n=>n.name),M4=Ne(wr,n=>n.description),E4=n=>Ne(wr,e=>qt.selectById(e.meshes,n)),A4=Ne(wr,n=>n.meshes),px=Ne(wr,n=>n.parts),T4=n=>Ne(px,e=>at.selectAll(e).filter(t=>t.parentId==n)),C4=Ne(wr,n=>at.selectTotal(n.parts)),sm=n=>Ne(px,e=>{var t;return(t=at.selectById(e,n))!=null?t:null}),P4=n=>Ne(sm(n),e=>{var t;return(t=e==null?void 0:e.name)!=null?t:"n/a"}),I4=n=>Ne(sm(n),e=>{var t;return(t=e==null?void 0:e.position)!=null?t:{x:0,y:0,z:0}}),L4=Ne(wr,n=>at.selectAll(n.parts).filter(e=>e.type==Y.LightEmittingObject)),R4=n=>Ne(sm(n),e=>{var t;return(t=e==null?void 0:e.rotation)!=null?t:{x:0,y:0,z:0}}),F4=Ne(wr,n=>at.selectAll(n.parts).some(e=>e.type==Y.LightEmittingObject)),D4=n=>Ne(wr,e=>fx(e,n)),bA=(n,e)=>{const t=at.selectById(n,e);if(!t||t.type!=Y.Geometry)throw new Error(`Invalid id (${e}) for geometry part!`);return t},SA=(n,e)=>{const t=at.selectById(n,e);if(!t||t.type!=Y.LightEmittingObject)throw new Error(`Invalid id (${e}) for light emitting part!`);return t},N4=n=>{let e=0;return Il.selectAll(n).forEach(t=>{if(t.type==kn.Single)e++;else if(t.type==kn.Range)e+=t.endFaceId-t.startFaceId+1;else throw new Error(`Invalid assignment type: ${e}`)}),e},k4=n=>Ne(wr,e=>at.selectAll(e.parts).filter(t=>t.type==Y.LightEmittingSurface).map(t=>t).filter(t=>id.selectById(t.lightEmittingObjects,n)!=null).map(t=>({id:t.id,partName:t.name,geometryPart:bA(e.parts,t.parentId),lightEmittingObjects:id.selectAll(t.lightEmittingObjects).map(r=>({intensity:r.intensity,part:SA(e.parts,r.lightEmittingObjectId)})),faceCount:N4(t.faceAssignments)}))),O4=n=>Ne(wr,e=>SA(e.parts,n)),z4=n=>Ne(wr,e=>bA(e.parts,n)),U4=n=>Ne(wr,e=>at.selectAll(e.parts).filter(t=>t.type!=Y.Geometry?!1:t.meshId==n).length==0),B4=Ne(wr,n=>n.totalFaceCount),Te=_A.actions;var Z1=(n,e)=>{let t=_A.reducer(n,e);if(!n)return t;if(n.parts!=t.parts){let r=0;for(const i of at.selectAll(t.parts))if(i.type==Y.Geometry){const s=qt.selectById(t.meshes,i.meshId);s&&(r+=s.faceCount)}t={...t,totalFaceCount:r}}return t};const mt={name:S4,description:M4,meshDefinitions:A4,meshDefinition:E4,part:sm,partCount:C4,parts:px,childParts:T4,partName:P4,partPosition:I4,partRotation:R4,lightEmittingParts:L4,hasLightEmittingParts:F4,isPartNameTaken:D4,lightEmittingSurfacesForLeo:k4,geometryPart:z4,lightEmittingPart:O4,canRemoveMesh:U4,surfaceCount:B4},MA={selection:Dt.getInitialState(),tool:{type:Le.None},canActivateTranslateTool:!1,canActivateRotateTool:!1,canActivateEditLesTool:!1,selectedMeshId:null,fixChildren:!1,data:{hidden:Ds.getInitialState()}},EA=zy({name:"editor",initialState:MA,reducers:{geometryPartSelected(n,e){var i,s;const t=e.payload.id,r=Tr.addMany(Tr.getInitialState(),(s=(i=e.payload.groups)==null?void 0:i.map(a=>{var c;const o=a.id,l=zs.addMany(zs.getInitialState(),(c=a.faces)!=null?c:[]);return{index:o,faceIndices:l}}))!=null?s:[]);n.selection=Dt.addOne(Dt.getInitialState(),{type:Y.Geometry,id:t,faceGroups:r})},jointPartSelected(n,e){n.selection=Dt.addOne(Dt.getInitialState(),{type:Y.Joint,id:e.payload.id,axis:e.payload.axis})},partsSelected(n,e){},partSelectionCleared(n){Dt.removeAll(n.selection),n.tool={type:Le.None}},toolDataSet(n,e){n.tool=e.payload,e.payload.clearSelection&&(n.selection=Dt.getInitialState())},addedToSelection(n,e){const t=sn.selectById(n.selection,e.payload.partId);if(t&&t.type!=Y.Geometry)return;const r=t!=null?t.faceGroups:Tr.getInitialState(),i=ei.selectById(r,e.payload.groupIndex),s=i!=null?i.faceIndices:zs.getInitialState();ps.selectById(s,e.payload.faceIndex)==null&&Dt.upsertOne(n.selection,{type:Y.Geometry,id:e.payload.partId,faceGroups:Tr.upsertOne(r,{index:e.payload.groupIndex,faceIndices:zs.addOne(s,e.payload.faceIndex)})})},removedFromSelection(n,e){const t=sn.selectById(n.selection,e.payload.partId);if(!t||t.type!=Y.Geometry)return;let r=t.faceGroups;const i=ei.selectById(r,e.payload.groupIndex);if(i==null)return;let s=i.faceIndices;ps.selectById(s,e.payload.faceIndex)!=null&&(s=zs.removeOne(s,e.payload.faceIndex),ps.selectTotal(s)?r=Tr.updateOne(r,{id:i.index,changes:{faceIndices:s}}):r=Tr.removeOne(r,i.index),Dt.updateOne(n.selection,{id:e.payload.partId,changes:{faceGroups:r}}))},faceSelectionCleared(n){Dt.updateMany(n.selection,sn.selectAll(n.selection).map(e=>({id:e.id,changes:{faceGroups:Tr.getInitialState()}})))},expandFaceSelection(n){},selectedMeshSet(n,e){n.selectedMeshId=e.payload},selectedMeshCleared(n){n.selectedMeshId=null},fixChildrenSet(n,e){n.fixChildren=e.payload},lesEditStarted(n,e){},hideGeometryFaceGroups(n,e){const t=Qa.selectById(n.data.hidden,e.payload.partId);if(t&&t.type==Y.Geometry){const r=Wa.addMany(t.faceGroups,e.payload.groupIndices.slice());Ds.updateOne(n.data.hidden,{id:e.payload.partId,changes:{faceGroups:r}})}else{const r={type:Y.Geometry,id:e.payload.partId,faceGroups:Wa.addMany(Wa.getInitialState(),e.payload.groupIndices)};Ds.upsertOne(n.data.hidden,r)}},showGeometryFaceGroups(n,e){const t=Qa.selectById(n.data.hidden,e.payload.partId);if(!t||t.type!=Y.Geometry)return;const r=Wa.removeMany(t.faceGroups,e.payload.groupIndices.slice());Ul.selectTotal(r)?Ds.updateOne(n.data.hidden,{id:e.payload.partId,changes:{faceGroups:r}}):Ds.removeOne(n.data.hidden,e.payload.partId)},showAllGeometryFaceGroups(n,e){const t=Qa.selectById(n.data.hidden,e.payload.partId);!t||t.type!=Y.Geometry||Ds.removeOne(n.data.hidden,e.payload.partId)}},extraReducers:n=>{n.addCase(Te.partsDeleted,e=>{Dt.removeAll(e.selection)}).addCase(Te.reset,e=>{Dt.removeAll(e.selection),e.tool={type:Le.None},e.selectedMeshId=null,e.data={hidden:Ds.getInitialState()}}).addCase(Te.loaded,e=>{e.tool={type:Le.None},e.selectedMeshId=null}).addCase(Te.lesCreated,(e,t)=>{Dt.updateMany(e.selection,sn.selectAll(e.selection).map(r=>({id:r.id,changes:{faceGroups:Tr.getInitialState()}}))),e.tool.type==Le.LesEdit&&(e.tool={type:Le.None},e.selection=Dt.addOne(Dt.getInitialState(),{type:Y.LightEmittingObject,id:t.payload.lightEmittingPartId}))}).addCase(Te.lesUpdated,(e,t)=>{e.tool={type:Le.None},e.selection=Dt.addOne(Dt.getInitialState(),{type:Y.LightEmittingSurface,id:t.payload.id})})}}),ii=n=>n.editor,am=Ne(ii,n=>n.selection),AA=Ne(am,n=>sn.selectAll(n).map(e=>e.id)),H4=n=>Ne(AA,e=>e.includes(n)),G4=(n,e,t)=>Ne(am,r=>{const i=sn.selectById(r,n);if(!i||i.type!=Y.Geometry)return!1;const s=ei.selectById(i.faceGroups,e);return s==null?!1:ps.selectById(s.faceIndices,t)!=null}),V4=Ne(ii,n=>n.canActivateRotateTool),j4=Ne(ii,n=>n.canActivateTranslateTool),W4=Ne(ii,n=>n.canActivateEditLesTool),X4=Ne(ii,n=>n.tool),Y4=Ne(am,n=>{let e=!1;return sn.selectAll(n).filter(t=>t.type==Y.Geometry).map(t=>t).forEach(t=>{ei.selectAll(t.faceGroups).forEach(r=>{e=e||ps.selectTotal(r.faceIndices)>0})}),e}),$4=Ne(n=>({parts:n.luminaire.parts,selection:n.editor.selection}),n=>sn.selectAll(n.selection).map(e=>{const t=at.selectById(n.parts,e.id);if(!t)throw new Error(`Unknown part id: ${e.id}`);const r=new Map;return e.type==Y.Geometry&&ei.selectAll(e.faceGroups).forEach(i=>r.set(i.index,new Set(ps.selectAll(i.faceIndices)))),{part:t,faceGroups:r}})),Z4=Ne(ii,n=>n.selectedMeshId),q4=Ne(ii,n=>n.fixChildren),Q4=Ne(ii,n=>sn.selectAll(n.selection).map(e=>e.type==Y.Geometry?{type:Y.Geometry,id:e.id,faceGroups:ei.selectAll(e.faceGroups).map(i=>({index:i.index,faces:ps.selectAll(i.faceIndices)}))}:e.type==Y.Joint?{type:Y.Joint,id:e.id,axis:e.axis}:{type:e.type,id:e.id})),J4=(n,e)=>Ne(ii,t=>{const r=sn.selectById(t.selection,n);return!r||r.type!=Y.Geometry?!1:ei.selectById(r.faceGroups,e)!=null}),K4=(n,e)=>Ne(ii,t=>{const r=Qa.selectById(t.data.hidden,n);return!r||r.type!=Y.Geometry?!1:Ul.selectById(r.faceGroups,e)!=null}),ez=n=>Ne(ii,e=>{const t=Qa.selectById(e.data.hidden,n);return!t||t.type!=Y.Geometry?!1:Ul.selectTotal(t.faceGroups)>0}),tz=Ne(ii,n=>Qa.selectAll(n.data.hidden).map(t=>t.type==Y.Geometry?{type:Y.Geometry,id:t.id,faceGroups:Ul.selectAll(t.faceGroups)}:t)),je=EA.actions,bt={selection:Q4,selectedPartEntities:am,selectedPartIds:AA,isPartSelected:H4,isFaceSelected:G4,canActivateRotateTool:V4,canActivateTranslateTool:j4,canActivateEditLesTool:W4,activeTool:X4,hasSelectedFaces:Y4,selectedParts:$4,selectedMeshId:Z4,fixChildren:q4,isFaceGroupSelected:J4,isFaceGroupHidden:K4,hiddenItems:tz,hasHiddenFaceGroups:ez},nz=(n,e)=>{if(e.length==0||e.length>1)return!1;const t=e[0].type;return!(t==Y.ElectricalConnector||t==Y.LightEmittingSurface||t==Y.PendulumConnector)},rz=(n,e)=>{if(e.length==0||e.length>1)return!1;const t=at.selectById(n.luminaire.parts,e[0].id);return!(t==null||t.type==Y.LightEmittingSurface)},iz=(n,e)=>{if(e.length==0||e.length>1)return!1;const t=at.selectById(n.luminaire.parts,e[0].id);return t==null?!1:t.type==Y.Geometry},sz=(n,e,t)=>{const r=at.selectById(t.luminaire.parts,e);if(!r||r.type!=Y.LightEmittingSurface)return n;const i=new Tu().expand(r.faceAssignments);return{...n,tool:{type:Le.LesEdit,mode:Nt.EditLesFaces,lesId:e,geometryPartId:r.parentId},selection:Dt.addOne(Dt.getInitialState(),{type:Y.Geometry,id:r.parentId,faceGroups:Tr.addMany(Tr.getInitialState(),i.map(s=>({index:s.groupId,faceIndices:zs.addMany(zs.getInitialState(),s.faces)})))})}},TA=(n,e,t)=>{const r=at.selectById(t.luminaire.parts,e);return r?r.type==Y.Geometry?{...n,selection:Dt.addOne(n.selection,{type:r.type,id:e,faceGroups:Tr.getInitialState()})}:r.type==Y.Joint?{...n,selection:Dt.addOne(n.selection,{type:r.type,id:e,axis:null})}:{...n,selection:Dt.addOne(n.selection,{type:r.type,id:e})}:n},q1=(n,e,t)=>{const r={...n,selection:Dt.getInitialState()};return TA(r,e,t)},az=(n,e,t)=>{let r={...n,selection:Dt.getInitialState()};return e.payload.forEach(i=>r=TA(r,i,t)),sn.selectTotal(r.selection)!=1&&(r.tool={type:Le.None}),r},oz=(n,e)=>{const t=sn.selectAll(n.selection);if(!t.length)return n;const r=t.filter(a=>a.type==Y.Geometry&&ei.selectTotal(a.faceGroups)>0);if(!r.length)return n;const i=r.map(a=>{const o=a,l=at.selectById(e.luminaire.parts,o.id);if(!l||l.type!=Y.Geometry)return null;const c=qt.selectById(e.luminaire.meshes,l.meshId);if(!c)return null;const u=ei.selectAll(o.faceGroups).map(h=>{var d;return(d=yA.selectById(c.groups,h.index))!=null?d:null}).filter(h=>h!=null).map(h=>h);return u.length?{part:l,meshGroups:u}:null}).filter(a=>a!=null).map(a=>a);if(!i.length)return n;let s={...n.selection};return i.forEach(a=>{const o=sn.selectById(s,a.part.id);if(!o||o.type!=Y.Geometry)return;let l=o.faceGroups;a.meshGroups.forEach(c=>{l=Tr.updateOne(l,{id:c.id,changes:{faceIndices:Wa.addMany(Wa.getInitialState(),Array.from(new Array(c.faceCount),(u,h)=>h))}})}),s=Dt.updateOne(s,{id:o.id,changes:{faceGroups:l}})}),{...n,selection:s}};function Q1(n,e){let t=EA.reducer(n==null?void 0:n.editor,e);if(n==null)return t;switch(e.type){case je.lesEditStarted.type:t=sz(t,e.payload,n);break;case je.partsSelected.type:t=az(t,e,n);break;case je.expandFaceSelection.type:t=oz(t,n);break;case Te.geometryPartAdded.type:case Te.geometryPartWithAutoJointAdded.type:case Te.jointPartAdded.type:case Te.lightEmittingPartAdded.type:case Te.sensorPartAdded.type:case Te.pendulumConnectorPartAdded.type:case Te.electricalConnectorPartAdded.type:t=q1(t,n.luminaire.nextPartId-1,n);break;case Te.loaded.type:t=MA;break;case Te.lightEmittingPartWithSurfacesAdded.type:t=q1(t,n.luminaire.nextPartId-2,n),t={...t,tool:{type:Le.None}};break}const r=nz(n,sn.selectAll(t.selection)),i=rz(n,sn.selectAll(t.selection));t.canActivateRotateTool!=r&&(t={...t,canActivateRotateTool:r}),t.canActivateTranslateTool!=i&&(t={...t,canActivateTranslateTool:i});const s=iz(n,sn.selectAll(t.selection));return t.canActivateEditLesTool!=s&&(t={...t,canActivateEditLesTool:s}),t}const J1=50,CA={undoStack:[],redoStack:[]};function lz(n){const e=n.history.undoStack;return e.length==0?n:{luminaire:e[e.length-1].luminaire,editor:e[e.length-1].editor,history:{undoStack:e.slice(0,e.length-1),redoStack:n.history.redoStack.concat([{luminaire:n.luminaire,editor:n.editor}])},runtime:n.runtime}}function cz(n){const e=n.history.redoStack;return e.length==0?n:{luminaire:e[e.length-1].luminaire,editor:e[e.length-1].editor,history:{undoStack:n.history.undoStack.concat([{luminaire:n.luminaire,editor:n.editor}]),redoStack:e.slice(0,e.length-1)},runtime:n.runtime}}function uz(n,e){return n.luminaire!=e.luminaire||n.editor.data!=e.editor.data}function dz(n){const e={luminaire:n.luminaire,editor:n.editor},t=n.history.undoStack.length>=J1-1?[...n.history.undoStack.slice(n.history.undoStack.length-J1+1),e]:[...n.history.undoStack,e];return{...n.history,undoStack:t,redoStack:[]}}function hz(n,e,t){switch(t.type){case Vl.undo.type:return lz(e);case Vl.redo.type:return cz(e);case Te.reset.type:case Te.loaded.type:return{...e,history:CA}}const r=n!=null&&uz(n,e)?dz(n):e.history;return{...e,history:r}}const fz=io("history/undo"),pz=io("history/redo"),mx=n=>n.history,mz=Ne(mx,n=>n.undoStack.length>0),gz=Ne(mx,n=>n.redoStack.length>0),vz=Ne(mx,n=>n.redoStack.length>0||n.undoStack.length>0),Vl={undo:fz,redo:pz},Cu={canHistoryUndo:mz,canHistoryRedo:gz,hasChanges:vz},yz={nextImportMessageId:1,importMessages:Au.getInitialState(),ui:{leftSidebarWidth:300,rightSidebarWidth:300},temp:{position:null,rotation:null,insertPoint:null,leoShape:null,jointAxisData:null},isTransforming:!1,view:{jointObjectsVisible:!0,lightEmittingObjectsVisible:!0,sensorObjectsVisible:!0,electricalConnectorObjectsVisible:!0,pendulumConnectorObjectsVisible:!0,cameraType:$e.Pers,xyFlipped:!1,yzFlipped:!1,xzFlipped:!1,wireframe3D:!1,wireframe2D:!0,wallMode:!1},dragDrop:null,defaultScaling:mr.m,messages:{overlay:{tool:null}},requestedL3DOverride:null,meshSizeWarnings:od.getInitialState(),progress:null,labelOverlay:{labels:sp.getInitialState()},modals:{nextId:1,stack:cl.getInitialState()}},PA=zy({name:"runtime",initialState:yz,reducers:{importMessageCreated(n,e){Au.addOne(n.importMessages,{id:n.nextImportMessageId++,message:e.payload.message})},importMessageRemoved(n,e){Au.removeOne(n.importMessages,e.payload)},clearImportMessages(n){Au.removeAll(n.importMessages)},uiLeftSidebarWidthSet(n,e){e.payload>0?n.ui.leftSidebarWidth=e.payload:n.ui.leftSidebarWidth=0},uiRightSidebarWidthSet(n,e){e.payload>0?n.ui.rightSidebarWidth=e.payload:n.ui.rightSidebarWidth=0},transformingChanged(n,e){n.isTransforming=e.payload},tempPositionSet(n,e){n.temp.position={x:e.payload.x,y:e.payload.y,z:e.payload.z}},tempPositionCleared(n){n.temp.position=null},tempRotationSet(n,e){n.temp.rotation={x:e.payload.x,y:e.payload.y,z:e.payload.z}},tempRotationCleared(n){n.temp.rotation=null},lightEmittingObjectVisibilitySet(n,e){n.view.lightEmittingObjectsVisible=e.payload},jointObjectVisibilitySet(n,e){n.view.jointObjectsVisible=e.payload},sensorObjectVisibilitySet(n,e){n.view.sensorObjectsVisible=e.payload},electricalConnectorObjectVisibilitySet(n,e){n.view.electricalConnectorObjectsVisible=e.payload},pendulumConnectorObjectVisibilitySet(n,e){n.view.pendulumConnectorObjectsVisible=e.payload},objectsVisibilityReset(n){n.view.lightEmittingObjectsVisible=!0,n.view.jointObjectsVisible=!0,n.view.sensorObjectsVisible=!0,n.view.electricalConnectorObjectsVisible=!0,n.view.pendulumConnectorObjectsVisible=!0},dragDropStarted(n,e){n.dragDrop=e.payload},dragDropStopped(n){n.dragDrop=null},dragDropHoverPartIdUpdated(n,e){n.dragDrop&&(n.dragDrop.hoverPart=e.payload)},defaultScalingChanged(n,e){n.defaultScaling=e.payload},requestL3DOverride(n,e){n.requestedL3DOverride=e.payload},meshSizeWarningCreated(n,e){od.addOne(n.meshSizeWarnings,{id:e.payload})},clearMeshSizeWarnings(n){od.removeAll(n.meshSizeWarnings)},progressStarted(n,e){const t=n.modals.nextId++;n.progress={title:e.payload.title,inProgress:!0,closable:!1,message:null,modalId:t},cl.addOne(n.modals.stack,{id:t,data:{type:gr.Progress}})},progressUpdated(n,e){const t=n.progress;t!=null&&(e.payload.title!=null&&(t.title=e.payload.title),e.payload.inProgress!=null&&(t.inProgress=e.payload.inProgress),e.payload.closable!=null&&(t.closable=e.payload.closable),e.payload.message!=null&&(t.message=e.payload.message))},progressCleared(n){n.progress!=null&&(cl.removeOne(n.modals.stack,n.progress.modalId),n.progress=null)},cameraTypeChanged(n,e){n.view.cameraType=e.payload.type,e.payload.xzFlipped!=null&&(n.view.xzFlipped=e.payload.xzFlipped),e.payload.yzFlipped!=null&&(n.view.yzFlipped=e.payload.yzFlipped),e.payload.xyFlipped!=null&&(n.view.xyFlipped=e.payload.xyFlipped)},setGroundMode(n){n.view.wallMode=!1},setWallMode(n){n.view.wallMode=!0},tempInsertPointSet(n,e){n.temp.insertPoint=tt.vector(e.payload)},tempInsertPointCleared(n){n.temp.insertPoint=null},labelSet(n,e){sp.upsertOne(n.labelOverlay.labels,e.payload)},labelCleared(n,e){sp.removeOne(n.labelOverlay.labels,e.payload)},tempLeoShapeSet(n,e){e.payload.type==Oe.Rectangle?n.temp.leoShape={type:Oe.Rectangle,sizeX:tt.positiveValue(e.payload.sizeX),sizeY:tt.positiveValue(e.payload.sizeY)}:e.payload.type==Oe.Circle?n.temp.leoShape={type:Oe.Circle,diameter:tt.positiveValue(e.payload.diameter)}:He.throw(Xe.UnknownLightEmittingShapeType,"Unknown shape type: "+e.payload.type),n.temp.leoShape=e.payload},tempLeoShapeCleared(n){n.temp.leoShape=null},modalPushed(n,e){const t=n.modals.nextId++;cl.addOne(n.modals.stack,{id:t,data:e.payload})},modalClosed(n,e){cl.removeOne(n.modals.stack,e.payload)},wireframe2dChanged(n,e){n.view.wireframe2D=e.payload},wireframe3dChanged(n,e){n.view.wireframe3D=e.payload},tempJointAxisDataSet(n,e){n.temp.jointAxisData=e.payload},tempJointAxisDataCleared(n){n.temp.jointAxisData=null}}}),Pe=PA.actions;var K1=(n,e)=>{let t=PA.reducer(n==null?void 0:n.runtime,e);return n&&e.type==Te.geometryMeshesAndPartsAdded.type&&(t=Zz(n,e)),t};const Mt=n=>n.runtime,xz=Ne(Mt,n=>n.importMessages),wz=Ne(Mt,n=>n.ui.leftSidebarWidth),_z=Ne(Mt,n=>n.ui.rightSidebarWidth),bz=Ne(Mt,n=>n.temp.position),Sz=Ne(Mt,n=>n.temp.rotation),Mz=Ne(Mt,n=>{var e;return(e=n.temp.insertPoint)!=null?e:{x:0,y:0,z:0}}),Ez=Ne(Mt,n=>n.temp.leoShape),Az=Ne(Mt,n=>n.temp.jointAxisData),Tz=Ne(Mt,n=>n.isTransforming),Cz=Ne(Mt,n=>n.view.lightEmittingObjectsVisible),Pz=Ne(Mt,n=>n.view.jointObjectsVisible),Iz=Ne(Mt,n=>n.view.sensorObjectsVisible),Lz=Ne(Mt,n=>n.view.electricalConnectorObjectsVisible),Rz=Ne(Mt,n=>n.view.pendulumConnectorObjectsVisible),Fz=Ne(Mt,n=>n.messages.overlay.tool),Dz=Ne(Mt,n=>n.dragDrop),Nz=Ne(Mt,n=>n.defaultScaling),kz=Ne(Mt,n=>n.requestedL3DOverride),Oz=Ne(Mt,n=>n.meshSizeWarnings),zz=Ne(Mt,n=>n.progress),Uz=Ne(Mt,n=>n.view.cameraType),Bz=Ne(Mt,n=>n.view.xzFlipped),Hz=Ne(Mt,n=>n.view.yzFlipped),Gz=Ne(Mt,n=>n.view.xyFlipped),Vz=Ne(Mt,n=>n.view.wireframe3D),jz=Ne(Mt,n=>n.view.wireframe2D),Wz=Ne(Mt,n=>n.labelOverlay),Xz=Ne(Mt,n=>wA.selectAll(n.modals.stack)),Yz=n=>Ne(Mt,e=>wA.selectAll(e.modals.stack).find(t=>t.data.type==n)!=null),$z=Ne(Mt,n=>n.view.wallMode),pt={importMessages:xz,ui:{leftSidebarWidth:wz,rightSidebarWidth:_z},temp:{position:bz,rotation:Sz,insertPoint:Mz,leoShape:Ez,jointAxisData:Az},isTransforming:Tz,view:{areJointObjectsVisible:Pz,areLightEmittingObjectsVisible:Cz,areSensorObjectsVisible:Iz,areElectricalConnectorObjectsVisible:Lz,arePendulumConnectorObjectsVisible:Rz,cameraType:Uz,xzFlipped:Bz,yzFlipped:Hz,xyFlipped:Gz,wireframe2d:jz,wireframe3d:Vz,wallMode:$z},dragDrop:Dz,defaultScaling:Nz,messages:{overlay:{tool:Fz}},requestedL3DOverride:kz,meshSizeWarnings:Oz,progress:zz,measurementOverlay:Wz,modal:{isModalOpen:Yz,data:Xz}};function Zz(n,e){const t=e.payload.meshes.length,r=n.luminaire.nextMeshId-t,i=n.luminaire.nextMeshId,s={...n.runtime};for(let a=r;a<i;a++){const o=qt.selectById(n.luminaire.meshes,a);!!o&&Lr.isSizeUnrealistic(o.scaledSize)&&(s.meshSizeWarnings=od.addOne(s.meshSizeWarnings,{id:a}))}return s}const me=oI({reducer:(n,e)=>{if(n==null)return{luminaire:Z1(void 0,e),editor:Q1(void 0,e),history:CA,runtime:K1(void 0,e)};const t={...n,luminaire:Z1(n.luminaire,e)},r={luminaire:t.luminaire,editor:Q1(t,e),history:t.history,runtime:K1(t,e)};return hz(n,r,e)},devTools:!1}),Je=()=>uE(),Ae=C3;const qz="_main_1ws5w_1",Qz="_viewportArea_1ws5w_25";var eb={main:qz,viewportArea:Qz};const Jz="_renderer_y7okj_1";var Kz={renderer:Jz},ut=(n=>(n[n.MouseDown=0]="MouseDown",n[n.MouseMove=1]="MouseMove",n[n.MouseUp=2]="MouseUp",n[n.MouseWheel=3]="MouseWheel",n[n.TouchStart=4]="TouchStart",n[n.TouchMove=5]="TouchMove",n[n.TouchEnd=6]="TouchEnd",n[n.TouchCancel=7]="TouchCancel",n[n.TouchLeave=8]="TouchLeave",n[n.KeyDown=9]="KeyDown",n[n.KeyUp=10]="KeyUp",n[n.ContextMenu=11]="ContextMenu",n))(ut||{}),o0=function(n,e){return o0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},o0(n,e)};function fc(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o0(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function e5(n,e,t,r){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):i(u.value).then(o,l)}c((r=r.apply(n,e||[])).next())})}function IA(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function jl(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ya(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s}function xa(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function Ll(n){return this instanceof Ll?(this.v=n,this):new Ll(n)}function t5(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(d){r[d]&&(i[d]=function(f){return new Promise(function(v,g){s.push([d,f,v,g])>1||o(d,f)})})}function o(d,f){try{l(r[d](f))}catch(v){h(s[0][3],v)}}function l(d){d.value instanceof Ll?Promise.resolve(d.value.v).then(c,u):h(s[0][2],d)}function c(d){o("next",d)}function u(d){o("throw",d)}function h(d,f){d(f),s.shift(),s.length&&o(s[0][0],s[0][1])}}function n5(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof jl=="function"?jl(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(a){return new Promise(function(o,l){a=n[s](a),i(o,l,a.done,a.value)})}}function i(s,a,o,l){Promise.resolve(l).then(function(c){s({value:c,done:o})},a)}}function fn(n){return typeof n=="function"}function LA(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Og=LA(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function l0(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var om=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=jl(a),l=o.next();!l.done;l=o.next()){var c=l.value;c.remove(this)}}catch(g){e={error:g}}finally{try{l&&!l.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if(fn(u))try{u()}catch(g){s=g instanceof Og?g.errors:[g]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var d=jl(h),f=d.next();!f.done;f=d.next()){var v=f.value;try{tb(v)}catch(g){s=s!=null?s:[],g instanceof Og?s=xa(xa([],ya(s)),ya(g.errors)):s.push(g)}}}catch(g){r={error:g}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}}if(s)throw new Og(s)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)tb(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&l0(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&l0(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),RA=om.EMPTY;function FA(n){return n instanceof om||n&&"closed"in n&&fn(n.remove)&&fn(n.add)&&fn(n.unsubscribe)}function tb(n){fn(n)?n():n.unsubscribe()}var gx={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},c0={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=c0.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,xa([n,e],ya(t))):setTimeout.apply(void 0,xa([n,e],ya(t)))},clearTimeout:function(n){var e=c0.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(n)},delegate:void 0};function DA(n){c0.setTimeout(function(){throw n})}function u0(){}var Nh=null;function uf(n){if(gx.useDeprecatedSynchronousErrorHandling){var e=!Nh;if(e&&(Nh={errorThrown:!1,error:null}),n(),e){var t=Nh,r=t.errorThrown,i=t.error;if(Nh=null,r)throw i}}else n()}var vx=function(n){fc(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,FA(t)&&t.add(r)):r.destination=a5,r}return e.create=function(t,r,i){return new d0(t,r,i)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(om),r5=Function.prototype.bind;function zg(n,e){return r5.call(n,e)}var i5=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){kh(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){kh(r)}else kh(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){kh(t)}},n}(),d0=function(n){fc(e,n);function e(t,r,i){var s=n.call(this)||this,a;if(fn(t)||!t)a={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var o;s&&gx.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=function(){return s.unsubscribe()},a={next:t.next&&zg(t.next,o),error:t.error&&zg(t.error,o),complete:t.complete&&zg(t.complete,o)}):a=t}return s.destination=new i5(a),s}return e}(vx);function kh(n){DA(n)}function s5(n){throw n}var a5={closed:!0,next:u0,error:s5,complete:u0},yx=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function lm(n){return n}function o5(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return NA(n)}function NA(n){return n.length===0?lm:n.length===1?n[0]:function(t){return n.reduce(function(r,i){return i(r)},t)}}var ni=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,s=c5(e)?e:new d0(e,t,r);return uf(function(){var a=i,o=a.operator,l=a.source;s.add(o?o.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=nb(t),new t(function(i,s){var a=new d0({next:function(o){try{e(o)}catch(l){s(l),a.unsubscribe()}},error:s,complete:i});r.subscribe(a)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[yx]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return NA(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=nb(e),new e(function(r,i){var s;t.subscribe(function(a){return s=a},function(a){return i(a)},function(){return r(s)})})},n.create=function(e){return new n(e)},n}();function nb(n){var e;return(e=n!=null?n:gx.Promise)!==null&&e!==void 0?e:Promise}function l5(n){return n&&fn(n.next)&&fn(n.error)&&fn(n.complete)}function c5(n){return n&&n instanceof vx||l5(n)&&FA(n)}function u5(n){return fn(n==null?void 0:n.lift)}function Aa(n){return function(e){if(u5(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function mo(n,e,t,r,i){return new d5(n,e,t,r,i)}var d5=function(n){fc(e,n);function e(t,r,i,s,a,o){var l=n.call(this,t)||this;return l.onFinalize=a,l.shouldUnsubscribe=o,l._next=r?function(c){try{r(c)}catch(u){t.error(u)}}:n.prototype._next,l._error=s?function(c){try{s(c)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,l._complete=i?function(){try{i()}catch(c){t.error(c)}finally{this.unsubscribe()}}:n.prototype._complete,l}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(vx),h5=LA(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Mn=function(n){fc(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new rb(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new h5},e.prototype.next=function(t){var r=this;uf(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var a=jl(r.currentObservers),o=a.next();!o.done;o=a.next()){var l=o.value;l.next(t)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;uf(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;uf(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,s=i.hasError,a=i.isStopped,o=i.observers;return s||a?RA:(this.currentObservers=null,o.push(t),new om(function(){r.currentObservers=null,l0(o,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r.thrownError,a=r.isStopped;i?t.error(s):a&&t.complete()},e.prototype.asObservable=function(){var t=new ni;return t.source=this,t},e.create=function(t,r){return new rb(t,r)},e}(ni),rb=function(n){fc(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:RA},e}(Mn),f5=function(n){fc(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,s=t._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(Mn);function p5(n){return n&&fn(n.schedule)}function kA(n){return n[n.length-1]}function OA(n){return fn(kA(n))?n.pop():void 0}function m5(n){return p5(kA(n))?n.pop():void 0}var zA=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function UA(n){return fn(n==null?void 0:n.then)}function BA(n){return fn(n[yx])}function HA(n){return Symbol.asyncIterator&&fn(n==null?void 0:n[Symbol.asyncIterator])}function GA(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function g5(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var VA=g5();function jA(n){return fn(n==null?void 0:n[VA])}function WA(n){return t5(this,arguments,function(){var t,r,i,s;return IA(this,function(a){switch(a.label){case 0:t=n.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,Ll(t.read())];case 3:return r=a.sent(),i=r.value,s=r.done,s?[4,Ll(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,Ll(i)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function XA(n){return fn(n==null?void 0:n.getReader)}function cm(n){if(n instanceof ni)return n;if(n!=null){if(BA(n))return v5(n);if(zA(n))return y5(n);if(UA(n))return x5(n);if(HA(n))return YA(n);if(jA(n))return w5(n);if(XA(n))return _5(n)}throw GA(n)}function v5(n){return new ni(function(e){var t=n[yx]();if(fn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function y5(n){return new ni(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function x5(n){return new ni(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,DA)})}function w5(n){return new ni(function(e){var t,r;try{for(var i=jl(n),s=i.next();!s.done;s=i.next()){var a=s.value;if(e.next(a),e.closed)return}}catch(o){t={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function YA(n){return new ni(function(e){b5(n,e).catch(function(t){return e.error(t)})})}function _5(n){return YA(WA(n))}function b5(n,e){var t,r,i,s;return e5(this,void 0,void 0,function(){var a,o;return IA(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),t=n5(n),l.label=1;case 1:return[4,t.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(a=r.value,e.next(a),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),i={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function ia(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function $A(n,e){return e===void 0&&(e=0),Aa(function(t,r){t.subscribe(mo(r,function(i){return ia(r,n,function(){return r.next(i)},e)},function(){return ia(r,n,function(){return r.complete()},e)},function(i){return ia(r,n,function(){return r.error(i)},e)}))})}function ZA(n,e){return e===void 0&&(e=0),Aa(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function S5(n,e){return cm(n).pipe(ZA(e),$A(e))}function M5(n,e){return cm(n).pipe(ZA(e),$A(e))}function E5(n,e){return new ni(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function A5(n,e){return new ni(function(t){var r;return ia(t,e,function(){r=n[VA](),ia(t,e,function(){var i,s,a;try{i=r.next(),s=i.value,a=i.done}catch(o){t.error(o);return}a?t.complete():t.next(s)},0,!0)}),function(){return fn(r==null?void 0:r.return)&&r.return()}})}function qA(n,e){if(!n)throw new Error("Iterable cannot be null");return new ni(function(t){ia(t,e,function(){var r=n[Symbol.asyncIterator]();ia(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function T5(n,e){return qA(WA(n),e)}function C5(n,e){if(n!=null){if(BA(n))return S5(n,e);if(zA(n))return E5(n,e);if(UA(n))return M5(n,e);if(HA(n))return qA(n,e);if(jA(n))return A5(n,e);if(XA(n))return T5(n,e)}throw GA(n)}function QA(n,e){return e?C5(n,e):cm(n)}function tn(n,e){return Aa(function(t,r){var i=0;t.subscribe(mo(r,function(s){r.next(n.call(e,s,i++))}))})}var P5=Array.isArray;function I5(n,e){return P5(e)?n.apply(void 0,xa([],ya(e))):n(e)}function JA(n){return tn(function(e){return I5(n,e)})}var L5=Array.isArray,R5=Object.getPrototypeOf,F5=Object.prototype,D5=Object.keys;function N5(n){if(n.length===1){var e=n[0];if(L5(e))return{args:e,keys:null};if(k5(e)){var t=D5(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function k5(n){return n&&typeof n=="object"&&R5(n)===F5}function O5(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function z5(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=m5(n),r=OA(n),i=N5(n),s=i.args,a=i.keys;if(s.length===0)return QA([],t);var o=new ni(KA(s,t,a?function(l){return O5(a,l)}:lm));return r?o.pipe(JA(r)):o}function KA(n,e,t){return t===void 0&&(t=lm),function(r){ib(e,function(){for(var i=n.length,s=new Array(i),a=i,o=i,l=function(u){ib(e,function(){var h=QA(n[u],e),d=!1;h.subscribe(mo(r,function(f){s[u]=f,d||(d=!0,o--),o||r.next(t(s.slice()))},function(){--a||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function ib(n,e,t){n?ia(t,n,e):e()}var U5=Array.isArray;function B5(n){return n.length===1&&U5(n[0])?n[0]:n}function sb(n,e){return Aa(function(t,r){var i=0;t.subscribe(mo(r,function(s){return n.call(e,s,i++)&&r.next(s)}))})}function e2(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=OA(n);return t?o5(e2.apply(void 0,xa([],ya(n))),JA(t)):Aa(function(r,i){KA(xa([r],ya(B5(n))))(i)})}function ab(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return e2.apply(void 0,xa([],ya(n)))}function In(n,e){return e===void 0&&(e=lm),n=n!=null?n:H5,Aa(function(t,r){var i,s=!0;t.subscribe(mo(r,function(a){var o=e(a);(s||!n(i,o))&&(s=!1,i=o,r.next(a))}))})}function H5(n,e){return n===e}function an(n){return Aa(function(e,t){cm(n).subscribe(mo(t,function(){return t.complete()},u0)),!t.closed&&e.subscribe(t)})}function G5(n,e){return e===void 0&&(e=!1),Aa(function(t,r){var i=0;t.subscribe(mo(r,function(s){var a=n(s,i++);(a||e)&&r.next(s),!a&&r.complete()}))})}class um{constructor(e,t){P(this,"isDisposed$",new Mn);this.scene=e,this.viewInfo=t}dispose(){this.isDisposed$.next(!0)}needEvent(e,t){switch(e){case ut.MouseDown:return this.needMouseDown(t);case ut.MouseMove:return this.needMouseMove(t);case ut.MouseUp:return this.needMouseUp(t);case ut.MouseWheel:return this.needMouseWheel(t);case ut.TouchStart:return this.needTouchStart(t);case ut.TouchMove:return this.needTouchMove(t);case ut.TouchEnd:return this.needTouchEnd(t);case ut.TouchCancel:return this.needTouchCancel(t);case ut.TouchLeave:return this.needTouchLeave(t);case ut.KeyDown:return this.needKeyDown(t);case ut.KeyUp:return this.needKeyUp(t);case ut.ContextMenu:return this.needContextMenu(t)}throw new Error("Unknown input event type: "+e)}handleEvent(e,t){switch(e){case ut.MouseDown:return this.handleMouseDown(t);case ut.MouseMove:return this.handleMouseMove(t);case ut.MouseUp:return this.handleMouseUp(t);case ut.MouseWheel:return this.handleMouseWheel(t);case ut.TouchStart:return this.handleTouchStart(t);case ut.TouchMove:return this.handleTouchMove(t);case ut.TouchEnd:return this.handleTouchEnd(t);case ut.TouchCancel:return this.handleTouchCancel(t);case ut.TouchLeave:return this.handleTouchLeave(t);case ut.KeyDown:return this.handleKeyDown(t);case ut.KeyUp:return this.handleKeyUp(t);case ut.ContextMenu:return this.handleContextMenu(t)}throw new Error("Unknown input event type: "+e)}needMouseDown(e){return!1}handleMouseDown(e){return!1}needMouseMove(e){return!1}handleMouseMove(e){return!1}needMouseUp(e){return!1}handleMouseUp(e){return!1}needMouseWheel(e){return!1}handleMouseWheel(e){return!1}needTouchStart(e){return!1}handleTouchStart(e){return!1}needTouchEnd(e){return!1}handleTouchEnd(e){return!1}needTouchMove(e){return!1}handleTouchMove(e){return!1}needTouchCancel(e){return!1}handleTouchCancel(e){return!1}needTouchLeave(e){return!1}handleTouchLeave(e){return!1}needKeyDown(e){return!1}handleKeyDown(e){return!1}needKeyUp(e){return!1}handleKeyUp(e){return!1}needContextMenu(e){return!1}handleContextMenu(e){return!1}updateFromCameraInfo(e){}}class V5{constructor(){P(this,"store$",new Mn);P(this,"syncList",new Array);P(this,"isHandlingSyncList",!1);P(this,"luminaire$",this.store$.pipe(tn(e=>e.luminaire),In()));P(this,"editor$",this.store$.pipe(tn(e=>e.editor),In()));P(this,"runtime$",this.store$.pipe(tn(e=>e.runtime),In()));P(this,"editorSelection$",this.editor$.pipe(tn(e=>({tool:e.tool,parts:sn.selectAll(e.selection).map(t=>t.type==Y.Geometry?{type:Y.Geometry,partId:t.id,faceGroups:ei.selectAll(t.faceGroups).map(r=>({groupIndex:r.index,faceIndices:ps.selectAll(r.faceIndices)}))}:{type:t.type,partId:t.id})})),In()));P(this,"editorFixChildren$",this.editor$.pipe(tn(e=>e.fixChildren),In()));P(this,"editorActiveTool$",this.editor$.pipe(tn(e=>e.tool),In()));P(this,"editorSelectedItems$",this.editor$.pipe(tn(e=>sn.selectAll(e.selection)),tn(e=>e.map(t=>{let r;return t.type==Y.Geometry?r={type:Y.Geometry,id:t.id,faceGroups:ei.selectAll(t.faceGroups).map(s=>({index:s.index,faces:Ul.selectAll(s.faceIndices)}))}:t.type==Y.Joint?r={type:Y.Joint,id:t.id,axis:t.axis}:r={type:t.type,id:t.id},r})),In()));P(this,"editorHiddenEntries$",this.editor$.pipe(tn(e=>Qa.selectAll(e.data.hidden).map(t=>t.type==Y.Geometry?{type:Y.Geometry,id:t.id,faceGroupIndices:Ul.selectAll(t.faceGroups)}:{type:null,id:t.id})),In()));P(this,"sceneData$",this.luminaire$.pipe(ab(this.editorSelection$),ab(this.editorHiddenEntries$),In(),tn(e=>{const t=e[0][0],r=e[0][1],i=e[1];return{parts:at.selectAll(t.parts).map(o=>{const l=r.parts.find(u=>u.partId==o.id),c=l!=null;if(o.type==Y.Geometry){if(!!l&&l.type!=Y.Geometry)throw new Error("Mismatched selection for part");const u=l==null?[]:l.faceGroups.map(f=>f.groupIndex),h=i.find(f=>f.id==o.id);if(!!h&&h.type!=Y.Geometry)throw new Error("Mismatched hidden data for part");const d=h==null?[]:h.faceGroupIndices;return{type:Y.Geometry,part:o,isSelected:c,selectedFaceGroups:u,hiddenFaceGroups:d}}return{type:null,part:o,isSelected:c}})}})));P(this,"viewSettings$",this.runtime$.pipe(tn(e=>e.view),In()));P(this,"geometryMeshMaterial$",e=>this.luminaire$.pipe(tn(t=>{const r=qt.selectById(t.meshes,e);return r==null?null:r.material}),sb(t=>t!=null),tn(t=>t),In()));P(this,"tempInsertPoint$",this.runtime$.pipe(tn(e=>e.temp.insertPoint),In()));P(this,"runtimeUi$",this.runtime$.pipe(tn(e=>e.ui),In()));P(this,"dragDropHoverPart$",this.runtime$.pipe(tn(e=>{var t,r;return(r=(t=e.dragDrop)==null?void 0:t.hoverPart)!=null?r:null}),In()));P(this,"parts$",this.luminaire$.pipe(tn(e=>e.parts),In()));P(this,"part$",e=>this.parts$.pipe(tn(t=>{var r;return(r=at.selectById(t,e))!=null?r:null}),G5(t=>t!=null),sb(t=>t!=null),tn(t=>t),In()));P(this,"partTransformation$",e=>this.part$(e).pipe(tn(t=>({position:t.position,rotation:t.rotation})),In()))}handleSyncList(){if(this.isHandlingSyncList)return;this.isHandlingSyncList=!0;let e;for(;e=this.syncList.shift();)this.store$.next(e);this.isHandlingSyncList=!1}next(e){this.syncList.push(e),this.handleSyncList()}}const En=new V5,hi=class{constructor(e){P(this,"frustumSize",2);P(this,"_cameraType");P(this,"_currentCamera");P(this,"camera3D");P(this,"cameraXZ");P(this,"cameraYZ");P(this,"cameraXY");P(this,"isDisposed$",new Mn);P(this,"xzFlipped");P(this,"yzFlipped");P(this,"xyFlipped");this.viewport=e,this.camera3D=this.create3DCamera(),this.cameraXZ=this.createXZCamera(),this.cameraYZ=this.createYZCamera(),this.cameraXY=this.createXYCamera();const t=me.getState().runtime.view;this._cameraType=t.cameraType,this._currentCamera=this.getCurrentCameraByType(this._cameraType),this.xzFlipped=t.xzFlipped,this.yzFlipped=t.yzFlipped,this.xyFlipped=t.xyFlipped,En.viewSettings$.pipe(an(this.isDisposed$)).subscribe(r=>{this._cameraType=r.cameraType,this._currentCamera=this.getCurrentCameraByType(this._cameraType),this.xzFlipped!=r.xzFlipped&&(this.xzFlipped=r.xzFlipped,this.cameraXZ.position.set(this.cameraXZ.position.x,this.xzFlipped?hi.OrthographicCameraDistance:-hi.OrthographicCameraDistance,this.cameraXZ.position.z),this.cameraXZ.updateMatrix(),this.cameraXZ.updateMatrixWorld(),this.cameraXZ.updateProjectionMatrix()),this.yzFlipped!=r.yzFlipped&&(this.yzFlipped=r.yzFlipped,this.cameraYZ.position.set(this.yzFlipped?-hi.OrthographicCameraDistance:hi.OrthographicCameraDistance,this.cameraYZ.position.y,this.cameraYZ.position.z),this.cameraXZ.updateMatrix(),this.cameraXZ.updateMatrixWorld(),this.cameraYZ.updateProjectionMatrix()),this.xyFlipped!=r.xyFlipped&&(this.xyFlipped=r.xyFlipped,this.cameraXY.position.set(this.cameraXY.position.x,this.cameraXY.position.y,this.xyFlipped?-hi.OrthographicCameraDistance:hi.OrthographicCameraDistance),this.cameraXY.up.set(0,1,0),this.cameraXZ.updateMatrix(),this.cameraXZ.updateMatrixWorld(),this.cameraXY.updateProjectionMatrix())})}dispose(){this.isDisposed$.next(!0)}get cameraType(){return this._cameraType}get currentCamera(){return this._currentCamera}create3DCamera(){const e=new rn;return e.position.set(1,-1,1),e.fov=75,e.near=.001,e.far=100,e.aspect=this.viewport.width/this.viewport.height,e.updateProjectionMatrix(),e.layers.enableAll(),e}createXZCamera(){const e=this.viewport.width,t=this.viewport.height,r=e/t,i=new Qn(this.frustumSize*r/-2,this.frustumSize*r/2,this.frustumSize/2,this.frustumSize/-2,1,1e3);return i.position.set(0,-hi.OrthographicCameraDistance,0),i.near=.001,i.far=100,i.updateProjectionMatrix(),i.layers.enableAll(),i}createYZCamera(){const e=this.viewport.width,t=this.viewport.height,r=e/t,i=new Qn(this.frustumSize*r/-2,this.frustumSize*r/2,this.frustumSize/2,this.frustumSize/-2,1,1e3);return i.position.set(hi.OrthographicCameraDistance,0,0),i.near=.001,i.far=100,i.updateProjectionMatrix(),i.layers.enableAll(),i}createXYCamera(){const e=this.viewport.width,t=this.viewport.height,r=e/t,i=new Qn(this.frustumSize*r/-2,this.frustumSize*r/2,this.frustumSize/2,this.frustumSize/-2,1,1e3);return i.position.set(0,0,hi.OrthographicCameraDistance),i.near=.001,i.far=100,i.updateProjectionMatrix(),i.layers.enableAll(),i}getCurrentCameraByType(e){return e==$e.XZ?this.cameraXZ:e==$e.YZ?this.cameraYZ:e==$e.XY?this.cameraXY:this.camera3D}resize(){const e=this.viewport.width,t=this.viewport.height,r=e/t,i=this.frustumSize*r/-2,s=this.frustumSize*r/2,a=this.frustumSize/2,o=this.frustumSize/-2;this.camera3D.aspect=e/t,this.camera3D.updateProjectionMatrix(),this.cameraXZ.left=i,this.cameraXZ.right=s,this.cameraXZ.top=a,this.cameraXZ.bottom=o,this.cameraXZ.updateProjectionMatrix(),this.cameraYZ.left=i,this.cameraYZ.right=s,this.cameraYZ.top=a,this.cameraYZ.bottom=o,this.cameraYZ.updateProjectionMatrix(),this.cameraXY.left=i,this.cameraXY.right=s,this.cameraXY.top=a,this.cameraXY.bottom=o,this.cameraXY.updateProjectionMatrix()}};let zi=hi;P(zi,"OrthographicCameraDistance",50);class Oh extends Ma{constructor(t,r){super();P(this,"enabled",!0);P(this,"target",new L);P(this,"minDistance",0);P(this,"maxDistance",1/0);P(this,"minZoom",0);P(this,"maxZoom",1/0);P(this,"minPolarAngle",0);P(this,"maxPolarAngle",Math.PI);P(this,"minAzimuthAngle",-1/0);P(this,"maxAzimuthAngle",1/0);P(this,"enableDamping",!1);P(this,"dampingFactor",.05);P(this,"enableZoom",!0);P(this,"zoomSpeed",1);P(this,"enableRotate",!0);P(this,"rotateSpeed",1);P(this,"enablePan",!0);P(this,"panSpeed",1);P(this,"screenSpacePanning",!1);P(this,"keyPanSpeed",7);P(this,"autoRotate",!1);P(this,"autoRotateSpeed",2);P(this,"enableKeys",!0);P(this,"keys",{LEFT:37,UP:38,RIGHT:39,BOTTOM:40});P(this,"mouseButtons",{LEFT:wo.ROTATE,MIDDLE:wo.PAN,RIGHT:wo.DOLLY});P(this,"touches",{ONE:_o.ROTATE,TWO:_o.DOLLY_PAN});P(this,"target0");P(this,"position0");P(this,"zoom0");P(this,"changeEvent",{type:"change"});P(this,"startEvent",{type:"start"});P(this,"endEvent",{type:"end"});P(this,"STATE",{NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6});P(this,"state",this.STATE.NONE);P(this,"EPS",1e-6);P(this,"spherical",new j1);P(this,"sphericalDelta",new j1);P(this,"scale",1);P(this,"panOffset",new L);P(this,"zoomChanged",!1);P(this,"rotateStart",new oe);P(this,"rotateEnd",new oe);P(this,"rotateDelta",new oe);P(this,"panStart",new oe);P(this,"panEnd",new oe);P(this,"panDelta",new oe);P(this,"dollyStart",new oe);P(this,"dollyEnd",new oe);P(this,"dollyDelta",new oe);P(this,"offset",new L);P(this,"quat");P(this,"quatInverse");P(this,"lastPosition",new L);P(this,"lastQuaternion",new qe);P(this,"camera");P(this,"viewport");switch(this.cameraType=t,t){case $e.XZ:this.camera=r.cameraSystem.cameraXZ;break;case $e.YZ:this.camera=r.cameraSystem.cameraYZ;break;case $e.XY:this.camera=r.cameraSystem.cameraXY;break;default:this.camera=r.cameraSystem.camera3D;break}this.viewport=r.viewport,this.quat=new qe().setFromUnitVectors(this.camera.up,new L(0,1,0)),this.quatInverse=this.quat.clone().invert(),this.target0=this.target.clone(),this.position0=this.camera.position.clone(),this.zoom0=this.camera.zoom,this.update()}isActive(){return this.state!=this.STATE.NONE}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}reset(t){switch(this.target.copy(this.target0),this.cameraType){case $e.XZ:this.camera.position.set(this.position0.x,t.xzFlipped?zi.OrthographicCameraDistance:-zi.OrthographicCameraDistance,this.position0.z);break;case $e.YZ:this.camera.position.set(t.yzFlipped?-zi.OrthographicCameraDistance:zi.OrthographicCameraDistance,this.position0.y,this.position0.z);break;case $e.XY:this.camera.position.set(this.position0.x,this.position0.y,t.xyFlipped?-zi.OrthographicCameraDistance:zi.OrthographicCameraDistance);break;default:this.camera.position.copy(this.position0);break}this.camera.zoom=this.zoom0,this.camera.updateProjectionMatrix(),this.dispatchEvent(this.changeEvent),this.update()}update(){var t=this.camera.position;return this.offset.copy(t).sub(this.target),this.offset.applyQuaternion(this.quat),this.spherical.setFromVector3(this.offset),this.autoRotate&&this.state===this.STATE.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.enableDamping?(this.spherical.theta+=this.sphericalDelta.theta*this.dampingFactor,this.spherical.phi+=this.sphericalDelta.phi*this.dampingFactor):(this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi),this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.enableDamping===!0?this.target.addScaledVector(this.panOffset,this.dampingFactor):this.target.add(this.panOffset),this.offset.setFromSpherical(this.spherical),this.offset.applyQuaternion(this.quatInverse),t.copy(this.target).add(this.offset),this.camera.lookAt(this.target),this.camera.lookAt(this.target),this.enableDamping===!0?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor,this.panOffset.multiplyScalar(1-this.dampingFactor)):(this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0)),this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.camera.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.camera.quaternion))>this.EPS?(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.camera.position),this.lastQuaternion.copy(this.camera.quaternion),this.zoomChanged=!1,!0):!1}dispose(){}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(t){this.sphericalDelta.theta-=t}rotateUp(t){this.sphericalDelta.phi-=t}panLeft(t,r){var i=new L;i.setFromMatrixColumn(r,0),i.multiplyScalar(-t),this.panOffset.add(i)}panUp(t,r){var i=new L;this.screenSpacePanning===!0?i.setFromMatrixColumn(r,1):(i.setFromMatrixColumn(r,0),i.crossVectors(this.camera.up,i)),i.multiplyScalar(t),this.panOffset.add(i)}pan(t,r){var i=new L,s=this.viewport;const a=this.camera;if(a instanceof rn){var o=a.position;i.copy(o).sub(this.target);var l=i.length();l*=Math.tan(a.fov/2*Math.PI/180),this.panLeft(2*t*l/s.height,a.matrix),this.panUp(2*r*l/s.height,a.matrix)}else a instanceof Qn&&(this.panLeft(t*(a.right-a.left)/a.zoom/s.width,a.matrix),this.panUp(r*(a.top-a.bottom)/a.zoom/s.height,a.matrix))}dollyIn(t){const r=this.camera;r instanceof rn?this.scale/=t:r instanceof Qn&&(r.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,r.zoom*t)),r.updateProjectionMatrix(),this.zoomChanged=!0)}dollyOut(t){const r=this.camera;r instanceof rn?this.scale*=t:r instanceof Qn&&(r.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,r.zoom/t)),r.updateProjectionMatrix(),this.zoomChanged=!0)}handleMouseDownRotate(t){this.rotateStart.set(t.clientX,t.clientY)}handleMouseDownDolly(t){this.dollyStart.set(t.clientX,t.clientY)}handleMouseDownPan(t){this.panStart.set(t.clientX,t.clientY)}handleMouseMoveRotate(t){this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);var r=this.viewport;this.rotateLeft(2*Math.PI*this.rotateDelta.x/r.height),this.rotateUp(2*Math.PI*this.rotateDelta.y/r.height),this.rotateStart.copy(this.rotateEnd),this.update()}handleMouseMoveDolly(t){this.dollyEnd.set(t.clientX,t.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyIn(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyOut(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(t){this.panEnd.set(t.clientX,t.clientY),this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.update()}handleMouseUp(t){}handleMouseWheel(t){t.deltaY<0?this.dollyOut(this.getZoomScale()):t.deltaY>0&&this.dollyIn(this.getZoomScale()),this.update()}handleKeyDown(t){var r=!1;switch(t.keyCode){case this.keys.UP:this.pan(0,this.keyPanSpeed),r=!0;break;case this.keys.BOTTOM:this.pan(0,-this.keyPanSpeed),r=!0;break;case this.keys.LEFT:this.pan(this.keyPanSpeed,0),r=!0;break;case this.keys.RIGHT:this.pan(-this.keyPanSpeed,0),r=!0;break}r&&(t.preventDefault(),this.update())}handleTouchStartRotate(t){if(t.touches.length==1)this.rotateStart.set(t.touches[0].pageX,t.touches[0].pageY);else{var r=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);this.rotateStart.set(r,i)}}handleTouchStartPan(t){if(t.touches.length==1)this.panStart.set(t.touches[0].pageX,t.touches[0].pageY);else{var r=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);this.panStart.set(r,i)}}handleTouchStartDolly(t){var r=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(r*r+i*i);this.dollyStart.set(0,s)}handleTouchStartDollyPan(t){this.enableZoom&&this.handleTouchStartDolly(t),this.enablePan&&this.handleTouchStartPan(t)}handleTouchStartDollyRotate(t){this.enableZoom&&this.handleTouchStartDolly(t),this.enableRotate&&this.handleTouchStartRotate(t)}handleTouchMoveRotate(t){if(t.touches.length==1)this.rotateEnd.set(t.touches[0].pageX,t.touches[0].pageY);else{var r=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);this.rotateEnd.set(r,i)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);var s=this.viewport;this.rotateLeft(2*Math.PI*this.rotateDelta.x/s.height),this.rotateUp(2*Math.PI*this.rotateDelta.y/s.height),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(t){if(t.touches.length==1)this.panEnd.set(t.touches[0].pageX,t.touches[0].pageY);else{var r=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);this.panEnd.set(r,i)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(t){var r=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(r*r+i*i);this.dollyEnd.set(0,s),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyIn(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(t){this.enableZoom&&this.handleTouchMoveDolly(t),this.enablePan&&this.handleTouchMovePan(t)}handleTouchMoveDollyRotate(t){this.enableZoom&&this.handleTouchMoveDolly(t),this.enableRotate&&this.handleTouchMoveRotate(t)}handleTouchEnd(t){}onMouseDown(t){if(this.enabled!==!1){t.preventDefault();var r;switch(t.button){case 0:r=this.mouseButtons.LEFT;break;case 1:r=this.mouseButtons.MIDDLE;break;case 2:r=this.mouseButtons.RIGHT;break;default:r=-1}switch(r){case wo.DOLLY:if(this.enableZoom===!1)return;this.handleMouseDownDolly(t),this.state=this.STATE.DOLLY;break;case wo.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(t),this.state=this.STATE.PAN}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(t),this.state=this.STATE.ROTATE}break;case wo.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(t),this.state=this.STATE.ROTATE}else{if(this.enablePan===!1)return;this.handleMouseDownPan(t),this.state=this.STATE.PAN}break;default:this.state=this.STATE.NONE}this.state!==this.STATE.NONE&&this.dispatchEvent(this.startEvent)}}onMouseMove(t){if(this.enabled!==!1)switch(t.preventDefault(),this.state){case this.STATE.ROTATE:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(t);break;case this.STATE.DOLLY:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(t);break;case this.STATE.PAN:if(this.enablePan===!1)return;this.handleMouseMovePan(t);break}}onMouseUp(t){this.enabled!==!1&&(this.handleMouseUp(t),this.dispatchEvent(this.endEvent),this.state=this.STATE.NONE)}onMouseWheel(t){this.enabled===!1||this.enableZoom===!1||this.state!==this.STATE.NONE&&this.state!==this.STATE.ROTATE||(t.preventDefault(),t.stopPropagation(),this.dispatchEvent(this.startEvent),this.handleMouseWheel(t),this.dispatchEvent(this.endEvent))}onKeyDown(t){this.enabled===!1||this.enableKeys===!1||this.enablePan===!1||this.handleKeyDown(t)}onTouchStart(t){if(this.enabled!==!1){switch(t.preventDefault(),t.touches.length){case 1:switch(this.touches.ONE){case _o.ROTATE:if(this.enableRotate===!1)return;this.handleTouchStartRotate(t),this.state=this.STATE.TOUCH_ROTATE;break;case _o.PAN:if(this.enablePan===!1)return;this.handleTouchStartPan(t),this.state=this.STATE.TOUCH_PAN;break;default:this.state=this.STATE.NONE}break;case 2:switch(this.touches.TWO){case _o.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(t),this.state=this.STATE.TOUCH_DOLLY_PAN;break;case _o.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(t),this.state=this.STATE.TOUCH_DOLLY_ROTATE;break;default:this.state=this.STATE.NONE}break;default:this.state=this.STATE.NONE}this.state!==this.STATE.NONE&&this.dispatchEvent(this.startEvent)}}onTouchMove(t){if(this.enabled!==!1)switch(t.preventDefault(),t.stopPropagation(),this.state){case this.STATE.TOUCH_ROTATE:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(t),this.update();break;case this.STATE.TOUCH_PAN:if(this.enablePan===!1)return;this.handleTouchMovePan(t),this.update();break;case this.STATE.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(t),this.update();break;case this.STATE.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(t),this.update();break;default:this.state=this.STATE.NONE}}onTouchEnd(t){this.enabled!==!1&&(this.handleTouchEnd(t),this.dispatchEvent(this.endEvent),this.state=this.STATE.NONE)}onContextMenu(t){this.enabled!==!1&&t.preventDefault()}}class j5{constructor(){P(this,"cameraInfo$",new Mn);P(this,"_cameraInfo",null);P(this,"currentRenderState",{pointCount:0,lineCount:0,triangleCount:0,callCount:0});P(this,"renderState$");this.renderState$=new f5(this.currentRenderState)}get cameraInfo(){return this._cameraInfo}updateCameraInfo(e){this._cameraInfo={...e},this.cameraInfo$.next(this._cameraInfo)}updateRenderState(e){(e.pointCount!=this.currentRenderState.pointCount||e.lineCount!=this.currentRenderState.lineCount||e.triangleCount!=this.currentRenderState.triangleCount||e.callCount!=this.currentRenderState.callCount)&&(this.currentRenderState.pointCount=e.pointCount,this.currentRenderState.lineCount=e.lineCount,this.currentRenderState.triangleCount=e.triangleCount,this.currentRenderState.callCount=e.callCount,this.renderState$.next(this.currentRenderState))}}const Dr=new j5;class W5{constructor(){P(this,"wireframeMaterial",new Gn({color:0}))}createWireframe(e){const t=new nt,r=new Array,i=e.getAttribute("position"),s=e.getAttribute("normal");return e.polygons.forEach(a=>{const o=a.loopIndices.length;for(let l=0;l<o;l++){const c=a.loopIndices[l],u=a.loopIndices[(l+1)%o],h=new L(s.getX(c),s.getY(c),s.getZ(c)).normalize().multiplyScalar(1e-4),d=new L(s.getX(u),s.getY(u),s.getZ(u)).normalize().multiplyScalar(1e-4);r.push(new L(i.getX(c),i.getY(c),i.getZ(c)).add(h)),r.push(new L(i.getX(u),i.getY(u),i.getZ(u)).add(d))}}),t.setFromPoints(r),new ys(t,this.wireframeMaterial)}}const X5=new W5;class Y5{constructor(){P(this,"objectCache",new Map);P(this,"cleared$",new Mn);P(this,"resetCamera$",new Mn)}addData(e,t){if(!this.objectCache.has(e)){const r=this.createWireframeGroup(t);this.objectCache.set(e,{group:t,wireframeGroup:r,materialLibraries:[],materials:new Map})}return this.objectCache.get(e)}hasData(e){return this.objectCache.has(e)}getData(e){const t=this.objectCache.get(e);if(t==null)throw new Error("Unknown cached object url: "+e);return t}clear(){this.objectCache.forEach((e,t)=>URL.revokeObjectURL(t)),this.objectCache.clear(),this.cleared$.next(),this.resetCamera()}resetCamera(){this.resetCamera$.next()}createWireframeGroup(e){const t=new bi;return e.children.forEach(r=>{if(!(r instanceof be))throw new Error("Imported child has to be of type Mesh!");t.add(X5.createWireframe(r.geometry))}),t}}const Xt=new Y5;class Wl{static getPickPosition(e,t){const r=t.rect,i={x:e.clientX-r.left,y:e.clientY-r.top};return new oe(i.x/r.width*2-1,i.y/r.height*-2+1)}}class De{}P(De,"Static",0),P(De,"GeometryLayer",1),P(De,"JointLayer",2),P(De,"LightEmittingObjectLayer",3),P(De,"SensorLayer",4),P(De,"PendulumConnectorLayer",5),P(De,"ElectricalConnectorLayer",6),P(De,"SelectedWireframeLayer",26),P(De,"SelectedLayer",27),P(De,"WireframeLayer",28),P(De,"ToolLayer",29),P(De,"DraggerLayer",30),P(De,"NotHighlightedLayer",31);class $5 extends um{constructor(t,r){super(t,r);P(this,"cameraChangeHandler");P(this,"clickPos",null);P(this,"cameraControl3D");P(this,"cameraControlXZ");P(this,"cameraControlYZ");P(this,"cameraControlXY");P(this,"_cameraControl");this.cameraControl3D=new Oh($e.Pers,r),this.cameraControl3D.enableDamping=!0,this.cameraControl3D.dampingFactor=.25,this.cameraControl3D.screenSpacePanning=!0,this.cameraControlXZ=new Oh($e.XZ,r),this.cameraControlXZ.enableDamping=!0,this.cameraControlXZ.dampingFactor=.25,this.cameraControlXZ.screenSpacePanning=!0,this.cameraControlXZ.enableRotate=!1,this.cameraControlYZ=new Oh($e.YZ,r),this.cameraControlYZ.enableDamping=!0,this.cameraControlYZ.dampingFactor=.25,this.cameraControlYZ.screenSpacePanning=!0,this.cameraControlYZ.enableRotate=!1,this.cameraControlXY=new Oh($e.XY,r),this.cameraControlXY.enableDamping=!0,this.cameraControlXY.dampingFactor=.25,this.cameraControlXY.screenSpacePanning=!0,this.cameraControlXY.enableRotate=!1,this._cameraControl=this.getCameraControlByType(r.cameraSystem.cameraType),this.cameraChangeHandler=()=>{this.onCameraUpdated()},this.cameraChangeHandler(),Xt.resetCamera$.pipe(an(this.isDisposed$)).subscribe(()=>this.cameraControl.reset(me.getState().runtime.view)),En.viewSettings$.pipe(an(this.isDisposed$)).subscribe(i=>{this._cameraControl=this.getCameraControlByType(i.cameraType),this._cameraControl.update(),this.onCameraUpdated()}),this.cameraControl3D.addEventListener("change",this.cameraChangeHandler),this.cameraControlXZ.addEventListener("change",this.cameraChangeHandler),this.cameraControlYZ.addEventListener("change",this.cameraChangeHandler),this.cameraControlXY.addEventListener("change",this.cameraChangeHandler)}getCameraControlByType(t){switch(t){case $e.XZ:return this.cameraControlXZ;case $e.YZ:return this.cameraControlYZ;case $e.XY:return this.cameraControlXY}return this.cameraControl3D}get cameraControl(){return this._cameraControl}update(){this.cameraControl.update()}onCameraUpdated(){this.cameraControl.cameraType==$e.Pers?Dr.updateCameraInfo({type:$e.Pers,position:this.cameraControl.camera.position,target:this.cameraControl.target}):Dr.updateCameraInfo({type:this.cameraControl.cameraType,zoom:this.cameraControl.camera.zoom})}needMouseDown(t){return!t.isHandled}handleMouseDown(t){const r=t.event;return this.cameraControl.onMouseDown(r),r.button==1&&r.ctrlKey&&(this.clickPos=new oe(r.x,r.y)),!1}needMouseMove(t){return!t.isHandled&&this.cameraControl.isActive()}handleMouseMove(t){const r=t.event;return this.cameraControl.onMouseMove(r),!1}needMouseUp(t){return!t.isHandled&&this.cameraControl.isActive()}handleMouseUp(t){const r=t.event;if(this.cameraControl.onMouseUp(r),this.clickPos!=null){if(new oe(r.x,r.y).distanceTo(this.clickPos)<5){const s=Wl.getPickPosition(r,this.viewInfo.viewport),a=new va;a.setFromCamera(s,this.cameraControl.camera),a.layers.disableAll(),a.layers.enable(De.GeometryLayer);const o=a.intersectObjects(this.scene.children,!0);o&&o.length&&(this.cameraControl.target=o[0].point)}this.clickPos=null}return!1}needMouseWheel(t){return!t.isHandled}handleMouseWheel(t){const r=t.event;return this.cameraControl.onMouseWheel(r),!1}dispose(){super.dispose(),this.cameraControl3D.removeEventListener("change",this.cameraChangeHandler),this.cameraControlXZ.removeEventListener("change",this.cameraChangeHandler),this.cameraControlYZ.removeEventListener("change",this.cameraChangeHandler),this.cameraControlXY.removeEventListener("change",this.cameraChangeHandler)}}class ob{static arrayEquals(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0}}class _s extends be{constructor(t,r){super(t,r);P(this,"isSceneMesh",!0);this.layers.disableAll(),this.layers.enable(De.GeometryLayer)}}class wa extends _s{constructor(t,r,i){super(r,i);P(this,"isGroupMesh",!0);P(this,"sceneVisibility",!0);P(this,"originalGroups");this.groupIndex=t,this.geometry.groups.length||this.geometry.addGroup(0,1/0),this.originalGroups=r.groups.slice()}resetFaces(){this.geometry.groups=this.originalGroups.slice()}reduceFacesTo(t){this.geometry.clearGroups();for(let r=0;r<this.geometry.polygons.length;r++){const i=this.geometry.polygons[r];if(t.includes(r)){const s=i.firstVertexIndex,a=i.lastVertexIndex-i.firstVertexIndex+1;this.geometry.addGroup(s,a)}}}clearGroups(){this.geometry.clearGroups()}addGroups(t,r){t.forEach(i=>this.geometry.addGroup(i.start,i.count,r))}setSceneVisibility(t){this.sceneVisibility=t,this.visible=t}restoreSceneVisibility(){this.visible=this.sceneVisibility}}class sa{static getPolygonIndexFromTriangleIndex(e,t){return e.triangleMapping.get(t)}static getPolygonNormalFromTriangleIndex(e,t){const r=sa.getPolygonIndexFromTriangleIndex(e,t);return this.getPolygonNormal(e,r)}static getPolygonVerticesFromTriengleIndex(e,t){const r=sa.getPolygonIndexFromTriangleIndex(e,t),i=new Array;return sa.visitPolygonVertices(e,r,(s,a)=>{i.push({position:s,normal:a})}),i}static getPolygonNormal(e,t){const r=e.getAttribute("normal"),i=e.polygons[t],s=new L(0,0,0),a=i.loopIndices.length;for(let o=0;o<a;o++){const l=i.loopIndices[o],c=new L(r.getX(l),r.getY(l),r.getZ(l));s.add(c)}return s.normalize()}static visitPolygonVertices(e,t,r){const i=e.getAttribute("position"),s=e.getAttribute("normal"),a=e.polygons[t],o=a.loopIndices.length;let l=0;for(let c=0;c<o;c++){const u=a.loopIndices[c],h=new L(s.getX(u),s.getY(u),s.getZ(u)),d=new L(i.getX(u),i.getY(u),i.getZ(u));r(d,h),l++}return l}}class Z5 extends ot{constructor(){super();P(this,"isSceneObject",!0);P(this,"isDisposed$",new Mn);this.layers.disableAll(),this.layers.enable(De.GeometryLayer),this.rotation.order="ZXY",He.debug("creating SceneObject: "+this.uuid)}dispose(){He.debug("dispose SceneObject: "+this.uuid),this.isDisposed$.next(!0)}}class Vn extends Z5{constructor(t,r){super();P(this,"_partChildren",new bi);P(this,"_visualChildren",new bi);P(this,"_wireframeChildren",new bi);P(this,"isPartObject",!0);this.partType=t,this.partId=r,super.add(this._partChildren),super.add(this._visualChildren),super.add(this._wireframeChildren)}get partGroup(){return this._partChildren}get visualGroup(){return this._visualChildren}get parts(){return this._partChildren.children.map(t=>t)}addPart(t){this._partChildren.add(t)}removePart(t){this._partChildren.remove(t)}get visuals(){return this._visualChildren.children}addVisual(t){this._visualChildren.add(t)}removeVisual(t){this._visualChildren.remove(t)}get wireframe(){return this._wireframeChildren.children}addWireframe(t){this._wireframeChildren.add(t)}removeWireframe(t){this._wireframeChildren.remove(t)}add(t){return He.warn(Xe.PartObjectAddUsed,"PartObject: Please use the addPart/addVisual method for adding children!"),super.add(t)}remove(t){return He.warn(Xe.PartObjectRemoveUsed,"PartObject: Please use the removePart/removeVisual method for removing children!"),super.remove(t)}static get(t){if(t==null)throw Error("'mesh' argument must not be null!");if(t.parent==null)throw Error("'SceneMesh' must have a parent!");let r=t.parent;for(;r;){if(r instanceof Vn)return r;r=r.parent}throw Error("'SceneMesh' is not in a hierarchy with a 'SceneObject' ancestor!")}findPartRecursive(t){if(this.partId==t)return this;for(let r=0;r<this.parts.length;r++){const s=this.parts[r].findPartRecursive(t);if(s)return s}return null}update(t){const r=t.parts.find(i=>i.part.id==this.partId);if(!r)throw Error("No data for part-id ("+this.partId+") found!");this.onUpdate(r)}updateFromCameraInfo(t){}traverseParts(t){t(this),this.parts.forEach(r=>r.traverseParts(t))}onUpdate(t){const r=t.part;this.position.set(r.position.x,r.position.y,r.position.z),this.rotation.set(st.degToRad(r.rotation.x),st.degToRad(r.rotation.y),st.degToRad(r.rotation.z)),this.scale.set(1,1,1)}}var df=(n=>(n[n.None=0]="None",n[n.Click=1]="Click",n[n.ClickThrough=2]="ClickThrough",n[n.PartsOnly=4]="PartsOnly",n))(df||{});class t2{constructor(e,t){P(this,"startPos",null);P(this,"lastSelectedKeys",new Array);P(this,"nextIndex",0);P(this,"layers",new ac);this.viewInfo=e,this.scene=t}updateFromSettings(e){this.layers.disableAll(),this.layers.enable(De.GeometryLayer),e.jointObjectsVisible&&this.layers.enable(De.JointLayer),e.lightEmittingObjectsVisible&&this.layers.enable(De.LightEmittingObjectLayer),e.sensorObjectsVisible&&this.layers.enable(De.SensorLayer),e.pendulumConnectorObjectsVisible&&this.layers.enable(De.PendulumConnectorLayer),e.electricalConnectorObjectsVisible&&this.layers.enable(De.ElectricalConnectorLayer)}start(e){const t=e.event;this.startPos=new oe(t.x,t.y);const r=this.pick(Wl.getPickPosition(t,this.viewInfo.viewport),this.layers.mask);return this.getPickedParts(r,0).length!=0}createGeomKey(e,t){return t.length?`geom_${e}_g_${t.map(r=>`${r}`).join("_")}`:`geom_${e}`}createJointKey(e,t){return`joint_${e}${t==xt.X?"_X":t==xt.Y?"_Y":t==xt.Z?"_Z":""}`}createCommonKey(e){return`part_${e}`}createKey(e){return e.type==Y.Geometry?this.createGeomKey(e.id,e.faceGroups.map(t=>t.index)):e.type==Y.Joint?this.createJointKey(e.id,e.axis):this.createCommonKey(e.id)}checkSelection(e,t){var d;const r=(d=t==null?void 0:t.mode)!=null?d:0;if(this.startPos==null)return!1;const i=e.event,s=new oe(i.x,i.y);if(r&1&&this.startPos.distanceTo(s)>3)return!1;const a=bt.selection(me.getState()),o=a.map(f=>this.createKey(f)),l=this.pick(Wl.getPickPosition(i,this.viewInfo.viewport),this.layers.mask),c=this.getPickedParts(l,r),u=(r&2)==2?this.getNextPickedPart(c):c.length?c[0]:null;if(!u)return(t==null?void 0:t.partSelectionCallback)&&r&1&&a.length&&t.partSelectionCallback([]),this.startPos=null,(r&1)==1;const h=[u.key];if((t==null?void 0:t.partSelectionCallback)&&!ob.arrayEquals(o,h))t.partSelectionCallback([u]);else if((t==null?void 0:t.faceSelectionCallback)&&u.type==Y.Geometry){const f=u.mesh,v=a.find(p=>p.id==u.part.partId);if(v==null||v.type!=Y.Geometry||!(f instanceof wa))return!0;const g=f.groupIndex,y=sa.getPolygonIndexFromTriangleIndex(f.geometry,u.faceIndex);t.faceSelectionCallback(v.id,g,y)}return r&1&&this.end(),!0}end(){this.startPos=null}getPickedParts(e,t){if(!e.length)return[];const r=new Array;e.forEach(o=>{if(!(o.object instanceof _s)||o.face==null)return;const l=o.object,c=Vn.get(l),u=o.faceIndex;let h;if(c.partType==Y.Geometry){const d=l;h={key:this.createGeomKey(c.partId,[d.groupIndex]),type:Y.Geometry,part:c,mesh:d,faceIndex:u!=null?u:-1}}else if(c.partType==Y.Joint){const d=l;h={key:this.createJointKey(c.partId,d.axis),type:Y.Joint,part:c,mesh:d,axis:d.axis}}else{const d=this.createCommonKey(c.partId);h={type:null,key:d,part:c,mesh:l}}r.find(d=>d.key==h.key)||r.push(h)});const i=bt.hiddenItems(me.getState()),s=r.filter(o=>{const l=i.find(c=>c.id==o.part.partId);return l?!(l.type!=Y.Geometry||!(o.mesh instanceof wa)||l.faceGroups.includes(o.mesh.groupIndex)):!0});if((t&4)!=4)return s;var a=s.filter((o,l,c)=>c.findIndex(u=>u.part==o.part)==l);return a}getNextPickedPart(e){const t=this.lastSelectedKeys,r=this.lastSelectedKeys=e.map(l=>l.key);if(!e.length)return null;const i=Array.from(t).sort(),s=Array.from(r).sort();let a=0;if(ob.arrayEquals(i,s))a=this.nextIndex++;else if(t.length>0){const l=vt.modulo(this.nextIndex-1,t.length),c=t[l],u=r.findIndex(h=>h==c);u>=0&&(a=vt.modulo(u+1,r.length))}return this.nextIndex=vt.modulo(a+1,r.length),e[a]}pick(e,t){const r=new va;return r.setFromCamera(e,this.viewInfo.cameraSystem.currentCamera),t!=null&&(r.layers.mask=t),r.intersectObjects(this.scene.children,!0)}}class q5 extends um{constructor(t,r){super(t,r);P(this,"selectHandler");this.selectHandler=new t2(r,t),En.viewSettings$.pipe(an(this.isDisposed$)).subscribe(i=>this.selectHandler.updateFromSettings(i))}needMouseDown(t){const r=t.event;return r.buttons==1||r.buttons==2}handleMouseDown(t){return t.isHandled||t.hasPreventSelect?!1:this.selectHandler.start(t)}needMouseUp(t){return!0}handleMouseUp(t){return this.selectHandler.checkSelection(t,{mode:df.Click|df.PartsOnly|df.ClickThrough,partSelectionCallback:r=>{if(!r.length){me.dispatch(je.partSelectionCleared());return}const i=r[0];i.type==Y.Joint?me.dispatch(je.jointPartSelected({id:i.part.partId,axis:i.axis})):me.dispatch(je.partsSelected([i.part.partId]))}})}}class Q5{constructor(e,t){P(this,"_isHandled",!1);P(this,"_preventSelect",!1);this.eventType=e,this.event=t}get isHandled(){return this._isHandled}setHandled(){this._isHandled=!0}get hasPreventSelect(){return this._preventSelect}preventSelect(){this._preventSelect=!0}}var Ar=(n=>(n[n.None=0]="None",n[n.Move=1]="Move",n[n.Rotate=2]="Rotate",n))(Ar||{});class pc extends um{onUpdateSelectedItems(e){}onDataUpdate(e){}updateSelectedItems(e){this.onUpdateSelectedItems(e)}updateData(e){this.onDataUpdate(e)}needKeyDown(e){return e.event.key=="Escape"}handleKeyDown(e){return e.event.key=="Escape"?(me.dispatch(je.toolDataSet({type:Le.None})),!0):!1}}const xx={side:Un,transparent:!0,opacity:.2,polygonOffset:!0,polygonOffsetFactor:-.3},wx={},J5=new Pt({...xx,color:16711680,depthWrite:!1}),K5=new Gn({...wx,color:16711680}),eU=new Pt({...xx,color:65280,depthWrite:!1}),tU=new Gn({...wx,color:65280}),nU=new Pt({...xx,color:255,depthWrite:!1}),rU=new Gn({...wx,color:255});class Ug extends _s{constructor(e,t,r){super(new nt,r),this.joint=e,this.axis=t}update(e,t){var r;(r=this.geometry)==null||r.dispose(),this.geometry=new Jy(Si.ArcSize,32,st.degToRad(e.min),st.degToRad(e.max-e.min)),this.setRotationFromQuaternion(t),e.isRotatable?this.joint.visuals.includes(this)||this.joint.addVisual(this):this.joint.visuals.includes(this)&&this.joint.removeVisual(this)}}class Bg extends gn{constructor(e,t,r,i){super(new nt().setFromPoints(r),i),this.joint=e,this.axis=t}update(e,t){this.setRotationFromQuaternion(t),e.isRotatable?this.joint.visuals.includes(this)||this.joint.addVisual(this):this.joint.visuals.includes(this)&&this.joint.removeVisual(this)}}function Ia(n,e=!0){return n.layers.disableAll(),n.layers.enable(De.JointLayer),e||n.layers.enable(De.NotHighlightedLayer),n}const hl=class extends Vn{constructor(t){super(Y.Joint,t.id);P(this,"mesh");P(this,"xAxis");P(this,"yAxis");P(this,"zAxis");P(this,"xAxisLine");P(this,"yAxisLine");P(this,"zAxisLine");P(this,"_data");this._data=t,this.mesh=Ia(new _s(new ws(.01,8,8),new Pt({color:"#AAA"}))),this.addVisual(this.mesh),this.xAxis=Ia(new Ug(this,xt.X,J5),!1),this.yAxis=Ia(new Ug(this,xt.Y,eU),!1),this.zAxis=Ia(new Ug(this,xt.Z,nU),!1),this.xAxisLine=Ia(new Bg(this,xt.X,[new L(0,0,0),new L(0,hl.LineSize,0)],K5),!1),this.yAxisLine=Ia(new Bg(this,xt.Y,[new L(0,0,0),new L(0,0,-hl.LineSize)],tU),!1),this.zAxisLine=Ia(new Bg(this,xt.Z,[new L(0,0,0),new L(0,hl.LineSize,0)],rU),!1)}get data(){return this._data}updateAxis(t,r){t==xt.X?this._data.xAxis={...r}:t==xt.Y?this._data.yAxis={...r}:t==xt.Z?this._data.zAxis={...r}:He.warn(Xe.UnknownAxisInJointObject,"Unknown axis: "+t),this.updateRotation()}onUpdate(t){if(super.onUpdate(t),t.part.type!=Y.Joint)throw Error(`Invalid part type: ${t.part.type.toString()}. Expected type: ${Y.Joint.toString()}`);const r=t.part;this._data={xAxis:{...r.xAxis},yAxis:{...r.yAxis},zAxis:{...r.zAxis}},this.updateRotation()}updateRotation(){const t=vt.getJointAxisRotations(this._data),{defaultRotation:r,xRotation:i,zRotation:s}=new Ws().getDefaultJointRotation(this._data),a=s.clone().multiply(i);this.zAxis.update(this._data.zAxis,t.zAxis),this.xAxis.update(this._data.xAxis,t.xAxis),this.yAxis.update(this._data.yAxis,t.yAxis),this.zAxisLine.update(this._data.zAxis,s),this.xAxisLine.update(this._data.xAxis,a),this.yAxisLine.update(this._data.yAxis,r),this.partGroup.setRotationFromQuaternion(r)}updateFromCameraInfo(t){super.updateFromCameraInfo(t);const r=vt.getZoomScale(this,t);this.visualGroup.scale.set(r,r,r)}dispose(){var t,r;super.dispose(),(t=this.mesh.geometry)==null||t.dispose(),(r=this.mesh.material)==null||r.dispose()}};let Si=hl;P(Si,"ArcSize",.2),P(Si,"LineSize",hl.ArcSize*1.1);const La=new va,Dn=new L,is=new L,Ut=new qe,lb={X:new L(1,0,0),Y:new L(0,1,0),Z:new L(0,0,1)};class n2 extends ot{constructor(t,r){super();P(this,"isTransformControls",!0);P(this,"worldPosition",new L);P(this,"worldPositionStart",new L);P(this,"worldQuaternion",new qe);P(this,"worldQuaternionStart",new qe);P(this,"cameraPosition",new L);P(this,"cameraQuaternion",new qe);P(this,"pointStart",new L);P(this,"pointEnd",new L);P(this,"rotationAxis",new L);P(this,"rotationAngle",0);P(this,"eye",new L);P(this,"object",null);P(this,"objectRotation",null);P(this,"enabled",!0);P(this,"axis",null);P(this,"mode","translate");P(this,"space","world");P(this,"dragging",!1);P(this,"translationSnap",null);P(this,"scaleSnap",null);P(this,"rotationSnap",null);P(this,"size",1);P(this,"showX",!0);P(this,"showY",!0);P(this,"showZ",!0);P(this,"lockChildren",!1);P(this,"_offset",new L);P(this,"_startNorm",new L);P(this,"_endNorm",new L);P(this,"_cameraScale",new L);P(this,"_parentPosition",new L);P(this,"_parentQuaternion",new qe);P(this,"_parentQuaternionInv",new qe);P(this,"_parentScale",new L);P(this,"_worldScaleStart",new L);P(this,"_worldQuaternionInv",new qe);P(this,"_worldScale",new L);P(this,"_positionStart",new L);P(this,"_quaternionStart",new qe);P(this,"_scaleStart",new L);P(this,"_matrixStart",new ze);P(this,"_childMatrices",new Map);P(this,"_gizmo");P(this,"_plane");this.handler=t,this.viewInfo=r,this.visible=!1,this._gizmo=new iU(this),this.add(this._gizmo),this._plane=new sU(this),this.add(this._plane)}updateMatrixWorld(){this.object!=null&&(this.object.updateMatrixWorld(),this.object.parent==null?He.error(Xe.AttachedObjectIsNotPartOfScene,"TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert());const t=this.viewInfo.cameraSystem.currentCamera;t.updateMatrixWorld(),t.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}setRayCaster(t){La.setFromCamera(t,this.viewInfo.cameraSystem.currentCamera),La.layers.disableAll(),La.layers.enable(De.DraggerLayer)}pointerHover(t){if(this.object==null||this.dragging==!0)return;this.setRayCaster(t);const r=Hg(this._gizmo.picker[this.mode],La,!1);r?this.axis=r.object.name:this.axis=null}pointerDown(t){var r;if(!(this.object==null||this.dragging==!0||t.button!=0)&&this.axis!=null){this.setRayCaster(t);const i=Hg(this._plane,La,!0);i&&(this.object.updateMatrixWorld(),(r=this.object.parent)==null||r.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this._matrixStart.copy(this.object.matrix),this._childMatrices.clear(),this.lockChildren&&this.object instanceof Vn&&this.object.partGroup.children.filter(s=>s instanceof Vn).map(s=>s).forEach(s=>{this._childMatrices.set(s,s.matrix.clone())}),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0}}pointerMove(t){const r=this.axis,i=this.mode,s=this.object;let a=this.space;if(i=="scale"?a="local":(r=="E"||r=="XYZE"||r=="XYZ")&&(a="world"),s==null||r==null||this.dragging==!1||t.button!=0)return;this.setRayCaster(t);const o=Hg(this._plane,La,!0);if(!!o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i=="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a=="local"&&r!="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),r.indexOf("X")==-1&&(this._offset.x=0),r.indexOf("Y")==-1&&(this._offset.y=0),r.indexOf("Z")==-1&&(this._offset.z=0),a=="local"&&r!="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a=="local"&&(s.position.applyQuaternion(Ut.copy(this._quaternionStart).invert()),r.search("X")!=-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),r.search("Y")!=-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),r.search("Z")!=-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),a=="world"&&(s.parent&&s.position.add(Dn.setFromMatrixPosition(s.parent.matrixWorld)),r.search("X")!=-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),r.search("Y")!=-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),r.search("Z")!=-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Dn.setFromMatrixPosition(s.parent.matrixWorld))));else if(i=="scale"){if(r.search("XYZ")!=-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),is.set(l,l,l)}else Dn.copy(this.pointStart),is.copy(this.pointEnd),Dn.applyQuaternion(this._worldQuaternionInv),is.applyQuaternion(this._worldQuaternionInv),is.divide(Dn),r.search("X")==-1&&(is.x=1),r.search("Y")==-1&&(is.y=1),r.search("Z")==-1&&(is.z=1);s.scale.copy(this._scaleStart).multiply(is),this.scaleSnap&&(r.search("X")!=-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),r.search("Y")!=-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),r.search("Z")!=-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i=="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=5/this.worldPosition.distanceTo(Dn.setFromMatrixPosition(this.viewInfo.cameraSystem.currentCamera.matrixWorld));if(r=="E")this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1;else if(r=="XYZE")this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Dn.copy(this.rotationAxis).cross(this.eye))*l;else if(r=="X"||r=="Y"||r=="Z"){this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAxis.copy(lb[r]);let c=Dn.copy(this._startNorm).angleTo(this._endNorm);Dn.cross(this._endNorm).normalize();const u=Dn.dot(this.eye);Dn.copy(lb[r]),s.localToWorld(Dn).sub(s.localToWorld(is.set(0,0,0)));const h=this.eye.dot(Dn);u<0&&(c=-c),h<0&&(c=-c),this.rotationAngle=c}this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a=="local"&&r!="E"&&r!="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(Ut.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(Ut.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}if(this.lockChildren){s.updateMatrix();const l=new ze().multiplyMatrices(s.matrix.clone().invert(),this._matrixStart),c=new ze;s instanceof Si&&(s.partGroup.updateMatrix(),c.copy(s.partGroup.matrix)),this._childMatrices.forEach((u,h)=>{if(h.partType==Y.LightEmittingObject)return;const d=c.clone().invert().multiply(l).multiply(c).multiply(u),f=new L,v=new qe,g=new L;d.decompose(f,v,g),h.position.copy(f),h.quaternion.copy(v)})}this.handler.onObjectChanging(s)}}pointerUp(t){t.button==0&&(this.dragging&&this.axis!=null&&this.object!=null&&this.handler.onObjectChanged(this.object),this.dragging=!1,this.axis=null)}dispose(){this.traverse(t=>{(t instanceof be||t instanceof gn)&&(t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose())})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=null,this.visible=!1,this.axis=null,this}getRaycaster(){return La}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}getPointer(t){if(document.pointerLockElement)return{x:0,y:0,button:t.button,ctrlKey:t.ctrlKey};var r=t,i=r.changedTouches?r.changedTouches[0]:t,s=this.viewInfo.viewport.rect;return{x:(i.clientX-s.left)/s.width*2-1,y:-(i.clientY-s.top)/s.height*2+1,button:t.button,ctrlKey:t.ctrlKey}}onPointerHover(t){!this.enabled||this.pointerHover(this.getPointer(t))}onPointerDown(t){!this.enabled||(this.pointerHover(this.getPointer(t)),this.pointerDown(this.getPointer(t)))}onPointerMove(t){!this.enabled||this.pointerMove(this.getPointer(t))}onPointerUp(t){!this.enabled||this.pointerUp(this.getPointer(t))}}function Hg(n,e,t){const r=e.intersectObject(n,!0);for(let i=0;i<r.length;i++)if(r[i].object.visible||t)return r[i];return!1}const zh=new sr().reorder("ZXY"),It=new L(0,1,0),cb=new L(0,0,0),ub=new ze,Uh=new qe,hf=new qe,Fi=new L,db=new ze,ru=new L(1,0,0),Oa=new L(0,1,0),iu=new L(0,0,1),Bh=new L,jc=new L,Wc=new L;class iU extends ot{constructor(t){super();P(this,"isTransformControlsGizmo",!0);P(this,"gizmo",{});P(this,"picker",{});P(this,"helper",{});this.controls=t,this.type="TransformControlsGizmo";const r=new Pt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new Gn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=r.clone();s.opacity=.15;const a=i.clone();a.opacity=.5;const o=r.clone();o.color.setHex(16711680);const l=r.clone();l.color.setHex(65280);const c=r.clone();c.color.setHex(255);const u=r.clone();u.color.setHex(16711680),u.opacity=.5;const h=r.clone();h.color.setHex(65280),h.opacity=.5;const d=r.clone();d.color.setHex(255),d.opacity=.5;const f=r.clone();f.opacity=.25;const v=r.clone();v.color.setHex(16776960),v.opacity=.25,r.clone().color.setHex(16776960),r.clone().color.setHex(7895160);const p=new Fn(0,.04,.1,12);p.translate(0,.05,0);const m=new ln(.08,.08,.08);m.translate(0,.04,0);const x=new nt;x.setAttribute("position",new Ye([0,0,0,1,0,0],3));const w=new Fn(.0075,.0075,.5,3);w.translate(0,.25,0);function b(R,ee){const J=new ll(R,.0075,3,64,ee*Math.PI*2);return J.rotateY(Math.PI/2),J.rotateX(Math.PI/2),J}function C(){const R=new nt;return R.setAttribute("position",new Ye([0,0,0,1,1,1],3)),R}const A={X:[[new be(p,o),[.5,0,0],[0,0,-Math.PI/2]],[new be(p,o),[-.5,0,0],[0,0,Math.PI/2]],[new be(w,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new be(p,l),[0,.5,0]],[new be(p,l),[0,-.5,0],[Math.PI,0,0]],[new be(w,l)]],Z:[[new be(p,c),[0,0,.5],[Math.PI/2,0,0]],[new be(p,c),[0,0,-.5],[-Math.PI/2,0,0]],[new be(w,c),null,[Math.PI/2,0,0]]],XYZ:[[new be(new ol(.1,0),f.clone()),[0,0,0]]],XY:[[new be(new ln(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new be(new ln(.15,.15,.01),u.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new be(new ln(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},F={X:[[new be(new Fn(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new be(new Fn(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new be(new Fn(.2,0,.6,4),s),[0,.3,0]],[new be(new Fn(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new be(new Fn(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new be(new Fn(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new be(new ol(.2,0),s)]],XY:[[new be(new ln(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new be(new ln(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new be(new ln(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},N={START:[[new be(new ol(.01,2),a),null,null,null,"helper"]],END:[[new be(new ol(.01,2),a),null,null,null,"helper"]],DELTA:[[new gn(C(),a),null,null,null,"helper"]],X:[[new gn(x,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new gn(x,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new gn(x,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},O={X:[[new be(b(.5,1),o)]],Y:[[new be(b(.5,1),l),null,[0,0,-Math.PI/2]]],Z:[[new be(b(.5,1),c),null,[0,Math.PI/2,0]]]},H={AXIS:[[new gn(x,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={X:[[new be(new ll(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new be(new ll(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new be(new ll(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]]},U={X:[[new be(m,o),[.5,0,0],[0,0,-Math.PI/2]],[new be(w,o),[0,0,0],[0,0,-Math.PI/2]],[new be(m,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new be(m,l),[0,.5,0]],[new be(w,l)],[new be(m,l),[0,-.5,0],[0,0,Math.PI]]],Z:[[new be(m,c),[0,0,.5],[Math.PI/2,0,0]],[new be(w,c),[0,0,0],[Math.PI/2,0,0]],[new be(m,c),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new be(new ln(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new be(new ln(.15,.15,.01),u),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new be(new ln(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new be(new ln(.1,.1,.1),f.clone())]]},_={X:[[new be(new Fn(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new be(new Fn(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new be(new Fn(.2,0,.6,4),s),[0,.3,0]],[new be(new Fn(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new be(new Fn(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new be(new Fn(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new be(new ln(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new be(new ln(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new be(new ln(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new be(new ln(.2,.2,.2),s),[0,0,0]]]},z={X:[[new gn(x,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new gn(x,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new gn(x,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function j(R){const ee=new ot;for(const J in R)for(let le=R[J].length;le--;){const k=R[J][le][0].clone(),V=R[J][le][1],$=R[J][le][2],Q=R[J][le][3],ie=R[J][le][4];k.name=J,k.userData.tag=ie,V&&k.position.set(V[0],V[1],V[2]),$&&k.rotation.set($[0],$[1],$[2]),Q&&k.scale.set(Q[0],Q[1],Q[2]),k.updateMatrix();const ne=k.geometry.clone();ne.applyMatrix4(k.matrix),k.geometry=ne,k.renderOrder=1/0,k.position.set(0,0,0),k.rotation.set(0,0,0),k.scale.set(1,1,1),ee.add(k)}return ee}this.add(this.gizmo.translate=j(A)),this.add(this.gizmo.rotate=j(O)),this.add(this.gizmo.scale=j(U)),this.add(this.picker.translate=j(F)),this.add(this.picker.rotate=j(D)),this.add(this.picker.scale=j(_)),this.add(this.helper.translate=j(N)),this.add(this.helper.rotate=j(H)),this.add(this.helper.scale=j(z)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const i=(this.controls.mode=="scale"?"local":this.controls.space)=="local"?this.controls.worldQuaternion:hf;this.gizmo.translate.visible=this.controls.mode=="translate",this.gizmo.rotate.visible=this.controls.mode=="rotate",this.gizmo.scale.visible=this.controls.mode=="scale",this.helper.translate.visible=this.controls.mode=="translate",this.helper.rotate.visible=this.controls.mode=="rotate",this.helper.scale.visible=this.controls.mode=="scale";const s=[...this.picker[this.controls.mode].children,...this.gizmo[this.controls.mode].children,...this.helper[this.controls.mode].children];for(let a=0;a<s.length;a++){const o=s[a];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.controls.worldPosition);let l;const c=this.controls.viewInfo.cameraSystem.currentCamera;if(c instanceof Qn)l=(c.top-c.bottom)/c.zoom;else if(c instanceof rn)l=this.controls.worldPosition.distanceTo(this.controls.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*c.fov/360)/c.zoom,7);else throw new Error("Unknown Camera");if(o.scale.set(1,1,1).multiplyScalar(l*this.controls.size/4),o.userData.tag=="helper"){o.visible=!1,o.name=="AXIS"?(o.position.copy(this.controls.worldPositionStart),o.visible=!!this.controls.axis,this.controls.axis=="X"&&(Ut.setFromEuler(zh.set(0,0,0)),o.quaternion.copy(i).multiply(Ut),Math.abs(It.copy(ru).applyQuaternion(i).dot(this.controls.eye))>.9&&(o.visible=!1)),this.controls.axis=="Y"&&(Ut.setFromEuler(zh.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(Ut),Math.abs(It.copy(Oa).applyQuaternion(i).dot(this.controls.eye))>.9&&(o.visible=!1)),this.controls.axis=="Z"&&(Ut.setFromEuler(zh.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(Ut),Math.abs(It.copy(iu).applyQuaternion(i).dot(this.controls.eye))>.9&&(o.visible=!1)),this.controls.axis=="XYZE"&&(Ut.setFromEuler(zh.set(0,Math.PI/2,0)),It.copy(this.controls.rotationAxis),o.quaternion.setFromRotationMatrix(ub.lookAt(cb,It,Oa)),o.quaternion.multiply(Ut),o.visible=this.controls.dragging),this.controls.axis=="E"&&(o.visible=!1)):o.name=="START"?(o.position.copy(this.controls.worldPositionStart),o.visible=this.controls.dragging):o.name=="END"?(o.position.copy(this.controls.worldPosition),o.visible=this.controls.dragging):o.name=="DELTA"?(o.position.copy(this.controls.worldPositionStart),o.quaternion.copy(this.controls.worldQuaternionStart),Dn.set(1e-10,1e-10,1e-10).add(this.controls.worldPositionStart).sub(this.controls.worldPosition).multiplyScalar(-1),Dn.applyQuaternion(this.controls.worldQuaternionStart.clone().invert()),o.scale.copy(Dn),o.visible=this.controls.dragging):(o.quaternion.copy(i),this.controls.dragging?o.position.copy(this.controls.worldPositionStart):o.position.copy(this.controls.worldPosition),this.controls.axis&&(o.visible=this.controls.axis.search(o.name)!=-1));continue}o.quaternion.copy(i),this.controls.mode=="translate"||this.controls.mode=="scale"?(o.name=="X"&&Math.abs(It.copy(ru).applyQuaternion(i).dot(this.controls.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name=="Y"&&Math.abs(It.copy(Oa).applyQuaternion(i).dot(this.controls.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name=="Z"&&Math.abs(It.copy(iu).applyQuaternion(i).dot(this.controls.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name=="XY"&&Math.abs(It.copy(iu).applyQuaternion(i).dot(this.controls.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name=="YZ"&&Math.abs(It.copy(ru).applyQuaternion(i).dot(this.controls.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name=="XZ"&&Math.abs(It.copy(Oa).applyQuaternion(i).dot(this.controls.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.controls.mode=="rotate"&&(Uh.copy(i),It.copy(this.controls.eye).applyQuaternion(Ut.copy(i).invert()),o.name.search("E")!=-1&&o.quaternion.setFromRotationMatrix(ub.lookAt(this.controls.eye,cb,Oa)),o.name=="X"&&(Ut.setFromAxisAngle(ru,Math.atan2(-It.y,It.z)),Ut.multiplyQuaternions(Uh,Ut),o.quaternion.copy(Ut)),o.name=="Y"&&(Ut.setFromAxisAngle(Oa,Math.atan2(It.x,It.z)),Ut.multiplyQuaternions(Uh,Ut),o.quaternion.copy(Ut)),o.name=="Z"&&(Ut.setFromAxisAngle(iu,Math.atan2(It.y,It.x)),Ut.multiplyQuaternions(Uh,Ut),o.quaternion.copy(Ut))),o.visible=o.visible&&(o.name.indexOf("X")==-1||this.controls.showX),o.visible=o.visible&&(o.name.indexOf("Y")==-1||this.controls.showY),o.visible=o.visible&&(o.name.indexOf("Z")==-1||this.controls.showZ),o.visible=o.visible&&(o.name.indexOf("E")==-1||this.controls.showX&&this.controls.showY&&this.controls.showZ),(o instanceof be||o instanceof gn)&&(o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.controls.enabled&&this.controls.axis&&(o.name==this.controls.axis||this.controls.axis.split("").some(function(u){return o.name==u}))&&(o.material.color.setHex(16776960),o.material.opacity=1))}super.updateMatrixWorld(t)}}class sU extends be{constructor(t){super(new oc(1e5,1e5,2,2),new Pt({visible:!1,wireframe:!0,side:Un,transparent:!0,opacity:.1,toneMapped:!1}));P(this,"isTransformControlsPlane",!0);this.controls=t,this.type="TransformControlsPlane"}updateMatrixWorld(t){let r=this.controls.space;switch(this.position.copy(this.controls.worldPosition),this.controls.mode=="scale"&&(r="local"),Bh.copy(ru).applyQuaternion(r=="local"?this.controls.worldQuaternion:hf),jc.copy(Oa).applyQuaternion(r=="local"?this.controls.worldQuaternion:hf),Wc.copy(iu).applyQuaternion(r=="local"?this.controls.worldQuaternion:hf),It.copy(jc),this.controls.mode){case"translate":case"scale":switch(this.controls.axis){case"X":It.copy(this.controls.eye).cross(Bh),Fi.copy(Bh).cross(It);break;case"Y":It.copy(this.controls.eye).cross(jc),Fi.copy(jc).cross(It);break;case"Z":It.copy(this.controls.eye).cross(Wc),Fi.copy(Wc).cross(It);break;case"XY":Fi.copy(Wc);break;case"YZ":Fi.copy(Bh);break;case"XZ":It.copy(Wc),Fi.copy(jc);break;case"XYZ":case"E":Fi.set(0,0,0);break}break;case"rotate":default:Fi.set(0,0,0)}Fi.length()==0?this.quaternion.copy(this.controls.cameraQuaternion):(db.lookAt(Dn.set(0,0,0),Fi,It),this.quaternion.setFromRotationMatrix(db)),super.updateMatrixWorld(t)}}class hb extends pc{constructor(t,r){super(t,r);P(this,"transformControl");P(this,"mode",Ar.None);P(this,"lockChildren",!1);this.transformControl=new n2(this,this.viewInfo),this.transformControl.setTranslationSnap(.001),this.transformControl.setRotationSnap(st.degToRad(.1)),this.transformControl.setSize(1),this.transformControl.traverse(i=>{i.layers.disableAll(),i.layers.enable(De.DraggerLayer)}),this.scene.add(this.transformControl),En.editorFixChildren$.pipe(an(this.isDisposed$)).subscribe(i=>this.updateLockChildren(i)),this.updateLockChildren(me.getState().editor.fixChildren)}updateLockChildren(t){this.lockChildren=t,this.transformControl.lockChildren=t}onObjectChanging(t){t!=null&&(me.dispatch(Pe.transformingChanged(!0)),this.mode==Ar.Move?me.dispatch(Pe.tempPositionSet({x:t.position.x,y:t.position.y,z:t.position.z})):this.mode==Ar.Rotate&&me.dispatch(Pe.tempRotationSet({x:st.radToDeg(t.rotation.x),y:st.radToDeg(t.rotation.y),z:st.radToDeg(t.rotation.z)})))}onObjectChanged(t){t!=null&&(me.dispatch(Pe.transformingChanged(!1)),this.mode==Ar.Move?(me.dispatch(Pe.tempPositionCleared()),me.dispatch(Te.partPositionSet({partId:t.partId,position:{x:t.position.x,y:t.position.y,z:t.position.z},lockChildren:this.lockChildren}))):this.mode==Ar.Rotate&&(me.dispatch(Pe.tempRotationCleared()),me.dispatch(Te.partRotationSet({partId:t.partId,rotation:{x:st.radToDeg(t.rotation.x),y:st.radToDeg(t.rotation.y),z:st.radToDeg(t.rotation.z)},lockChildren:this.lockChildren}))))}onUpdateSelectedItems(t){this.transformControl.detach(),t.length>0&&(t.length==1?(this.transformControl.attach(t[0].partObject),this.transformControl.lockChildren=this.lockChildren):He.error(Xe.CantTransformMultiSelection,"TODO: Multiselection-Transform!"))}dispose(){super.dispose(),this.transformControl.object!=null&&this.transformControl.detach(),this.scene.remove(this.transformControl),this.mode=Ar.None}setMode(t){this.mode=t,this.updateFromMode()}getType(){if(this.mode==Ar.Move)return Le.Translate;if(this.mode==Ar.Rotate)return Le.Rotate;He.throw(Xe.InvalidStateInTransformTool,"Invalid state in TransformTool")}updateFromMode(){this.mode==Ar.Rotate?(this.transformControl.setMode("rotate"),this.transformControl.setSpace("local")):this.mode==Ar.Move?(this.transformControl.setMode("translate"),this.transformControl.setSpace("world")):He.throw(Xe.UnkwnoModeInTransformTool,"Unknown mode in TransformTool: "+this.mode)}needMouseDown(t){return!0}handleMouseDown(t){return this.transformControl.onPointerDown(t.event),this.transformControl.dragging}needMouseMove(t){return!0}handleMouseMove(t){return this.transformControl.onPointerHover(t.event),this.transformControl.dragging&&this.transformControl.onPointerMove(t.event),this.transformControl.dragging}needMouseUp(t){return this.transformControl.dragging}handleMouseUp(t){const r=this.transformControl.dragging;return this.transformControl.onPointerUp(t.event),this.transformControl.dragging&&He.error(Xe.TransformToolTransformControlShouldBeDeactivatedByNow,"Transform-Control should be deactivated by now!"),r}}class _x{constructor(e){this.context=e}initialize(){}dispose(){}needMouseDown(e){return!1}handleMouseDown(e){return!1}needMouseMove(e){return!1}handleMouseMove(e){return!1}needMouseUp(e){return!0}handleMouseUp(e){return!1}needKeyDown(e){return!1}handleKeyDown(e){return!1}needKeyUp(e){return!1}handleKeyUp(e){return!1}updateDataFromSelection(e){}}class fb extends _x{get type(){return Nt.None}}class aU extends _x{get type(){return Nt.SelectParts}updateDataFromSelection(e){var t;this.context.geometryPartId==null&&(e.length==1&&e[0].type==Y.Geometry?me.dispatch(je.toolDataSet({type:Le.LesEdit,mode:Nt.SelectFaces,geometryPartId:e[0].id,lightEmittingPartId:(t=this.context.lightEmittingObjectId)!=null?t:void 0})):(e.length!=1||e[0].partObject.partType!=Y.LightEmittingObject||e[0].id!=this.context.lightEmittingObjectId)&&me.dispatch(je.toolDataSet({type:Le.None})))}}class bx extends _x{constructor(t,r){super(t);P(this,"invertKey","Control");P(this,"clickPos",null);P(this,"selectionInverted",!1);this.selectHandler=r}needMouseDown(t){return t.event.buttons==1}handleMouseDown(t){if(t.isHandled||t.hasPreventSelect)return!1;if(t.preventSelect(),this.selectHandler.start(t))return!0;const r=t.event;return this.clickPos=new oe(r.x,r.y),!1}needMouseMove(t){return t.event.buttons==1}handleMouseMove(t){return this.handleSelect(t)}needMouseUp(t){return!0}handleMouseUp(t){const r=this.handleSelect(t);if(this.selectHandler.end(),r)return!0;if(this.clickPos!=null){const i=t.event,s=new oe(i.x,i.y);this.clickPos.distanceTo(s)<4&&bt.hasSelectedFaces(me.getState())&&me.dispatch(je.faceSelectionCleared()),this.clickPos=null}return!1}needKeyDown(t){return super.needKeyDown(t)?!0:this.selectionInverted?!1:t.event.key==this.invertKey}handleKeyDown(t){return super.handleKeyDown(t)?!0:t.event.key==this.invertKey?(this.selectionInverted=!0,!0):!1}needKeyUp(t){return this.selectionInverted?t.event.key==this.invertKey:!1}handleKeyUp(t){return t.event.key==this.invertKey?(this.selectionInverted=!1,!0):!1}handleSelect(t){return this.selectHandler.checkSelection(t,{faceSelectionCallback:(r,i,s)=>{const a=bt.isFaceSelected(r,i,s)(me.getState());!this.selectionInverted&&!a?me.dispatch(je.addedToSelection({partId:r,groupIndex:i,faceIndex:s})):this.selectionInverted&&a&&me.dispatch(je.removedFromSelection({partId:r,groupIndex:i,faceIndex:s}))}})}updateDataFromSelection(t){super.updateDataFromSelection(t),this.context.geometryPartId&&(t.map(r=>r.partObject.partId).includes(this.context.geometryPartId)||me.dispatch(je.toolDataSet({type:Le.None})))}}class oU extends bx{constructor(){super(...arguments);P(this,"leoVisibility",null)}get type(){return Nt.SelectFaces}initialize(){this.leoVisibility=pt.view.areLightEmittingObjectsVisible(me.getState()),me.dispatch(Pe.lightEmittingObjectVisibilitySet(!1)),me.dispatch(je.faceSelectionCleared())}dispose(){this.leoVisibility!=null&&me.dispatch(Pe.lightEmittingObjectVisibilitySet(this.leoVisibility))}}class lU extends bx{get type(){return Nt.CreateLeo}initialize(){me.dispatch(je.faceSelectionCleared())}}class cU extends bx{constructor(){super(...arguments);P(this,"leoVisibility",null)}get type(){return Nt.EditLesFaces}initialize(){this.leoVisibility=pt.view.areLightEmittingObjectsVisible(me.getState()),me.dispatch(Pe.lightEmittingObjectVisibilitySet(!1))}dispose(){this.leoVisibility!=null&&me.dispatch(Pe.lightEmittingObjectVisibilitySet(this.leoVisibility))}updateDataFromSelection(t){super.updateDataFromSelection(t),(t.length!=1||t[0].partObject.partId!=this.context.geometryPartId)&&me.dispatch(je.toolDataSet({type:Le.None}))}}class pb extends pc{constructor(t,r){super(t,r);P(this,"selectHandler");P(this,"context",{geometryPartId:null,lightEmittingObjectId:null,lesId:null});P(this,"mode");this.mode=new fb(this.context),this.mode.initialize(),this.selectHandler=new t2(r,t),En.viewSettings$.pipe(an(this.isDisposed$)).subscribe(i=>this.selectHandler.updateFromSettings(i))}getType(){return Le.LesEdit}onUpdateSelectedItems(t){this.mode.updateDataFromSelection(t)}onDataUpdate(t){var r,i,s;if(t.type!=Le.LesEdit){He.error(Xe.InvalidToolDataTypeLesEditToolDataUpdate,"Unexpected ToolData.type in LesEditTool.DataUpdate: "+t.type.toString());return}this.context.geometryPartId=(r=t.geometryPartId)!=null?r:null,this.context.lightEmittingObjectId=(i=t.lightEmittingPartId)!=null?i:null,this.context.lesId=(s=t.lesId)!=null?s:null,this.setMode(t)}setMode(t){if(this.mode.type!=t.mode){switch(this.mode.dispose(),t.mode){case Nt.SelectFaces:this.mode=new oU(this.context,this.selectHandler);break;case Nt.SelectParts:this.mode=new aU(this.context);break;case Nt.CreateLeo:this.mode=new lU(this.context,this.selectHandler);break;case Nt.EditLesFaces:this.mode=new cU(this.context,this.selectHandler);break;case Nt.None:this.mode=new fb(this.context);break;default:He.throw(Xe.UnknownLesToolMode,`Unknown LES tool mode: ${t.mode}!`)}this.mode.initialize()}}dispose(){this.mode.dispose(),super.dispose(),me.dispatch(je.faceSelectionCleared())}needMouseDown(t){return this.mode.needMouseDown(t)||super.needMouseDown(t)}handleMouseDown(t){return this.mode.needMouseDown(t)&&this.mode.handleMouseDown(t)||super.handleMouseDown(t)}needMouseMove(t){return this.mode.needMouseMove(t)||super.needMouseMove(t)}handleMouseMove(t){return this.mode.needMouseMove(t)&&this.mode.handleMouseMove(t)||super.handleMouseMove(t)}needMouseUp(t){return this.mode.needMouseUp(t)||super.needMouseUp(t)}handleMouseUp(t){return this.mode.needMouseUp(t)&&this.mode.handleMouseUp(t)||super.handleMouseUp(t)}needKeyDown(t){return this.mode.needKeyDown(t)||super.needKeyDown(t)}handleKeyDown(t){return this.mode.needKeyDown(t)&&this.mode.handleKeyDown(t)||super.handleKeyDown(t)}needKeyUp(t){return this.mode.needKeyUp(t)||super.needKeyUp(t)}handleKeyUp(t){return this.mode.needKeyUp(t)&&this.mode.handleKeyUp(t)||super.handleKeyUp(t)}}class mb extends pc{constructor(t,r){super(t,r);P(this,"object");P(this,"controls");this.object=new ot,this.controls=new n2(this,r),this.controls.traverse(i=>{i.layers.disableAll(),i.layers.enable(De.DraggerLayer)}),this.scene.add(this.object),this.scene.add(this.controls),this.controls.attach(this.object),En.tempInsertPoint$.pipe(an(this.isDisposed$)).subscribe(i=>{i&&this.object.position.set(i.x,i.y,i.z)})}dispose(){super.dispose(),this.controls.detach(),this.controls.remove(this.controls),this.scene.remove(this.object),this.controls.dispose()}getType(){return Le.InsertPosition}onObjectChanging(t){this.updateInsertPoint(t.position)}onObjectChanged(t){this.updateInsertPoint(t.position)}updateInsertPoint(t){me.dispatch(Pe.tempInsertPointSet({x:t.x,y:t.y,z:t.z}))}onUpdateSelectedItems(t){t.length&&me.dispatch(je.toolDataSet({type:Le.None}))}needMouseDown(t){return!0}handleMouseDown(t){return this.controls.onPointerDown(t.event),this.controls.dragging}needMouseMove(t){return!0}handleMouseMove(t){return this.controls.onPointerHover(t.event),this.controls.dragging&&this.controls.onPointerMove(t.event),this.controls.dragging}needMouseUp(t){return this.controls.dragging}handleMouseUp(t){const r=this.controls.dragging;return this.controls.onPointerUp(t.event),this.controls.dragging&&He.warn(Xe.InsertPositionToolTransformControlShouldBeDeactivatedByNow,"Transform-Control should be deactivated by now!"),r}}const Hh={intersection:null},vr={position:new L},Mr=new L,Er=new L,uU=new Cr(new L(1,0,0)),dU=new Cr(new L(0,1,0)),hU=new Cr(new L(0,0,1)),gb="position",Gg="measurement";class dm{constructor(e,t,r,i,s=null){this.scene=e,this.raycaster=t,this.viewInfo=r,this.callbacks=i,this.startMousePos=s}start(e){return this.startMousePos=new oe(e.clientX,e.clientY),this.onStart(e,this.startMousePos)}update(e){return this.startMousePos==null?this:this.onUpdate(e,this.startMousePos,new oe(e.clientX,e.clientY))}stop(e){if(this.startMousePos==null)return this;this.onStop(e,this.startMousePos,new oe(e.clientX,e.clientY))}onStart(e,t){return!1}onUpdate(e,t,r){return this}onStop(e,t,r){}}class fU extends dm{onStart(e,t){if(!this.callbacks.tryGetPosition(e,vr))return!1;const r=vr.position;return this.callbacks.setPosFunc(0,r),this.callbacks.setPosFunc(1,r),this.callbacks.setVisibility(!0),this.callbacks.setState(1),!0}onUpdate(e,t,r){return this.callbacks.tryGetPosition(e,vr)&&this.callbacks.setPosFunc(1,vr.position),t.distanceTo(r)>5?new r2(this.scene,this.raycaster,this.viewInfo,this.callbacks,this.startMousePos):this}}class r2 extends dm{onStart(e,t){return!0}onUpdate(e,t,r){return this.callbacks.tryGetPosition(e,vr)&&this.callbacks.setPosFunc(1,vr.position),this}onStop(e,t,r){this.callbacks.tryGetPosition(e,vr)&&(this.callbacks.setPosFunc(1,vr.position),this.callbacks.setState(2))}}class pU extends dm{onStop(e,t,r){t.distanceTo(r)<3&&(this.callbacks.setState(0),this.callbacks.setVisibility(!1))}}class vb extends dm{constructor(e,t,r,i,s,a=null){super(e,t,r,i,a),this.pointIndex=s}onStart(e,t){return!0}onUpdate(e,t,r){return this.callbacks.tryGetPosition(e,vr)&&this.callbacks.setPosFunc(this.pointIndex,vr.position),this}onStop(e,t,r){this.callbacks.tryGetPosition(e,vr)&&this.callbacks.setPosFunc(this.pointIndex,vr.position)}}class yb extends pc{constructor(t,r){super(t,r);P(this,"sphereGeom");P(this,"sphereMaterial");P(this,"lineGeometry");P(this,"lineMaterial");P(this,"line");P(this,"points",new Array);P(this,"state",0);P(this,"action",null);P(this,"raycaster",new va);const i=o=>{o.layers.disableAll(),o.layers.enable(De.ToolLayer)};this.raycaster.layers.disableAll(),this.raycaster.layers.enable(De.GeometryLayer),this.sphereGeom=new ws(.0075,8,8),this.sphereMaterial=new Pt({color:"#3A3"});const s=new be(this.sphereGeom,this.sphereMaterial),a=new be(this.sphereGeom,this.sphereMaterial);this.lineGeometry=new nt,this.lineGeometry.setAttribute(gb,new Kt(new Float32Array(6),3)),this.lineGeometry.setDrawRange(0,2),this.lineMaterial=new Gn({color:"#A3A"}),this.line=new gn(this.lineGeometry,this.lineMaterial),this.points.push(s),this.points.push(a),this.setVisibility(!1),i(s),i(a),i(this.line),this.scene.add(this.points[0]),this.scene.add(this.points[1]),this.scene.add(this.line),Dr.cameraInfo$.pipe(an(this.isDisposed$)).subscribe(o=>this.updateView())}dispose(){this.setVisibility(!1),super.dispose(),this.scene.remove(this.points[0]),this.scene.remove(this.points[1]),this.scene.remove(this.line),this.sphereGeom.dispose(),this.sphereMaterial.dispose(),this.lineGeometry.dispose(),this.lineMaterial.dispose()}getType(){return Le.Measurement}updateView(){if(this.state==0)return;const t=this.viewInfo.viewport.width,r=this.viewInfo.viewport.height,i=t/2,s=r/2,a=this.getDistance(),o=this.viewInfo.cameraSystem.currentCamera;Mr.copy(this.points[0].position).project(o),Er.copy(this.points[1].position).project(o).add(Mr).divideScalar(2),Er.x=Er.x*i+i,Er.y=-(Er.y*s)+s;const l=a.toFixed(3),c=xA.selectById(me.getState().runtime.labelOverlay.labels,Gg);(c==null||c.position.x!=Mr.x||c.position.y!=Mr.y||c.text!=l)&&me.dispatch(Pe.labelSet({id:Gg,position:{x:Er.x,y:Er.y},text:l}))}needMouseDown(t){return t.event.button==0&&this.action==null}handleMouseDown(t){var s,a;t.preventSelect();const r=t.event,i={setPosFunc:(o,l)=>this.setPosition(o,l),setVisibility:o=>this.setVisibility(o),setState:o=>this.state=o,getState:()=>this.state,tryGetPosition:(o,l)=>this.tryGetPosition(o,l)};if(this.state==0)this.action=new fU(this.scene,this.raycaster,this.viewInfo,i);else if(this.state==1)this.action=new r2(this.scene,this.raycaster,this.viewInfo,i);else if(this.state==2){const o=this.tryGetIntersection(r,Hh,{layer:De.ToolLayer})?Hh.intersection.object:null;o==this.points[0]?this.action=new vb(this.scene,this.raycaster,this.viewInfo,i,0):o==this.points[1]?this.action=new vb(this.scene,this.raycaster,this.viewInfo,i,1):this.action=new pU(this.scene,this.raycaster,this.viewInfo,i)}return this.updateScale(),this.updateView(),(a=(s=this.action)==null?void 0:s.start(r))!=null?a:!1}needMouseMove(t){return t.event.button==0}handleMouseMove(t){const r=t.event;return this.action!=null?(this.action=this.action.update(r),this.updateScale(),this.updateView()):this.state==1&&this.tryGetPosition(r,vr)&&(this.setPosition(1,vr.position),this.updateScale(),this.updateView()),!1}needMouseUp(t){return t.event.button==0&&this.action!=null}handleMouseUp(t){var i;const r=t.event;return(i=this.action)==null||i.stop(r),this.action=null,this.updateScale(),this.updateView(),!1}updateFromCameraInfo(t){super.updateFromCameraInfo(t),this.updateScale(t)}updateScale(t){const r=t!=null?t:Dr.cameraInfo;if(!r)return;const i=vt.getZoomScale(this.points[0],r);this.points[0].scale.set(i,i,i);const s=vt.getZoomScale(this.points[1],r);this.points[1].scale.set(s,s,s)}setPosition(t,r){if(t<0||t>1)return;this.points[t].position.copy(r);const i=this.lineGeometry.attributes[gb];i.setXYZ(t,r.x,r.y,r.z),i.needsUpdate=!0,this.lineGeometry.computeBoundingBox(),this.lineGeometry.computeBoundingSphere()}setVisibility(t){this.points[0].visible=t,this.points[1].visible=t,this.line.visible=t,t||me.dispatch(Pe.labelCleared(Gg))}tryGetIntersection(t,r,i){var o;const s=Wl.getPickPosition(t,this.viewInfo.viewport);this.raycaster.layers.disableAll(),this.raycaster.layers.enable((o=i==null?void 0:i.layer)!=null?o:De.GeometryLayer),this.raycaster.setFromCamera(s,this.viewInfo.cameraSystem.currentCamera);const a=this.raycaster.intersectObject(this.scene);return r.intersection=a.length>0?a[0]:null,r.intersection!=null}getPositionOnPlane(){const t=this.viewInfo.cameraSystem.cameraType;return t==$e.Pers||t==$e.XY?this.raycaster.ray.intersectPlane(hU,Mr):t==$e.XZ?this.raycaster.ray.intersectPlane(dU,Mr):t==$e.YZ?this.raycaster.ray.intersectPlane(uU,Mr):null}tryGetPosition(t,r){const i=this.tryGetIntersection(t,Hh)?Hh.intersection.point:this.getPositionOnPlane();return i==null?!1:(r.position.copy(i),!0)}getDistance(){const t=this.viewInfo.cameraSystem.cameraType;return t==$e.Pers?this.points[0].position.distanceTo(this.points[1].position):t==$e.XZ?(Mr.copy(this.points[0].position).setY(0),Er.copy(this.points[1].position).setY(0),Mr.distanceTo(Er)):t==$e.YZ?(Mr.copy(this.points[0].position).setX(0),Er.copy(this.points[1].position).setX(0),Mr.distanceTo(Er)):t==$e.XY?(Mr.copy(this.points[0].position).setZ(0),Er.copy(this.points[1].position).setZ(0),Mr.distanceTo(Er)):0}}const Xc="position",Hr=32,Fx=class extends _s{constructor(){super(new nt,Fx.SurfaceMaterial);P(this,"isLightEmittingMesh",!0);P(this,"lastShape",null);this.geometry.applyQuaternion(new qe().setFromAxisAngle(new L(1,0,0),Math.PI))}update(t){(!this.lastShape||this.lastShape.type!=t.type)&&(this.geometry.hasAttribute(Xc)&&this.geometry.deleteAttribute(Xc),t.type==Oe.Rectangle?this.geometry.setAttribute(Xc,new Kt(new Float32Array(8*3),3)):t.type==Oe.Circle?this.geometry.setAttribute(Xc,new Kt(new Float32Array((Hr+1)*2*3),3)):He.throw(Xe.UnknownLightEmittingShapeType,"Unknown light emitting shape type: "+t.type));const r=new Array,i=this.geometry.attributes[Xc];if(t.type==Oe.Rectangle){const s=t.sizeX/2,a=t.sizeY/2;i.setXYZ(0,s,a,-.001),i.setXYZ(1,-s,a,-.001),i.setXYZ(2,-s,-a,-.001),i.setXYZ(3,s,-a,-.001),i.setXYZ(4,s,a,.001),i.setXYZ(5,-s,a,.001),i.setXYZ(6,-s,-a,.001),i.setXYZ(7,s,-a,.001),r.push(0,1,2,2,3,0,4,5,6,6,7,4,0,1,5,5,4,0,1,2,6,6,5,1,2,3,7,7,6,2,3,0,4,4,7,3)}else if(t.type==Oe.Circle){i.setXYZ(0,0,0,-.001),i.setXYZ(Hr+1,0,0,.001);const s=t.diameter/2;for(let a=0;a<Hr;a++){const o=0+a/Hr*Math.PI*2,l=s*Math.cos(o),c=s*Math.sin(o);i.setXYZ(a+1,l,c,-.001),i.setXYZ(a+Hr+2,l,c,.001)}for(let a=1;a<=Hr;a++){const o=a,l=vt.modulo(a,Hr)+1,c=0,u=Hr+2;r.push(o,l,c),r.push(o,u,l)}for(let a=1;a<=Hr;a++){const o=a,l=vt.modulo(a,Hr)+1,c=a+Hr+1,u=l+Hr+1;r.push(o,l,c),r.push(l,u,c)}}else He.throw(Xe.UnknownLightEmittingShapeType,"Unknown light emitting shape type: "+t.type);this.geometry.setIndex(r),i.needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()}};let ff=Fx;P(ff,"SurfaceMaterial",new Pt({color:16776960,side:Un,transparent:!0,opacity:.8,polygonOffset:!0,polygonOffsetUnits:-1,polygonOffsetFactor:-1}));class i2 extends Vn{constructor(t){super(Y.LightEmittingObject,t.id);P(this,"_shape");P(this,"_surface");P(this,"_c0Line");P(this,"_g0Line");P(this,"_c0LineMaterial");P(this,"_g0LineMaterial");P(this,"shapeType$",new Mn);this.name=t.name,this._shape=t.shape,this._c0LineMaterial=new Pt({color:16776960}),this._g0LineMaterial=new Pt({color:16711680});const r=this.createGeometries();this._surface=r.surface,this._c0Line=r.c0Line,this._g0Line=r.g0Line,this.addVisual(this._surface),this.addVisual(this._c0Line),this.addVisual(this._g0Line)}get shape(){return this._shape}get surface(){return this._surface}createGeometries(){const t=new ff;let r=new L(0,0,0),i=new L(0,0,-.5),s=[];s.push(r,i);var a=new np(new tp(s),4,.001,16,!0);r=new L(0,0,0),i=new L(.5,0,0);let o=[];o.push(r,i);var l=new np(new tp(o),4,.001,16,!0);const c=new be(a,this._c0LineMaterial),u=new be(l,this._g0LineMaterial);return t.layers.disableAll(),t.layers.enable(De.LightEmittingObjectLayer),c.layers.disableAll(),c.layers.enable(De.LightEmittingObjectLayer),u.layers.disableAll(),u.layers.enable(De.LightEmittingObjectLayer),{surface:t,c0Line:c,g0Line:u}}onUpdate(t){super.onUpdate(t);const r=t.part.shape,i=this.shape.type!=r.type;this._shape=r,this._surface.update(this._shape),i&&this.shapeType$.next(this.shape.type)}dispose(){this.removeVisual(this._surface),this.removeVisual(this._c0Line),this.removeVisual(this._g0Line),super.dispose(),this._surface.geometry.dispose(),this._c0Line.geometry.dispose(),this._g0Line.geometry.dispose(),this._c0LineMaterial.dispose(),this._g0LineMaterial.dispose()}}const Vg=new va,Yc=new L,Rl=new L,fr=new oe,h0=new qe,xb=new ze;class s2 extends ot{constructor(e,t,r){super(),this.controls=e,this.fetchPosition=t,this.positionUpdated=r}update(){if(!this.controls.leo)return;this.controls.leo.getWorldQuaternion(h0),xb.copy(this.controls.leo.matrixWorld);const e=this.fetchPosition();if(!e){this.visible=!1;return}this.visible=!0,Rl.set(e.x,e.y,0),Rl.applyMatrix4(xb),this.position.copy(Rl),this.updateMatrix()}moved(e){this.positionUpdated(e),this.update()}updateScale(e){const t=vt.getZoomScale(this,e);this.scale.set(t,t,t)}}function mU(){return new ws(.0075)}const Dx=class extends s2{constructor(t,r,i,s){super(t,i,s);P(this,"mesh");this.mesh=new be(Dx.geometry,r),this.mesh.layers.disableAll(),this.mesh.layers.enable(De.ToolLayer),this.add(this.mesh)}};let pi=Dx;P(pi,"geometry",mU());class gU extends ot{constructor(t,r){super();P(this,"isTransformControls",!0);P(this,"_leo",null);P(this,"_enabled",!0);P(this,"_dragging",!1);P(this,"_shapeStart",null);P(this,"_shapeEnd",null);P(this,"_pointStart",new oe);P(this,"_pointEnd",new oe);P(this,"_positionStart",new L);P(this,"_quaternionStart",new qe);P(this,"_matrixWorldInverse",new ze);P(this,"_plane");P(this,"_handles",new Array);P(this,"isDetached$",new Mn);P(this,"_currentHandle",null);this.changeHandler=t,this.viewInfo=r,this.visible=!1,this._plane=new vU,this.add(this._plane);const i=new Pt({color:new Ce(1,0,0)});this.createCornerHandles(i),this.createEdgeHandles(i),this.add(...this._handles)}dispose(){this.traverse(t=>{(t instanceof be||t instanceof gn)&&(t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose())})}update(){this.setupFromLeo()}get leo(){return this._leo}get dragging(){return this._dragging}updateFromCameraInfo(t){this.updateScale(t)}updateScale(t){const r=t!=null?t:Dr.cameraInfo;!r||this._handles.forEach(i=>i.updateScale(r))}setRayCaster(t){Vg.setFromCamera(t,this.viewInfo.cameraSystem.currentCamera),Vg.layers.enableAll()}intersectObjectWithRay(t,r){const i=Vg.intersectObject(t,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||r)return i[s];return null}pointerHover(t){var i;if(this._leo==null||this._dragging==!0)return;this.setRayCaster(t);const r=this.intersectObjectWithRay(this,!1);r&&((i=r.object)==null?void 0:i.parent)instanceof s2?this._currentHandle=r.object.parent:this._currentHandle=null}pointerDown(t){var i;if(this._leo==null||this._dragging==!0||t.button!=0||!this._currentHandle)return;this.setRayCaster(t);const r=this.intersectObjectWithRay(this._plane,!0);r&&(this._leo.updateMatrixWorld(),(i=this._leo.parent)==null||i.updateMatrixWorld(),this._positionStart.copy(this._leo.position),this._quaternionStart.copy(this._leo.quaternion),this._matrixWorldInverse.copy(this._leo.matrixWorld).invert(),r.point.applyMatrix4(this._matrixWorldInverse),this._pointStart.set(r.point.x,r.point.y),this._pointEnd.set(r.point.x,r.point.y)),this._dragging=!0}pointerMove(t){if(this._leo==null||this._shapeEnd==null||this._currentHandle==null||this._dragging==!1||t.button!=0)return;this.setRayCaster(t);const r=this.intersectObjectWithRay(this._plane,!0);!r||(r.point.applyMatrix4(this._matrixWorldInverse),this._pointEnd.set(r.point.x,r.point.y),fr.copy(this._pointEnd).sub(this._pointStart),this._currentHandle.moved(fr),this.dragging&&(this.changeHandler.shapeChanging(this._leo.position,{...this._shapeEnd}),this.updateScale()))}pointerUp(t){t.button!=0||this._dragging==!1||this._leo==null||this._shapeEnd==null||(this.changeHandler.shapeChanged(this._leo.position,{...this._shapeEnd}),this.setupFromLeo(),this._dragging=!1)}setupFromLeo(){!this._leo||(this._shapeStart={...this._leo.shape},this._shapeEnd={...this._leo.shape},this._leo.updateMatrixWorld(),this._leo.matrixWorld.decompose(Yc,h0,Rl),this._plane.position.copy(Yc),this._plane.quaternion.copy(h0),this._handles.forEach(t=>t.update()),this.updateScale())}attach(t){return this._leo=t,this._leo.shapeType$.pipe(an(this.isDetached$)).subscribe(()=>this.setupFromLeo()),this.setupFromLeo(),this.visible=!0,this}detach(){return this.isDetached$.next(!0),this._leo=null,this.visible=!1,this}getPointer(t){if(document.pointerLockElement)return{x:0,y:0,button:t.button,ctrlKey:t.ctrlKey};var r=t,i=r.changedTouches?r.changedTouches[0]:t,s=this.viewInfo.viewport.rect;return{x:(i.clientX-s.left)/s.width*2-1,y:-(i.clientY-s.top)/s.height*2+1,button:t.button,ctrlKey:t.ctrlKey}}onPointerHover(t){!this._enabled||this.pointerHover(this.getPointer(t))}onPointerDown(t){!this._enabled||(this.pointerHover(this.getPointer(t)),this.pointerDown(this.getPointer(t)))}onPointerMove(t){!this._enabled||this.pointerMove(this.getPointer(t))}onPointerUp(t){!this._enabled||this.pointerUp(this.getPointer(t))}createCornerHandles(t){this._handles.push(new pi(this,t,()=>!this._leo||!this._shapeEnd||this._shapeEnd.type!=Oe.Rectangle?null:fr.set(this._shapeEnd.sizeX/2,this._shapeEnd.sizeY/2),r=>{var i;((i=this._leo)==null?void 0:i.shape.type)==Oe.Rectangle&&this.handleUpdateRectangle(r,this.getValidRectangleState())})),this._handles.push(new pi(this,t,()=>!this._leo||!this._shapeEnd||this._shapeEnd.type!=Oe.Rectangle?null:fr.set(this._shapeEnd.sizeX/2,-this._shapeEnd.sizeY/2),r=>{var i;((i=this._leo)==null?void 0:i.shape.type)==Oe.Rectangle&&this.handleUpdateRectangle(r,this.getValidRectangleState(),{flipY:!0})})),this._handles.push(new pi(this,t,()=>!this._leo||!this._shapeEnd||this._shapeEnd.type!=Oe.Rectangle?null:fr.set(-this._shapeEnd.sizeX/2,-this._shapeEnd.sizeY/2),r=>{var i;((i=this._leo)==null?void 0:i.shape.type)==Oe.Rectangle&&this.handleUpdateRectangle(r,this.getValidRectangleState(),{flipX:!0,flipY:!0})})),this._handles.push(new pi(this,t,()=>!this._leo||!this._shapeEnd||this._shapeEnd.type!=Oe.Rectangle?null:fr.set(-this._shapeEnd.sizeX/2,this._shapeEnd.sizeY/2),r=>{var i;((i=this._leo)==null?void 0:i.shape.type)==Oe.Rectangle&&this.handleUpdateRectangle(r,this.getValidRectangleState(),{flipX:!0})}))}createEdgeHandles(t){this._handles.push(new pi(this,t,()=>!this._leo||!this._shapeEnd?null:this._shapeEnd.type==Oe.Circle?fr.set(this._shapeEnd.diameter/2,0):this._shapeEnd.type==Oe.Rectangle?fr.set(this._shapeEnd.sizeX/2,0):null,r=>{var i,s;((i=this._leo)==null?void 0:i.shape.type)==Oe.Rectangle?this.handleUpdateRectangle(r.setY(0),this.getValidRectangleState()):((s=this._leo)==null?void 0:s.shape.type)==Oe.Circle&&this.handleUpdateCircle(r.setY(0),this.getValidCircleState())})),this._handles.push(new pi(this,t,()=>!this._leo||!this._shapeEnd?null:this._shapeEnd.type==Oe.Circle?fr.set(0,this._shapeEnd.diameter/2):this._shapeEnd.type==Oe.Rectangle?fr.set(0,this._shapeEnd.sizeY/2):null,r=>{var i,s;((i=this._leo)==null?void 0:i.shape.type)==Oe.Rectangle?this.handleUpdateRectangle(r.setX(0),this.getValidRectangleState()):((s=this._leo)==null?void 0:s.shape.type)==Oe.Circle&&this.handleUpdateCircle(r.setX(0),this.getValidCircleState())})),this._handles.push(new pi(this,t,()=>!this._leo||!this._shapeEnd?null:this._shapeEnd.type==Oe.Circle?fr.set(-this._shapeEnd.diameter/2,0):this._shapeEnd.type==Oe.Rectangle?fr.set(-this._shapeEnd.sizeX/2,0):null,r=>{var i,s;((i=this._leo)==null?void 0:i.shape.type)==Oe.Rectangle?this.handleUpdateRectangle(r.setY(0),this.getValidRectangleState(),{flipX:!0}):((s=this._leo)==null?void 0:s.shape.type)==Oe.Circle&&this.handleUpdateCircle(r.setY(0),this.getValidCircleState(),!0)})),this._handles.push(new pi(this,t,()=>!this._leo||!this._shapeEnd?null:this._shapeEnd.type==Oe.Circle?fr.set(0,-this._shapeEnd.diameter/2):this._shapeEnd.type==Oe.Rectangle?fr.set(0,-this._shapeEnd.sizeY/2):null,r=>{var i,s;((i=this._leo)==null?void 0:i.shape.type)==Oe.Rectangle?this.handleUpdateRectangle(r.setX(0),this.getValidRectangleState(),{flipY:!0}):((s=this._leo)==null?void 0:s.shape.type)==Oe.Circle&&this.handleUpdateCircle(r.setX(0),this.getValidCircleState(),!0)}))}getValidRectangleState(){if(!this._leo||!this._shapeStart||!this._shapeEnd||this._shapeStart.type!=Oe.Rectangle||this._shapeEnd.type!=Oe.Rectangle)throw new Error("Unexpected");return{leo:this._leo,shapeStart:this._shapeStart,shapeEnd:this._shapeEnd}}getValidCircleState(){if(!this._leo||!this._shapeStart||!this._shapeEnd||this._shapeStart.type!=Oe.Circle||this._shapeEnd.type!=Oe.Circle)throw new Error("Unexpected");return{leo:this._leo,shapeStart:this._shapeStart,shapeEnd:this._shapeEnd}}handleCommonUpdate(t,r,i){Yc.set(i.x,i.y,0).divideScalar(2),Yc.applyQuaternion(this._quaternionStart).sub(Rl.set(0,0,0).applyQuaternion(this._quaternionStart)),t.position.copy(Rl.copy(this._positionStart).add(Yc)),t.surface.update(r),this._handles.forEach(s=>s.update())}handleUpdateRectangle(t,r,i){const{leo:s,shapeStart:a,shapeEnd:o}=r;o.sizeX=i!=null&&i.flipX?a.sizeX-t.x:a.sizeX+t.x,o.sizeX<.001&&(o.sizeX=.001,t.x=o.sizeX-a.sizeX,i!=null&&i.flipX&&(t.x=-t.x)),o.sizeY=i!=null&&i.flipY?a.sizeY-t.y:a.sizeY+t.y,o.sizeY<.001&&(o.sizeY=.001,t.y=o.sizeY-a.sizeY,i!=null&&i.flipY&&(t.y=-t.y)),this.handleCommonUpdate(s,o,t)}handleUpdateCircle(t,r,i){const{leo:s,shapeStart:a,shapeEnd:o}=r;Math.abs(t.x)<1e-4?(o.diameter=i?a.diameter-t.y:a.diameter+t.y,o.diameter<.001&&(o.diameter=.001,t.y=o.diameter-a.diameter,i&&(t.y=-t.y))):Math.abs(t.y)<1e-4&&(o.diameter=i?a.diameter-t.x:a.diameter+t.x,o.diameter<.001&&(o.diameter=.001,t.x=o.diameter-a.diameter,i&&(t.x=-t.x))),this.handleCommonUpdate(s,o,t)}}class vU extends be{constructor(){super(new oc(100,100,2,2),new Pt({visible:!0,wireframe:!0,side:Un,toneMapped:!1}));P(this,"isTransformControlsPlane",!0);this.type="TransformControlsPlane"}}class wb extends pc{constructor(t,r){super(t,r);P(this,"controls");P(this,"leo",null);this.controls=new gU(this,r),this.scene.add(this.controls)}getType(){return Le.ScaleLeo}shapeChanging(t,r){me.dispatch(Pe.tempPositionSet({x:t.x,y:t.y,z:t.z})),me.dispatch(Pe.tempLeoShapeSet(r))}shapeChanged(t,r){var i;this.leo&&me.dispatch(Te.lightEmittingPartShapeChanged({partId:(i=this.leo)==null?void 0:i.partId,shape:r,position:{x:t.x,y:t.y,z:t.z}})),me.dispatch(Pe.tempPositionCleared()),me.dispatch(Pe.tempLeoShapeCleared())}dispose(){this.controls.detach(),this.scene.remove(this.controls)}onUpdateSelectedItems(t){if(this.leo!=null&&(this.controls.detach(),this.leo=null),t.length!=1)return;const r=t[0].partObject;r instanceof i2&&(this.controls.detach(),this.leo=r,this.controls.attach(this.leo))}onDataUpdate(t){}needMouseDown(t){return!0}handleMouseDown(t){return this.controls.onPointerDown(t.event),this.controls.dragging}needMouseMove(t){return!0}handleMouseMove(t){return this.controls.onPointerHover(t.event),this.controls.dragging&&this.controls.onPointerMove(t.event),this.controls.dragging}needMouseUp(t){return this.controls.dragging}handleMouseUp(t){const r=this.controls.dragging;return this.controls.onPointerUp(t.event),this.controls.dragging&&He.error(Xe.ScaleLeoToolTransformControlShouldBeDeactivatedByNow,"Transform-Control should be deactivated by now!"),r}updateFromCameraInfo(t){this.controls.updateFromCameraInfo(t)}}const jg=new va,yU=new oe,xU=new oe,Hs=new L,Ui=new L,_b=new qe,a2=new Pt({color:new Ce(0,0,0)}),wU=new Pt({visible:!1}),_U=new Pt({color:new Ce(1,0,0)}),bU=new Pt({color:new Ce(0,1,0)}),SU=new Pt({color:new Ce(0,0,1)}),MU=new Pt({color:new Ce(239/255,138/255,25/255)});function EU(){return new ws(.01)}const pp=class extends ot{constructor(t,r,i,s){super();P(this,"mesh");P(this,"hitMesh");P(this,"_angleOffset",0);this.controls=t,this.radius=r,this.fetchAngle=i,this.positionUpdated=s,this.mesh=new be(pp.geometry,a2),this.mesh.layers.disableAll(),this.mesh.layers.enable(De.ToolLayer),this.add(this.mesh),this.hitMesh=new be(pp.geometry,wU),this.hitMesh.layers.disableAll(),this.hitMesh.layers.enable(De.ToolLayer),this.hitMesh.scale.set(2,2,2),this.add(this.hitMesh)}get angleOffset(){return this._angleOffset}down(t,r){const i=this.fetchAngle();if(!i)return;Hs.set(1,0,0),Ui.set(t,r,0);const s=Hs.angleTo(Ui),a=st.radToDeg(Hs.cross(Ui).z<0?-s:s);this._angleOffset=i-a}update(){if(!this.controls.joint)return;const t=Dr.cameraInfo,r=t!=null?vt.getZoomScale(this.controls.joint,t):1;this.updateInternal(r)}moved(){this.positionUpdated(),this.update()}setMaterial(t){this.mesh.material=t}updateScale(t){const r=vt.getZoomScale(this,t);if(this.scale.set(r,r,r),!this.controls.joint)return;const i=vt.getZoomScale(this.controls.joint,t);this.updateInternal(i)}updateInternal(t){const r=this.fetchAngle();if(r==null){this.visible=!1;return}this.visible=!0;const i=yU.set(this.radius*t,0).rotateAround(xU.set(0,0),st.degToRad(r));Ui.set(i.x,i.y,0),Ui.applyMatrix4(this.controls.plane.matrixWorld),this.position.copy(Ui),this.updateMatrix()}};let Ya=pp;P(Ya,"geometry",EU());class AU extends ot{constructor(t,r){super();P(this,"_enabled",!0);P(this,"_dragging",!1);P(this,"_pointStart",new oe);P(this,"_pointEnd",new oe);P(this,"_matrixWorldInverse",new ze);P(this,"_handles",new Array);P(this,"_plane");P(this,"_isDetached$",new Mn);P(this,"_joint",null);P(this,"_currentHandle",null);this.changeHandler=t,this.viewInfo=r,this._plane=this.createPlane(),this.add(this._plane),this.visible=!1;const i=()=>{var o,l;Hs.set(1,0,0),Ui.set(this._pointEnd.x,this._pointEnd.y,0);const s=Hs.angleTo(Ui),a=(l=(o=this._currentHandle)==null?void 0:o.angleOffset)!=null?l:0;return st.radToDeg(Hs.cross(Ui).z<0?-s:s)+a};this._handles.push(new Ya(this,Si.ArcSize,()=>this._joint==null?null:this.getMinAngle(),()=>{if(this._joint==null)return null;let s=i();const a=this.getAxisData();s>a.max&&(s=-180),s>a.default&&(s=a.default),this._joint.object.updateAxis(this._joint.axis,{...a,min:s})})),this._handles.push(new Ya(this,Si.LineSize,()=>this._joint==null?null:this.getDefaultAngle(),()=>{if(this._joint==null)return null;let s=i();const a=this.getAxisData();s<a.min&&(s=a.min),s>a.max&&(s=a.max),this._joint.object.updateAxis(this._joint.axis,{...a,default:s})})),this._handles.push(new Ya(this,Si.ArcSize,()=>this._joint==null?null:this.getMaxAngle(),()=>{if(this._joint==null)return null;let s=i();const a=this.getAxisData();s<a.min&&(s=180),s<a.default&&(s=a.default),this._joint.object.updateAxis(this._joint.axis,{...a,max:s})})),this.add(...this._handles)}get joint(){var t,r;return(r=(t=this._joint)==null?void 0:t.object)!=null?r:null}get enabled(){return this._enabled}get dragging(){return this._dragging}get plane(){return this._plane}attachJoint(t,r){const i=at.selectById(me.getState().luminaire.parts,t.partId);if(!i||i.type!=Y.Joint)throw new Error(`No joint part with id ${t.partId} available!`);return this._joint={axis:r,object:t,data:{...r==xt.X?i.xAxis:r==xt.Y?i.yAxis:i.zAxis}},this.updatePlane(),En.partTransformation$(this._joint.object.partId).pipe(an(this._isDetached$)).subscribe(()=>this.update()),this._handles.forEach(s=>s.setMaterial(this.getHandleMaterial())),this.updateScale(),this.visible=!0,this}detach(){return this._isDetached$.next(!0),this._joint=null,this.visible=!1,this}updateFromCameraInfo(t){this.updateScale(t)}getHandleMaterial(){return this._joint==null?a2:this._joint.axis==xt.X?_U:this._joint.axis==xt.Y?bU:SU}updateScale(t){const r=t!=null?t:Dr.cameraInfo;!r||this._handles.forEach(i=>i.updateScale(r))}update(){if(this._joint==null)return;const t=this._joint.axis,r=this._joint.object.data;this._joint.data={...t==xt.X?r.xAxis:t==xt.Y?r.yAxis:r.zAxis},this.updatePlane()}updatePlane(){if(this._joint==null)return;const t=this._joint.axis,r=this._joint.object;r.updateMatrixWorld(),r.matrixWorld.decompose(Hs,_b,Ui),this._plane.position.copy(Hs);const i=_b,s=vt.getJointAxisRotations(r.data);t==xt.X?this._plane.quaternion.copy(i.multiply(s.xAxis)):t==xt.Y?this._plane.quaternion.copy(i.multiply(s.yAxis)):t==xt.Z&&this._plane.quaternion.copy(i.multiply(s.zAxis)),this._plane.updateMatrix(),this._plane.updateMatrixWorld(),this._handles.forEach(a=>a.update())}getObjectData(){if(this._joint==null)throw new Error("EditJointControls-Instance has invalid state!");return this._joint.axis==xt.X?this._joint.object.data.xAxis:this._joint.axis==xt.Y?this._joint.object.data.yAxis:this._joint.object.data.zAxis}getAxisData(){if(this._joint==null)throw new Error("EditJointControls-Instance has invalid state!");return this._joint.data}getDefaultAngle(){return this.getObjectData().default}getMinAngle(){return this.getObjectData().min}getMaxAngle(){return this.getObjectData().max}getPointer(t){if(document.pointerLockElement)return{x:0,y:0,button:t.button,ctrlKey:t.ctrlKey};var r=t,i=r.changedTouches?r.changedTouches[0]:t,s=this.viewInfo.viewport.rect;return{x:(i.clientX-s.left)/s.width*2-1,y:-(i.clientY-s.top)/s.height*2+1,button:t.button,ctrlKey:t.ctrlKey}}onPointerHover(t){!this.enabled||this.pointerHover(this.getPointer(t))}onPointerDown(t){!this.enabled||(this.pointerHover(this.getPointer(t)),this.pointerDown(this.getPointer(t)))}onPointerMove(t){!this.enabled||this.pointerMove(this.getPointer(t))}onPointerUp(t){!this.enabled||this.pointerUp(this.getPointer(t))}createPlane(){return new be(new oc(50,50,2,2),new Pt({visible:!1,wireframe:!0,side:Un,toneMapped:!1}))}setRayCaster(t){jg.setFromCamera(t,this.viewInfo.cameraSystem.currentCamera),jg.layers.enableAll()}intersectObjectWithRay(t,r){const i=jg.intersectObject(t,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||r)return i[s];return null}pointerHover(t){var s,a;if(this._joint==null||this.dragging==!0)return;this.setRayCaster(t);const r=this.intersectObjectWithRay(this,!1),i=this._currentHandle;this._currentHandle=r&&((s=r.object)==null?void 0:s.parent)instanceof Ya?r.object.parent:null,i!=this._currentHandle&&(i==null||i.setMaterial(this.getHandleMaterial()),(a=this._currentHandle)==null||a.setMaterial(MU))}pointerDown(t){if(!this._joint||this.dragging==!0||t.button!=0||!this._currentHandle)return;this.setRayCaster(t);const r=this.intersectObjectWithRay(this.plane,!0);r&&(this._matrixWorldInverse.copy(this.plane.matrixWorld).invert(),r.point.applyMatrix4(this._matrixWorldInverse),this._currentHandle.down(r.point.x,r.point.y),this._pointStart.set(r.point.x,r.point.y),this._pointEnd.set(r.point.x,r.point.y)),this._dragging=!0}pointerMove(t){if(this._joint==null||this._currentHandle==null||this.dragging==!1||t.button!=0)return;this.setRayCaster(t);const r=this.intersectObjectWithRay(this.plane,!0);!r||(r.point.applyMatrix4(this._matrixWorldInverse),this._pointEnd.set(r.point.x,r.point.y),this._currentHandle.moved(),this.dragging&&this.changeHandler.axisChanging(this._joint.axis,this.getObjectData()))}pointerUp(t){t.button!=0||this.dragging==!1||this._joint==null||(this.changeHandler.axisChanged(this._joint.axis,this.getObjectData()),this._joint.data={...this.getObjectData()},this._dragging=!1)}}class bb extends pc{constructor(t,r){super(t,r);P(this,"_controls");P(this,"_joint",null);P(this,"_axis",null);this._controls=new AU(this,r),this.scene.add(this._controls)}dispose(){super.dispose(),this.scene.remove(this._controls)}getType(){return Le.EditJoint}axisChanging(t,r){me.dispatch(Pe.tempJointAxisDataSet({...r,axis:t}))}axisChanged(t,r){!this._joint||(me.dispatch(Pe.tempJointAxisDataCleared()),t==xt.X?me.dispatch(Te.jointPartXAxisChanged({partId:this._joint.partId,axis:r})):t==xt.Y?me.dispatch(Te.jointPartYAxisChanged({partId:this._joint.partId,axis:r})):t==xt.Z&&me.dispatch(Te.jointPartZAxisChanged({partId:this._joint.partId,axis:r})))}onUpdateSelectedItems(t){if(!!this._joint)if(t.length==1&&t[0].type==Y.Joint){const r=t[0];r.axis!=null&&this._axis!=null&&(r.axis!=this._axis||r.id!=this._joint.partId)&&me.dispatch(je.toolDataSet({type:Le.EditJoint,jointId:r.id,axis:r.axis}))}else this._controls.detach(),me.dispatch(je.toolDataSet({type:Le.None}))}onDataUpdate(t){this._controls.detach(),this._joint=null,this._axis=null,t.type==Le.EditJoint&&(this._axis=t.axis,this.scene.traverseParts(r=>{r.partType==Y.Joint&&r.partId==t.jointId&&(this._joint=r)}),this._joint!=null&&this._controls.attachJoint(this._joint,this._axis))}needMouseDown(t){return!0}handleMouseDown(t){return this._controls.onPointerDown(t.event),this._controls.dragging}needMouseMove(t){return!0}handleMouseMove(t){return this._controls.onPointerHover(t.event),this._controls.dragging&&this._controls.onPointerMove(t.event),this._controls.dragging}needMouseUp(t){return this._controls.dragging}handleMouseUp(t){const r=this._controls.dragging;return this._controls.onPointerUp(t.event),this._controls.dragging&&He.warn(Xe.EditJointToolTransformControlShouldBeDeactivatedByNow,"Transform-Control should be deactivated by now!"),r}updateFromCameraInfo(t){this._controls.updateFromCameraInfo(t)}}class TU extends um{constructor(t,r){super(t,r);P(this,"userTool",null);P(this,"lastCameraInfo",null)}dispose(){this.destroyUserTool()}needEvent(t,r){return this.userTool!=null?this.userTool.needEvent(t,r):!1}handleEvent(t,r){return this.userTool!=null?this.userTool.handleEvent(t,r):!1}destroyUserTool(){this.userTool!=null&&(this.userTool.dispose(),this.userTool=null)}canSetUserTool(t){return t==Le.None?!0:sn.selectTotal(me.getState().editor.selection)==1}setTool(t){var i,s;const r=t.type;r==Le.Translate||r==Le.Rotate?(this.ensureTransformTool(),r==Le.Translate?this.userTool.setMode(Ar.Move):this.userTool.setMode(Ar.Rotate)):r==Le.LesEdit?this.ensureLesEditTool():r==Le.InsertPosition?this.ensureInserPositionTool():r==Le.Measurement?this.ensureMeasurementTool():r==Le.ScaleLeo?this.ensureScaleLeoTool():r==Le.EditJoint?this.ensureJointEdit():this.destroyUserTool(),this.lastCameraInfo&&((i=this.userTool)==null||i.updateFromCameraInfo(this.lastCameraInfo)),(s=this.userTool)==null||s.updateData(t)}getToolType(){return this.userTool==null?Le.None:this.userTool.getType()}ensureTransformTool(){this.userTool instanceof hb||(this.userTool!=null&&this.destroyUserTool(),this.userTool=new hb(this.scene,this.viewInfo))}ensureLesEditTool(){this.userTool instanceof pb||(this.userTool!=null&&this.destroyUserTool(),this.userTool=new pb(this.scene,this.viewInfo))}ensureInserPositionTool(){this.userTool instanceof mb||(this.userTool!=null&&this.destroyUserTool(),this.userTool=new mb(this.scene,this.viewInfo))}ensureMeasurementTool(){this.userTool instanceof yb||(this.userTool!=null&&this.destroyUserTool(),this.userTool=new yb(this.scene,this.viewInfo))}ensureScaleLeoTool(){this.userTool instanceof wb||(this.userTool!=null&&this.destroyUserTool(),this.userTool=new wb(this.scene,this.viewInfo))}ensureJointEdit(){this.userTool instanceof bb||(this.userTool!=null&&this.destroyUserTool(),this.userTool=new bb(this.scene,this.viewInfo))}setSelectedItems(t){this.userTool!=null&&this.userTool.updateSelectedItems(t)}updateFromCameraInfo(t){this.lastCameraInfo=t,this.userTool!=null&&this.userTool.updateFromCameraInfo(t)}}class Xl extends nt{constructor(){super();P(this,"isMappedBufferGeometry",!0);P(this,"triangleMapping",new Map);P(this,"polygons",new Array);P(this,"polygonCount",0)}copy(t){return super.copy(t),this.triangleMapping=new Map(t.triangleMapping),this.polygons=t.polygons.map(r=>({loopIndices:[...r.loopIndices],firstVertexIndex:r.firstVertexIndex,lastVertexIndex:r.lastVertexIndex})),this}clone(){return new Xl().copy(this)}}class CU{constructor(e,t){this.parent=e,this.setMeshFromMeshDefinition(t),this.updateMaterials(t)}update(e,t){const r=mt.meshDefinition(t)(me.getState());if(r==null){He.warn(Xe.GeometryDefinitionNotAvailable_Update,`Geometry definition (${t}) not available!`);return}if(e.type!=Y.Geometry){He.warn(Xe.InvalidDataTypeInGeometryUpdate,"Invalid data type in scene data update!");return}const i=vt.getScaleFactor(r.units);this.parent.groupMeshes.forEach(s=>{s.scale.set(i,i,i),s.setSceneVisibility(!e.hiddenFaceGroups.includes(s.groupIndex))}),this.parent.wireframe.forEach(s=>{s.scale.set(i,i,i)})}updateMaterials(e){const t=Xt.getData(e.meshUrl);this.parent.groupMeshes.forEach(r=>{const i=t.group.children[r.groupIndex];r.material=Array.isArray(i.material)?i.material:[i.material]})}setMeshFromMeshDefinition(e){if(!Xt.hasData(e.meshUrl)){He.warn(Xe.UnknownMeshUrl,"Unknown mesh url : "+e.meshUrl);return}const t=Xt.getData(e.meshUrl),r=vt.getScaleFactor(e.units);t.group.children.forEach((i,s)=>{i instanceof be||He.throw(Xe.ImportedChildOfGeometryPartObjectMustBeOfTypeMesh,"Imported child has to be of type Mesh!");const a=i.geometry;a instanceof Xl||He.throw(Xe.ImportedGeometryMustBeOfTypeMappedBufferGeometry,"Imported Geometry has to be of type MappedBufferGeometry!");const o=new wa(s,a);o.scale.set(r,r,r),this.parent.addVisual(o)}),t.wireframeGroup.children.forEach(i=>{i instanceof ys||He.throw(Xe.ImportedWireframeMustBeOfTypeLineSegments,"Imported wireframe child has to be of type LineSegments!");const s=new ys(i.geometry,new Gn({color:new Ce(0,0,0)}));s.scale.set(r,r,r),s.layers.disableAll(),s.layers.enable(De.WireframeLayer),this.parent.addWireframe(s)})}}class ao extends Vn{constructor(t){super(Y.Geometry,t.id);P(this,"isGeometryPartObject",!0);P(this,"geometry",null);He.debug("creating: GeometryPartObject: "+this.uuid),this.createGeometry(t),this.name=t.name}get groupMeshes(){return this.visuals.filter(t=>t instanceof wa).map(t=>t)}createGeometry(t){const r=t.meshId,i=mt.meshDefinition(r)(me.getState());if(i==null){He.warn(Xe.GeometryDefinitionNotAvailable_Create,`Geometry definition (${r}) not available!`);return}const s=new CU(this,i);if(En.geometryMeshMaterial$(r).pipe(an(this.isDisposed$)).subscribe(a=>{s.updateMaterials(i)}),this.geometry=s,this.geometry==null){He.warn(Xe.NoGeometryPartCreated,`No geometry for part ${t.name} (${t.id}) created!`);return}}onUpdate(t){super.onUpdate(t);const r=t.part;r.type!=Y.Geometry&&He.throw(Xe.InvalidPartTypeOnGeometryPartUpdate,`Invalid part type: ${r.type.toString()}. Expected type: ${Y.Geometry.toString()}`),this.geometry==null&&He.throw(Xe.GeometryPartObjectNotInitialized,`GeometryPartObject (${this.partId}) is not initialized!`);const i=r;this.geometry.update(t,i.meshId)}}class PU{constructor(e,t){P(this,"userToolHost");P(this,"tools",new Array);P(this,"isDisposed$",new Mn);P(this,"cameraTool");this.scene=e,this.viewInfo=t,this.userToolHost=this.createUserToolHost(),this.cameraTool=this.createCameraTool(),this.tools.push(this.userToolHost),this.tools.push(this.cameraTool),this.tools.push(this.createSelectionTool()),this.connectStore()}dispose(){this.isDisposed$.next(!0),this.tools.forEach(e=>e.dispose())}createUserToolHost(){return new TU(this.scene,this.viewInfo)}createCameraTool(){return new $5(this.scene,this.viewInfo)}createSelectionTool(){return new q5(this.scene,this.viewInfo)}getSceneItemsFromSelection(e){const t=new Map;return this.scene.traverse(i=>{i instanceof Vn&&e.find(s=>s.id==i.partId)!=null&&t.set(i.partId,i)}),e.map(i=>{const s=t.get(i.id);if(!s)throw new Error(`No scene object for part id (${i.id}) available!`);if(i.type==Y.Geometry){if(!(s instanceof ao))throw new Error("Invalid scene object type. GeometryPartObject expected!");return{type:Y.Geometry,id:i.id,partObject:s}}if(i.type==Y.Joint){if(!(s instanceof Si))throw new Error("Invalid scene object type. JointPartObject expected!");return{type:Y.Joint,id:i.id,partObject:s,axis:i.axis}}return{type:null,id:i.id,partObject:s}})}connectStore(){En.editorActiveTool$.pipe(an(this.isDisposed$)).subscribe(e=>{this.userToolHost.setTool(e);const t=bt.selection(me.getState()),r=this.getSceneItemsFromSelection(t);this.userToolHost.setSelectedItems(r)}),En.editorSelectedItems$.pipe(an(this.isDisposed$)).subscribe(e=>{const t=this.getSceneItemsFromSelection(e);this.userToolHost.setSelectedItems(t)})}preRenderUpdate(){this.cameraTool.update()}propagateEventToTools(e,t,r){let i=new Q5(e,t);this.tools.forEach(s=>{s.needEvent(e,i)&&s.handleEvent(e,i)&&i.setHandled()})}updateFromCameraInfo(e){for(const t of this.tools)t.updateFromCameraInfo(e)}}class ap extends Vn{constructor(t,r){super(Y.LightEmittingSurface,t.id);P(this,"data",new Map);this.targetGeometry=r,this.updateFromPart(t)}onUpdate(t){const r=t.part;r.type==Y.LightEmittingSurface&&this.updateFromPart(r)}updateFromPart(t){this.data.clear(),Il.selectAll(t.faceAssignments).forEach(r=>{let i=this.data.get(r.groupId);i||(i=new Array,this.data.set(r.groupId,i));const s=this.targetGeometry.groupMeshes.find(o=>o.groupIndex==r.groupId);if(!s){He.warn(Xe.NoGroupMeshWithGivenIndex,`No group mesh with index (${r.groupId}) found!`);return}const a=s.geometry;if(!a){He.warn(Xe.GroupMeshHasNoGeometry,`Group mesh with index (${r.groupId}) has no geometry!`);return}if(r.type==kn.Single){if(a.polygons.length<=r.faceId){He.warn(Xe.GroupMeshGeometryHasNoFace,`Geometry of group mesh with index (${r.groupId}) has no face with index ${r.faceId}!`);return}const o=a.polygons[r.faceId];i.push({start:o.firstVertexIndex,count:o.lastVertexIndex-o.firstVertexIndex+1})}else if(r.type==kn.Range){if(a.polygons.length<=r.startFaceId||a.polygons.length<=r.endFaceId){He.warn(Xe.LightEmittingSurfaceRangeIsNotValid,`Light emitting surface range assignment is not valid! Range: ${r.startFaceId}-${r.endFaceId}, max face index: ${a.polygons.length-1}`);return}else if(r.startFaceId>r.endFaceId){He.warn(Xe.LightEmittingSurfaceRangeStartIsInvalid,"Invalid LES range assignment: end is lower than start!");return}let o=0;for(let l=r.startFaceId;l<=r.endFaceId;l++){const c=a.polygons[l];o+=c.lastVertexIndex-c.firstVertexIndex+1}i.push({start:a.polygons[r.startFaceId].firstVertexIndex,count:o})}else He.error(Xe.UnknownLesAssignmentType,`Unknown LesAssignmentType: ${r.type}`)})}visitGroupMeshes(t){this.data.forEach((r,i)=>t(i,r))}}class IU{constructor(e,t){P(this,"isDisposed$",new Mn);P(this,"currentSceneSelection",new Array);this.scene=e,this.outlinePass=t,z5([En.editorSelection$,En.dragDropHoverPart$]).pipe(an(this.isDisposed$)).subscribe(r=>{const i=r[0],s=r[1];let a=!1,o=!1;if(this.scene.traverseParts(l=>{o=o||this.visitSelectedLightEmittingSurface(l,t,i),a=a||this.visitSelectedPart(l,t,i,s)}),!a){const l=new Array;t.setSelection(l)}if(!o){const l={key:null,value:[]};t.setLightEmittingSurfaceRenderData(l)}this.updateSelectedLayer(i.parts.map(l=>l.partId),i.tool.type==Le.LesEdit)})}dispose(){this.isDisposed$.next(!0)}visitSelectedLightEmittingSurface(e,t,r){const i={key:null,value:[]};if(!(e instanceof ap))return t.setLightEmittingSurfaceRenderData(i),!1;const s=r.parts.find(a=>a.partId==e.partId);if(!s)return t.setLightEmittingSurfaceRenderData(i),!1;if(s&&s.type==Y.LightEmittingSurface&&e instanceof ap){const a=e.targetGeometry.groupMeshes.slice();i.key=e,i.value=a}return t.setLightEmittingSurfaceRenderData(i),!0}visitSelectedPart(e,t,r,i){const s=new Array,a=r.parts.find(o=>o.partId==e.partId);return!a&&(!i||e.partId!=i.id)?!1:(e.visuals.forEach(o=>{if(!(o instanceof be)||o.geometry.type=="TubeGeometry"||o.layers.mask&1<<De.NotHighlightedLayer)return;const l={mesh:o};if(a&&a.type==Y.Geometry&&o instanceof wa){const c=a.faceGroups.find(u=>u.groupIndex==o.groupIndex);c&&(l.groupMesh=o,r.tool.type==Le.LesEdit&&(l.faceIndices=c.faceIndices))}s.push(l)}),t.setSelection(s),!0)}updateSelectedLayer(e,t){const r=this.currentSceneSelection.slice();this.currentSceneSelection.splice(0,this.currentSceneSelection.length),r.forEach(i=>{i.partObject.visuals.forEach(s=>{s.layers.disable(De.SelectedLayer)})}),r.forEach(i=>{i.partObject.wireframe.forEach(s=>{s.layers.disable(De.SelectedWireframeLayer)})}),e.forEach(i=>{let s=null;if(this.scene.traverse(o=>{o instanceof Vn&&o.partId==i&&(s=o)}),s==null)throw new Error(`No part object for id ${i} found in scene!`);const a=s;a.visuals.forEach(o=>o.layers.enable(De.SelectedLayer)),t&&a.wireframe.forEach(o=>o.layers.enable(De.SelectedWireframeLayer)),this.currentSceneSelection.push({partId:i,partObject:s})})}}class LU{constructor(e,t,r,i){P(this,"mouseDownHandler",e=>{this.toolManager.propagateEventToTools(ut.MouseDown,e,this.layers)});P(this,"mouseMoveHandler",e=>{this.toolManager.propagateEventToTools(ut.MouseMove,e,this.layers)});P(this,"mouseUpHandler",e=>{this.toolManager.propagateEventToTools(ut.MouseUp,e,this.layers)});P(this,"wheelHandler",e=>{this.toolManager.propagateEventToTools(ut.MouseWheel,e,this.layers)});P(this,"touchStartHandler",e=>{this.toolManager.propagateEventToTools(ut.TouchStart,e,this.layers)});P(this,"touchMoveHandler",e=>{this.toolManager.propagateEventToTools(ut.TouchMove,e,this.layers)});P(this,"touchEndHandler",e=>{this.toolManager.propagateEventToTools(ut.TouchEnd,e,this.layers)});P(this,"touchCancelHandler",e=>{this.toolManager.propagateEventToTools(ut.TouchCancel,e,this.layers)});P(this,"touchLeaveHandler",e=>{this.toolManager.propagateEventToTools(ut.TouchLeave,e,this.layers)});P(this,"keyDownHandler",e=>{this.isFromInput(e)||this.defaultEventHandler.handleKeyDown(e)||this.toolManager.propagateEventToTools(ut.KeyDown,e,this.layers)});P(this,"keyUpHandler",e=>{this.isFromInput(e)||this.defaultEventHandler.handleKeyUp(e)||this.toolManager.propagateEventToTools(ut.KeyUp,e,this.layers)});P(this,"contextMenuHandler",e=>{this.toolManager.propagateEventToTools(ut.ContextMenu,e,this.layers)});this.domElement=e,this.toolManager=t,this.defaultEventHandler=r,this.layers=i,this.domElement.addEventListener("mousedown",this.mouseDownHandler,!1),document.addEventListener("mousemove",this.mouseMoveHandler,!1),document.addEventListener("mouseup",this.mouseUpHandler,!1),this.domElement.addEventListener("wheel",this.wheelHandler,!1),this.domElement.addEventListener("touchstart",this.touchStartHandler,!1),this.domElement.addEventListener("touchend",this.touchEndHandler,!1),this.domElement.addEventListener("touchmove",this.touchMoveHandler,!1),this.domElement.addEventListener("touchcancel",this.touchCancelHandler,!1),this.domElement.addEventListener("touchleave",this.touchLeaveHandler,!1),document.addEventListener("keydown",this.keyDownHandler,!1),document.addEventListener("keyup",this.keyUpHandler,!1),this.domElement.addEventListener("contextmenu",this.contextMenuHandler,!1)}dispose(){this.domElement.removeEventListener("mousedown",this.mouseDownHandler,!1),document.removeEventListener("mousemove",this.mouseMoveHandler,!1),document.removeEventListener("mouseup",this.mouseUpHandler,!1),this.domElement.removeEventListener("wheel",this.wheelHandler,!1),this.domElement.removeEventListener("touchstart",this.touchStartHandler,!1),this.domElement.removeEventListener("touchend",this.touchEndHandler,!1),this.domElement.removeEventListener("touchmove",this.touchMoveHandler,!1),this.domElement.removeEventListener("touchcancel",this.touchCancelHandler,!1),this.domElement.removeEventListener("touchleave",this.touchLeaveHandler,!1),document.removeEventListener("keydown",this.keyDownHandler,!1),document.removeEventListener("keyup",this.keyUpHandler,!1),this.domElement.removeEventListener("contextmenu",this.contextMenuHandler,!1)}isFromInput(e){const t=e.target;return t.localName=="input"||t.localName=="select"||t.localName=="textarea"}}class RU extends Ea{constructor(t){super();P(this,"isDisposed$",new Mn);this.childSync=t,He.debug("creating scene: "+this.uuid),this.layers.disableAll(),this.layers.enable(De.GeometryLayer),En.sceneData$.pipe(an(this.isDisposed$)).subscribe(r=>this.update(r))}get parts(){return this.children.filter(t=>t instanceof Vn).map(t=>t)}addPart(t){this.add(t)}removePart(t){this.remove(t)}clearParts(){this.childSync.disposeChildren(this)}dispose(){this.isDisposed$.next(!0),this.clearParts()}update(t){this.childSync.updateChildren(t,0,this)}findPartRecursive(t){for(let r=0;r<this.parts.length;r++){const i=this.parts[r];if(i.partId==t)return i;const s=i.findPartRecursive(t);if(s)return s}return null}traverseParts(t){this.parts.forEach(r=>r.traverseParts(t))}}var Yl={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;

		}`};class hm{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const FU=new Qn(-1,1,1,-1,0,1),Sx=new nt;Sx.setAttribute("position",new Ye([-1,3,0,-1,-1,0,3,-1,0],3));Sx.setAttribute("uv",new Ye([0,2,0,0,2,0],2));class DU{constructor(e){this._mesh=new be(Sx,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,FU)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class f0 extends hm{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof wn?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Zp.clone(e.uniforms),this.material=new wn({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new DU(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class Sb extends hm{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let a,o;this.inverse?(a=0,o=1):(a=1,o=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),s.buffers.stencil.setClear(o),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class NU extends hm{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class kU{constructor(e,t){if(this.renderer=e,t===void 0){const r={minFilter:_n,magFilter:_n,format:bn},i=e.getSize(new oe);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,t=new dn(this._width*this._pixelRatio,this._height*this._pixelRatio,r),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],Yl===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),f0===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new f0(Yl),this.clock=new KO}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,s=this.passes.length;i<s;i++){const a=this.passes[i];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),a.needsSwap){if(r){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}Sb!==void 0&&(a instanceof Sb?r=!0:a instanceof NU&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new oe);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}new Qn(-1,1,1,-1,0,1);const o2=new nt;o2.setAttribute("position",new Ye([-1,3,0,-1,-1,0,3,-1,0],3));o2.setAttribute("uv",new Ye([0,2,0,0,2,0],2));const OU={uniforms:{tDiffuse:{value:null},resolution:{value:new oe(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D tDiffuse;

		uniform vec2 resolution;

		varying vec2 vUv;

		#define FXAA_PC 1
		#define FXAA_GLSL_100 1
		#define FXAA_QUALITY_PRESET 12

		#define FXAA_GREEN_AS_LUMA 1

		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_PC_CONSOLE
				//
				// The console algorithm for PC is included
				// for developers targeting really low spec machines.
				// Likely better to just run FXAA_PC, and use a really low preset.
				//
				#define FXAA_PC_CONSOLE 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_GLSL_120
				#define FXAA_GLSL_120 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_GLSL_130
				#define FXAA_GLSL_130 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_HLSL_3
				#define FXAA_HLSL_3 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_HLSL_4
				#define FXAA_HLSL_4 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_HLSL_5
				#define FXAA_HLSL_5 0
		#endif
		/*==========================================================================*/
		#ifndef FXAA_GREEN_AS_LUMA
				//
				// For those using non-linear color,
				// and either not able to get luma in alpha, or not wanting to,
				// this enables FXAA to run using green as a proxy for luma.
				// So with this enabled, no need to pack luma in alpha.
				//
				// This will turn off AA on anything which lacks some amount of green.
				// Pure red and blue or combination of only R and B, will get no AA.
				//
				// Might want to lower the settings for both,
				//		fxaaConsoleEdgeThresholdMin
				//		fxaaQualityEdgeThresholdMin
				// In order to insure AA does not get turned off on colors
				// which contain a minor amount of green.
				//
				// 1 = On.
				// 0 = Off.
				//
				#define FXAA_GREEN_AS_LUMA 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_EARLY_EXIT
				//
				// Controls algorithm's early exit path.
				// On PS3 turning this ON adds 2 cycles to the shader.
				// On 360 turning this OFF adds 10ths of a millisecond to the shader.
				// Turning this off on console will result in a more blurry image.
				// So this defaults to on.
				//
				// 1 = On.
				// 0 = Off.
				//
				#define FXAA_EARLY_EXIT 1
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_DISCARD
				//
				// Only valid for PC OpenGL currently.
				// Probably will not work when FXAA_GREEN_AS_LUMA = 1.
				//
				// 1 = Use discard on pixels which don't need AA.
				//		 For APIs which enable concurrent TEX+ROP from same surface.
				// 0 = Return unchanged color on pixels which don't need AA.
				//
				#define FXAA_DISCARD 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_FAST_PIXEL_OFFSET
				//
				// Used for GLSL 120 only.
				//
				// 1 = GL API supports fast pixel offsets
				// 0 = do not use fast pixel offsets
				//
				#ifdef GL_EXT_gpu_shader4
						#define FXAA_FAST_PIXEL_OFFSET 1
				#endif
				#ifdef GL_NV_gpu_shader5
						#define FXAA_FAST_PIXEL_OFFSET 1
				#endif
				#ifdef GL_ARB_gpu_shader5
						#define FXAA_FAST_PIXEL_OFFSET 1
				#endif
				#ifndef FXAA_FAST_PIXEL_OFFSET
						#define FXAA_FAST_PIXEL_OFFSET 0
				#endif
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_GATHER4_ALPHA
				//
				// 1 = API supports gather4 on alpha channel.
				// 0 = API does not support gather4 on alpha channel.
				//
				#if (FXAA_HLSL_5 == 1)
						#define FXAA_GATHER4_ALPHA 1
				#endif
				#ifdef GL_ARB_gpu_shader5
						#define FXAA_GATHER4_ALPHA 1
				#endif
				#ifdef GL_NV_gpu_shader5
						#define FXAA_GATHER4_ALPHA 1
				#endif
				#ifndef FXAA_GATHER4_ALPHA
						#define FXAA_GATHER4_ALPHA 0
				#endif
		#endif


		/*============================================================================
														FXAA QUALITY - TUNING KNOBS
		------------------------------------------------------------------------------
		NOTE the other tuning knobs are now in the shader function inputs!
		============================================================================*/
		#ifndef FXAA_QUALITY_PRESET
				//
				// Choose the quality preset.
				// This needs to be compiled into the shader as it effects code.
				// Best option to include multiple presets is to
				// in each shader define the preset, then include this file.
				//
				// OPTIONS
				// -----------------------------------------------------------------------
				// 10 to 15 - default medium dither (10=fastest, 15=highest quality)
				// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)
				// 39			 - no dither, very expensive
				//
				// NOTES
				// -----------------------------------------------------------------------
				// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)
				// 13 = about same speed as FXAA 3.9 and better than 12
				// 23 = closest to FXAA 3.9 visually and performance wise
				//	_ = the lowest digit is directly related to performance
				// _	= the highest digit is directly related to style
				//
				#define FXAA_QUALITY_PRESET 12
		#endif


		/*============================================================================

															 FXAA QUALITY - PRESETS

		============================================================================*/

		/*============================================================================
												 FXAA QUALITY - MEDIUM DITHER PRESETS
		============================================================================*/
		#if (FXAA_QUALITY_PRESET == 10)
				#define FXAA_QUALITY_PS 3
				#define FXAA_QUALITY_P0 1.5
				#define FXAA_QUALITY_P1 3.0
				#define FXAA_QUALITY_P2 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 11)
				#define FXAA_QUALITY_PS 4
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 3.0
				#define FXAA_QUALITY_P3 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 12)
				#define FXAA_QUALITY_PS 5
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 4.0
				#define FXAA_QUALITY_P4 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 13)
				#define FXAA_QUALITY_PS 6
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 4.0
				#define FXAA_QUALITY_P5 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 14)
				#define FXAA_QUALITY_PS 7
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 4.0
				#define FXAA_QUALITY_P6 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 15)
				#define FXAA_QUALITY_PS 8
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 4.0
				#define FXAA_QUALITY_P7 12.0
		#endif

		/*============================================================================
												 FXAA QUALITY - LOW DITHER PRESETS
		============================================================================*/
		#if (FXAA_QUALITY_PRESET == 20)
				#define FXAA_QUALITY_PS 3
				#define FXAA_QUALITY_P0 1.5
				#define FXAA_QUALITY_P1 2.0
				#define FXAA_QUALITY_P2 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 21)
				#define FXAA_QUALITY_PS 4
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 22)
				#define FXAA_QUALITY_PS 5
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 23)
				#define FXAA_QUALITY_PS 6
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 24)
				#define FXAA_QUALITY_PS 7
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 3.0
				#define FXAA_QUALITY_P6 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 25)
				#define FXAA_QUALITY_PS 8
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 4.0
				#define FXAA_QUALITY_P7 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 26)
				#define FXAA_QUALITY_PS 9
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 4.0
				#define FXAA_QUALITY_P8 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 27)
				#define FXAA_QUALITY_PS 10
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 2.0
				#define FXAA_QUALITY_P8 4.0
				#define FXAA_QUALITY_P9 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 28)
				#define FXAA_QUALITY_PS 11
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 2.0
				#define FXAA_QUALITY_P8 2.0
				#define FXAA_QUALITY_P9 4.0
				#define FXAA_QUALITY_P10 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 29)
				#define FXAA_QUALITY_PS 12
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 2.0
				#define FXAA_QUALITY_P8 2.0
				#define FXAA_QUALITY_P9 2.0
				#define FXAA_QUALITY_P10 4.0
				#define FXAA_QUALITY_P11 8.0
		#endif

		/*============================================================================
												 FXAA QUALITY - EXTREME QUALITY
		============================================================================*/
		#if (FXAA_QUALITY_PRESET == 39)
				#define FXAA_QUALITY_PS 12
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.0
				#define FXAA_QUALITY_P2 1.0
				#define FXAA_QUALITY_P3 1.0
				#define FXAA_QUALITY_P4 1.0
				#define FXAA_QUALITY_P5 1.5
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 2.0
				#define FXAA_QUALITY_P8 2.0
				#define FXAA_QUALITY_P9 2.0
				#define FXAA_QUALITY_P10 4.0
				#define FXAA_QUALITY_P11 8.0
		#endif



		/*============================================================================

																		API PORTING

		============================================================================*/
		#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)
				#define FxaaBool bool
				#define FxaaDiscard discard
				#define FxaaFloat float
				#define FxaaFloat2 vec2
				#define FxaaFloat3 vec3
				#define FxaaFloat4 vec4
				#define FxaaHalf float
				#define FxaaHalf2 vec2
				#define FxaaHalf3 vec3
				#define FxaaHalf4 vec4
				#define FxaaInt2 ivec2
				#define FxaaSat(x) clamp(x, 0.0, 1.0)
				#define FxaaTex sampler2D
		#else
				#define FxaaBool bool
				#define FxaaDiscard clip(-1)
				#define FxaaFloat float
				#define FxaaFloat2 float2
				#define FxaaFloat3 float3
				#define FxaaFloat4 float4
				#define FxaaHalf half
				#define FxaaHalf2 half2
				#define FxaaHalf3 half3
				#define FxaaHalf4 half4
				#define FxaaSat(x) saturate(x)
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_GLSL_100 == 1)
			#define FxaaTexTop(t, p) texture2D(t, p, 0.0)
			#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_GLSL_120 == 1)
				// Requires,
				//	#version 120
				// And at least,
				//	#extension GL_EXT_gpu_shader4 : enable
				//	(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)
				#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)
				#if (FXAA_FAST_PIXEL_OFFSET == 1)
						#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)
				#else
						#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)
				#endif
				#if (FXAA_GATHER4_ALPHA == 1)
						// use #extension GL_ARB_gpu_shader5 : enable
						#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)
						#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)
						#define FxaaTexGreen4(t, p) textureGather(t, p, 1)
						#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)
				#endif
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_GLSL_130 == 1)
				// Requires "#version 130" or better
				#define FxaaTexTop(t, p) textureLod(t, p, 0.0)
				#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)
				#if (FXAA_GATHER4_ALPHA == 1)
						// use #extension GL_ARB_gpu_shader5 : enable
						#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)
						#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)
						#define FxaaTexGreen4(t, p) textureGather(t, p, 1)
						#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)
				#endif
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_HLSL_3 == 1)
				#define FxaaInt2 float2
				#define FxaaTex sampler2D
				#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))
				#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_HLSL_4 == 1)
				#define FxaaInt2 int2
				struct FxaaTex { SamplerState smpl; Texture2D tex; };
				#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)
				#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_HLSL_5 == 1)
				#define FxaaInt2 int2
				struct FxaaTex { SamplerState smpl; Texture2D tex; };
				#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)
				#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)
				#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)
				#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)
				#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)
				#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)
		#endif


		/*============================================================================
											 GREEN AS LUMA OPTION SUPPORT FUNCTION
		============================================================================*/
		#if (FXAA_GREEN_AS_LUMA == 0)
				FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }
		#else
				FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }
		#endif




		/*============================================================================

																 FXAA3 QUALITY - PC

		============================================================================*/
		#if (FXAA_PC == 1)
		/*--------------------------------------------------------------------------*/
		FxaaFloat4 FxaaPixelShader(
				//
				// Use noperspective interpolation here (turn off perspective interpolation).
				// {xy} = center of pixel
				FxaaFloat2 pos,
				//
				// Used only for FXAA Console, and not used on the 360 version.
				// Use noperspective interpolation here (turn off perspective interpolation).
				// {xy_} = upper left of pixel
				// {_zw} = lower right of pixel
				FxaaFloat4 fxaaConsolePosPos,
				//
				// Input color texture.
				// {rgb_} = color in linear or perceptual color space
				// if (FXAA_GREEN_AS_LUMA == 0)
				//		 {__a} = luma in perceptual color space (not linear)
				FxaaTex tex,
				//
				// Only used on the optimized 360 version of FXAA Console.
				// For everything but 360, just use the same input here as for "tex".
				// For 360, same texture, just alias with a 2nd sampler.
				// This sampler needs to have an exponent bias of -1.
				FxaaTex fxaaConsole360TexExpBiasNegOne,
				//
				// Only used on the optimized 360 version of FXAA Console.
				// For everything but 360, just use the same input here as for "tex".
				// For 360, same texture, just alias with a 3nd sampler.
				// This sampler needs to have an exponent bias of -2.
				FxaaTex fxaaConsole360TexExpBiasNegTwo,
				//
				// Only used on FXAA Quality.
				// This must be from a constant/uniform.
				// {x_} = 1.0/screenWidthInPixels
				// {_y} = 1.0/screenHeightInPixels
				FxaaFloat2 fxaaQualityRcpFrame,
				//
				// Only used on FXAA Console.
				// This must be from a constant/uniform.
				// This effects sub-pixel AA quality and inversely sharpness.
				//	 Where N ranges between,
				//		 N = 0.50 (default)
				//		 N = 0.33 (sharper)
				// {x__} = -N/screenWidthInPixels
				// {_y_} = -N/screenHeightInPixels
				// {_z_} =	N/screenWidthInPixels
				// {__w} =	N/screenHeightInPixels
				FxaaFloat4 fxaaConsoleRcpFrameOpt,
				//
				// Only used on FXAA Console.
				// Not used on 360, but used on PS3 and PC.
				// This must be from a constant/uniform.
				// {x__} = -2.0/screenWidthInPixels
				// {_y_} = -2.0/screenHeightInPixels
				// {_z_} =	2.0/screenWidthInPixels
				// {__w} =	2.0/screenHeightInPixels
				FxaaFloat4 fxaaConsoleRcpFrameOpt2,
				//
				// Only used on FXAA Console.
				// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.
				// This must be from a constant/uniform.
				// {x__} =	8.0/screenWidthInPixels
				// {_y_} =	8.0/screenHeightInPixels
				// {_z_} = -4.0/screenWidthInPixels
				// {__w} = -4.0/screenHeightInPixels
				FxaaFloat4 fxaaConsole360RcpFrameOpt2,
				//
				// Only used on FXAA Quality.
				// This used to be the FXAA_QUALITY_SUBPIX define.
				// It is here now to allow easier tuning.
				// Choose the amount of sub-pixel aliasing removal.
				// This can effect sharpness.
				//	 1.00 - upper limit (softer)
				//	 0.75 - default amount of filtering
				//	 0.50 - lower limit (sharper, less sub-pixel aliasing removal)
				//	 0.25 - almost off
				//	 0.00 - completely off
				FxaaFloat fxaaQualitySubpix,
				//
				// Only used on FXAA Quality.
				// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.
				// It is here now to allow easier tuning.
				// The minimum amount of local contrast required to apply algorithm.
				//	 0.333 - too little (faster)
				//	 0.250 - low quality
				//	 0.166 - default
				//	 0.125 - high quality
				//	 0.063 - overkill (slower)
				FxaaFloat fxaaQualityEdgeThreshold,
				//
				// Only used on FXAA Quality.
				// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.
				// It is here now to allow easier tuning.
				// Trims the algorithm from processing darks.
				//	 0.0833 - upper limit (default, the start of visible unfiltered edges)
				//	 0.0625 - high quality (faster)
				//	 0.0312 - visible limit (slower)
				// Special notes when using FXAA_GREEN_AS_LUMA,
				//	 Likely want to set this to zero.
				//	 As colors that are mostly not-green
				//	 will appear very dark in the green channel!
				//	 Tune by looking at mostly non-green content,
				//	 then start at zero and increase until aliasing is a problem.
				FxaaFloat fxaaQualityEdgeThresholdMin,
				//
				// Only used on FXAA Console.
				// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.
				// It is here now to allow easier tuning.
				// This does not effect PS3, as this needs to be compiled in.
				//	 Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.
				//	 Due to the PS3 being ALU bound,
				//	 there are only three safe values here: 2 and 4 and 8.
				//	 These options use the shaders ability to a free *|/ by 2|4|8.
				// For all other platforms can be a non-power of two.
				//	 8.0 is sharper (default!!!)
				//	 4.0 is softer
				//	 2.0 is really soft (good only for vector graphics inputs)
				FxaaFloat fxaaConsoleEdgeSharpness,
				//
				// Only used on FXAA Console.
				// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.
				// It is here now to allow easier tuning.
				// This does not effect PS3, as this needs to be compiled in.
				//	 Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.
				//	 Due to the PS3 being ALU bound,
				//	 there are only two safe values here: 1/4 and 1/8.
				//	 These options use the shaders ability to a free *|/ by 2|4|8.
				// The console setting has a different mapping than the quality setting.
				// Other platforms can use other values.
				//	 0.125 leaves less aliasing, but is softer (default!!!)
				//	 0.25 leaves more aliasing, and is sharper
				FxaaFloat fxaaConsoleEdgeThreshold,
				//
				// Only used on FXAA Console.
				// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.
				// It is here now to allow easier tuning.
				// Trims the algorithm from processing darks.
				// The console setting has a different mapping than the quality setting.
				// This only applies when FXAA_EARLY_EXIT is 1.
				// This does not apply to PS3,
				// PS3 was simplified to avoid more shader instructions.
				//	 0.06 - faster but more aliasing in darks
				//	 0.05 - default
				//	 0.04 - slower and less aliasing in darks
				// Special notes when using FXAA_GREEN_AS_LUMA,
				//	 Likely want to set this to zero.
				//	 As colors that are mostly not-green
				//	 will appear very dark in the green channel!
				//	 Tune by looking at mostly non-green content,
				//	 then start at zero and increase until aliasing is a problem.
				FxaaFloat fxaaConsoleEdgeThresholdMin,
				//
				// Extra constants for 360 FXAA Console only.
				// Use zeros or anything else for other platforms.
				// These must be in physical constant registers and NOT immediates.
				// Immediates will result in compiler un-optimizing.
				// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)
				FxaaFloat4 fxaaConsole360ConstDir
		) {
		/*--------------------------------------------------------------------------*/
				FxaaFloat2 posM;
				posM.x = pos.x;
				posM.y = pos.y;
				#if (FXAA_GATHER4_ALPHA == 1)
						#if (FXAA_DISCARD == 0)
								FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);
								#if (FXAA_GREEN_AS_LUMA == 0)
										#define lumaM rgbyM.w
								#else
										#define lumaM rgbyM.y
								#endif
						#endif
						#if (FXAA_GREEN_AS_LUMA == 0)
								FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);
								FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));
						#else
								FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);
								FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));
						#endif
						#if (FXAA_DISCARD == 1)
								#define lumaM luma4A.w
						#endif
						#define lumaE luma4A.z
						#define lumaS luma4A.x
						#define lumaSE luma4A.y
						#define lumaNW luma4B.w
						#define lumaN luma4B.z
						#define lumaW luma4B.x
				#else
						FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);
						#if (FXAA_GREEN_AS_LUMA == 0)
								#define lumaM rgbyM.w
						#else
								#define lumaM rgbyM.y
						#endif
						#if (FXAA_GLSL_100 == 1)
							FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));
						#else
							FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));
						#endif
				#endif
		/*--------------------------------------------------------------------------*/
				FxaaFloat maxSM = max(lumaS, lumaM);
				FxaaFloat minSM = min(lumaS, lumaM);
				FxaaFloat maxESM = max(lumaE, maxSM);
				FxaaFloat minESM = min(lumaE, minSM);
				FxaaFloat maxWN = max(lumaN, lumaW);
				FxaaFloat minWN = min(lumaN, lumaW);
				FxaaFloat rangeMax = max(maxWN, maxESM);
				FxaaFloat rangeMin = min(minWN, minESM);
				FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;
				FxaaFloat range = rangeMax - rangeMin;
				FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);
				FxaaBool earlyExit = range < rangeMaxClamped;
		/*--------------------------------------------------------------------------*/
				if(earlyExit)
						#if (FXAA_DISCARD == 1)
								FxaaDiscard;
						#else
								return rgbyM;
						#endif
		/*--------------------------------------------------------------------------*/
				#if (FXAA_GATHER4_ALPHA == 0)
						#if (FXAA_GLSL_100 == 1)
							FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));
						#else
							FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));
						#endif
				#else
						FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));
						FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));
				#endif
		/*--------------------------------------------------------------------------*/
				FxaaFloat lumaNS = lumaN + lumaS;
				FxaaFloat lumaWE = lumaW + lumaE;
				FxaaFloat subpixRcpRange = 1.0/range;
				FxaaFloat subpixNSWE = lumaNS + lumaWE;
				FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;
				FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;
		/*--------------------------------------------------------------------------*/
				FxaaFloat lumaNESE = lumaNE + lumaSE;
				FxaaFloat lumaNWNE = lumaNW + lumaNE;
				FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;
				FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;
		/*--------------------------------------------------------------------------*/
				FxaaFloat lumaNWSW = lumaNW + lumaSW;
				FxaaFloat lumaSWSE = lumaSW + lumaSE;
				FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);
				FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);
				FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;
				FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;
				FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;
				FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;
		/*--------------------------------------------------------------------------*/
				FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;
				FxaaFloat lengthSign = fxaaQualityRcpFrame.x;
				FxaaBool horzSpan = edgeHorz >= edgeVert;
				FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;
		/*--------------------------------------------------------------------------*/
				if(!horzSpan) lumaN = lumaW;
				if(!horzSpan) lumaS = lumaE;
				if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;
				FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;
		/*--------------------------------------------------------------------------*/
				FxaaFloat gradientN = lumaN - lumaM;
				FxaaFloat gradientS = lumaS - lumaM;
				FxaaFloat lumaNN = lumaN + lumaM;
				FxaaFloat lumaSS = lumaS + lumaM;
				FxaaBool pairN = abs(gradientN) >= abs(gradientS);
				FxaaFloat gradient = max(abs(gradientN), abs(gradientS));
				if(pairN) lengthSign = -lengthSign;
				FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);
		/*--------------------------------------------------------------------------*/
				FxaaFloat2 posB;
				posB.x = posM.x;
				posB.y = posM.y;
				FxaaFloat2 offNP;
				offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
				offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;
				if(!horzSpan) posB.x += lengthSign * 0.5;
				if( horzSpan) posB.y += lengthSign * 0.5;
		/*--------------------------------------------------------------------------*/
				FxaaFloat2 posN;
				posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;
				posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;
				FxaaFloat2 posP;
				posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;
				posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;
				FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;
				FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));
				FxaaFloat subpixE = subpixC * subpixC;
				FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));
		/*--------------------------------------------------------------------------*/
				if(!pairN) lumaNN = lumaSS;
				FxaaFloat gradientScaled = gradient * 1.0/4.0;
				FxaaFloat lumaMM = lumaM - lumaNN * 0.5;
				FxaaFloat subpixF = subpixD * subpixE;
				FxaaBool lumaMLTZero = lumaMM < 0.0;
		/*--------------------------------------------------------------------------*/
				lumaEndN -= lumaNN * 0.5;
				lumaEndP -= lumaNN * 0.5;
				FxaaBool doneN = abs(lumaEndN) >= gradientScaled;
				FxaaBool doneP = abs(lumaEndP) >= gradientScaled;
				if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;
				if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;
				FxaaBool doneNP = (!doneN) || (!doneP);
				if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;
				if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;
		/*--------------------------------------------------------------------------*/
				if(doneNP) {
						if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
						if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
						if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
						if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
						doneN = abs(lumaEndN) >= gradientScaled;
						doneP = abs(lumaEndP) >= gradientScaled;
						if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;
						if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;
						doneNP = (!doneN) || (!doneP);
						if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;
						if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;
		/*--------------------------------------------------------------------------*/
						#if (FXAA_QUALITY_PS > 3)
						if(doneNP) {
								if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
								if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
								if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
								if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
								doneN = abs(lumaEndN) >= gradientScaled;
								doneP = abs(lumaEndP) >= gradientScaled;
								if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;
								if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;
								doneNP = (!doneN) || (!doneP);
								if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;
								if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;
		/*--------------------------------------------------------------------------*/
								#if (FXAA_QUALITY_PS > 4)
								if(doneNP) {
										if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
										if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
										if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
										if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
										doneN = abs(lumaEndN) >= gradientScaled;
										doneP = abs(lumaEndP) >= gradientScaled;
										if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;
										if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;
										doneNP = (!doneN) || (!doneP);
										if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;
										if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;
		/*--------------------------------------------------------------------------*/
										#if (FXAA_QUALITY_PS > 5)
										if(doneNP) {
												if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
												if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
												if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
												if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
												doneN = abs(lumaEndN) >= gradientScaled;
												doneP = abs(lumaEndP) >= gradientScaled;
												if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;
												if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;
												doneNP = (!doneN) || (!doneP);
												if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;
												if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;
		/*--------------------------------------------------------------------------*/
												#if (FXAA_QUALITY_PS > 6)
												if(doneNP) {
														if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
														if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
														if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
														if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
														doneN = abs(lumaEndN) >= gradientScaled;
														doneP = abs(lumaEndP) >= gradientScaled;
														if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;
														if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;
														doneNP = (!doneN) || (!doneP);
														if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;
														if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;
		/*--------------------------------------------------------------------------*/
														#if (FXAA_QUALITY_PS > 7)
														if(doneNP) {
																if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
																if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
																if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
																if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
																doneN = abs(lumaEndN) >= gradientScaled;
																doneP = abs(lumaEndP) >= gradientScaled;
																if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;
																if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;
																doneNP = (!doneN) || (!doneP);
																if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;
																if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;
		/*--------------------------------------------------------------------------*/
				#if (FXAA_QUALITY_PS > 8)
				if(doneNP) {
						if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
						if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
						if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
						if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
						doneN = abs(lumaEndN) >= gradientScaled;
						doneP = abs(lumaEndP) >= gradientScaled;
						if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;
						if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;
						doneNP = (!doneN) || (!doneP);
						if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;
						if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;
		/*--------------------------------------------------------------------------*/
						#if (FXAA_QUALITY_PS > 9)
						if(doneNP) {
								if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
								if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
								if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
								if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
								doneN = abs(lumaEndN) >= gradientScaled;
								doneP = abs(lumaEndP) >= gradientScaled;
								if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;
								if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;
								doneNP = (!doneN) || (!doneP);
								if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;
								if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;
		/*--------------------------------------------------------------------------*/
								#if (FXAA_QUALITY_PS > 10)
								if(doneNP) {
										if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
										if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
										if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
										if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
										doneN = abs(lumaEndN) >= gradientScaled;
										doneP = abs(lumaEndP) >= gradientScaled;
										if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;
										if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;
										doneNP = (!doneN) || (!doneP);
										if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;
										if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;
		/*--------------------------------------------------------------------------*/
										#if (FXAA_QUALITY_PS > 11)
										if(doneNP) {
												if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
												if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
												if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
												if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
												doneN = abs(lumaEndN) >= gradientScaled;
												doneP = abs(lumaEndP) >= gradientScaled;
												if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;
												if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;
												doneNP = (!doneN) || (!doneP);
												if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;
												if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;
		/*--------------------------------------------------------------------------*/
												#if (FXAA_QUALITY_PS > 12)
												if(doneNP) {
														if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
														if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
														if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
														if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
														doneN = abs(lumaEndN) >= gradientScaled;
														doneP = abs(lumaEndP) >= gradientScaled;
														if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;
														if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;
														doneNP = (!doneN) || (!doneP);
														if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;
														if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;
		/*--------------------------------------------------------------------------*/
												}
												#endif
		/*--------------------------------------------------------------------------*/
										}
										#endif
		/*--------------------------------------------------------------------------*/
								}
								#endif
		/*--------------------------------------------------------------------------*/
						}
						#endif
		/*--------------------------------------------------------------------------*/
				}
				#endif
		/*--------------------------------------------------------------------------*/
														}
														#endif
		/*--------------------------------------------------------------------------*/
												}
												#endif
		/*--------------------------------------------------------------------------*/
										}
										#endif
		/*--------------------------------------------------------------------------*/
								}
								#endif
		/*--------------------------------------------------------------------------*/
						}
						#endif
		/*--------------------------------------------------------------------------*/
				}
		/*--------------------------------------------------------------------------*/
				FxaaFloat dstN = posM.x - posN.x;
				FxaaFloat dstP = posP.x - posM.x;
				if(!horzSpan) dstN = posM.y - posN.y;
				if(!horzSpan) dstP = posP.y - posM.y;
		/*--------------------------------------------------------------------------*/
				FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;
				FxaaFloat spanLength = (dstP + dstN);
				FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;
				FxaaFloat spanLengthRcp = 1.0/spanLength;
		/*--------------------------------------------------------------------------*/
				FxaaBool directionN = dstN < dstP;
				FxaaFloat dst = min(dstN, dstP);
				FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;
				FxaaFloat subpixG = subpixF * subpixF;
				FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;
				FxaaFloat subpixH = subpixG * fxaaQualitySubpix;
		/*--------------------------------------------------------------------------*/
				FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;
				FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);
				if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;
				if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;
				#if (FXAA_DISCARD == 1)
						return FxaaTexTop(tex, posM);
				#else
						return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);
				#endif
		}
		/*==========================================================================*/
		#endif

		void main() {
			gl_FragColor = FxaaPixelShader(
				vUv,
				vec4(0.0),
				tDiffuse,
				tDiffuse,
				tDiffuse,
				resolution,
				vec4(0.0),
				vec4(0.0),
				vec4(0.0),
				0.75,
				0.166,
				0.0833,
				0.0,
				0.0,
				0.0,
				vec4(0.0)
			);

			// TODO avoid querying texture twice for same texel
			gl_FragColor.a = texture2D(tDiffuse, vUv).a;
		}`};class l2{constructor(){P(this,"enabled",!0);P(this,"needsSwap",!0);P(this,"clear",!1);P(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,r,i,s){He.error(Xe.PassRenderMustBeImplementedInDerivedPass,"Pass: .render() must be implemented in derived pass.")}}class c2 extends l2{constructor(t,r,i,s,a){super();P(this,"clear",!0);P(this,"clearDepth",!1);P(this,"needsSwap",!1);P(this,"_oldClearColor",new Ce);P(this,"overrideMaterial");P(this,"clearColor");P(this,"clearAlpha");this.scene=t,this.viewInfo=r,this.overrideMaterial=i!=null?i:null,this.clearColor=s,this.clearAlpha=a!==void 0?a:0}render(t,r,i,s,a){const o=t.autoClear;t.autoClear=!1;let l,c=null;this.overrideMaterial!==void 0&&(c=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),l=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:i),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.viewInfo.cameraSystem.currentCamera),this.clearColor&&t.setClearColor(this._oldClearColor,l),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=c),t.autoClear=o}}class Gh extends c2{constructor(t,r){super(t,r);P(this,"layers");this.layers=new ac}render(t,r,i,s,a){const o=this.viewInfo.cameraSystem.currentCamera.layers.mask;this.viewInfo.cameraSystem.currentCamera.layers.mask=this.layers.mask,super.render(t,r,i,s,a),this.viewInfo.cameraSystem.currentCamera.layers.mask=o}}class u2{constructor(){P(this,"camera",new Qn(-1,1,1,-1,0,1));P(this,"geometry",new nt);P(this,"mesh");this.geometry.setAttribute("position",new Ye([-1,3,0,-1,-1,0,3,-1,0],3)),this.geometry.setAttribute("uv",new Ye([0,2,0,0,2,0],2)),this.mesh=new be(this.geometry)}get layers(){return this.camera.layers}get material(){const e=this.mesh.material;if(Array.isArray(e))throw new Error("Only single material supported!");return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var Fl=`varying vec3 vNormal;\r
varying vec2 vUv;\r
\r
void main() {\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1);\r
  vNormal = normalize(normalMatrix * normal);\r
  vUv = uv;\r
}`,zU=`varying vec2 vUv;\r
\r
uniform sampler2D maskTexture;\r
uniform vec2 texSize;\r
uniform vec3 visibleEdgeColor;\r
uniform vec3 hiddenEdgeColor;\r
\r
void main() {\r
    vec2 invSize = 1.0 / texSize;\r
    vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\r
    vec4 c1 = texture2D(maskTexture, vUv + uvOffset.xy);\r
    vec4 c2 = texture2D(maskTexture, vUv - uvOffset.xy);\r
    vec4 c3 = texture2D(maskTexture, vUv + uvOffset.yw);\r
    vec4 c4 = texture2D(maskTexture, vUv - uvOffset.yw);\r
    float diff1 = (c1.b - c2.b) * 0.5;\r
    float diff2 = (c3.b - c4.b) * 0.5;\r
    float d = length(vec2(diff1, diff2));\r
    float a1 = min(c1.b, c2.b);\r
    float a2 = min(c3.b, c4.b);\r
    float visibilityFactor = min(a1, a2);\r
    vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\r
    gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\r
}`,d2=`#include <morphtarget_pars_vertex>\r
#include <skinning_pars_vertex>\r
\r
varying vec4 projTexCoord;\r
varying vec4 vPosition;\r
uniform mat4 textureMatrix;\r
\r
void main() {\r
\r
    #include <skinbase_vertex>\r
    #include <begin_vertex>\r
    #include <morphtarget_vertex>\r
    #include <skinning_vertex>\r
    #include <project_vertex>\r
\r
    vPosition = mvPosition;\r
    vec4 worldPosition = modelMatrix * vec4(transformed, 1.0);\r
    projTexCoord = textureMatrix * worldPosition;\r
\r
}`,h2=`#include <packing>\r
\r
varying vec4 vPosition;\r
varying vec4 projTexCoord;\r
uniform sampler2D depthTexture;\r
uniform vec2 cameraNearFar;\r
uniform bool faceMask;\r
\r
void main() {\r
\r
    float depth = unpackRGBAToDepth(texture2DProj(depthTexture, projTexCoord));\r
    float viewZ = -perspectiveDepthToViewZ(depth, cameraNearFar.x, cameraNearFar.y) * 1.0001;\r
    float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\r
    gl_FragColor = vec4(faceMask ? 1.0 : 0.0, depthTest, 0.0, 1.0);\r
\r
}`,UU=`#include <common>\r
\r
varying vec2 vUv;\r
uniform sampler2D colorTexture;\r
uniform vec2 texSize;\r
uniform vec2 direction;\r
uniform float kernelRadius;\r
\r
float gaussianPdf(in float x, in float sigma) {\r
    return 0.39894 * exp(-0.5 * x * x / (sigma * sigma)) / sigma;\r
}\r
\r
void main() {\r
    vec2 invSize = 1.0 / texSize;\r
    float weightSum = gaussianPdf(0.0, kernelRadius);\r
    vec4 diffuseSum = texture2D(colorTexture, vUv) * weightSum;\r
    vec2 delta = direction * invSize * kernelRadius / float(MAX_RADIUS);\r
    vec2 uvOffset = delta;\r
    for(int i = 1; i <= MAX_RADIUS; i++) {\r
        float w = gaussianPdf(uvOffset.x, kernelRadius);\r
        vec4 sample1 = texture2D(colorTexture, vUv + uvOffset);\r
        vec4 sample2 = texture2D(colorTexture, vUv - uvOffset);\r
        diffuseSum += ((sample1 + sample2) * w);\r
        weightSum += (2.0 * w);\r
        uvOffset += delta;\r
    }\r
    gl_FragColor = diffuseSum / weightSum;\r
}`,BU=`varying vec2 vUv;\r
\r
uniform sampler2D maskTexture;\r
uniform sampler2D edgeTexture;\r
uniform vec3 objectColor;\r
uniform vec3 faceColor;\r
uniform float edgeStrength;\r
uniform float time;\r
\r
void main() {\r
    vec4 edgeValue = texture2D(edgeTexture, vUv);\r
    vec4 maskColor = texture2D(maskTexture, vUv);\r
    vec4 edgeColor = edgeStrength * maskColor.b * edgeValue;\r
    float timeFactor = sin(time * 7.5) * 0.5 + 0.5;\r
    vec4 visibleObjectColor = vec4(objectColor, 0.2 + 0.3 * timeFactor);\r
    vec4 hiddenObjectColor = vec4(objectColor, 0.1 + 0.2 * timeFactor);\r
    vec4 visibleFaceColor = vec4(faceColor, 0.4 + 0.3 * timeFactor);\r
    vec4 hiddenFaceColor = vec4(faceColor, 0.1 + 0.2 * timeFactor);\r
    if(maskColor.b < 0.5) {\r
        if(maskColor.r < 0.5)\r
            gl_FragColor = maskColor.g > 0.5 ? hiddenObjectColor : visibleObjectColor;\r
        else\r
            gl_FragColor = maskColor.g > 0.5 ? hiddenFaceColor : visibleFaceColor;\r
    } else\r
        gl_FragColor = edgeColor;\r
\r
}`;const mp=class extends l2{constructor(t,r,i){super();P(this,"layers");P(this,"outlineMeshes",[]);P(this,"visibleEdgeColor",new Ce(240/255,115/255,0));P(this,"hiddenEdgeColor",new Ce(240/255/2,115/255/2,0));P(this,"edgeThickness",1);P(this,"edgeStrength",3);P(this,"downSampleRatio",2);P(this,"maskBufferMaterial");P(this,"renderTargetMaskBuffer");P(this,"depthMaterial");P(this,"prepareMaskMaterial");P(this,"renderTargetDepthBuffer");P(this,"renderTargetMaskDownSampleBuffer");P(this,"renderTargetBlurBuffer1");P(this,"renderTargetBlurBuffer2");P(this,"edgeDetectionMaterial");P(this,"renderTargetEdgeBuffer1");P(this,"separableBlurMaterial1");P(this,"separableBlurMaterial2");P(this,"overlayMaterial");P(this,"materialCopy");P(this,"_oldClearColor");P(this,"oldClearAlpha");P(this,"fsQuad");P(this,"textureMatrix",new ze);P(this,"copyUniforms");P(this,"_visibilityCache",new Map);P(this,"cameraOrtho");P(this,"sceneOrtho");P(this,"spriteMaterial");P(this,"renderData",{key:null,value:[]});P(this,"lesMeshes",new Array);this.resolution=t,this.scene=r,this.viewInfo=i,this.layers=new ac,this.resolution=t!==void 0?new oe(t.x,t.y):new oe(256,256);const s={minFilter:_n,magFilter:_n,format:bn},a=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new Pt({color:16777215}),this.maskBufferMaterial.side=Un,this.renderTargetMaskBuffer=new dn(this.resolution.x,this.resolution.y,s),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new Kp,this.depthMaterial.side=Un,this.depthMaterial.depthPacking=jy,this.depthMaterial.blending=Qr,this.prepareMaskMaterial=this.createPrepareMaskMaterial(),this.prepareMaskMaterial.side=Un,this.renderTargetDepthBuffer=new dn(this.resolution.x,this.resolution.y,s),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new dn(a,o,s),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new dn(a,o,s),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new dn(Math.round(a/2),Math.round(o/2),s),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.createEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new dn(a,o,s),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1;const l=4,c=4;this.separableBlurMaterial1=this.createSeperableBlurMaterial(l),this.separableBlurMaterial1.uniforms.texSize.value.set(a,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.createSeperableBlurMaterial(c),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(a/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=c,this.overlayMaterial=this.createOverlayMaterial(),Yl===void 0&&He.throw(Xe.OutlinePassReliesOnCopyShader,"OutlinePass relies on CopyShader");const u=Yl;this.copyUniforms=Zp.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new wn({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:Qr,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Ce,this.oldClearAlpha=1,this.fsQuad=new u2,this.fsQuad.layers.enableAll(),this.textureMatrix=new ze;const h=t.x,d=t.y;this.cameraOrtho=new Qn(-h/2,h/2,d/2,-d/2,1,10),this.cameraOrtho.position.z=10,this.sceneOrtho=new Ea;const f=h/4,v=d/4;this.spriteMaterial=new em({transparent:!0});const g=new Qy(this.spriteMaterial);g.scale.set(f,v,1),this.sceneOrtho.add(g),g.position.set(-h/2+f/2,d/2-v/2,1)}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose()}setSelection(t){this.outlineMeshes=t}setLightEmittingSurfaceRenderData(t){this.renderData=t}setSize(t,r){this.renderTargetMaskBuffer.setSize(t,r),this.renderTargetDepthBuffer.setSize(t,r);let i=Math.round(t/this.downSampleRatio),s=Math.round(r/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,s),this.renderTargetBlurBuffer1.setSize(i,s),this.renderTargetEdgeBuffer1.setSize(i,s),this.separableBlurMaterial1.uniforms.texSize.value.set(i,s),i=Math.round(i/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(i,s),this.separableBlurMaterial2.uniforms.texSize.value.set(i,s)}changeVisibilityOfSelectedObjects(t){const r=this._visibilityCache;function i(s){var a;s.type=="Mesh"&&(t==!0?s.visible=(a=r.get(s))!=null?a:!1:(r.set(s,s.visible),s.visible=t))}for(let s=0;s<this.outlineMeshes.length;s++)this.outlineMeshes[s].mesh.traverse(i)}changeVisibilityOfNonSelectedObjects(t){const r=this._visibilityCache,i=new Array;function s(o){o.type=="Mesh"&&i.push(o)}for(let o=0;o<this.outlineMeshes.length;o++)this.outlineMeshes[o].mesh.traverse(s);function a(o){var l;if(o.type=="Mesh"){let c=!1;for(let u=0;u<i.length;u++)if(i[u].id===o.id){c=!0;break}if(c===!1){const u=o.visible;(t===!1||r.get(o)===!0)&&(o.visible=t),r.set(o,u)}}else o.type=="Line"&&(t===!0?o.visible=(l=r.get(o))!=null?l:!1:(r.set(o,o.visible),o.visible=t))}this.scene.traverse(a)}updateTextureMatrix(){const t=this.viewInfo.cameraSystem.currentCamera;this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(t.projectionMatrix),this.textureMatrix.multiply(t.matrixWorldInverse)}render(t,r,i,s,a){if(!this.outlineMeshes.length&&!this.renderData.key)return;const o=this.viewInfo.cameraSystem.currentCamera,l=o.layers.mask,c=t.autoClear;o.layers.disable(De.LightEmittingObjectLayer),o.layers.mask=this.layers.mask,this.renderSelection(t,i,a),o.layers.mask=l,t.autoClear=c,this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=i.texture,t.setRenderTarget(null),this.fsQuad.render(t))}renderSelection(t,r,i){const s=this.viewInfo.cameraSystem.currentCamera;t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha(),t.autoClear=!1,i&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const a=this.scene.background;this.scene.background=null,this.scene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.scene,s),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.scene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(s.near,s.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,this.prepareMaskMaterial.uniforms.faceMask.value=!1,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.scene,s),this.lesMeshes.splice(0),this.outlineMeshes.forEach(l=>{l.groupMesh?(l.groupMesh.visible=!0,l.faceIndices&&l.groupMesh.reduceFacesTo(l.faceIndices)):l.mesh.visible=!1}),this.prepareMaskMaterial.uniforms.faceMask.value=!0,t.setRenderTarget(this.renderTargetMaskBuffer),this.renderData.key&&this.renderData.key.visitGroupMeshes((l,c)=>{const u=this.renderData.value.find(d=>d.groupIndex==l);if(!u)return;u.visible=!0,this.lesMeshes.includes(u)||this.lesMeshes.push(u),u.clearGroups(),u.addGroups(c,0);let h=u.parent;for(;h!=null;)h.visible=!0,h=h.parent;t.render(this.scene,s),u.visible=!1}),t.render(this.scene,s),this.outlineMeshes.forEach(l=>{l.mesh.visible=!0,l.groupMesh&&l.groupMesh.resetFaces()}),this.lesMeshes.forEach(l=>l.resetFaces()),this.scene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.scene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.visibleEdgeColor,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.hiddenEdgeColor,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=mp.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=mp.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial;const o=performance.now()/1e3;this.overlayMaterial.uniforms.time={value:o},this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,i&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(r),this.fsQuad.render(t),t.setClearColor(this._oldClearColor,this.oldClearAlpha),this.scene.traverse(l=>{l instanceof wa&&l.restoreSceneVisibility()})}renderDebug(t){t.autoClear=!1,t.clearDepth(),this.spriteMaterial.map=this.renderTargetMaskBuffer.texture,t.render(this.sceneOrtho,this.cameraOrtho)}createPrepareMaskMaterial(){return new wn({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new oe(.5,.5)},textureMatrix:{value:null},faceMask:{value:!1}},vertexShader:d2,fragmentShader:h2})}createEdgeDetectionMaterial(){return new wn({uniforms:{maskTexture:{value:null},texSize:{value:new oe(.5,.5)},visibleEdgeColor:{value:new L(1,1,1)},hiddenEdgeColor:{value:new L(1,1,1)}},vertexShader:Fl,fragmentShader:zU})}createSeperableBlurMaterial(t){return new wn({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new oe(.5,.5)},direction:{value:new oe(.5,.5)},kernelRadius:{value:1}},vertexShader:Fl,fragmentShader:UU})}createOverlayMaterial(){return new wn({uniforms:{maskTexture:{value:null},edgeTexture:{value:null},patternTexture:{value:null},edgeStrength:{value:1},usePatternTexture:{value:!1},objectColor:{value:new L(240/255,115/255,0)},faceColor:{value:new L(0,115/255,240/255)}},vertexShader:Fl,fragmentShader:BU,depthTest:!1,depthWrite:!1,transparent:!0})}};let su=mp;P(su,"BlurDirectionX",new oe(1,0)),P(su,"BlurDirectionY",new oe(0,1));class HU extends Vn{constructor(t){super(Y.PendulumConnector,t.id);P(this,"mesh");this.mesh=new _s(new ws(.01,8,8),new Pt({color:"#0f0"})),this.mesh.layers.disableAll(),this.mesh.layers.enable(De.PendulumConnectorLayer),this.addVisual(this.mesh)}dispose(){var t,r;super.dispose(),this.removeVisual(this.mesh),(t=this.mesh.geometry)==null||t.dispose(),(r=this.mesh.material)==null||r.dispose()}updateFromCameraInfo(t){super.updateFromCameraInfo(t);const r=vt.getZoomScale(this,t);this.mesh.scale.set(r,r,r)}}class GU extends Vn{constructor(t){super(Y.ElectricalConnector,t.id);P(this,"mesh");this.mesh=new _s(new ws(.01,8,8),new Pt({color:"#f00"})),this.mesh.layers.disableAll(),this.mesh.layers.enable(De.ElectricalConnectorLayer),this.addVisual(this.mesh)}dispose(){var t,r;super.dispose(),this.removeVisual(this.mesh),(t=this.mesh.geometry)==null||t.dispose(),(r=this.mesh.material)==null||r.dispose()}updateFromCameraInfo(t){super.updateFromCameraInfo(t);const r=vt.getZoomScale(this,t);this.mesh.scale.set(r,r,r)}}class VU extends Vn{constructor(t){super(Y.Sensor,t.id);P(this,"mesh");P(this,"meshMaterial",new Pt({color:255}));P(this,"line");P(this,"lineMaterial",new Gn({color:255}));this.mesh=new _s(new ws(.01,8,8),this.meshMaterial),this.mesh.layers.disableAll(),this.mesh.layers.enable(De.SensorLayer),this.addVisual(this.mesh),this.lineMaterial=new Gn({color:255}),this.line=new gn(new nt().setFromPoints([new L(0,0,0),new L(0,0,-.1)]),this.lineMaterial),this.line.layers.disableAll(),this.line.layers.enable(De.SensorLayer),this.addVisual(this.line)}dispose(){var t,r;super.dispose(),this.removeVisual(this.mesh),(t=this.mesh.geometry)==null||t.dispose(),this.meshMaterial.dispose(),this.removeVisual(this.line),(r=this.line.geometry)==null||r.dispose(),this.lineMaterial.dispose()}updateFromCameraInfo(t){super.updateFromCameraInfo(t);const r=vt.getZoomScale(this,t);this.mesh.scale.set(r,r,r)}}class Mb{constructor(e){P(this,"removedParts",new Array);this.sceneData=e}}class jU{constructor(){}updateChildren(e,t,r){const i=new Mb(e);this.recursiveFindAndRemoveObsoleteParts(i,t,r),this.flatRemovedParts(i),this.recursiveFindAndCreateNewParts(i,t,r),this.recursiveUpdate(i,t,r);for(const s of i.removedParts)s.parts.length&&He.warn(Xe.RemovedPartObjectStillHasChildParts,`PartObject (${s.partId}, ${s.uuid}) still has part children!`),s.parent!=null&&He.warn(Xe.RemovedPartObjectStillHasAParent,`PartObject (${s.partId}, ${s.uuid}) still has a parent!`),s.dispose()}disposeChildren(e){const t=new Mb({parts:[]});this.findAndRemoveObsoleteParts(t,e,[]),this.flatRemovedParts(t);for(const r of t.removedParts)r.dispose()}recursiveFindAndRemoveObsoleteParts(e,t,r){const i=e.sceneData.parts.filter(s=>s.part.parentId==t);this.findAndRemoveObsoleteParts(e,r,i);for(const s of r.parts)this.recursiveFindAndRemoveObsoleteParts(e,s.partId,s)}recursiveFindAndCreateNewParts(e,t,r){const i=e.sceneData.parts.filter(s=>s.part.parentId==t);this.findAndCreateNewParts(e,r,i);for(const s of r.parts)this.recursiveFindAndCreateNewParts(e,s.partId,s)}recursiveUpdate(e,t,r){const i=e.sceneData.parts.filter(s=>s.part.parentId==t);this.findAndCreateNewParts(e,r,i);for(const s of r.parts)s.update(e.sceneData),Dr.cameraInfo&&s.updateFromCameraInfo(Dr.cameraInfo),this.recursiveUpdate(e,s.partId,s)}flatRemovedParts(e){for(const t of e.removedParts)t.parent!=null&&He.warn(Xe.RemovedPartObjectStillHasAParent2,`PartObject (${t.partId}, ${t.uuid}) still has a parent!`),this.recursiveFlatRemovedPart(e,t)}recursiveFlatRemovedPart(e,t){for(const r of t.parts)this.recursiveFlatRemovedPart(e,r),r.parent!=null&&r.parent.remove(r),e.removedParts.includes(r)||e.removedParts.push(r)}findAndRemoveObsoleteParts(e,t,r){t.parts.forEach(i=>{r.map(s=>s.part.id).includes(i.partId)||(e.removedParts.push(i),t.removePart(i))})}findAndCreateNewParts(e,t,r){const i=t.parts.map(s=>s.partId);for(const s of r)if(!i.includes(s.part.id)){const a=e.removedParts.findIndex(l=>l.partId==s.part.id),o=a>=0?e.removedParts.splice(a,1)[0]:this.createObject(s.part,t);t.addPart(o)}}createObject(e,t){if(e==null)throw Error("'part' argument must not be null!");var r=null;switch(e.type){case Y.Geometry:r=new ao(e);break;case Y.Joint:r=new Si(e);break;case Y.LightEmittingObject:r=new i2(e);break;case Y.Sensor:r=new VU(e);break;case Y.PendulumConnector:r=new HU(e);break;case Y.ElectricalConnector:r=new GU(e);break;case Y.LightEmittingSurface:if(!(t instanceof ao))throw new Error("LightEmittingSurfacePartObject can be child GeometryPartObject only!");r=new ap(e,t)}if(r==null)throw Error(`Failed to create 'PartObject' for ${e.name}(${e.id})`);return r}}class WU{constructor(e){P(this,"lightEmittingObjectFromSelectionRequestHandler");this.scene=e,this.lightEmittingObjectFromSelectionRequestHandler=()=>this.createLightEmittingPartFromSelection(),document.addEventListener("lightEmittingObjectFromSelectionRequest",this.lightEmittingObjectFromSelectionRequestHandler)}dispose(){document.removeEventListener("lightEmittingObjectFromSelectionRequest",this.lightEmittingObjectFromSelectionRequestHandler)}createLightEmittingPartFromSelection(){const e=sn.selectAll(me.getState().editor.selection);if(e.length!=1)return;const t=e[0];if(t.type!=Y.Geometry)return;const r=this.scene.findPartRecursive(t.id);if(!r||!(r instanceof ao))return;const i=new Array,s=new L(0,0,0);let a=0;const o=new Array;ei.selectAll(t.faceGroups).forEach(u=>{const h=r.groupMeshes.find(v=>v.groupIndex==u.index);if(!h)return;const d=ps.selectAll(u.faceIndices),f=new Array;o.push({groupId:u.index,faces:f}),d.forEach(v=>{if(v>h.geometry.polygons.length)return;f.push(v);const{worldNormal:g,worldPoints:y}=this.getPositionNormalAndVerticesFromPolygon(h,v);s.add(g),i.push(...y),a++})});const l=s.divideScalar(a),c=new L;new ur().setFromPoints(i).getCenter(c),l.length()>.01?l.normalize():l.set(0,0,-1),this.createLightEmittingPart(r,c,l,i,o)}getPositionNormalAndVerticesFromPolygon(e,t){const r=new L(0,0,0),i=new Array,s=sa.visitPolygonVertices(e.geometry,t,(o,l)=>{const c=e.localToWorld(o);r.add(e.localToWorld(l).sub(e.localToWorld(new L(0,0,0)))),i.push(c)});if(!s)throw new Error("Polygon has no vertices!");return{worldNormal:r.divideScalar(s).normalize(),worldPoints:i}}createLightEmittingPart(e,t,r,i,s){const a=e.worldToLocal(t),o=e.worldToLocal(r).sub(e.worldToLocal(new L(0,0,0))).normalize(),l=this.createLeoRotation(o),c=new ze().compose(a,new qe().setFromEuler(l),new L(1,1,1)).invert(),u=new hc().makeEmpty();i.map(y=>e.worldToLocal(y)).forEach(y=>{const p=y.applyMatrix4(c);u.expandByPoint(new oe(p.x,p.y))});const h=new oe;u.getSize(h);const d=e.partId,f={x:a.x,y:a.y,z:a.z},v={x:vt.round(st.radToDeg(l.x)),y:vt.round(st.radToDeg(l.y)),z:vt.round(st.radToDeg(l.z))},g={type:Oe.Rectangle,sizeX:h.x,sizeY:h.y};s!=null?me.dispatch(Te.lightEmittingPartWithSurfacesAdded({parentId:d,leo:{position:f,rotation:v,shape:g},les:{faceGroups:s}})):me.dispatch(Te.lightEmittingPartAdded({parentId:d,position:f,rotation:v,shape:g}))}createLeoRotation(e){const t=new sr().reorder("ZXY"),r=Math.abs(e.x),i=Math.abs(e.y),s=Math.abs(e.z);return r>i&&r>s?e.x>=0?t.set(0,Math.PI/2,Math.PI):t.set(0,Math.PI/2,0):i>=r&&i>s?e.y>0?t.set(0,Math.PI/2,-Math.PI/2):t.set(0,Math.PI/2,Math.PI/2):e.z>0?t.set(Math.PI,0,0):t.set(0,0,0),t}}class XU{handleKeyDown(e){if(e.key=="Delete"){const t=bt.selectedPartIds(me.getState());t.length&&me.dispatch(Te.partsDeleted(t))}else e.key=="z"&&e.ctrlKey?me.dispatch(Vl.undo()):e.key=="y"&&e.ctrlKey&&me.dispatch(Vl.redo());return!1}handleKeyUp(e){return!1}}var YU=`varying vec2 vUv;\r
\r
uniform sampler2D maskTexture;\r
uniform vec3 lesColor;\r
\r
void main() {\r
    vec4 maskColor = texture2D(maskTexture, vUv);\r
    vec4 visibleFaceColor = vec4(lesColor, 0.75);\r
    vec4 hiddenFaceColor = vec4(lesColor, 0.1);\r
    if(maskColor.b < 0.5) {\r
        gl_FragColor = maskColor.g > 0.5 ? hiddenFaceColor : visibleFaceColor;\r
    } else\r
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\r
\r
}`;class $U extends hm{constructor(t,r,i){super();P(this,"maskBufferMaterial");P(this,"renderTargetMaskBuffer");P(this,"depthMaterial");P(this,"prepareMaskMaterial");P(this,"renderTargetDepthBuffer");P(this,"overlayMaterial");P(this,"materialCopy");P(this,"_oldClearColor");P(this,"oldClearAlpha");P(this,"fsQuad");P(this,"textureMatrix",new ze);P(this,"copyUniforms");P(this,"cameraOrtho");P(this,"sceneOrtho");P(this,"spriteMaterial");P(this,"lesMeshes",new Array);P(this,"renderData",new Map);this.resolution=t,this.scene=r,this.viewInfo=i,this.resolution=t!==void 0?new oe(t.x,t.y):new oe(256,256);const s={minFilter:_n,magFilter:_n,format:bn};this.maskBufferMaterial=new Pt({color:16777215}),this.maskBufferMaterial.side=Un,this.renderTargetMaskBuffer=new dn(this.resolution.x,this.resolution.y,s),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new Kp,this.depthMaterial.side=Un,this.depthMaterial.depthPacking=jy,this.depthMaterial.blending=Qr,this.prepareMaskMaterial=this.createPrepareMaskMaterial(),this.prepareMaskMaterial.side=Un,this.renderTargetDepthBuffer=new dn(this.resolution.x,this.resolution.y,s),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.overlayMaterial=this.createOverlayMaterial(),Yl===void 0&&He.throw(Xe.LightEmittingSurfacePassReliesOnCopyShader,"LightEmittingSurfacePass relies on CopyShader");const a=Yl;this.copyUniforms=Zp.clone(a.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new wn({uniforms:this.copyUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,blending:Qr,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Ce,this.oldClearAlpha=1,this.fsQuad=new u2,this.fsQuad.layers.enableAll(),this.textureMatrix=new ze;const o=t.x,l=t.y;this.cameraOrtho=new Qn(-o/2,o/2,l/2,-l/2,1,10),this.cameraOrtho.position.z=10,this.sceneOrtho=new Ea;const c=o/4,u=l/4;this.spriteMaterial=new em({transparent:!0});const h=new Qy(this.spriteMaterial);h.scale.set(c,u,1),this.sceneOrtho.add(h),h.position.set(-o/2+c/2,l/2-u/2,1)}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose()}setSize(t,r){this.renderTargetMaskBuffer.setSize(t,r),this.renderTargetDepthBuffer.setSize(t,r)}setVisibilityForAllObjects(t){this.scene.traverse(r=>{(r instanceof wa||r instanceof Vn)&&(r.visible=t)})}updateTextureMatrix(){const t=this.viewInfo.cameraSystem.currentCamera;this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(t.projectionMatrix),this.textureMatrix.multiply(t.matrixWorldInverse)}render(t,r,i,s,a){const o=this.viewInfo.cameraSystem.currentCamera,l=o.layers.mask,c=t.autoClear;o.layers.disableAll(),o.layers.enable(De.GeometryLayer),this.renderLes(t,i,a),o.layers.mask=l,t.autoClear=c,this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=i.texture,t.setRenderTarget(null),this.fsQuad.render(t))}renderLes(t,r,i){const s=this.viewInfo.cameraSystem.currentCamera;t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha(),t.autoClear=!1,i&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1);const a=this.scene.background;this.scene.background=null,this.scene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.scene,s),this.updateTextureMatrix(),this.setVisibilityForAllObjects(!1),this.scene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(s.near,s.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,this.prepareMaskMaterial.uniforms.faceMask.value=!1,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.scene,s),this.renderData.clear(),this.scene.traverse(o=>{if(!(o instanceof ap))return;const l=o.targetGeometry.groupMeshes.slice();this.renderData.set(o,{groupMeshes:l})}),this.lesMeshes.splice(0),this.prepareMaskMaterial.uniforms.faceMask.value=!0,t.setRenderTarget(this.renderTargetMaskBuffer),this.renderData.forEach((o,l)=>{l.visitGroupMeshes((c,u)=>{const h=o.groupMeshes.find(f=>f.groupIndex==c);if(!h)return;h.visible=!0,this.lesMeshes.includes(h)||this.lesMeshes.push(h),h.clearGroups(),h.addGroups(u,0);let d=h.parent;for(;d!=null;)d.visible=!0,d=d.parent;t.render(this.scene,s),h.visible=!1})}),this.scene.overrideMaterial=null,this.setVisibilityForAllObjects(!0),this.scene.background=a,this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,i&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(r),this.fsQuad.render(t),t.setClearColor(this._oldClearColor,this.oldClearAlpha),this.lesMeshes.forEach(o=>o.resetFaces()),this.scene.traverse(o=>{o instanceof wa&&o.restoreSceneVisibility()})}renderDebug(t){t.autoClear=!1,t.clearDepth(),this.spriteMaterial.map=this.renderTargetMaskBuffer.texture,t.render(this.sceneOrtho,this.cameraOrtho)}createPrepareMaskMaterial(){return new wn({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new oe(.5,.5)},textureMatrix:{value:null},faceMask:{value:!1}},vertexShader:d2,fragmentShader:h2})}createOverlayMaterial(){return new wn({uniforms:{maskTexture:{value:null},lesColor:{value:new L(1,1,1)}},vertexShader:Fl,fragmentShader:YU,depthTest:!1,depthWrite:!1,transparent:!0})}}class ZU extends c2{constructor(t,r){super(t,r);P(this,"viewport",new Tt);P(this,"coordScene",new Ea);P(this,"coordCamera",new Qn(-1,1,1,-1,.01,2));P(this,"group",new bi);P(this,"arrowHelperX");P(this,"arrowHelperY");P(this,"arrowHelperZ");P(this,"position",new L(0,0,1));P(this,"rotation",new qe);this.clear=!1;const i=new L(0,0,0),s=new L(1,0,0),a=new L(0,1,0),o=new L(0,0,1);this.arrowHelperX=new Fg(s,i,1,16711680,.2,.1),this.arrowHelperY=new Fg(a,i,1,65280,.2,.1),this.arrowHelperZ=new Fg(o,i,1,255,.2,.1),this.group.add(this.arrowHelperX),this.group.add(this.arrowHelperY),this.group.add(this.arrowHelperZ),this.coordScene.add(this.group)}render(t,r,i,s,a){!Dr.cameraInfo||(this.viewInfo.cameraSystem.currentCamera.updateMatrix(),this.rotation.copy(this.viewInfo.cameraSystem.currentCamera.quaternion),this.position.set(0,0,1),this.position.applyQuaternion(this.rotation),this.coordCamera.position.copy(this.position),this.coordCamera.quaternion.copy(this.rotation),t.getViewport(this.viewport),t.setViewport(10,10,150,150),t.clearDepth(),t.render(this.coordScene,this.coordCamera),t.setViewport(this.viewport))}}class p0 extends ys{constructor(e=10,t=10,r=16711680,i=65280,s=8947848){const a=new Ce(r),o=new Ce(i),l=new Ce(s),c=t/2,u=e/t,h=e/2,d=new Array,f=new Array;for(let y=0,p=0,m=-h;y<=t;y++,m+=u){d.push(-h,0,m,h,0,m),d.push(m,0,-h,m,0,h);const x=y===c?a:l,w=y===c?o:l;x.toArray(f,p),p+=3,x.toArray(f,p),p+=3,w.toArray(f,p),p+=3,w.toArray(f,p),p+=3}const v=new nt;v.setAttribute("position",new Ye(d,3)),v.setAttribute("color",new Ye(f,3));const g=new Gn({vertexColors:!0,toneMapped:!1});super(v,g),this.type="GridHelper"}}class qU{constructor(e,t){P(this,"_wallMode");P(this,"isDisposed$",new Mn);const r=me.getState().runtime.view;this._wallMode=r.wallMode,En.viewSettings$.pipe(an(this.isDisposed$)).subscribe(i=>{this._wallMode!=i.wallMode&&(this._wallMode=i.wallMode,t.remove(e),e=this.createGridHelper(),t.add(e),this._wallMode&&e.rotateZ(st.degToRad(-90)))})}dispose(){this.isDisposed$.next(!0)}createGridHelper(){let e;return this._wallMode?e=new p0(2,20,255,65280,8947848):e=new p0(2,20),e.rotateX(st.degToRad(90)),e}}ot.DefaultUp.set(0,0,1);class QU{constructor(e){P(this,"scene");P(this,"defaultEventHandler");P(this,"toolManager");P(this,"highlightManager");P(this,"lightEmittingObjectCreator");P(this,"eventBinder");P(this,"renderer");P(this,"composer");P(this,"outlinePass");P(this,"lightEmittingSurfacesPass");P(this,"coordSysViewPass");P(this,"fxaaShaderPass");P(this,"resizeEventHandler");P(this,"isDisposed$",new Mn);P(this,"layers");P(this,"animateHandler");P(this,"sceneSystem");P(this,"gridHelper");P(this,"isDisposed",!1);P(this,"cameraSystem");this.viewport=e,this.gridHelper=this.createGridHelper(),this.scene=this.createScene(this.gridHelper),this.sceneSystem=new qU(this.gridHelper,this.scene),this.cameraSystem=new zi(this.viewport),this.defaultEventHandler=new XU,this.renderer=this.createRenderer(),this.outlinePass=this.createOutlinePass(),this.lightEmittingSurfacesPass=this.createLightEmittingSurfacesPass(),this.coordSysViewPass=new ZU(this.scene,this),this.fxaaShaderPass=this.createFxaaShaderPass(),this.composer=this.createEffectComposer(),this.toolManager=new PU(this.scene,this),this.highlightManager=new IU(this.scene,this.outlinePass),this.lightEmittingObjectCreator=new WU(this.scene),this.layers=new ac,this.eventBinder=new LU(e.element,this.toolManager,this.defaultEventHandler,this.layers),this.resizeEventHandler=()=>this.onResize(),this.animateHandler=()=>this.animate(),window.addEventListener("resize",this.resizeEventHandler),En.runtimeUi$.pipe(an(this.isDisposed$)).subscribe(t=>this.onResize()),Dr.cameraInfo$.pipe(an(this.isDisposed$)).subscribe(t=>{this.scene.traverseParts(r=>{r.updateFromCameraInfo(t)}),this.toolManager.updateFromCameraInfo(t)}),requestAnimationFrame(this.animateHandler)}dispose(){this.isDisposed$.next(!0),this.isDisposed=!0,window.removeEventListener("resize",this.resizeEventHandler),this.scene.dispose(),this.eventBinder.dispose(),this.lightEmittingObjectCreator.dispose(),this.highlightManager.dispose(),this.toolManager.dispose(),this.renderer.dispose(),this.cameraSystem.dispose(),this.sceneSystem.dispose()}onResize(){const e=this.viewport.width,t=this.viewport.height;this.cameraSystem.resize(),this.renderer.setSize(e,t),this.composer.setSize(e,t),this.lightEmittingSurfacesPass.setSize(e,t),this.outlinePass.setSize(e,t),this.fxaaShaderPass.uniforms.resolution.value.set(1/this.viewport.width,1/this.viewport.height)}createGridHelper(){const e=new p0(2,20);return e.rotateX(st.degToRad(90)),e}createScene(e){const t=new RU(new jU);return t.add(e),Xt.cleared$.pipe(an(this.isDisposed$)).subscribe(()=>t.clearParts()),t}createRenderer(){const e=window.screen.availHeight<=1080?1:1080/window.screen.availHeight,t=new St({alpha:!1});return t.setPixelRatio(e),t.setSize(this.viewport.width,this.viewport.height),t.setClearColor("#E8E8E8"),t.autoClear=!1,t.info.autoReset=!1,this.viewport.element.appendChild(t.domElement),t}animate(){if(this.isDisposed)return;requestAnimationFrame(this.animateHandler),this.toolManager.preRenderUpdate(),this.composer.render();const e=this.composer.renderer.info;Dr.updateRenderState({pointCount:e.render.points,lineCount:e.render.lines,triangleCount:e.render.triangles,callCount:e.render.calls}),this.renderer.info.reset()}createFxaaShaderPass(){const e=new f0(OU);return e.uniforms.resolution.value.set(1/this.viewport.width,1/this.viewport.height),e}createOutlinePass(){return new su(new oe(this.viewport.width,this.viewport.height),this.scene,this)}createLightEmittingSurfacesPass(){return new $U(new oe(this.viewport.width,this.viewport.height),this.scene,this)}createEffectComposer(){const e=new kU(this.renderer),t=new Gh(this.scene,this),r=new Gh(this.scene,this);r.layers.disableAll(),r.layers.enable(De.JointLayer),r.clear=!1,r.clearDepth=!0;const i=new Gh(this.scene,this);i.layers.disableAll(),i.layers.enable(De.DraggerLayer),i.clear=!1;const s=new Gh(this.scene,this);return s.layers.disableAll(),s.layers.enable(De.ToolLayer),s.clear=!1,s.clearDepth=!0,e.addPass(t),e.addPass(this.lightEmittingSurfacesPass),e.addPass(this.outlinePass),e.addPass(i),e.addPass(s),e.addPass(r),e.addPass(this.coordSysViewPass),e.addPass(this.fxaaShaderPass),En.viewSettings$.pipe(an(this.isDisposed$)).subscribe(a=>{t.layers.disableAll(),r.layers.disableAll(),this.outlinePass.layers.disableAll(),this.outlinePass.layers.enable(De.GeometryLayer),this.outlinePass.layers.enable(De.SelectedLayer),t.layers.enable(De.Static),t.layers.enable(De.SelectedWireframeLayer),a.jointObjectsVisible&&(r.layers.enable(De.JointLayer),this.outlinePass.layers.enable(De.JointLayer)),a.lightEmittingObjectsVisible&&(t.layers.enable(De.LightEmittingObjectLayer),this.outlinePass.layers.enable(De.LightEmittingObjectLayer)),a.sensorObjectsVisible&&(t.layers.enable(De.SensorLayer),this.outlinePass.layers.enable(De.SensorLayer)),a.electricalConnectorObjectsVisible&&(t.layers.enable(De.ElectricalConnectorLayer),this.outlinePass.layers.enable(De.ElectricalConnectorLayer)),a.pendulumConnectorObjectsVisible&&(t.layers.enable(De.PendulumConnectorLayer),this.outlinePass.layers.enable(De.PendulumConnectorLayer)),a.cameraType==$e.Pers&&a.wireframe3D||a.cameraType!=$e.Pers&&a.wireframe2D?t.layers.enable(De.WireframeLayer):t.layers.enable(De.GeometryLayer)}),e}canInsertMesh(e){const t=qt.selectById(me.getState().luminaire.meshes,e);return t==null?!1:Xt.hasData(t.meshUrl)}tryGetScenePosition(e,t){const r=new Cr(new L(0,0,1)),i=new va;return i.setFromCamera(e,this.cameraSystem.currentCamera),i.ray.intersectPlane(r,t)!=null}tryGetPositionOnGeometricObject(e,t){const r=new va;r.setFromCamera(e,this.cameraSystem.currentCamera),r.layers.disableAll(),r.layers.enable(De.GeometryLayer),r.layers.enable(De.JointLayer);const i=r.intersectObjects(this.scene.children,!0);if(i==null||i.length==0)return!1;for(let s=0;s<i.length;s++){const a=i[s];if(a.object instanceof _s){const o=a.object,l=Vn.get(a.object);if(l==null||a.faceIndex==null)continue;let c=null,u=null,h=null;if(l instanceof ao){const d=sa.getPolygonNormalFromTriangleIndex(o.geometry,a.faceIndex);u=a.object.localToWorld(d).sub(a.object.localToWorld(new L(0,0,0)));const f=sa.getPolygonVerticesFromTriengleIndex(o.geometry,a.faceIndex),v=new L;f.length&&(f.forEach(g=>v.add(g.position)),v.divideScalar(f.length)),c=a.object.localToWorld(v),h=f.map(g=>a.object.localToWorld(g.position))}return t.part=l,t.mesh=a.object,t.worldDropPosition=a.point,t.worldFacePosition=c,t.worldFaceNormal=u,t.worldFacePoints=h,!0}}return!1}createLeoFromDropTarget(e){!(e.part instanceof ao)||e.worldFacePoints==null||e.worldFaceNormal==null||e.worldFacePosition==null||this.lightEmittingObjectCreator.createLightEmittingPart(e.part,e.worldFacePosition,e.worldFaceNormal,e.worldFacePoints)}}const Rn=[];for(let n=0;n<256;n++)Rn[n]=(n<16?"0":"")+n.toString(16);const JU=typeof crypto!="undefined"&&"randomUUID"in crypto;function KU(){if(JU)return crypto.randomUUID().toUpperCase();const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Rn[n&255]+Rn[n>>8&255]+Rn[n>>16&255]+Rn[n>>24&255]+"-"+Rn[e&255]+Rn[e>>8&255]+"-"+Rn[e>>16&15|64]+Rn[e>>24&255]+"-"+Rn[t&63|128]+Rn[t>>8&255]+"-"+Rn[t>>16&255]+Rn[t>>24&255]+Rn[r&255]+Rn[r>>8&255]+Rn[r>>16&255]+Rn[r>>24&255]).toUpperCase()}function e6(n,e,t){var r;!e||e.type==kd.Geometry&&me.dispatch(Te.geometryPartAdded({parentId:n==null?void 0:n.id,meshId:e.meshId,position:(r=t==null?void 0:t.position)!=null?r:{x:0,y:0,z:0}}))}function t6(n,e,t){var r;!n||!e||e.type==kd.Geometry&&me.dispatch(Te.geometryPartWithAutoJointAdded({parentId:n==null?void 0:n.id,meshId:e.meshId,position:(r=t==null?void 0:t.position)!=null?r:{x:0,y:0,z:0}}))}function n6(n,e,t){var r;!n||me.dispatch(Te.lightEmittingPartAdded({parentId:n==null?void 0:n.id,position:(r=t==null?void 0:t.position)!=null?r:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},shape:{type:Oe.Rectangle,sizeX:.2,sizeY:.2}}))}function r6(n,e,t){var r;!n||me.dispatch(Te.jointPartAdded({parentId:n.id,position:(r=t==null?void 0:t.position)!=null?r:{x:0,y:0,z:0}}))}function i6(n,e,t){var r;!n||me.dispatch(Te.sensorPartAdded({parentId:n==null?void 0:n.id,position:(r=t==null?void 0:t.position)!=null?r:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}))}function s6(n,e,t){var r;!n||me.dispatch(Te.electricalConnectorPartAdded({parentId:n==null?void 0:n.id,position:(r=t==null?void 0:t.position)!=null?r:{x:0,y:0,z:0}}))}function a6(n,e,t){var r;!n||me.dispatch(Te.pendulumConnectorPartAdded({parentId:n==null?void 0:n.id,position:(r=t==null?void 0:t.position)!=null?r:{x:0,y:0,z:0}}))}function jo(n,e,t){var i;const r=(i=n==null?void 0:n.id)!=null?i:0;me.dispatch(Te.partParentChanged({partId:e,parentId:r}))}function f2(n,e){if(n.parentId==e)return!0;if(n.parentId==0)return!1;const t=mt.part(n.parentId)(me.getState());if(!t)throw new Error(`Invalid parent id (${n.parentId}) on part (${n.id})!`);return f2(t,e)}function Wo(n,e,t){return n?n.id==e?!1:!f2(n,e):!0}class o6{constructor(){P(this,"newItemMap",new Map);P(this,"existingItemMap",new Map);this.newItemMap.set(Y.Geometry,new Map().set(Y.Geometry,{drop:t6}).set(Y.LightEmittingObject,{drop:n6}).set(Y.Joint,{drop:r6}).set(Y.Sensor,{drop:i6}).set(Y.ElectricalConnector,{drop:s6}).set(Y.PendulumConnector,{drop:a6})).set(Y.Joint,new Map().set(Y.Geometry,{drop:e6})),this.existingItemMap.set(Y.Joint,new Map().set(Y.Geometry,{canDrop:Wo,drop:jo})).set(Y.Geometry,new Map().set(Y.LightEmittingObject,{canDrop:Wo,drop:jo}).set(Y.Joint,{canDrop:Wo,drop:jo}).set(Y.Sensor,{canDrop:Wo,drop:jo}).set(Y.PendulumConnector,{canDrop:Wo,drop:jo}).set(Y.ElectricalConnector,{canDrop:Wo,drop:jo}))}canDropOnPartId(e,t){const r=mt.part(e)(me.getState());return r?this.canDropOnPart(r,t):!1}canDropOnPart(e,t){var r,i,s,a,o,l,c,u;if(t.type==Ns.NewItem){const h=(i=this.newItemMap.get((r=e==null?void 0:e.type)!=null?r:Y.Joint))==null?void 0:i.get(t.itemType);return h?(a=(s=h.canDrop)==null?void 0:s.call(h,e,t.itemData))!=null?a:!0:!1}else if(t.type==Ns.ExistingPart){const h=(l=this.existingItemMap.get((o=e==null?void 0:e.type)!=null?o:Y.Joint))==null?void 0:l.get(t.itemType);return h?(u=(c=h.canDrop)==null?void 0:c.call(h,e,t.partId))!=null?u:!0:!1}return!1}performDrop(e,t,r){var i,s,a,o,l,c;t.type==Ns.NewItem?(a=(s=this.newItemMap.get((i=e==null?void 0:e.type)!=null?i:Y.Joint))==null?void 0:s.get(t.itemType))==null||a.drop(e,t.itemData,r):t.type==Ns.ExistingPart&&((c=(l=this.existingItemMap.get((o=e==null?void 0:e.type)!=null?o:Y.Joint))==null?void 0:l.get(t.itemType))==null||c.drop(e,t.partId,r)),this.stopDragDrop()}createId(){return KU().toLowerCase()}startExistingPartDragDrop(e){return me.dispatch(Pe.dragDropStarted({type:Ns.ExistingPart,uniqueId:this.createId(),itemType:e.type,partId:e.id,hoverPart:null})),me.getState().runtime.dragDrop.uniqueId}startNewItemDragDrop(e,t){return me.dispatch(Pe.dragDropStarted({type:Ns.NewItem,uniqueId:this.createId(),itemType:e,itemData:t!=null?t:null,hoverPart:null})),me.getState().runtime.dragDrop.uniqueId}stopDragDrop(){me.dispatch(Pe.dragDropStopped())}}const yn=new o6,l6={triangulate:function(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let s=p2(n,0,i,t,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,f;if(r&&(s=f6(n,e,s,t)),n.length>80*t){o=c=n[0],l=u=n[1];for(let v=t;v<i;v+=t)h=n[v],d=n[v+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-o,u-l),f=f!==0?1/f:0}return ld(s,a,t,o,l,f),a}};function p2(n,e,t,r,i){let s,a;if(i===M6(n,e,t,r)>0)for(s=e;s<t;s+=r)a=Eb(s,n[s],n[s+1],a);else for(s=t-r;s>=e;s-=r)a=Eb(s,n[s],n[s+1],a);return a&&fm(a,a.next)&&(ud(a),a=a.next),a}function _a(n,e){if(!n)return n;e||(e=n);let t=n,r;do if(r=!1,!t.steiner&&(fm(t,t.next)||$t(t.prev,t,t.next)===0)){if(ud(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function ld(n,e,t,r,i,s,a){if(!n)return;!a&&s&&y6(n,r,i,s);let o=n,l,c;for(;n.prev!==n.next;){if(l=n.prev,c=n.next,s?u6(n,r,i,s):c6(n)){e.push(l.i/t),e.push(n.i/t),e.push(c.i/t),ud(n),n=c.next,o=c.next;continue}if(n=c,n===o){a?a===1?(n=d6(_a(n),e,t),ld(n,e,t,r,i,s,2)):a===2&&h6(n,e,t,r,i,s):ld(_a(n),e,t,r,i,s,1);break}}}function c6(n){const e=n.prev,t=n,r=n.next;if($t(e,t,r)>=0)return!1;let i=n.next.next;for(;i!==n.prev;){if(ul(e.x,e.y,t.x,t.y,r.x,r.y,i.x,i.y)&&$t(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u6(n,e,t,r){const i=n.prev,s=n,a=n.next;if($t(i,s,a)>=0)return!1;const o=i.x<s.x?i.x<a.x?i.x:a.x:s.x<a.x?s.x:a.x,l=i.y<s.y?i.y<a.y?i.y:a.y:s.y<a.y?s.y:a.y,c=i.x>s.x?i.x>a.x?i.x:a.x:s.x>a.x?s.x:a.x,u=i.y>s.y?i.y>a.y?i.y:a.y:s.y>a.y?s.y:a.y,h=m0(o,l,e,t,r),d=m0(c,u,e,t,r);let f=n.prevZ,v=n.nextZ;for(;f&&f.z>=h&&v&&v.z<=d;){if(f!==n.prev&&f!==n.next&&ul(i.x,i.y,s.x,s.y,a.x,a.y,f.x,f.y)&&$t(f.prev,f,f.next)>=0||(f=f.prevZ,v!==n.prev&&v!==n.next&&ul(i.x,i.y,s.x,s.y,a.x,a.y,v.x,v.y)&&$t(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;f&&f.z>=h;){if(f!==n.prev&&f!==n.next&&ul(i.x,i.y,s.x,s.y,a.x,a.y,f.x,f.y)&&$t(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=d;){if(v!==n.prev&&v!==n.next&&ul(i.x,i.y,s.x,s.y,a.x,a.y,v.x,v.y)&&$t(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function d6(n,e,t){let r=n;do{const i=r.prev,s=r.next.next;!fm(i,s)&&m2(i,r,r.next,s)&&cd(i,s)&&cd(s,i)&&(e.push(i.i/t),e.push(r.i/t),e.push(s.i/t),ud(r),ud(r.next),r=n=s),r=r.next}while(r!==n);return _a(r)}function h6(n,e,t,r,i,s){let a=n;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&_6(a,o)){let l=g2(a,o);a=_a(a,a.next),l=_a(l,l.next),ld(a,e,t,r,i,s),ld(l,e,t,r,i,s);return}o=o.next}a=a.next}while(a!==n)}function f6(n,e,t,r){const i=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*r,l=s<a-1?e[s+1]*r:n.length,c=p2(n,o,l,r,!1),c===c.next&&(c.steiner=!0),i.push(w6(c));for(i.sort(p6),s=0;s<i.length;s++)m6(i[s],t),t=_a(t,t.next);return t}function p6(n,e){return n.x-e.x}function m6(n,e){if(e=g6(n,e),e){const t=g2(e,n);_a(e,e.next),_a(t,t.next)}}function g6(n,e){let t=e;const r=n.x,i=n.y;let s=-1/0,a;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const d=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=r&&d>s){if(s=d,d===r){if(i===t.y)return t;if(i===t.next.y)return t.next}a=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!a)return null;if(r===s)return a;const o=a,l=a.x,c=a.y;let u=1/0,h;t=a;do r>=t.x&&t.x>=l&&r!==t.x&&ul(i<c?r:s,i,l,c,i<c?s:r,i,t.x,t.y)&&(h=Math.abs(i-t.y)/(r-t.x),cd(t,n)&&(h<u||h===u&&(t.x>a.x||t.x===a.x&&v6(a,t)))&&(a=t,u=h)),t=t.next;while(t!==o);return a}function v6(n,e){return $t(n.prev,n,e.prev)<0&&$t(e.next,n,n.next)<0}function y6(n,e,t,r){let i=n;do i.z===null&&(i.z=m0(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,x6(i)}function x6(n){let e,t,r,i,s,a,o,l,c=1;do{for(t=n,n=null,s=null,a=0;t;){for(a++,r=t,o=0,e=0;e<c&&(o++,r=r.nextZ,!!r);e++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||t.z<=r.z)?(i=t,t=t.nextZ,o--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;t=r}s.nextZ=null,c*=2}while(a>1);return n}function m0(n,e,t,r,i){return n=32767*(n-t)*i,e=32767*(e-r)*i,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function w6(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function ul(n,e,t,r,i,s,a,o){return(i-a)*(e-o)-(n-a)*(s-o)>=0&&(n-a)*(r-o)-(t-a)*(e-o)>=0&&(t-a)*(s-o)-(i-a)*(r-o)>=0}function _6(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!b6(n,e)&&(cd(n,e)&&cd(e,n)&&S6(n,e)&&($t(n.prev,n,e.prev)||$t(n,e.prev,e))||fm(n,e)&&$t(n.prev,n,n.next)>0&&$t(e.prev,e,e.next)>0)}function $t(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function fm(n,e){return n.x===e.x&&n.y===e.y}function m2(n,e,t,r){const i=jh($t(n,e,t)),s=jh($t(n,e,r)),a=jh($t(t,r,n)),o=jh($t(t,r,e));return!!(i!==s&&a!==o||i===0&&Vh(n,t,e)||s===0&&Vh(n,r,e)||a===0&&Vh(t,n,r)||o===0&&Vh(t,e,r))}function Vh(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function jh(n){return n>0?1:n<0?-1:0}function b6(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&m2(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function cd(n,e){return $t(n.prev,n,n.next)<0?$t(n,e,n.next)>=0&&$t(n,n.prev,e)>=0:$t(n,e,n.prev)<0||$t(n,n.next,e)<0}function S6(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function g2(n,e){const t=new g0(n.i,n.x,n.y),r=new g0(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function Eb(n,e,t,r){const i=new g0(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ud(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function g0(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M6(n,e,t,r){let i=0;for(let s=e,a=t-r;s<t;s+=r)i+=(n[a]-n[s])*(n[s+1]+n[a+1]),a=s;return i}const E6=/^[og]\s*(.+)?/,A6=/^mtllib /,T6=/^usemtl /,C6=/^usemap /,Ab=new L,Wg=new L,Tb=new L,Cb=new L,Gr=new L;class op{constructor(e,t,r,i,s){P(this,"groupEnd",-1);P(this,"groupCount",-1);P(this,"inherited",!1);this.index=e,this.name=t,this.mtllib=r,this.smooth=i,this.groupStart=s}clone(e){const t=new op(e,this.name,this.mtllib,this.smooth,0);return t.groupEnd=-1,t.groupCount=-1,t.inherited=!1,t}}class P6{constructor(){P(this,"type","");P(this,"vertices",new Array);P(this,"normals",new Array);P(this,"colors",new Array);P(this,"uvs",new Array);P(this,"hasUVIndices",!1)}}class Pb{constructor(e,t){P(this,"geometry",new P6);P(this,"materials",new Array);P(this,"smooth",!0);P(this,"polygons",new Array);P(this,"triangleMapping",new Map);P(this,"nextTriangleIndex",0);this.name=e,this.fromDeclaration=t}startMaterial(e,t){const r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);const i=new op(this.materials.length,e||"",Array.isArray(t)&&t.length>0?t[t.length-1]:"",r!==void 0?r.smooth:this.smooth,r!==void 0?r.groupEnd:0);return this.materials.push(i),i}currentMaterial(){if(this.materials.length>0)return this.materials[this.materials.length-1]}_finalize(e){const t=this.currentMaterial();if(t&&t.groupEnd===-1&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&this.materials.length===0&&this.materials.push(new op(this.materials.length,"","",this.smooth,0)),t}}class I6{constructor(){P(this,"objects",new Array);P(this,"object");P(this,"vertices",new Array);P(this,"normals",new Array);P(this,"colors",new Array);P(this,"uvs",new Array);P(this,"materials",new Map);P(this,"materialLibraries",new Array);this.object=new Pb("",!1),this.objects.push(this.object)}startObject(e,t){var i;if(this.object&&!this.object.fromDeclaration){this.object.name=e,this.object.fromDeclaration=t;return}const r=this.object&&this.object.currentMaterial();if((i=this.object)==null||i._finalize(!0),this.object=new Pb(e||"",t!=!1),r&&r.name&&typeof r.clone=="function"){const s=r.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)}finalize(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)}parseVertexIndex(e,t){const r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3}parseNormalIndex(e,t){const r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3}parseUVIndex(e,t){const r=parseInt(e,10);return(r>=0?r-1:r+t/2)*2}addVertex(e,t,r){const i=this.vertices,s=this.object.geometry.vertices,a=s.length/3;s.push(i[e+0],i[e+1],i[e+2]);const o=s.length/3;s.push(i[t+0],i[t+1],i[t+2]);const l=s.length/3;return s.push(i[r+0],i[r+1],i[r+2]),{ia:a,ib:o,ic:l}}addVertexPoint(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])}addVertexLine(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])}addNormal(e,t,r){const i=this.normals,s=this.object.geometry.normals;s.push(i[e+0],i[e+1],i[e+2]),s.push(i[t+0],i[t+1],i[t+2]),s.push(i[r+0],i[r+1],i[r+2])}addFaceNormal(e,t,r){const i=this.vertices,s=this.object.geometry.normals;Ab.fromArray(i,e),Wg.fromArray(i,t),Tb.fromArray(i,r),Gr.subVectors(Tb,Wg),Cb.subVectors(Ab,Wg),Gr.cross(Cb),Gr.normalize(),s.push(Gr.x,Gr.y,Gr.z),s.push(Gr.x,Gr.y,Gr.z),s.push(Gr.x,Gr.y,Gr.z)}addColor(e,t,r){const i=this.colors,s=this.object.geometry.colors;i[e]!==void 0&&s.push(i[e+0],i[e+1],i[e+2]),i[t]!==void 0&&s.push(i[t+0],i[t+1],i[t+2]),i[r]!==void 0&&s.push(i[r+0],i[r+1],i[r+2])}addUV(e,t,r){const i=this.uvs,s=this.object.geometry.uvs;s.push(i[e+0],i[e+1]),s.push(i[t+0],i[t+1]),s.push(i[r+0],i[r+1])}addDefaultUV(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)}addUVLine(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])}addFace(e,t,r,i,s,a,o,l,c){const u=this.vertices.length;let h=this.parseVertexIndex(e,u),d=this.parseVertexIndex(t,u),f=this.parseVertexIndex(r,u);const v=this.addVertex(h,d,f);if(this.addColor(h,d,f),o!==void 0&&o!==""){const g=this.normals.length;h=this.parseNormalIndex(o,g),d=this.parseNormalIndex(l,g),f=this.parseNormalIndex(c,g),this.addNormal(h,d,f)}else this.addFaceNormal(h,d,f);if(i!==void 0&&i!==""){const g=this.uvs.length;h=this.parseUVIndex(i,g),d=this.parseUVIndex(s,g),f=this.parseUVIndex(a,g),this.addUV(h,d,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV();return v}addLineGeometry(e,t){this.object.geometry.type="Line";const r=this.vertices.length,i=this.uvs.length;for(let s=0,a=e.length;s<a;s++)this.addVertexLine(this.parseVertexIndex(e[s],r));for(let s=0,a=t.length;s<a;s++)this.addUVLine(this.parseUVIndex(t[s],i))}}class L6 extends Qi{load(e,t,r,i){const s=this,a=new lx(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){var l;try{t(s.parse(o))}catch(c){i?i(c):He.error(Xe.ObjLoadError,(l=c==null?void 0:c.toString())!=null?l:""),s.manager.itemError(e)}},r,i)}parse(e){const t=new I6;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const r=e.split(`
`);let i="",s="",a=0,o=null;const l=typeof"".trimLeft=="function";for(let h=0,d=r.length;h<d;h++)if(i=r[h],i=l?i.trimLeft():i.trim(),a=i.length,a!==0&&(s=i.charAt(0),s!=="#")){if(s==="v"){const f=i.split(/\s+/);switch(f[0]){case"v":t.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?t.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])):t.colors.push(0,0,0);break;case"vn":t.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":t.uvs.push(parseFloat(f[1]),parseFloat(f[2]));break}}else if(s==="f"){const v=i.substr(1).trim().split(/\s+/),g=new Array;for(let x=0,w=v.length;x<w;x++){const b=v[x];if(b.length>0){const C=b.split("/");g.push({parts:C,parsedVertexIndex:-1,geometryVertexIndices:[]})}}const y=t.object.polygons.length,p=t.object.geometry.vertices.length/3;if(g.length==3){const x=g[0],w=g[1],b=g[2],C=t.addFace(x.parts[0],w.parts[0],b.parts[0],x.parts[1],w.parts[1],b.parts[1],x.parts[2],w.parts[2],b.parts[2]);g[0].geometryVertexIndices.push(C.ia),g[1].geometryVertexIndices.push(C.ib),g[2].geometryVertexIndices.push(C.ic),t.object.triangleMapping.set(t.object.nextTriangleIndex++,y)}else if(g.length>3){const x=g.map(O=>{const H=O.parsedVertexIndex=t.parseVertexIndex(O.parts[0],t.vertices.length);return new L(t.vertices[H],t.vertices[H+1],t.vertices[H+2])}),w=(O,H)=>(O%H+H)%H,b=new L;for(let O=0;O<x.length;O++){const H=x[w(O+1,x.length)],D=x[O],U=x[w(O-1,x.length)],_=new L().subVectors(H,D).normalize(),z=new L().subVectors(U,D).normalize();b.add(new L().crossVectors(_,z))}b.normalize();const C=new qe().setFromUnitVectors(b,new L(0,0,1)),F=x.map(O=>O.applyQuaternion(C)).map(O=>new oe(O.x,O.y)).flatMap(O=>[O.x,O.y]),N=l6.triangulate(F,null,2);for(let O=0;O<N.length;O+=3){const H=N[O],D=N[O+1],U=N[O+2],_=g[H],z=g[D],j=g[U],R=t.addFace(_.parts[0],z.parts[0],j.parts[0],_.parts[1],z.parts[1],j.parts[1],_.parts[2],z.parts[2],j.parts[2]);g[H].geometryVertexIndices.push(R.ia),g[D].geometryVertexIndices.push(R.ib),g[U].geometryVertexIndices.push(R.ic),t.object.triangleMapping.set(t.object.nextTriangleIndex++,y)}}const m=t.object.geometry.vertices.length/3-1;t.object.polygons.push({loopIndices:g.map(x=>x.geometryVertexIndices[0]),firstVertexIndex:p,lastVertexIndex:m})}else if(s==="l"){const f=i.substring(1).trim().split(" ");let v=[];const g=[];if(i.indexOf("/")===-1)v=f;else for(let y=0,p=f.length;y<p;y++){const m=f[y].split("/");m[0]!==""&&v.push(m[0]),m[1]!==""&&g.push(m[1])}t.addLineGeometry(v,g)}else if(s!=="p")if((o=E6.exec(i))!==null){const f=(" "+o[0].substr(1).trim()).substr(1);t.startObject(f,!0)}else if(T6.test(i))t.object.startMaterial(i.substring(7).trim(),t.materialLibraries);else if(A6.test(i))t.materialLibraries.push(i.substring(7).trim());else if(C6.test(i))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(s==="s"){if(o=i.split(" "),o.length>1){const v=o[1].trim().toLowerCase();t.object.smooth=v!=="0"&&v!=="off"}else t.object.smooth=!0;const f=t.object.currentMaterial();f&&(f.smooth=t.object.smooth)}else{if(i==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+i+'"')}}t.finalize();const c=new bi;if(c.materialLibraries=t.materialLibraries,!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let h=0,d=t.objects.length;h<d;h++){const f=t.objects[h],v=f.geometry,g=f.materials,y=v.type==="Line",p=v.type==="Points";let m=!1;if(v.vertices.length===0)continue;const x=new Xl;x.triangleMapping=f.triangleMapping,x.polygons=f.polygons.map(C=>({loopIndices:C.loopIndices,firstVertexIndex:C.firstVertexIndex,lastVertexIndex:C.lastVertexIndex})),x.polygonCount=x.polygons.length,x.setAttribute("position",new Ye(v.vertices,3)),v.normals.length>0&&x.setAttribute("normal",new Ye(v.normals,3)),v.colors.length>0&&(m=!0,x.setAttribute("color",new Ye(v.colors,3))),v.hasUVIndices===!0&&x.setAttribute("uv",new Ye(v.uvs,2));const w=[];for(let C=0,A=g.length;C<A;C++){const F=g[C],N=F.name+"_"+F.smooth+"_"+m;let O=t.materials.get(N);O===void 0&&(y?O=new Gn:p?O=new ep({size:1,sizeAttenuation:!1}):O=new ox,O.name=F.name,O.vertexColors=m,t.materials.set(N,O)),w.push(O)}let b;if(w.length>1){for(let C=0,A=g.length;C<A;C++){const F=g[C];x.addGroup(F.groupStart,F.groupCount,C)}y?b=new ys(x,w):p?b=new cf(x,w):b=new be(x,w)}else y?b=new ys(x,w[0]):p?b=new cf(x,w[0]):b=new be(x,w[0]);b.name=f.name,c.add(b)}else if(t.vertices.length>0){const h=new ep({size:1,sizeAttenuation:!1}),d=new Xl;d.setAttribute("position",new Ye(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(d.setAttribute("color",new Ye(t.colors,3)),h.vertexColors=!0);const f=new cf(d,h);c.add(f)}return c}}class R6 extends Qi{constructor(e){super(e)}load(e,t,r,i){const s=this,a=this.path===""?gA.extractUrlBase(e):this.path,o=new lx(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(s.parse(l,a))}catch(c){i?i(c):console.error(c),s.manager.itemError(e)}},r,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const r=e.split(`
`);let i={};const s=/\s+/,a={};for(let l=0;l<r.length;l++){let c=r[l];if(c=c.trim(),c.length===0||c.charAt(0)==="#")continue;const u=c.indexOf(" ");let h=u>=0?c.substring(0,u):c;h=h.toLowerCase();let d=u>=0?c.substring(u+1):"";if(d=d.trim(),h==="newmtl")i={name:d},a[d]=i;else if(h==="ka"||h==="kd"||h==="ks"||h==="ke"){const f=d.split(s,3);i[h]=[parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])]}else i[h]=d}const o=new F6(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(a),o}}class F6{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:Bl,this.wrap=this.options.wrap!==void 0?this.options.wrap:$f}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const r in e){const i=e[r],s={};t[r]=s;for(const a in i){let o=!0,l=i[a];const c=a.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(l=[l[0]/255,l[1]/255,l[2]/255]),this.options&&this.options.ignoreZeroRGBs&&l[0]===0&&l[1]===0&&l[2]===0&&(o=!1);break}o&&(s[c]=l)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,r=this.materialsInfo[e],i={name:e,side:this.side};function s(o,l){return typeof l!="string"||l===""?"":/^https?:\/\//i.test(l)?l:o+l}function a(o,l){if(i[o])return;const c=t.getTextureParams(l,i),u=t.loadTexture(s(t.baseUrl,c.url));u.repeat.copy(c.scale),u.offset.copy(c.offset),u.wrapS=t.wrap,u.wrapT=t.wrap,i[o]=u}for(const o in r){const l=r[o];let c;if(l!=="")switch(o.toLowerCase()){case"kd":i.color=new Ce().fromArray(l);break;case"ks":i.specular=new Ce().fromArray(l);break;case"ke":i.emissive=new Ce().fromArray(l);break;case"map_kd":a("map",l);break;case"map_ks":a("specularMap",l);break;case"map_ke":a("emissiveMap",l);break;case"norm":a("normalMap",l);break;case"map_bump":case"bump":a("bumpMap",l);break;case"map_d":a("alphaMap",l),i.transparent=!0;break;case"ns":i.shininess=parseFloat(l);break;case"d":c=parseFloat(l),c<1&&(i.opacity=c,i.transparent=!0);break;case"tr":c=parseFloat(l),this.options&&this.options.invertTrProperty&&(c=1-c),c>0&&(i.opacity=1-c,i.transparent=!0);break}}return this.materials[e]=new ox(i),this.materials[e]}getTextureParams(e,t){const r={scale:new oe(1,1),offset:new oe(0,0)},i=e.split(/\s+/);let s;return s=i.indexOf("-bm"),s>=0&&(t.bumpScale=parseFloat(i[s+1]),i.splice(s,2)),s=i.indexOf("-s"),s>=0&&(r.scale.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),s=i.indexOf("-o"),s>=0&&(r.offset.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),r.url=i.join(" ").trim(),r}loadTexture(e,t,r,i,s){const a=this.manager!==void 0?this.manager:uA;let o=a.getHandler(e);o===null&&(o=new im(a)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const l=o.load(e,r,i,s);return t!==void 0&&(l.mapping=t),l}}var D6=`uniform sampler2D materialMap;\r
\r
varying vec2 vUv;\r
varying vec3 vNormal;\r
\r
void main() {\r
    float intensity = dot(vec3(0.0, 0.0, 1.0), normalize(vNormal)) * 0.8 + 0.2;\r
    vec4 texture = texture2D(materialMap, vUv);\r
\r
    gl_FragColor = vec4(intensity * texture.xyz, texture.w);\r
}`,N6=`uniform vec4 color;\r
\r
varying vec3 vNormal;\r
\r
void main() {\r
    float intensity = dot(vec3(0.0, 0.0, 1.0), normalize(vNormal)) * 0.8 + 0.2;\r
    gl_FragColor = vec4(intensity * color.xyz, color.w);\r
}`;class v2 extends wn{constructor(t,r,i){super(i);P(this,"isMeshMaterial",!0);this.name=t,r<.99&&(this.transparent=!0,this.depthWrite=!1)}}class v0 extends v2{constructor(t,r,i){super(t,r,{vertexShader:Fl,fragmentShader:D6});P(this,"isMeshTextureMaterial",!0);this.uniforms.materialMap={value:i}}}class Pu extends v2{constructor(t,r,i){super(t,r,{vertexShader:Fl,fragmentShader:N6});P(this,"isMeshColorMaterial",!0);this.uniforms.color={value:new Tt(i.r,i.g,i.b,r)}}}class y0{constructor(){P(this,"objLoader",new L6);P(this,"mtlLoader",new R6)}async readObjAsync(e){var d;const t=await e.text(),r=this.objLoader.parse(t),i=URL.createObjectURL(e),s=new L,a=new ur;a.setFromObject(r),a.getSize(s);const o={x:s.x,y:s.y,z:s.z},c=(d=r.materialLibraries)!=null?d:new Array;let u=0;const h=new Array;return r.children.forEach((f,v)=>{f instanceof be&&f.geometry instanceof Xl&&(u+=f.geometry.polygonCount,h.push({index:v,name:`Mesh (${v+1})`,faceCount:f.geometry.polygonCount}))}),{url:i,group:r,mtlLibraries:c,size:o,faceCount:u,groups:h}}async readMtlFileAsync(e){return this.readMtlBlobAsync(e.name,e)}async readMtlBlobAsync(e,t){const r=await t.text(),i=URL.createObjectURL(t),s=new Array,a=new Map,o=this.mtlLoader.parse(r,"");return Object.keys(o.materialsInfo).forEach(c=>{const u=o.materialsInfo[c];u!=null&&a.set(c,u);const h=u==null?void 0:u.map_kd;h!=null&&s.push(h)}),{name:e,url:i,textureFileNames:s,materialInfos:a}}static async convertMaterialAsync(e,t,r,i){var a,o,l,c;if(t.map_kd&&(i==null?void 0:i.has(t.map_kd))){const u=i.get(t.map_kd);if(u!=null)return r.loadAsync(u).then(h=>{var d;return new v0(e,(d=t.d)!=null?d:1,h)})}const s=t.kd!=null?new Ce((a=t.kd[0])!=null?a:0,(o=t.kd[1])!=null?o:0,(l=t.kd[2])!=null?l:0):new Ce(.6,.6,.6);return new Pu(e,(c=t.d)!=null?c:1,s)}}class pf{constructor(){P(this,"renderer");P(this,"scene");P(this,"camera");P(this,"isDisposed");this.renderer=new St({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(128,128),this.renderer.setClearColor("#E8E8E8"),this.scene=new Ea,this.camera=new rn(45,1),this.isDisposed=!1}createScene(e){if(this.scene.clear(),Xt.hasData(e)){const t=Xt.getData(e);t.group.rotation.z=0,this.scene.add(t.group)}}createBoundingBox(e){const t=new ur;return t.setFromObject(e.children[0]),t}createCamera(e){const t=new L,r=new L;e.getSize(t);const i=Math.max(t.x,t.y,t.z);e.getCenter(r),this.camera.position.set(i*2,i*2,r.z+i),this.camera.lookAt(0,0,r.z),this.camera.aspect=1,this.camera.updateProjectionMatrix()}async createScreenshot(e){if(this.isDisposed)throw Error("PreviewRenderer is disposed");this.createScene(e);const t=this.createBoundingBox(this.scene);return this.createCamera(t),this.renderer.render(this.scene,this.camera),await this.createScreenshotInternal()}async createScreenshotInternal(){const e=this.renderer.domElement.toDataURL("image/jpeg");return await fetch(e).then(t=>t.blob()).then(t=>URL.createObjectURL(t))}dispose(){this.isDisposed||(this.renderer.dispose(),this.isDisposed=!0)}}class Xg{constructor(e){P(this,"_files",new Array);P(this,"_usageMap",new Map);P(this,"cachedTextures",new Map);for(let t=0;t<e.length;t++){const r=e[t];this._files.push(r),this._usageMap.set(r,!1)}}get files(){return this._files}setFileUsed(e){this._usageMap.set(e,!0)}findFilesByExtension(e){return this.files.filter(t=>t.name.toLowerCase().endsWith(e.toLowerCase()))}findFileByName(e){var t;return(t=this.files.find(r=>r.name==e))!=null?t:null}getUnusedFileNames(){const e=new Array;return this._usageMap.forEach((t,r)=>{t||e.push(r.name)}),e}}class pm{constructor(){P(this,"reader",new y0)}async ImportObjects(e,t,r,i){if(!e.length)return;const s=new Xg(e),a=s.findFilesByExtension(".obj");if(!a.length){i("Material libraries and textures can only be imported together with the corresponding .obj file");return}const o=new pf;t.start("Importing OBJ Files ..."),await this.readObjects(a,s).then(async l=>{if(l.length)for(const u of l)await this.updateObjectMaterials(u.url,s);const c=s.getUnusedFileNames();return c.length&&i(`Files ignored: ${c.join(" ")}`),l}).then(async l=>{for(const c of l)c.previewUrl=await o.createScreenshot(c.url);return l}).then(l=>{if(l.length){const c=pt.defaultScaling(me.getState());r({meshes:l,unit:c})}}).then(()=>{o.dispose(),t.clear()},l=>{const c=l.toString();He.warn(Xe.ReadObjectsFailed,c),t.update({inProgress:!1,closable:!0,message:c})})}ImportMaterialLibraries(e,t,r,i){if(!e.length)return;const s=mt.meshDefinition(t)(me.getState());if(!s)return;const a=new Xg(e),o=a.findFilesByExtension(".mtl").map(u=>u.name);if(!o.length){i("Textures can only be imported together with the corresponding .mtl file");return}const l=this.getMissingMaterialLibraryFileNames(t),{usable:c}=this.splitUsableUnusedFileNames(o,l);if(!c.length){i("No missing files selected!");return}this.readMaterialLibraries(s.meshUrl,c,a).then(u=>{if(!e.length)return;const h=this.getDistinctTextureFileNames(u);this.readTextures(h,a).then(async d=>{const f={meshId:t,materialLibraries:new Array,textures:d,previewUrl:null};if(u.length){await this.updateObjectMaterialsByMeshId(t,a);const g=u.map(y=>({name:y.name,url:y.url,ignored:!1}));f.materialLibraries.push(...g)}const v=a.getUnusedFileNames();return v.length&&i(`Files ignored: ${v.join(" ")}`),f}).then(async d=>{const f=new pf,v=await f.createScreenshot(s.meshUrl).catch(g=>(He.warn(Xe.ScreenshotAfterMaterialFailed,g),null)).then(g=>(f.dispose(),g));d.previewUrl=v,r(d)})})}ImportTextures(e,t,r,i){if(!e.length)return;const s=new Xg(e),a=s.findFilesByExtension(".jpg"),o=s.findFilesByExtension(".png"),l=[...a,...o].map(h=>h.name),c=this.getMissingTextureFileNames(t),{usable:u}=this.splitUsableUnusedFileNames(l,c);if(!u.length){i("No missing files selected!");return}this.readTextures(u,s).then(async h=>{const d={meshId:t,textures:new Array,previewUrl:null};h.length&&(await this.updateObjectMaterialsByMeshId(t,s),d.textures.push(...h));const f=s.getUnusedFileNames();return f.length&&i(`Files ignored: ${f.join(" ")}`),d}).then(async h=>{const d=mt.meshDefinition(t)(me.getState());if(!d)return;const f=new pf,v=await f.createScreenshot(d.meshUrl).catch(g=>(He.warn(Xe.ScreenshotAfterTextureFailed,g),null)).then(g=>(f.dispose(),g));h.previewUrl=v,r(h)})}async readTextures(e,t){return Promise.all(e.map(async r=>{r=this.getFileName(r);const i=t.cachedTextures.get(r);if(i!=null)return i;const s=t.findFileByName(r);if(s==null)return{name:r,url:null,ignored:!1};const a=URL.createObjectURL(s),o={name:r,url:a,ignored:!1};return t.cachedTextures.set(r,o),t.setFileUsed(s),o}))}getFileName(e){return e.split("\\").pop().split("/").pop()}async readMaterialLibraries(e,t,r){const i=Xt.hasData(e)?Xt.getData(e):null;return Promise.all(t.map(async s=>{s=this.getFileName(s);const a=i==null?void 0:i.materialLibraries.find(h=>h.name==s);if(a!=null)return a;const o=r.findFileByName(s);if(o==null)return{name:s,url:null,ignored:!1,textureFileNames:[],materialInfos:new Map};const l=await this.reader.readMtlFileAsync(o);return r.setFileUsed(o),Xt.getData(e).materialLibraries.push({name:l.name,url:l.url,ignored:!1,textureFileNames:l.textureFileNames,materialInfos:l.materialInfos}),{name:l.name,url:l.url,ignored:!1,textureFileNames:l.textureFileNames,materialInfos:l.materialInfos}}))}async readObjectsInternal(e,t){return(await Promise.all(e.map(async i=>await this.reader.readObjAsync(i).then(async s=>{t.setFileUsed(i),Xt.addData(s.url,s.group);const a=await this.readMaterialLibraries(s.url,s.mtlLibraries,t);return{name:i.name,url:s.url,materialLibraries:a,size:s.size,groups:s.groups,faceCount:s.faceCount}},s=>(He.warn(Xe.ReadObjectsInternalFailed,s),null))))).filter(i=>i!=null).map(i=>i)}getDistinctTextureFileNames(e){const t=new Array;return e.forEach(r=>{r.textureFileNames.forEach(i=>{t.includes(i)||t.push(i)})}),t}async readObjects(e,t){const r=await this.readObjectsInternal(e,t);return await Promise.all(r.map(async s=>{const a=this.getDistinctTextureFileNames(s.materialLibraries);return{name:s.name,url:s.url,materialLibraries:s.materialLibraries.map(l=>({name:l.name,url:l.url,ignored:!1})),textures:await this.readTextures(a,t),groups:s.groups,size:s.size,faceCount:s.faceCount,previewUrl:""}}))}getMissingMaterialLibraryFileNames(e){const t=qt.selectById(me.getState().luminaire.meshes,e);if(!t)throw new Error(`Invalid mesh id: ${e}`);return sd.selectAll(t.material.libraries).filter(r=>r.url==null).map(r=>r.name)}getMissingTextureFileNames(e){const t=qt.selectById(me.getState().luminaire.meshes,e);if(!t)throw new Error(`Invalid mesh id: ${e}`);return ad.selectAll(t.material.textures).filter(r=>r.url==null).map(r=>r.name)}splitUsableUnusedFileNames(e,t){const r=new Array,i=new Array;return e.forEach(s=>{t.includes(s)?r.push(s):i.push(s)}),{usable:r,unused:i}}getMaterialInfo(e,t){for(let r=0;r<t.materialLibraries.length;r++){const i=t.materialLibraries[r];if(i.url==null)break;const o=i.materialInfos.get(e);if(o)return o}return null}async updateMaterial(e,t,r,i){var s;if(t.map_kd!=null&&e instanceof Pu&&r.cachedTextures.has(t.map_kd)){const a=r.cachedTextures.get(t.map_kd);if((a==null?void 0:a.url)!=null){const o=await i.loadAsync(a.url);return new v0(e.name,(s=t.d)!=null?s:1,o)}}return e}async createMaterial(e,t,r,i){var a,o,l,c,u;let s=null;if(t.map_kd&&r.cachedTextures.has(t.map_kd)){const h=r.cachedTextures.get(t.map_kd);if((h==null?void 0:h.url)!=null){const d=await i.loadAsync(h.url);s=new v0(e,(a=t.d)!=null?a:1,d)}}if(!s){const h=t.kd!=null?new Ce((o=t.kd[0])!=null?o:0,(l=t.kd[1])!=null?l:0,(c=t.kd[2])!=null?c:0):new Ce(.6,.6,.6);s=new Pu(e,(u=t.d)!=null?u:1,h)}return s}async getOrCreateFinalMaterial(e,t,r,i){var c;const s=this.getMaterialInfo(e,t);let a=1;if(s&&(a=(c=s.d)!=null?c:1),!s)return new Pu(e,a,new Ce(.6,.6,.6));const o=t.materials.get(e),l=o!=null?await this.updateMaterial(o,s,r,i):await this.createMaterial(e,s,r,i);return t.materials.set(e,l),l}async updateObjectMaterials(e,t){if(!Xt.hasData(e))return;const r=Xt.getData(e),i=new im;for(const s of r.group.children){const a=s,o=a.material;Array.isArray(o)?a.material=await Promise.all(o.map(l=>this.getOrCreateFinalMaterial(l.name,r,t,i))):a.material=await this.getOrCreateFinalMaterial(o.name,r,t,i)}}async updateObjectMaterialsByMeshId(e,t){const r=qt.selectById(me.getState().luminaire.meshes,e);r!=null&&await this.updateObjectMaterials(r.meshUrl,t)}}class Mx{start(e){me.dispatch(Pe.progressStarted({title:e}))}update(e){me.dispatch(Pe.progressUpdated(e))}clear(){me.dispatch(Pe.progressCleared())}}var y2={exports:{}};/*!

JSZip v3.10.0 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(n,e){(function(t){n.exports=t()})(function(){return function t(r,i,s){function a(c,u){if(!i[c]){if(!r[c]){var h=typeof Vd=="function"&&Vd;if(!u&&h)return h(c,!0);if(o)return o(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[c]={exports:{}};r[c][0].call(f.exports,function(v){var g=r[c][1][v];return a(g||v)},f,f.exports,t,r,i,s)}return i[c].exports}for(var o=typeof Vd=="function"&&Vd,l=0;l<s.length;l++)a(s[l]);return a}({1:[function(t,r,i){var s=t("./utils"),a=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,u,h,d,f,v,g,y=[],p=0,m=l.length,x=m,w=s.getTypeOf(l)!=="string";p<l.length;)x=m-p,h=w?(c=l[p++],u=p<m?l[p++]:0,p<m?l[p++]:0):(c=l.charCodeAt(p++),u=p<m?l.charCodeAt(p++):0,p<m?l.charCodeAt(p++):0),d=c>>2,f=(3&c)<<4|u>>4,v=1<x?(15&u)<<2|h>>6:64,g=2<x?63&h:64,y.push(o.charAt(d)+o.charAt(f)+o.charAt(v)+o.charAt(g));return y.join("")},i.decode=function(l){var c,u,h,d,f,v,g=0,y=0,p="data:";if(l.substr(0,p.length)===p)throw new Error("Invalid base64 input, it looks like a data url.");var m,x=3*(l=l.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&x--,l.charAt(l.length-2)===o.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(m=a.uint8array?new Uint8Array(0|x):new Array(0|x);g<l.length;)c=o.indexOf(l.charAt(g++))<<2|(d=o.indexOf(l.charAt(g++)))>>4,u=(15&d)<<4|(f=o.indexOf(l.charAt(g++)))>>2,h=(3&f)<<6|(v=o.indexOf(l.charAt(g++))),m[y++]=c,f!==64&&(m[y++]=u),v!==64&&(m[y++]=h);return m}},{"./support":30,"./utils":32}],2:[function(t,r,i){var s=t("./external"),a=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(u,h,d,f,v){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=v}c.prototype={getContentWorker:function(){var u=new a(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new a(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(u,h,d){return u.pipe(new o).pipe(new l("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new l("compressedSize")).withStreamInfo("compression",h)},r.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,r,i){var s=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(a){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,r,i){var s=t("./utils"),a=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();r.exports=function(o,l){return o!==void 0&&o.length?s.getTypeOf(o)!=="string"?function(c,u,h,d){var f=a,v=d+h;c^=-1;for(var g=d;g<v;g++)c=c>>>8^f[255&(c^u[g])];return-1^c}(0|l,o,o.length,0):function(c,u,h,d){var f=a,v=d+h;c^=-1;for(var g=d;g<v;g++)c=c>>>8^f[255&(c^u.charCodeAt(g))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,r,i){var s=null;s=typeof Promise!="undefined"?Promise:t("lie"),r.exports={Promise:s}},{lie:37}],7:[function(t,r,i){var s=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",a=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),c=s?"uint8array":"array";function u(h,d){l.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",o.inherits(u,l),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,h.data),!1)},u.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,r,i){function s(f,v){var g,y="";for(g=0;g<v;g++)y+=String.fromCharCode(255&f),f>>>=8;return y}function a(f,v,g,y,p,m){var x,w,b=f.file,C=f.compression,A=m!==c.utf8encode,F=o.transformTo("string",m(b.name)),N=o.transformTo("string",c.utf8encode(b.name)),O=b.comment,H=o.transformTo("string",m(O)),D=o.transformTo("string",c.utf8encode(O)),U=N.length!==b.name.length,_=D.length!==O.length,z="",j="",R="",ee=b.dir,J=b.date,le={crc32:0,compressedSize:0,uncompressedSize:0};v&&!g||(le.crc32=f.crc32,le.compressedSize=f.compressedSize,le.uncompressedSize=f.uncompressedSize);var k=0;v&&(k|=8),A||!U&&!_||(k|=2048);var V=0,$=0;ee&&(V|=16),p==="UNIX"?($=798,V|=function(ie,ne){var Se=ie;return ie||(Se=ne?16893:33204),(65535&Se)<<16}(b.unixPermissions,ee)):($=20,V|=function(ie){return 63&(ie||0)}(b.dosPermissions)),x=J.getUTCHours(),x<<=6,x|=J.getUTCMinutes(),x<<=5,x|=J.getUTCSeconds()/2,w=J.getUTCFullYear()-1980,w<<=4,w|=J.getUTCMonth()+1,w<<=5,w|=J.getUTCDate(),U&&(j=s(1,1)+s(u(F),4)+N,z+="up"+s(j.length,2)+j),_&&(R=s(1,1)+s(u(H),4)+D,z+="uc"+s(R.length,2)+R);var Q="";return Q+=`
\0`,Q+=s(k,2),Q+=C.magic,Q+=s(x,2),Q+=s(w,2),Q+=s(le.crc32,4),Q+=s(le.compressedSize,4),Q+=s(le.uncompressedSize,4),Q+=s(F.length,2),Q+=s(z.length,2),{fileRecord:h.LOCAL_FILE_HEADER+Q+F+z,dirRecord:h.CENTRAL_FILE_HEADER+s($,2)+Q+s(H.length,2)+"\0\0\0\0"+s(V,4)+s(y,4)+F+z+H}}var o=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),u=t("../crc32"),h=t("../signature");function d(f,v,g,y){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=v,this.zipPlatform=g,this.encodeFileName=y,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,l),d.prototype.push=function(f){var v=f.meta.percent||0,g=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,l.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:g?(v+100*(g-y-1))/g:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var v=this.streamFiles&&!f.file.dir;if(v){var g=a(f,v,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var v=this.streamFiles&&!f.file.dir,g=a(f,v,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),v)this.push({data:function(y){return h.DATA_DESCRIPTOR+s(y.crc32,4)+s(y.compressedSize,4)+s(y.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,v=0;v<this.dirRecords.length;v++)this.push({data:this.dirRecords[v],meta:{percent:100}});var g=this.bytesWritten-f,y=function(p,m,x,w,b){var C=o.transformTo("string",b(w));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(p,2)+s(p,2)+s(m,4)+s(x,4)+s(C.length,2)+C}(this.dirRecords.length,g,f,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var v=this;return f.on("data",function(g){v.processChunk(g)}),f.on("end",function(){v.closedSource(v.previous.streamInfo),v._sources.length?v.prepareNextSource():v.end()}),f.on("error",function(g){v.error(g)}),this},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var v=this._sources;if(!l.prototype.error.call(this,f))return!1;for(var g=0;g<v.length;g++)try{v[g].error(f)}catch{}return!0},d.prototype.lock=function(){l.prototype.lock.call(this);for(var f=this._sources,v=0;v<f.length;v++)f[v].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,r,i){var s=t("../compressions"),a=t("./ZipFileWorker");i.generateWorker=function(o,l,c){var u=new a(l.streamFiles,c,l.platform,l.encodeFileName),h=0;try{o.forEach(function(d,f){h++;var v=function(m,x){var w=m||x,b=s[w];if(!b)throw new Error(w+" is not a valid compression method !");return b}(f.options.compression,l.compression),g=f.options.compressionOptions||l.compressionOptions||{},y=f.dir,p=f.date;f._compressWorker(v,g).withStreamInfo("file",{name:d,dir:y,date:p,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new s;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(s.prototype=t("./object")).loadAsync=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.version="3.10.0",s.loadAsync=function(a,o){return new s().loadAsync(a,o)},s.external=t("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,r,i){var s=t("./utils"),a=t("./external"),o=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function h(d){return new a.Promise(function(f,v){var g=d.decompressed.getContentWorker().pipe(new c);g.on("error",function(y){v(y)}).on("end",function(){g.streamInfo.crc32!==d.decompressed.crc32?v(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(d,f){var v=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(d)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(g){var y=new l(f);return y.load(g),y}).then(function(g){var y=[a.Promise.resolve(g)],p=g.files;if(f.checkCRC32)for(var m=0;m<p.length;m++)y.push(h(p[m]));return a.Promise.all(y)}).then(function(g){for(var y=g.shift(),p=y.files,m=0;m<p.length;m++){var x=p[m],w=x.fileNameStr,b=s.resolve(x.fileNameStr);v.file(b,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:f.createFolders}),x.dir||(v.file(b).unsafeOriginalName=w)}return y.zipComment.length&&(v.comment=y.zipComment),v})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,r,i){var s=t("../utils"),a=t("../stream/GenericWorker");function o(l,c){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}s.inherits(o,a),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(u){c.push({data:u,meta:{percent:0}})}).on("error",function(u){c.isPaused?this.generatedError=u:c.error(u)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,r,i){var s=t("readable-stream").Readable;function a(o,l,c){s.call(this,l),this._helper=o;var u=this;o.on("data",function(h,d){u.push(h)||u._helper.pause(),c&&c(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}t("../utils").inherits(a,s),a.prototype._read=function(){this._helper.resume()},r.exports=a},{"../utils":32,"readable-stream":16}],14:[function(t,r,i){r.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(s,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,a);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,a)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var a=new Buffer(s);return a.fill(0),a},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(t,r,i){function s(b,C,A){var F,N=o.getTypeOf(C),O=o.extend(A||{},u);O.date=O.date||new Date,O.compression!==null&&(O.compression=O.compression.toUpperCase()),typeof O.unixPermissions=="string"&&(O.unixPermissions=parseInt(O.unixPermissions,8)),O.unixPermissions&&16384&O.unixPermissions&&(O.dir=!0),O.dosPermissions&&16&O.dosPermissions&&(O.dir=!0),O.dir&&(b=p(b)),O.createFolders&&(F=y(b))&&m.call(this,F,!0);var H=N==="string"&&O.binary===!1&&O.base64===!1;A&&A.binary!==void 0||(O.binary=!H),(C instanceof h&&C.uncompressedSize===0||O.dir||!C||C.length===0)&&(O.base64=!1,O.binary=!0,C="",O.compression="STORE",N="string");var D=null;D=C instanceof h||C instanceof l?C:v.isNode&&v.isStream(C)?new g(b,C):o.prepareContent(b,C,O.binary,O.optimizedBinaryString,O.base64);var U=new d(b,D,O);this.files[b]=U}var a=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),u=t("./defaults"),h=t("./compressedObject"),d=t("./zipObject"),f=t("./generate"),v=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),y=function(b){b.slice(-1)==="/"&&(b=b.substring(0,b.length-1));var C=b.lastIndexOf("/");return 0<C?b.substring(0,C):""},p=function(b){return b.slice(-1)!=="/"&&(b+="/"),b},m=function(b,C){return C=C!==void 0?C:u.createFolders,b=p(b),this.files[b]||s.call(this,b,null,{dir:!0,createFolders:C}),this.files[b]};function x(b){return Object.prototype.toString.call(b)==="[object RegExp]"}var w={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(b){var C,A,F;for(C in this.files)F=this.files[C],(A=C.slice(this.root.length,C.length))&&C.slice(0,this.root.length)===this.root&&b(A,F)},filter:function(b){var C=[];return this.forEach(function(A,F){b(A,F)&&C.push(F)}),C},file:function(b,C,A){if(arguments.length!==1)return b=this.root+b,s.call(this,b,C,A),this;if(x(b)){var F=b;return this.filter(function(O,H){return!H.dir&&F.test(O)})}var N=this.files[this.root+b];return N&&!N.dir?N:null},folder:function(b){if(!b)return this;if(x(b))return this.filter(function(N,O){return O.dir&&b.test(N)});var C=this.root+b,A=m.call(this,C),F=this.clone();return F.root=A.name,F},remove:function(b){b=this.root+b;var C=this.files[b];if(C||(b.slice(-1)!=="/"&&(b+="/"),C=this.files[b]),C&&!C.dir)delete this.files[b];else for(var A=this.filter(function(N,O){return O.name.slice(0,b.length)===b}),F=0;F<A.length;F++)delete this.files[A[F].name];return this},generate:function(b){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(b){var C,A={};try{if((A=o.extend(b||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");o.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var F=A.comment||this.comment||"";C=f.generateWorker(this,A,F)}catch(N){(C=new l("error")).error(N)}return new c(C,A.type||"string",A.mimeType)},generateAsync:function(b,C){return this.generateInternalStream(b).accumulate(C)},generateNodeStream:function(b,C){return(b=b||{}).type||(b.type="nodebuffer"),this.generateInternalStream(b).toNodejsStream(C)}};r.exports=w},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,r,i){r.exports=t("stream")},{stream:void 0}],17:[function(t,r,i){var s=t("./DataReader");function a(o){s.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(a,s),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),h=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===l&&this.data[d+1]===c&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),h=o.charCodeAt(3),d=this.readData(4);return l===d[0]&&c===d[1]&&u===d[2]&&h===d[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=a},{"../utils":32,"./DataReader":18}],18:[function(t,r,i){var s=t("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(o){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return s.transformTo("string",this.readData(o))},readData:function(o){},lastIndexOfSignature:function(o){},readAndCheckSignature:function(o){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},r.exports=a},{"../utils":32}],19:[function(t,r,i){var s=t("./Uint8ArrayReader");function a(o){s.call(this,o)}t("../utils").inherits(a,s),a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,r,i){var s=t("./DataReader");function a(o){s.call(this,o)}t("../utils").inherits(a,s),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=a},{"../utils":32,"./DataReader":18}],21:[function(t,r,i){var s=t("./ArrayReader");function a(o){s.call(this,o)}t("../utils").inherits(a,s),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(t,r,i){var s=t("../utils"),a=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),u=t("./Uint8ArrayReader");r.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||a.uint8array?d==="nodebuffer"?new c(h):a.uint8array?new u(s.transformTo("uint8array",h)):new o(s.transformTo("array",h)):new l(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,r,i){var s=t("./GenericWorker"),a=t("../utils");function o(l){s.call(this,"ConvertWorker to "+l),this.destType=l}a.inherits(o,s),o.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},r.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,r,i){var s=t("./GenericWorker"),a=t("../crc32");function o(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,s),o.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},r.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,r,i){var s=t("../utils"),a=t("./GenericWorker");function o(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}s.inherits(o,a),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}a.prototype.processChunk.call(this,l)},r.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,r,i){var s=t("../utils"),a=t("./GenericWorker");function o(l){a.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(u){c.dataIsReady=!0,c.data=u,c.max=u&&u.length||0,c.type=s.getTypeOf(u),c.isPaused||c._tickAndRepeat()},function(u){c.error(u)})}s.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,r,i){function s(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(l){o.processChunk(l)}),a.on("end",function(){o.end()}),a.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},r.exports=s},{}],29:[function(t,r,i){var s=t("../utils"),a=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),c=t("../support"),u=t("../external"),h=null;if(c.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(v,g){return new u.Promise(function(y,p){var m=[],x=v._internalType,w=v._outputType,b=v._mimeType;v.on("data",function(C,A){m.push(C),g&&g(A)}).on("error",function(C){m=[],p(C)}).on("end",function(){try{var C=function(A,F,N){switch(A){case"blob":return s.newBlob(s.transformTo("arraybuffer",F),N);case"base64":return l.encode(F);default:return s.transformTo(A,F)}}(w,function(A,F){var N,O=0,H=null,D=0;for(N=0;N<F.length;N++)D+=F[N].length;switch(A){case"string":return F.join("");case"array":return Array.prototype.concat.apply([],F);case"uint8array":for(H=new Uint8Array(D),N=0;N<F.length;N++)H.set(F[N],O),O+=F[N].length;return H;case"nodebuffer":return Buffer.concat(F);default:throw new Error("concat : unsupported type '"+A+"'")}}(x,m),b);y(C)}catch(A){p(A)}m=[]}).resume()})}function f(v,g,y){var p=g;switch(g){case"blob":case"arraybuffer":p="uint8array";break;case"base64":p="string"}try{this._internalType=p,this._outputType=g,this._mimeType=y,s.checkSupport(p),this._worker=v.pipe(new a(p)),v.lock()}catch(m){this._worker=new o("error"),this._worker.error(m)}}f.prototype={accumulate:function(v){return d(this,v)},on:function(v,g){var y=this;return v==="data"?this._worker.on(v,function(p){g.call(y,p.data,p.meta)}):this._worker.on(v,function(){s.delay(g,arguments,y)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(v){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},v)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",i.nodebuffer=typeof Buffer!="undefined",i.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(s),i.blob=a.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,r,i){for(var s=t("./utils"),a=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;c[254]=c[254]=1;function h(){l.call(this,"utf-8 decode"),this.leftOver=null}function d(){l.call(this,"utf-8 encode")}i.utf8encode=function(f){return a.nodebuffer?o.newBufferFrom(f,"utf-8"):function(v){var g,y,p,m,x,w=v.length,b=0;for(m=0;m<w;m++)(64512&(y=v.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=v.charCodeAt(m+1)))==56320&&(y=65536+(y-55296<<10)+(p-56320),m++),b+=y<128?1:y<2048?2:y<65536?3:4;for(g=a.uint8array?new Uint8Array(b):new Array(b),m=x=0;x<b;m++)(64512&(y=v.charCodeAt(m)))==55296&&m+1<w&&(64512&(p=v.charCodeAt(m+1)))==56320&&(y=65536+(y-55296<<10)+(p-56320),m++),y<128?g[x++]=y:(y<2048?g[x++]=192|y>>>6:(y<65536?g[x++]=224|y>>>12:(g[x++]=240|y>>>18,g[x++]=128|y>>>12&63),g[x++]=128|y>>>6&63),g[x++]=128|63&y);return g}(f)},i.utf8decode=function(f){return a.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(v){var g,y,p,m,x=v.length,w=new Array(2*x);for(g=y=0;g<x;)if((p=v[g++])<128)w[y++]=p;else if(4<(m=c[p]))w[y++]=65533,g+=m-1;else{for(p&=m===2?31:m===3?15:7;1<m&&g<x;)p=p<<6|63&v[g++],m--;1<m?w[y++]=65533:p<65536?w[y++]=p:(p-=65536,w[y++]=55296|p>>10&1023,w[y++]=56320|1023&p)}return w.length!==y&&(w.subarray?w=w.subarray(0,y):w.length=y),s.applyFromCharCode(w)}(f=s.transformTo(a.uint8array?"uint8array":"array",f))},s.inherits(h,l),h.prototype.processChunk=function(f){var v=s.transformTo(a.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var g=v;(v=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),v.set(g,this.leftOver.length)}else v=this.leftOver.concat(v);this.leftOver=null}var y=function(m,x){var w;for((x=x||m.length)>m.length&&(x=m.length),w=x-1;0<=w&&(192&m[w])==128;)w--;return w<0||w===0?x:w+c[m[w]]>x?w:x}(v),p=v;y!==v.length&&(a.uint8array?(p=v.subarray(0,y),this.leftOver=v.subarray(y,v.length)):(p=v.slice(0,y),this.leftOver=v.slice(y,v.length))),this.push({data:i.utf8decode(p),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,l),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,r,i){var s=t("./support"),a=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function c(g){return g}function u(g,y){for(var p=0;p<g.length;++p)y[p]=255&g.charCodeAt(p);return y}t("setimmediate"),i.newBlob=function(g,y){i.checkSupport("blob");try{return new Blob([g],{type:y})}catch{try{var p=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return p.append(g),p.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(g,y,p){var m=[],x=0,w=g.length;if(w<=p)return String.fromCharCode.apply(null,g);for(;x<w;)y==="array"||y==="nodebuffer"?m.push(String.fromCharCode.apply(null,g.slice(x,Math.min(x+p,w)))):m.push(String.fromCharCode.apply(null,g.subarray(x,Math.min(x+p,w)))),x+=p;return m.join("")},stringifyByChar:function(g){for(var y="",p=0;p<g.length;p++)y+=String.fromCharCode(g[p]);return y},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function d(g){var y=65536,p=i.getTypeOf(g),m=!0;if(p==="uint8array"?m=h.applyCanBeUsed.uint8array:p==="nodebuffer"&&(m=h.applyCanBeUsed.nodebuffer),m)for(;1<y;)try{return h.stringifyByChunk(g,p,y)}catch{y=Math.floor(y/2)}return h.stringifyByChar(g)}function f(g,y){for(var p=0;p<g.length;p++)y[p]=g[p];return y}i.applyFromCharCode=d;var v={};v.string={string:c,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return v.string.uint8array(g).buffer},uint8array:function(g){return u(g,new Uint8Array(g.length))},nodebuffer:function(g){return u(g,o.allocBuffer(g.length))}},v.array={string:d,array:c,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(g)}},v.arraybuffer={string:function(g){return d(new Uint8Array(g))},array:function(g){return f(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:c,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(new Uint8Array(g))}},v.uint8array={string:d,array:function(g){return f(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:c,nodebuffer:function(g){return o.newBufferFrom(g)}},v.nodebuffer={string:d,array:function(g){return f(g,new Array(g.length))},arraybuffer:function(g){return v.nodebuffer.uint8array(g).buffer},uint8array:function(g){return f(g,new Uint8Array(g.length))},nodebuffer:c},i.transformTo=function(g,y){if(y=y||"",!g)return y;i.checkSupport(g);var p=i.getTypeOf(y);return v[p][g](y)},i.resolve=function(g){for(var y=g.split("/"),p=[],m=0;m<y.length;m++){var x=y[m];x==="."||x===""&&m!==0&&m!==y.length-1||(x===".."?p.pop():p.push(x))}return p.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":s.nodebuffer&&o.isBuffer(g)?"nodebuffer":s.uint8array&&g instanceof Uint8Array?"uint8array":s.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!s[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var y,p,m="";for(p=0;p<(g||"").length;p++)m+="\\x"+((y=g.charCodeAt(p))<16?"0":"")+y.toString(16).toUpperCase();return m},i.delay=function(g,y,p){setImmediate(function(){g.apply(p||null,y||[])})},i.inherits=function(g,y){function p(){}p.prototype=y.prototype,g.prototype=new p},i.extend=function(){var g,y,p={};for(g=0;g<arguments.length;g++)for(y in arguments[g])arguments[g].hasOwnProperty(y)&&p[y]===void 0&&(p[y]=arguments[g][y]);return p},i.prepareContent=function(g,y,p,m,x){return l.Promise.resolve(y).then(function(w){return s.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader!="undefined"?new l.Promise(function(b,C){var A=new FileReader;A.onload=function(F){b(F.target.result)},A.onerror=function(F){C(F.target.error)},A.readAsArrayBuffer(w)}):w}).then(function(w){var b=i.getTypeOf(w);return b?(b==="arraybuffer"?w=i.transformTo("uint8array",w):b==="string"&&(x?w=a.decode(w):p&&m!==!0&&(w=function(C){return u(C,s.uint8array?new Uint8Array(C.length):new Array(C.length))}(w))),w):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,r,i){var s=t("./reader/readerFor"),a=t("./utils"),o=t("./signature"),l=t("./zipEntry"),c=(t("./utf8"),t("./support"));function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(d)+", expected "+a.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var v=this.reader.readString(4)===d;return this.reader.setIndex(f),v},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=c.uint8array?"uint8array":"array",f=a.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,v=this.zip64EndOfCentralSize-44;0<v;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(h=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var v=d-f;if(0<v)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=v);else if(v<0)throw new Error("Corrupted zip: missing "+Math.abs(v)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,r,i){var s=t("./reader/readerFor"),a=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),u=t("./compressions"),h=t("./support");function d(f,v){this.options=f,this.loadOptions=v}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var v,g;if(f.skip(22),this.fileNameLength=f.readInt(2),g=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((v=function(y){for(var p in u)if(u.hasOwnProperty(p)&&u[p].magic===y)return u[p];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,v,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var v=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(v),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(f){if(this.extraFields[1]){var v=s(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=v.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=v.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=v.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=v.readInt(4))}},readExtraFields:function(f){var v,g,y,p=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<p;)v=f.readInt(2),g=f.readInt(2),y=f.readData(g),this.extraFields[v]={id:v,length:g,value:y};f.setIndex(p)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var v=this.findExtraFieldUnicodePath();if(v!==null)this.fileNameStr=v;else{var g=a.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var p=a.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(p)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var v=s(f.value);return v.readInt(1)!==1||l(this.fileName)!==v.readInt(4)?null:c.utf8decode(v.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var v=s(f.value);return v.readInt(1)!==1||l(this.fileComment)!==v.readInt(4)?null:c.utf8decode(v.readData(f.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,r,i){function s(v,g,y){this.name=v,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=g,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var a=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),u=t("./stream/GenericWorker");s.prototype={internalStream:function(v){var g=null,y="string";try{if(!v)throw new Error("No output type specified.");var p=(y=v.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),g=this._decompressWorker();var m=!this._dataBinary;m&&!p&&(g=g.pipe(new l.Utf8EncodeWorker)),!m&&p&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(x){(g=new u("error")).error(x)}return new a(g,y,"")},async:function(v,g){return this.internalStream(v).accumulate(g)},nodeStream:function(v,g){return this.internalStream(v||"nodebuffer").toNodejsStream(g)},_compressWorker:function(v,g){if(this._data instanceof c&&this._data.compression.magic===v.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(y,v,g)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,r,i){(function(s){var a,o,l=s.MutationObserver||s.WebKitMutationObserver;if(l){var c=0,u=new l(v),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),a=function(){h.data=c=++c%2}}else if(s.setImmediate||s.MessageChannel===void 0)a="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var g=s.document.createElement("script");g.onreadystatechange=function(){v(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:function(){setTimeout(v,0)};else{var d=new s.MessageChannel;d.port1.onmessage=v,a=function(){d.port2.postMessage(0)}}var f=[];function v(){var g,y;o=!0;for(var p=f.length;p;){for(y=f,f=[],g=-1;++g<p;)y[g]();p=f.length}o=!1}r.exports=function(g){f.push(g)!==1||o||a()}}).call(this,typeof os!="undefined"?os:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(t,r,i){var s=t("immediate");function a(){}var o={},l=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function h(p){if(typeof p!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,p!==a&&g(this,p)}function d(p,m,x){this.promise=p,typeof m=="function"&&(this.onFulfilled=m,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}function f(p,m,x){s(function(){var w;try{w=m(x)}catch(b){return o.reject(p,b)}w===p?o.reject(p,new TypeError("Cannot resolve promise with itself")):o.resolve(p,w)})}function v(p){var m=p&&p.then;if(p&&(typeof p=="object"||typeof p=="function")&&typeof m=="function")return function(){m.apply(p,arguments)}}function g(p,m){var x=!1;function w(A){x||(x=!0,o.reject(p,A))}function b(A){x||(x=!0,o.resolve(p,A))}var C=y(function(){m(b,w)});C.status==="error"&&w(C.value)}function y(p,m){var x={};try{x.value=p(m),x.status="success"}catch(w){x.status="error",x.value=w}return x}(r.exports=h).prototype.finally=function(p){if(typeof p!="function")return this;var m=this.constructor;return this.then(function(x){return m.resolve(p()).then(function(){return x})},function(x){return m.resolve(p()).then(function(){throw x})})},h.prototype.catch=function(p){return this.then(null,p)},h.prototype.then=function(p,m){if(typeof p!="function"&&this.state===c||typeof m!="function"&&this.state===l)return this;var x=new this.constructor(a);return this.state!==u?f(x,this.state===c?p:m,this.outcome):this.queue.push(new d(x,p,m)),x},d.prototype.callFulfilled=function(p){o.resolve(this.promise,p)},d.prototype.otherCallFulfilled=function(p){f(this.promise,this.onFulfilled,p)},d.prototype.callRejected=function(p){o.reject(this.promise,p)},d.prototype.otherCallRejected=function(p){f(this.promise,this.onRejected,p)},o.resolve=function(p,m){var x=y(v,m);if(x.status==="error")return o.reject(p,x.value);var w=x.value;if(w)g(p,w);else{p.state=c,p.outcome=m;for(var b=-1,C=p.queue.length;++b<C;)p.queue[b].callFulfilled(m)}return p},o.reject=function(p,m){p.state=l,p.outcome=m;for(var x=-1,w=p.queue.length;++x<w;)p.queue[x].callRejected(m);return p},h.resolve=function(p){return p instanceof this?p:o.resolve(new this(a),p)},h.reject=function(p){var m=new this(a);return o.reject(m,p)},h.all=function(p){var m=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=p.length,w=!1;if(!x)return this.resolve([]);for(var b=new Array(x),C=0,A=-1,F=new this(a);++A<x;)N(p[A],A);return F;function N(O,H){m.resolve(O).then(function(D){b[H]=D,++C!==x||w||(w=!0,o.resolve(F,b))},function(D){w||(w=!0,o.reject(F,D))})}},h.race=function(p){var m=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=p.length,w=!1;if(!x)return this.resolve([]);for(var b=-1,C=new this(a);++b<x;)A=p[b],m.resolve(A).then(function(F){w||(w=!0,o.resolve(C,F))},function(F){w||(w=!0,o.reject(C,F))});var A;return C}},{immediate:36}],38:[function(t,r,i){var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,r,i){var s=t("./zlib/deflate"),a=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,f=0,v=8;function g(p){if(!(this instanceof g))return new g(p);this.options=a.assign({level:d,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},p||{});var m=this.options;m.raw&&0<m.windowBits?m.windowBits=-m.windowBits:m.gzip&&0<m.windowBits&&m.windowBits<16&&(m.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var x=s.deflateInit2(this.strm,m.level,m.method,m.windowBits,m.memLevel,m.strategy);if(x!==h)throw new Error(l[x]);if(m.header&&s.deflateSetHeader(this.strm,m.header),m.dictionary){var w;if(w=typeof m.dictionary=="string"?o.string2buf(m.dictionary):u.call(m.dictionary)==="[object ArrayBuffer]"?new Uint8Array(m.dictionary):m.dictionary,(x=s.deflateSetDictionary(this.strm,w))!==h)throw new Error(l[x]);this._dict_set=!0}}function y(p,m){var x=new g(m);if(x.push(p,!0),x.err)throw x.msg||l[x.err];return x.result}g.prototype.push=function(p,m){var x,w,b=this.strm,C=this.options.chunkSize;if(this.ended)return!1;w=m===~~m?m:m===!0?4:0,typeof p=="string"?b.input=o.string2buf(p):u.call(p)==="[object ArrayBuffer]"?b.input=new Uint8Array(p):b.input=p,b.next_in=0,b.avail_in=b.input.length;do{if(b.avail_out===0&&(b.output=new a.Buf8(C),b.next_out=0,b.avail_out=C),(x=s.deflate(b,w))!==1&&x!==h)return this.onEnd(x),!(this.ended=!0);b.avail_out!==0&&(b.avail_in!==0||w!==4&&w!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(b.output,b.next_out))):this.onData(a.shrinkBuf(b.output,b.next_out)))}while((0<b.avail_in||b.avail_out===0)&&x!==1);return w===4?(x=s.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===h):w!==2||(this.onEnd(h),!(b.avail_out=0))},g.prototype.onData=function(p){this.chunks.push(p)},g.prototype.onEnd=function(p){p===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Deflate=g,i.deflate=y,i.deflateRaw=function(p,m){return(m=m||{}).raw=!0,y(p,m)},i.gzip=function(p,m){return(m=m||{}).gzip=!0,y(p,m)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,r,i){var s=t("./zlib/inflate"),a=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),u=t("./zlib/zstream"),h=t("./zlib/gzheader"),d=Object.prototype.toString;function f(g){if(!(this instanceof f))return new f(g);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},g||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||g&&g.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&(15&y.windowBits)==0&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var p=s.inflateInit2(this.strm,y.windowBits);if(p!==l.Z_OK)throw new Error(c[p]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function v(g,y){var p=new f(y);if(p.push(g,!0),p.err)throw p.msg||c[p.err];return p.result}f.prototype.push=function(g,y){var p,m,x,w,b,C,A=this.strm,F=this.options.chunkSize,N=this.options.dictionary,O=!1;if(this.ended)return!1;m=y===~~y?y:y===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?A.input=o.binstring2buf(g):d.call(g)==="[object ArrayBuffer]"?A.input=new Uint8Array(g):A.input=g,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new a.Buf8(F),A.next_out=0,A.avail_out=F),(p=s.inflate(A,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&N&&(C=typeof N=="string"?o.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,p=s.inflateSetDictionary(this.strm,C)),p===l.Z_BUF_ERROR&&O===!0&&(p=l.Z_OK,O=!1),p!==l.Z_STREAM_END&&p!==l.Z_OK)return this.onEnd(p),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&p!==l.Z_STREAM_END&&(A.avail_in!==0||m!==l.Z_FINISH&&m!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=o.utf8border(A.output,A.next_out),w=A.next_out-x,b=o.buf2string(A.output,x),A.next_out=w,A.avail_out=F-w,w&&a.arraySet(A.output,A.output,x,w,0),this.onData(b)):this.onData(a.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(O=!0)}while((0<A.avail_in||A.avail_out===0)&&p!==l.Z_STREAM_END);return p===l.Z_STREAM_END&&(m=l.Z_FINISH),m===l.Z_FINISH?(p=s.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===l.Z_OK):m!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(A.avail_out=0))},f.prototype.onData=function(g){this.chunks.push(g)},f.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=f,i.inflate=v,i.inflateRaw=function(g,y){return(y=y||{}).raw=!0,v(g,y)},i.ungzip=v},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,r,i){var s=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var u=c.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(l[h]=u[h])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var a={arraySet:function(l,c,u,h,d){if(c.subarray&&l.subarray)l.set(c.subarray(u,u+h),d);else for(var f=0;f<h;f++)l[d+f]=c[u+f]},flattenChunks:function(l){var c,u,h,d,f,v;for(c=h=0,u=l.length;c<u;c++)h+=l[c].length;for(v=new Uint8Array(h),c=d=0,u=l.length;c<u;c++)f=l[c],v.set(f,d),d+=f.length;return v}},o={arraySet:function(l,c,u,h,d){for(var f=0;f<h;f++)l[d+f]=c[u+f]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(s)},{}],42:[function(t,r,i){var s=t("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new s.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(h,d){if(d<65537&&(h.subarray&&o||!h.subarray&&a))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",v=0;v<d;v++)f+=String.fromCharCode(h[v]);return f}l[254]=l[254]=1,i.string2buf=function(h){var d,f,v,g,y,p=h.length,m=0;for(g=0;g<p;g++)(64512&(f=h.charCodeAt(g)))==55296&&g+1<p&&(64512&(v=h.charCodeAt(g+1)))==56320&&(f=65536+(f-55296<<10)+(v-56320),g++),m+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(m),g=y=0;y<m;g++)(64512&(f=h.charCodeAt(g)))==55296&&g+1<p&&(64512&(v=h.charCodeAt(g+1)))==56320&&(f=65536+(f-55296<<10)+(v-56320),g++),f<128?d[y++]=f:(f<2048?d[y++]=192|f>>>6:(f<65536?d[y++]=224|f>>>12:(d[y++]=240|f>>>18,d[y++]=128|f>>>12&63),d[y++]=128|f>>>6&63),d[y++]=128|63&f);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,v=d.length;f<v;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,v,g,y,p=d||h.length,m=new Array(2*p);for(f=v=0;f<p;)if((g=h[f++])<128)m[v++]=g;else if(4<(y=l[g]))m[v++]=65533,f+=y-1;else{for(g&=y===2?31:y===3?15:7;1<y&&f<p;)g=g<<6|63&h[f++],y--;1<y?m[v++]=65533:g<65536?m[v++]=g:(g-=65536,m[v++]=55296|g>>10&1023,m[v++]=56320|1023&g)}return u(m,v)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+l[h[f]]>d?f:d}},{"./common":41}],43:[function(t,r,i){r.exports=function(s,a,o,l){for(var c=65535&s|0,u=s>>>16&65535|0,h=0;o!==0;){for(o-=h=2e3<o?2e3:o;u=u+(c=c+a[l++]|0)|0,--h;);c%=65521,u%=65521}return c|u<<16|0}},{}],44:[function(t,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,r,i){var s=function(){for(var a,o=[],l=0;l<256;l++){a=l;for(var c=0;c<8;c++)a=1&a?3988292384^a>>>1:a>>>1;o[l]=a}return o}();r.exports=function(a,o,l,c){var u=s,h=c+l;a^=-1;for(var d=c;d<h;d++)a=a>>>8^u[255&(a^o[d])];return-1^a}},{}],46:[function(t,r,i){var s,a=t("../utils/common"),o=t("./trees"),l=t("./adler32"),c=t("./crc32"),u=t("./messages"),h=0,d=4,f=0,v=-2,g=-1,y=4,p=2,m=8,x=9,w=286,b=30,C=19,A=2*w+1,F=15,N=3,O=258,H=O+N+1,D=42,U=113,_=1,z=2,j=3,R=4;function ee(M,te){return M.msg=u[te],te}function J(M){return(M<<1)-(4<M?9:0)}function le(M){for(var te=M.length;0<=--te;)M[te]=0}function k(M){var te=M.state,X=te.pending;X>M.avail_out&&(X=M.avail_out),X!==0&&(a.arraySet(M.output,te.pending_buf,te.pending_out,X,M.next_out),M.next_out+=X,te.pending_out+=X,M.total_out+=X,M.avail_out-=X,te.pending-=X,te.pending===0&&(te.pending_out=0))}function V(M,te){o._tr_flush_block(M,0<=M.block_start?M.block_start:-1,M.strstart-M.block_start,te),M.block_start=M.strstart,k(M.strm)}function $(M,te){M.pending_buf[M.pending++]=te}function Q(M,te){M.pending_buf[M.pending++]=te>>>8&255,M.pending_buf[M.pending++]=255&te}function ie(M,te){var X,T,S=M.max_chain_length,B=M.strstart,q=M.prev_length,K=M.nice_match,W=M.strstart>M.w_size-H?M.strstart-(M.w_size-H):0,ce=M.window,pe=M.w_mask,ue=M.prev,ve=M.strstart+O,Z=ce[B+q-1],ye=ce[B+q];M.prev_length>=M.good_match&&(S>>=2),K>M.lookahead&&(K=M.lookahead);do if(ce[(X=te)+q]===ye&&ce[X+q-1]===Z&&ce[X]===ce[B]&&ce[++X]===ce[B+1]){B+=2,X++;do;while(ce[++B]===ce[++X]&&ce[++B]===ce[++X]&&ce[++B]===ce[++X]&&ce[++B]===ce[++X]&&ce[++B]===ce[++X]&&ce[++B]===ce[++X]&&ce[++B]===ce[++X]&&ce[++B]===ce[++X]&&B<ve);if(T=O-(ve-B),B=ve-O,q<T){if(M.match_start=te,K<=(q=T))break;Z=ce[B+q-1],ye=ce[B+q]}}while((te=ue[te&pe])>W&&--S!=0);return q<=M.lookahead?q:M.lookahead}function ne(M){var te,X,T,S,B,q,K,W,ce,pe,ue=M.w_size;do{if(S=M.window_size-M.lookahead-M.strstart,M.strstart>=ue+(ue-H)){for(a.arraySet(M.window,M.window,ue,ue,0),M.match_start-=ue,M.strstart-=ue,M.block_start-=ue,te=X=M.hash_size;T=M.head[--te],M.head[te]=ue<=T?T-ue:0,--X;);for(te=X=ue;T=M.prev[--te],M.prev[te]=ue<=T?T-ue:0,--X;);S+=ue}if(M.strm.avail_in===0)break;if(q=M.strm,K=M.window,W=M.strstart+M.lookahead,ce=S,pe=void 0,pe=q.avail_in,ce<pe&&(pe=ce),X=pe===0?0:(q.avail_in-=pe,a.arraySet(K,q.input,q.next_in,pe,W),q.state.wrap===1?q.adler=l(q.adler,K,pe,W):q.state.wrap===2&&(q.adler=c(q.adler,K,pe,W)),q.next_in+=pe,q.total_in+=pe,pe),M.lookahead+=X,M.lookahead+M.insert>=N)for(B=M.strstart-M.insert,M.ins_h=M.window[B],M.ins_h=(M.ins_h<<M.hash_shift^M.window[B+1])&M.hash_mask;M.insert&&(M.ins_h=(M.ins_h<<M.hash_shift^M.window[B+N-1])&M.hash_mask,M.prev[B&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=B,B++,M.insert--,!(M.lookahead+M.insert<N)););}while(M.lookahead<H&&M.strm.avail_in!==0)}function Se(M,te){for(var X,T;;){if(M.lookahead<H){if(ne(M),M.lookahead<H&&te===h)return _;if(M.lookahead===0)break}if(X=0,M.lookahead>=N&&(M.ins_h=(M.ins_h<<M.hash_shift^M.window[M.strstart+N-1])&M.hash_mask,X=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),X!==0&&M.strstart-X<=M.w_size-H&&(M.match_length=ie(M,X)),M.match_length>=N)if(T=o._tr_tally(M,M.strstart-M.match_start,M.match_length-N),M.lookahead-=M.match_length,M.match_length<=M.max_lazy_match&&M.lookahead>=N){for(M.match_length--;M.strstart++,M.ins_h=(M.ins_h<<M.hash_shift^M.window[M.strstart+N-1])&M.hash_mask,X=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart,--M.match_length!=0;);M.strstart++}else M.strstart+=M.match_length,M.match_length=0,M.ins_h=M.window[M.strstart],M.ins_h=(M.ins_h<<M.hash_shift^M.window[M.strstart+1])&M.hash_mask;else T=o._tr_tally(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++;if(T&&(V(M,!1),M.strm.avail_out===0))return _}return M.insert=M.strstart<N-1?M.strstart:N-1,te===d?(V(M,!0),M.strm.avail_out===0?j:R):M.last_lit&&(V(M,!1),M.strm.avail_out===0)?_:z}function _e(M,te){for(var X,T,S;;){if(M.lookahead<H){if(ne(M),M.lookahead<H&&te===h)return _;if(M.lookahead===0)break}if(X=0,M.lookahead>=N&&(M.ins_h=(M.ins_h<<M.hash_shift^M.window[M.strstart+N-1])&M.hash_mask,X=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),M.prev_length=M.match_length,M.prev_match=M.match_start,M.match_length=N-1,X!==0&&M.prev_length<M.max_lazy_match&&M.strstart-X<=M.w_size-H&&(M.match_length=ie(M,X),M.match_length<=5&&(M.strategy===1||M.match_length===N&&4096<M.strstart-M.match_start)&&(M.match_length=N-1)),M.prev_length>=N&&M.match_length<=M.prev_length){for(S=M.strstart+M.lookahead-N,T=o._tr_tally(M,M.strstart-1-M.prev_match,M.prev_length-N),M.lookahead-=M.prev_length-1,M.prev_length-=2;++M.strstart<=S&&(M.ins_h=(M.ins_h<<M.hash_shift^M.window[M.strstart+N-1])&M.hash_mask,X=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),--M.prev_length!=0;);if(M.match_available=0,M.match_length=N-1,M.strstart++,T&&(V(M,!1),M.strm.avail_out===0))return _}else if(M.match_available){if((T=o._tr_tally(M,0,M.window[M.strstart-1]))&&V(M,!1),M.strstart++,M.lookahead--,M.strm.avail_out===0)return _}else M.match_available=1,M.strstart++,M.lookahead--}return M.match_available&&(T=o._tr_tally(M,0,M.window[M.strstart-1]),M.match_available=0),M.insert=M.strstart<N-1?M.strstart:N-1,te===d?(V(M,!0),M.strm.avail_out===0?j:R):M.last_lit&&(V(M,!1),M.strm.avail_out===0)?_:z}function we(M,te,X,T,S){this.good_length=M,this.max_lazy=te,this.nice_length=X,this.max_chain=T,this.func=S}function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*A),this.dyn_dtree=new a.Buf16(2*(2*b+1)),this.bl_tree=new a.Buf16(2*(2*C+1)),le(this.dyn_ltree),le(this.dyn_dtree),le(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(F+1),this.heap=new a.Buf16(2*w+1),le(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*w+1),le(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ke(M){var te;return M&&M.state?(M.total_in=M.total_out=0,M.data_type=p,(te=M.state).pending=0,te.pending_out=0,te.wrap<0&&(te.wrap=-te.wrap),te.status=te.wrap?D:U,M.adler=te.wrap===2?0:1,te.last_flush=h,o._tr_init(te),f):ee(M,v)}function de(M){var te=ke(M);return te===f&&function(X){X.window_size=2*X.w_size,le(X.head),X.max_lazy_match=s[X.level].max_lazy,X.good_match=s[X.level].good_length,X.nice_match=s[X.level].nice_length,X.max_chain_length=s[X.level].max_chain,X.strstart=0,X.block_start=0,X.lookahead=0,X.insert=0,X.match_length=X.prev_length=N-1,X.match_available=0,X.ins_h=0}(M.state),te}function xe(M,te,X,T,S,B){if(!M)return v;var q=1;if(te===g&&(te=6),T<0?(q=0,T=-T):15<T&&(q=2,T-=16),S<1||x<S||X!==m||T<8||15<T||te<0||9<te||B<0||y<B)return ee(M,v);T===8&&(T=9);var K=new Me;return(M.state=K).strm=M,K.wrap=q,K.gzhead=null,K.w_bits=T,K.w_size=1<<K.w_bits,K.w_mask=K.w_size-1,K.hash_bits=S+7,K.hash_size=1<<K.hash_bits,K.hash_mask=K.hash_size-1,K.hash_shift=~~((K.hash_bits+N-1)/N),K.window=new a.Buf8(2*K.w_size),K.head=new a.Buf16(K.hash_size),K.prev=new a.Buf16(K.w_size),K.lit_bufsize=1<<S+6,K.pending_buf_size=4*K.lit_bufsize,K.pending_buf=new a.Buf8(K.pending_buf_size),K.d_buf=1*K.lit_bufsize,K.l_buf=3*K.lit_bufsize,K.level=te,K.strategy=B,K.method=X,de(M)}s=[new we(0,0,0,0,function(M,te){var X=65535;for(X>M.pending_buf_size-5&&(X=M.pending_buf_size-5);;){if(M.lookahead<=1){if(ne(M),M.lookahead===0&&te===h)return _;if(M.lookahead===0)break}M.strstart+=M.lookahead,M.lookahead=0;var T=M.block_start+X;if((M.strstart===0||M.strstart>=T)&&(M.lookahead=M.strstart-T,M.strstart=T,V(M,!1),M.strm.avail_out===0)||M.strstart-M.block_start>=M.w_size-H&&(V(M,!1),M.strm.avail_out===0))return _}return M.insert=0,te===d?(V(M,!0),M.strm.avail_out===0?j:R):(M.strstart>M.block_start&&(V(M,!1),M.strm.avail_out),_)}),new we(4,4,8,4,Se),new we(4,5,16,8,Se),new we(4,6,32,32,Se),new we(4,4,16,16,_e),new we(8,16,32,32,_e),new we(8,16,128,128,_e),new we(8,32,128,256,_e),new we(32,128,258,1024,_e),new we(32,258,258,4096,_e)],i.deflateInit=function(M,te){return xe(M,te,m,15,8,0)},i.deflateInit2=xe,i.deflateReset=de,i.deflateResetKeep=ke,i.deflateSetHeader=function(M,te){return M&&M.state?M.state.wrap!==2?v:(M.state.gzhead=te,f):v},i.deflate=function(M,te){var X,T,S,B;if(!M||!M.state||5<te||te<0)return M?ee(M,v):v;if(T=M.state,!M.output||!M.input&&M.avail_in!==0||T.status===666&&te!==d)return ee(M,M.avail_out===0?-5:v);if(T.strm=M,X=T.last_flush,T.last_flush=te,T.status===D)if(T.wrap===2)M.adler=0,$(T,31),$(T,139),$(T,8),T.gzhead?($(T,(T.gzhead.text?1:0)+(T.gzhead.hcrc?2:0)+(T.gzhead.extra?4:0)+(T.gzhead.name?8:0)+(T.gzhead.comment?16:0)),$(T,255&T.gzhead.time),$(T,T.gzhead.time>>8&255),$(T,T.gzhead.time>>16&255),$(T,T.gzhead.time>>24&255),$(T,T.level===9?2:2<=T.strategy||T.level<2?4:0),$(T,255&T.gzhead.os),T.gzhead.extra&&T.gzhead.extra.length&&($(T,255&T.gzhead.extra.length),$(T,T.gzhead.extra.length>>8&255)),T.gzhead.hcrc&&(M.adler=c(M.adler,T.pending_buf,T.pending,0)),T.gzindex=0,T.status=69):($(T,0),$(T,0),$(T,0),$(T,0),$(T,0),$(T,T.level===9?2:2<=T.strategy||T.level<2?4:0),$(T,3),T.status=U);else{var q=m+(T.w_bits-8<<4)<<8;q|=(2<=T.strategy||T.level<2?0:T.level<6?1:T.level===6?2:3)<<6,T.strstart!==0&&(q|=32),q+=31-q%31,T.status=U,Q(T,q),T.strstart!==0&&(Q(T,M.adler>>>16),Q(T,65535&M.adler)),M.adler=1}if(T.status===69)if(T.gzhead.extra){for(S=T.pending;T.gzindex<(65535&T.gzhead.extra.length)&&(T.pending!==T.pending_buf_size||(T.gzhead.hcrc&&T.pending>S&&(M.adler=c(M.adler,T.pending_buf,T.pending-S,S)),k(M),S=T.pending,T.pending!==T.pending_buf_size));)$(T,255&T.gzhead.extra[T.gzindex]),T.gzindex++;T.gzhead.hcrc&&T.pending>S&&(M.adler=c(M.adler,T.pending_buf,T.pending-S,S)),T.gzindex===T.gzhead.extra.length&&(T.gzindex=0,T.status=73)}else T.status=73;if(T.status===73)if(T.gzhead.name){S=T.pending;do{if(T.pending===T.pending_buf_size&&(T.gzhead.hcrc&&T.pending>S&&(M.adler=c(M.adler,T.pending_buf,T.pending-S,S)),k(M),S=T.pending,T.pending===T.pending_buf_size)){B=1;break}B=T.gzindex<T.gzhead.name.length?255&T.gzhead.name.charCodeAt(T.gzindex++):0,$(T,B)}while(B!==0);T.gzhead.hcrc&&T.pending>S&&(M.adler=c(M.adler,T.pending_buf,T.pending-S,S)),B===0&&(T.gzindex=0,T.status=91)}else T.status=91;if(T.status===91)if(T.gzhead.comment){S=T.pending;do{if(T.pending===T.pending_buf_size&&(T.gzhead.hcrc&&T.pending>S&&(M.adler=c(M.adler,T.pending_buf,T.pending-S,S)),k(M),S=T.pending,T.pending===T.pending_buf_size)){B=1;break}B=T.gzindex<T.gzhead.comment.length?255&T.gzhead.comment.charCodeAt(T.gzindex++):0,$(T,B)}while(B!==0);T.gzhead.hcrc&&T.pending>S&&(M.adler=c(M.adler,T.pending_buf,T.pending-S,S)),B===0&&(T.status=103)}else T.status=103;if(T.status===103&&(T.gzhead.hcrc?(T.pending+2>T.pending_buf_size&&k(M),T.pending+2<=T.pending_buf_size&&($(T,255&M.adler),$(T,M.adler>>8&255),M.adler=0,T.status=U)):T.status=U),T.pending!==0){if(k(M),M.avail_out===0)return T.last_flush=-1,f}else if(M.avail_in===0&&J(te)<=J(X)&&te!==d)return ee(M,-5);if(T.status===666&&M.avail_in!==0)return ee(M,-5);if(M.avail_in!==0||T.lookahead!==0||te!==h&&T.status!==666){var K=T.strategy===2?function(W,ce){for(var pe;;){if(W.lookahead===0&&(ne(W),W.lookahead===0)){if(ce===h)return _;break}if(W.match_length=0,pe=o._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,pe&&(V(W,!1),W.strm.avail_out===0))return _}return W.insert=0,ce===d?(V(W,!0),W.strm.avail_out===0?j:R):W.last_lit&&(V(W,!1),W.strm.avail_out===0)?_:z}(T,te):T.strategy===3?function(W,ce){for(var pe,ue,ve,Z,ye=W.window;;){if(W.lookahead<=O){if(ne(W),W.lookahead<=O&&ce===h)return _;if(W.lookahead===0)break}if(W.match_length=0,W.lookahead>=N&&0<W.strstart&&(ue=ye[ve=W.strstart-1])===ye[++ve]&&ue===ye[++ve]&&ue===ye[++ve]){Z=W.strstart+O;do;while(ue===ye[++ve]&&ue===ye[++ve]&&ue===ye[++ve]&&ue===ye[++ve]&&ue===ye[++ve]&&ue===ye[++ve]&&ue===ye[++ve]&&ue===ye[++ve]&&ve<Z);W.match_length=O-(Z-ve),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=N?(pe=o._tr_tally(W,1,W.match_length-N),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(pe=o._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),pe&&(V(W,!1),W.strm.avail_out===0))return _}return W.insert=0,ce===d?(V(W,!0),W.strm.avail_out===0?j:R):W.last_lit&&(V(W,!1),W.strm.avail_out===0)?_:z}(T,te):s[T.level].func(T,te);if(K!==j&&K!==R||(T.status=666),K===_||K===j)return M.avail_out===0&&(T.last_flush=-1),f;if(K===z&&(te===1?o._tr_align(T):te!==5&&(o._tr_stored_block(T,0,0,!1),te===3&&(le(T.head),T.lookahead===0&&(T.strstart=0,T.block_start=0,T.insert=0))),k(M),M.avail_out===0))return T.last_flush=-1,f}return te!==d?f:T.wrap<=0?1:(T.wrap===2?($(T,255&M.adler),$(T,M.adler>>8&255),$(T,M.adler>>16&255),$(T,M.adler>>24&255),$(T,255&M.total_in),$(T,M.total_in>>8&255),$(T,M.total_in>>16&255),$(T,M.total_in>>24&255)):(Q(T,M.adler>>>16),Q(T,65535&M.adler)),k(M),0<T.wrap&&(T.wrap=-T.wrap),T.pending!==0?f:1)},i.deflateEnd=function(M){var te;return M&&M.state?(te=M.state.status)!==D&&te!==69&&te!==73&&te!==91&&te!==103&&te!==U&&te!==666?ee(M,v):(M.state=null,te===U?ee(M,-3):f):v},i.deflateSetDictionary=function(M,te){var X,T,S,B,q,K,W,ce,pe=te.length;if(!M||!M.state||(B=(X=M.state).wrap)===2||B===1&&X.status!==D||X.lookahead)return v;for(B===1&&(M.adler=l(M.adler,te,pe,0)),X.wrap=0,pe>=X.w_size&&(B===0&&(le(X.head),X.strstart=0,X.block_start=0,X.insert=0),ce=new a.Buf8(X.w_size),a.arraySet(ce,te,pe-X.w_size,X.w_size,0),te=ce,pe=X.w_size),q=M.avail_in,K=M.next_in,W=M.input,M.avail_in=pe,M.next_in=0,M.input=te,ne(X);X.lookahead>=N;){for(T=X.strstart,S=X.lookahead-(N-1);X.ins_h=(X.ins_h<<X.hash_shift^X.window[T+N-1])&X.hash_mask,X.prev[T&X.w_mask]=X.head[X.ins_h],X.head[X.ins_h]=T,T++,--S;);X.strstart=T,X.lookahead=N-1,ne(X)}return X.strstart+=X.lookahead,X.block_start=X.strstart,X.insert=X.lookahead,X.lookahead=0,X.match_length=X.prev_length=N-1,X.match_available=0,M.next_in=K,M.input=W,M.avail_in=q,X.wrap=B,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,r,i){r.exports=function(s,a){var o,l,c,u,h,d,f,v,g,y,p,m,x,w,b,C,A,F,N,O,H,D,U,_,z;o=s.state,l=s.next_in,_=s.input,c=l+(s.avail_in-5),u=s.next_out,z=s.output,h=u-(a-s.avail_out),d=u+(s.avail_out-257),f=o.dmax,v=o.wsize,g=o.whave,y=o.wnext,p=o.window,m=o.hold,x=o.bits,w=o.lencode,b=o.distcode,C=(1<<o.lenbits)-1,A=(1<<o.distbits)-1;e:do{x<15&&(m+=_[l++]<<x,x+=8,m+=_[l++]<<x,x+=8),F=w[m&C];t:for(;;){if(m>>>=N=F>>>24,x-=N,(N=F>>>16&255)===0)z[u++]=65535&F;else{if(!(16&N)){if((64&N)==0){F=w[(65535&F)+(m&(1<<N)-1)];continue t}if(32&N){o.mode=12;break e}s.msg="invalid literal/length code",o.mode=30;break e}O=65535&F,(N&=15)&&(x<N&&(m+=_[l++]<<x,x+=8),O+=m&(1<<N)-1,m>>>=N,x-=N),x<15&&(m+=_[l++]<<x,x+=8,m+=_[l++]<<x,x+=8),F=b[m&A];n:for(;;){if(m>>>=N=F>>>24,x-=N,!(16&(N=F>>>16&255))){if((64&N)==0){F=b[(65535&F)+(m&(1<<N)-1)];continue n}s.msg="invalid distance code",o.mode=30;break e}if(H=65535&F,x<(N&=15)&&(m+=_[l++]<<x,(x+=8)<N&&(m+=_[l++]<<x,x+=8)),f<(H+=m&(1<<N)-1)){s.msg="invalid distance too far back",o.mode=30;break e}if(m>>>=N,x-=N,(N=u-h)<H){if(g<(N=H-N)&&o.sane){s.msg="invalid distance too far back",o.mode=30;break e}if(U=p,(D=0)===y){if(D+=v-N,N<O){for(O-=N;z[u++]=p[D++],--N;);D=u-H,U=z}}else if(y<N){if(D+=v+y-N,(N-=y)<O){for(O-=N;z[u++]=p[D++],--N;);if(D=0,y<O){for(O-=N=y;z[u++]=p[D++],--N;);D=u-H,U=z}}}else if(D+=y-N,N<O){for(O-=N;z[u++]=p[D++],--N;);D=u-H,U=z}for(;2<O;)z[u++]=U[D++],z[u++]=U[D++],z[u++]=U[D++],O-=3;O&&(z[u++]=U[D++],1<O&&(z[u++]=U[D++]))}else{for(D=u-H;z[u++]=z[D++],z[u++]=z[D++],z[u++]=z[D++],2<(O-=3););O&&(z[u++]=z[D++],1<O&&(z[u++]=z[D++]))}break}}break}}while(l<c&&u<d);l-=O=x>>3,m&=(1<<(x-=O<<3))-1,s.next_in=l,s.next_out=u,s.avail_in=l<c?c-l+5:5-(l-c),s.avail_out=u<d?d-u+257:257-(u-d),o.hold=m,o.bits=x}},{}],49:[function(t,r,i){var s=t("../utils/common"),a=t("./adler32"),o=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),u=1,h=2,d=0,f=-2,v=1,g=852,y=592;function p(D){return(D>>>24&255)+(D>>>8&65280)+((65280&D)<<8)+((255&D)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function x(D){var U;return D&&D.state?(U=D.state,D.total_in=D.total_out=U.total=0,D.msg="",U.wrap&&(D.adler=1&U.wrap),U.mode=v,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new s.Buf32(g),U.distcode=U.distdyn=new s.Buf32(y),U.sane=1,U.back=-1,d):f}function w(D){var U;return D&&D.state?((U=D.state).wsize=0,U.whave=0,U.wnext=0,x(D)):f}function b(D,U){var _,z;return D&&D.state?(z=D.state,U<0?(_=0,U=-U):(_=1+(U>>4),U<48&&(U&=15)),U&&(U<8||15<U)?f:(z.window!==null&&z.wbits!==U&&(z.window=null),z.wrap=_,z.wbits=U,w(D))):f}function C(D,U){var _,z;return D?(z=new m,(D.state=z).window=null,(_=b(D,U))!==d&&(D.state=null),_):f}var A,F,N=!0;function O(D){if(N){var U;for(A=new s.Buf32(512),F=new s.Buf32(32),U=0;U<144;)D.lens[U++]=8;for(;U<256;)D.lens[U++]=9;for(;U<280;)D.lens[U++]=7;for(;U<288;)D.lens[U++]=8;for(c(u,D.lens,0,288,A,0,D.work,{bits:9}),U=0;U<32;)D.lens[U++]=5;c(h,D.lens,0,32,F,0,D.work,{bits:5}),N=!1}D.lencode=A,D.lenbits=9,D.distcode=F,D.distbits=5}function H(D,U,_,z){var j,R=D.state;return R.window===null&&(R.wsize=1<<R.wbits,R.wnext=0,R.whave=0,R.window=new s.Buf8(R.wsize)),z>=R.wsize?(s.arraySet(R.window,U,_-R.wsize,R.wsize,0),R.wnext=0,R.whave=R.wsize):(z<(j=R.wsize-R.wnext)&&(j=z),s.arraySet(R.window,U,_-z,j,R.wnext),(z-=j)?(s.arraySet(R.window,U,_-z,z,0),R.wnext=z,R.whave=R.wsize):(R.wnext+=j,R.wnext===R.wsize&&(R.wnext=0),R.whave<R.wsize&&(R.whave+=j))),0}i.inflateReset=w,i.inflateReset2=b,i.inflateResetKeep=x,i.inflateInit=function(D){return C(D,15)},i.inflateInit2=C,i.inflate=function(D,U){var _,z,j,R,ee,J,le,k,V,$,Q,ie,ne,Se,_e,we,Me,ke,de,xe,M,te,X,T,S=0,B=new s.Buf8(4),q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!D||!D.state||!D.output||!D.input&&D.avail_in!==0)return f;(_=D.state).mode===12&&(_.mode=13),ee=D.next_out,j=D.output,le=D.avail_out,R=D.next_in,z=D.input,J=D.avail_in,k=_.hold,V=_.bits,$=J,Q=le,te=d;e:for(;;)switch(_.mode){case v:if(_.wrap===0){_.mode=13;break}for(;V<16;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if(2&_.wrap&&k===35615){B[_.check=0]=255&k,B[1]=k>>>8&255,_.check=o(_.check,B,2,0),V=k=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&k)<<8)+(k>>8))%31){D.msg="incorrect header check",_.mode=30;break}if((15&k)!=8){D.msg="unknown compression method",_.mode=30;break}if(V-=4,M=8+(15&(k>>>=4)),_.wbits===0)_.wbits=M;else if(M>_.wbits){D.msg="invalid window size",_.mode=30;break}_.dmax=1<<M,D.adler=_.check=1,_.mode=512&k?10:12,V=k=0;break;case 2:for(;V<16;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if(_.flags=k,(255&_.flags)!=8){D.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){D.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=k>>8&1),512&_.flags&&(B[0]=255&k,B[1]=k>>>8&255,_.check=o(_.check,B,2,0)),V=k=0,_.mode=3;case 3:for(;V<32;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}_.head&&(_.head.time=k),512&_.flags&&(B[0]=255&k,B[1]=k>>>8&255,B[2]=k>>>16&255,B[3]=k>>>24&255,_.check=o(_.check,B,4,0)),V=k=0,_.mode=4;case 4:for(;V<16;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}_.head&&(_.head.xflags=255&k,_.head.os=k>>8),512&_.flags&&(B[0]=255&k,B[1]=k>>>8&255,_.check=o(_.check,B,2,0)),V=k=0,_.mode=5;case 5:if(1024&_.flags){for(;V<16;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}_.length=k,_.head&&(_.head.extra_len=k),512&_.flags&&(B[0]=255&k,B[1]=k>>>8&255,_.check=o(_.check,B,2,0)),V=k=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(J<(ie=_.length)&&(ie=J),ie&&(_.head&&(M=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),s.arraySet(_.head.extra,z,R,ie,M)),512&_.flags&&(_.check=o(_.check,z,ie,R)),J-=ie,R+=ie,_.length-=ie),_.length))break e;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(J===0)break e;for(ie=0;M=z[R+ie++],_.head&&M&&_.length<65536&&(_.head.name+=String.fromCharCode(M)),M&&ie<J;);if(512&_.flags&&(_.check=o(_.check,z,ie,R)),J-=ie,R+=ie,M)break e}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(J===0)break e;for(ie=0;M=z[R+ie++],_.head&&M&&_.length<65536&&(_.head.comment+=String.fromCharCode(M)),M&&ie<J;);if(512&_.flags&&(_.check=o(_.check,z,ie,R)),J-=ie,R+=ie,M)break e}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;V<16;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if(k!==(65535&_.check)){D.msg="header crc mismatch",_.mode=30;break}V=k=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),D.adler=_.check=0,_.mode=12;break;case 10:for(;V<32;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}D.adler=_.check=p(k),V=k=0,_.mode=11;case 11:if(_.havedict===0)return D.next_out=ee,D.avail_out=le,D.next_in=R,D.avail_in=J,_.hold=k,_.bits=V,2;D.adler=_.check=1,_.mode=12;case 12:if(U===5||U===6)break e;case 13:if(_.last){k>>>=7&V,V-=7&V,_.mode=27;break}for(;V<3;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}switch(_.last=1&k,V-=1,3&(k>>>=1)){case 0:_.mode=14;break;case 1:if(O(_),_.mode=20,U!==6)break;k>>>=2,V-=2;break e;case 2:_.mode=17;break;case 3:D.msg="invalid block type",_.mode=30}k>>>=2,V-=2;break;case 14:for(k>>>=7&V,V-=7&V;V<32;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if((65535&k)!=(k>>>16^65535)){D.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&k,V=k=0,_.mode=15,U===6)break e;case 15:_.mode=16;case 16:if(ie=_.length){if(J<ie&&(ie=J),le<ie&&(ie=le),ie===0)break e;s.arraySet(j,z,R,ie,ee),J-=ie,R+=ie,le-=ie,ee+=ie,_.length-=ie;break}_.mode=12;break;case 17:for(;V<14;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if(_.nlen=257+(31&k),k>>>=5,V-=5,_.ndist=1+(31&k),k>>>=5,V-=5,_.ncode=4+(15&k),k>>>=4,V-=4,286<_.nlen||30<_.ndist){D.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;V<3;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}_.lens[q[_.have++]]=7&k,k>>>=3,V-=3}for(;_.have<19;)_.lens[q[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,X={bits:_.lenbits},te=c(0,_.lens,0,19,_.lencode,0,_.work,X),_.lenbits=X.bits,te){D.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;we=(S=_.lencode[k&(1<<_.lenbits)-1])>>>16&255,Me=65535&S,!((_e=S>>>24)<=V);){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if(Me<16)k>>>=_e,V-=_e,_.lens[_.have++]=Me;else{if(Me===16){for(T=_e+2;V<T;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if(k>>>=_e,V-=_e,_.have===0){D.msg="invalid bit length repeat",_.mode=30;break}M=_.lens[_.have-1],ie=3+(3&k),k>>>=2,V-=2}else if(Me===17){for(T=_e+3;V<T;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}V-=_e,M=0,ie=3+(7&(k>>>=_e)),k>>>=3,V-=3}else{for(T=_e+7;V<T;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}V-=_e,M=0,ie=11+(127&(k>>>=_e)),k>>>=7,V-=7}if(_.have+ie>_.nlen+_.ndist){D.msg="invalid bit length repeat",_.mode=30;break}for(;ie--;)_.lens[_.have++]=M}}if(_.mode===30)break;if(_.lens[256]===0){D.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,X={bits:_.lenbits},te=c(u,_.lens,0,_.nlen,_.lencode,0,_.work,X),_.lenbits=X.bits,te){D.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,X={bits:_.distbits},te=c(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,X),_.distbits=X.bits,te){D.msg="invalid distances set",_.mode=30;break}if(_.mode=20,U===6)break e;case 20:_.mode=21;case 21:if(6<=J&&258<=le){D.next_out=ee,D.avail_out=le,D.next_in=R,D.avail_in=J,_.hold=k,_.bits=V,l(D,Q),ee=D.next_out,j=D.output,le=D.avail_out,R=D.next_in,z=D.input,J=D.avail_in,k=_.hold,V=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;we=(S=_.lencode[k&(1<<_.lenbits)-1])>>>16&255,Me=65535&S,!((_e=S>>>24)<=V);){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if(we&&(240&we)==0){for(ke=_e,de=we,xe=Me;we=(S=_.lencode[xe+((k&(1<<ke+de)-1)>>ke)])>>>16&255,Me=65535&S,!(ke+(_e=S>>>24)<=V);){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}k>>>=ke,V-=ke,_.back+=ke}if(k>>>=_e,V-=_e,_.back+=_e,_.length=Me,we===0){_.mode=26;break}if(32&we){_.back=-1,_.mode=12;break}if(64&we){D.msg="invalid literal/length code",_.mode=30;break}_.extra=15&we,_.mode=22;case 22:if(_.extra){for(T=_.extra;V<T;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}_.length+=k&(1<<_.extra)-1,k>>>=_.extra,V-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;we=(S=_.distcode[k&(1<<_.distbits)-1])>>>16&255,Me=65535&S,!((_e=S>>>24)<=V);){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if((240&we)==0){for(ke=_e,de=we,xe=Me;we=(S=_.distcode[xe+((k&(1<<ke+de)-1)>>ke)])>>>16&255,Me=65535&S,!(ke+(_e=S>>>24)<=V);){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}k>>>=ke,V-=ke,_.back+=ke}if(k>>>=_e,V-=_e,_.back+=_e,64&we){D.msg="invalid distance code",_.mode=30;break}_.offset=Me,_.extra=15&we,_.mode=24;case 24:if(_.extra){for(T=_.extra;V<T;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}_.offset+=k&(1<<_.extra)-1,k>>>=_.extra,V-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){D.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(le===0)break e;if(ie=Q-le,_.offset>ie){if((ie=_.offset-ie)>_.whave&&_.sane){D.msg="invalid distance too far back",_.mode=30;break}ne=ie>_.wnext?(ie-=_.wnext,_.wsize-ie):_.wnext-ie,ie>_.length&&(ie=_.length),Se=_.window}else Se=j,ne=ee-_.offset,ie=_.length;for(le<ie&&(ie=le),le-=ie,_.length-=ie;j[ee++]=Se[ne++],--ie;);_.length===0&&(_.mode=21);break;case 26:if(le===0)break e;j[ee++]=_.length,le--,_.mode=21;break;case 27:if(_.wrap){for(;V<32;){if(J===0)break e;J--,k|=z[R++]<<V,V+=8}if(Q-=le,D.total_out+=Q,_.total+=Q,Q&&(D.adler=_.check=_.flags?o(_.check,j,Q,ee-Q):a(_.check,j,Q,ee-Q)),Q=le,(_.flags?k:p(k))!==_.check){D.msg="incorrect data check",_.mode=30;break}V=k=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;V<32;){if(J===0)break e;J--,k+=z[R++]<<V,V+=8}if(k!==(4294967295&_.total)){D.msg="incorrect length check",_.mode=30;break}V=k=0}_.mode=29;case 29:te=1;break e;case 30:te=-3;break e;case 31:return-4;case 32:default:return f}return D.next_out=ee,D.avail_out=le,D.next_in=R,D.avail_in=J,_.hold=k,_.bits=V,(_.wsize||Q!==D.avail_out&&_.mode<30&&(_.mode<27||U!==4))&&H(D,D.output,D.next_out,Q-D.avail_out)?(_.mode=31,-4):($-=D.avail_in,Q-=D.avail_out,D.total_in+=$,D.total_out+=Q,_.total+=Q,_.wrap&&Q&&(D.adler=_.check=_.flags?o(_.check,j,Q,D.next_out-Q):a(_.check,j,Q,D.next_out-Q)),D.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),($==0&&Q===0||U===4)&&te===d&&(te=-5),te)},i.inflateEnd=function(D){if(!D||!D.state)return f;var U=D.state;return U.window&&(U.window=null),D.state=null,d},i.inflateGetHeader=function(D,U){var _;return D&&D.state?(2&(_=D.state).wrap)==0?f:((_.head=U).done=!1,d):f},i.inflateSetDictionary=function(D,U){var _,z=U.length;return D&&D.state?(_=D.state).wrap!==0&&_.mode!==11?f:_.mode===11&&a(1,U,z,0)!==_.check?-3:H(D,U,z,z)?(_.mode=31,-4):(_.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,r,i){var s=t("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,d,f,v,g,y,p){var m,x,w,b,C,A,F,N,O,H=p.bits,D=0,U=0,_=0,z=0,j=0,R=0,ee=0,J=0,le=0,k=0,V=null,$=0,Q=new s.Buf16(16),ie=new s.Buf16(16),ne=null,Se=0;for(D=0;D<=15;D++)Q[D]=0;for(U=0;U<f;U++)Q[h[d+U]]++;for(j=H,z=15;1<=z&&Q[z]===0;z--);if(z<j&&(j=z),z===0)return v[g++]=20971520,v[g++]=20971520,p.bits=1,0;for(_=1;_<z&&Q[_]===0;_++);for(j<_&&(j=_),D=J=1;D<=15;D++)if(J<<=1,(J-=Q[D])<0)return-1;if(0<J&&(u===0||z!==1))return-1;for(ie[1]=0,D=1;D<15;D++)ie[D+1]=ie[D]+Q[D];for(U=0;U<f;U++)h[d+U]!==0&&(y[ie[h[d+U]]++]=U);if(A=u===0?(V=ne=y,19):u===1?(V=a,$-=257,ne=o,Se-=257,256):(V=l,ne=c,-1),D=_,C=g,ee=U=k=0,w=-1,b=(le=1<<(R=j))-1,u===1&&852<le||u===2&&592<le)return 1;for(;;){for(F=D-ee,O=y[U]<A?(N=0,y[U]):y[U]>A?(N=ne[Se+y[U]],V[$+y[U]]):(N=96,0),m=1<<D-ee,_=x=1<<R;v[C+(k>>ee)+(x-=m)]=F<<24|N<<16|O|0,x!==0;);for(m=1<<D-1;k&m;)m>>=1;if(m!==0?(k&=m-1,k+=m):k=0,U++,--Q[D]==0){if(D===z)break;D=h[d+y[U]]}if(j<D&&(k&b)!==w){for(ee===0&&(ee=j),C+=_,J=1<<(R=D-ee);R+ee<z&&!((J-=Q[R+ee])<=0);)R++,J<<=1;if(le+=1<<R,u===1&&852<le||u===2&&592<le)return 1;v[w=k&b]=j<<24|R<<16|C-g|0}}return k!==0&&(v[C+k]=D-ee<<24|64<<16|0),p.bits=j,0}},{"../utils/common":41}],51:[function(t,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,r,i){var s=t("../utils/common"),a=0,o=1;function l(S){for(var B=S.length;0<=--B;)S[B]=0}var c=0,u=29,h=256,d=h+1+u,f=30,v=19,g=2*d+1,y=15,p=16,m=7,x=256,w=16,b=17,C=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],F=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(d+2));l(H);var D=new Array(2*f);l(D);var U=new Array(512);l(U);var _=new Array(256);l(_);var z=new Array(u);l(z);var j,R,ee,J=new Array(f);function le(S,B,q,K,W){this.static_tree=S,this.extra_bits=B,this.extra_base=q,this.elems=K,this.max_length=W,this.has_stree=S&&S.length}function k(S,B){this.dyn_tree=S,this.max_code=0,this.stat_desc=B}function V(S){return S<256?U[S]:U[256+(S>>>7)]}function $(S,B){S.pending_buf[S.pending++]=255&B,S.pending_buf[S.pending++]=B>>>8&255}function Q(S,B,q){S.bi_valid>p-q?(S.bi_buf|=B<<S.bi_valid&65535,$(S,S.bi_buf),S.bi_buf=B>>p-S.bi_valid,S.bi_valid+=q-p):(S.bi_buf|=B<<S.bi_valid&65535,S.bi_valid+=q)}function ie(S,B,q){Q(S,q[2*B],q[2*B+1])}function ne(S,B){for(var q=0;q|=1&S,S>>>=1,q<<=1,0<--B;);return q>>>1}function Se(S,B,q){var K,W,ce=new Array(y+1),pe=0;for(K=1;K<=y;K++)ce[K]=pe=pe+q[K-1]<<1;for(W=0;W<=B;W++){var ue=S[2*W+1];ue!==0&&(S[2*W]=ne(ce[ue]++,ue))}}function _e(S){var B;for(B=0;B<d;B++)S.dyn_ltree[2*B]=0;for(B=0;B<f;B++)S.dyn_dtree[2*B]=0;for(B=0;B<v;B++)S.bl_tree[2*B]=0;S.dyn_ltree[2*x]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function we(S){8<S.bi_valid?$(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function Me(S,B,q,K){var W=2*B,ce=2*q;return S[W]<S[ce]||S[W]===S[ce]&&K[B]<=K[q]}function ke(S,B,q){for(var K=S.heap[q],W=q<<1;W<=S.heap_len&&(W<S.heap_len&&Me(B,S.heap[W+1],S.heap[W],S.depth)&&W++,!Me(B,K,S.heap[W],S.depth));)S.heap[q]=S.heap[W],q=W,W<<=1;S.heap[q]=K}function de(S,B,q){var K,W,ce,pe,ue=0;if(S.last_lit!==0)for(;K=S.pending_buf[S.d_buf+2*ue]<<8|S.pending_buf[S.d_buf+2*ue+1],W=S.pending_buf[S.l_buf+ue],ue++,K===0?ie(S,W,B):(ie(S,(ce=_[W])+h+1,B),(pe=A[ce])!==0&&Q(S,W-=z[ce],pe),ie(S,ce=V(--K),q),(pe=F[ce])!==0&&Q(S,K-=J[ce],pe)),ue<S.last_lit;);ie(S,x,B)}function xe(S,B){var q,K,W,ce=B.dyn_tree,pe=B.stat_desc.static_tree,ue=B.stat_desc.has_stree,ve=B.stat_desc.elems,Z=-1;for(S.heap_len=0,S.heap_max=g,q=0;q<ve;q++)ce[2*q]!==0?(S.heap[++S.heap_len]=Z=q,S.depth[q]=0):ce[2*q+1]=0;for(;S.heap_len<2;)ce[2*(W=S.heap[++S.heap_len]=Z<2?++Z:0)]=1,S.depth[W]=0,S.opt_len--,ue&&(S.static_len-=pe[2*W+1]);for(B.max_code=Z,q=S.heap_len>>1;1<=q;q--)ke(S,ce,q);for(W=ve;q=S.heap[1],S.heap[1]=S.heap[S.heap_len--],ke(S,ce,1),K=S.heap[1],S.heap[--S.heap_max]=q,S.heap[--S.heap_max]=K,ce[2*W]=ce[2*q]+ce[2*K],S.depth[W]=(S.depth[q]>=S.depth[K]?S.depth[q]:S.depth[K])+1,ce[2*q+1]=ce[2*K+1]=W,S.heap[1]=W++,ke(S,ce,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ye,ge){var Re,Fe,Ze,lt,kt,jn,rt=ge.dyn_tree,Tn=ge.max_code,Wt=ge.stat_desc.static_tree,bs=ge.stat_desc.has_stree,vo=ge.stat_desc.extra_bits,Cn=ge.stat_desc.extra_base,Ii=ge.stat_desc.max_length,dr=0;for(lt=0;lt<=y;lt++)ye.bl_count[lt]=0;for(rt[2*ye.heap[ye.heap_max]+1]=0,Re=ye.heap_max+1;Re<g;Re++)Ii<(lt=rt[2*rt[2*(Fe=ye.heap[Re])+1]+1]+1)&&(lt=Ii,dr++),rt[2*Fe+1]=lt,Tn<Fe||(ye.bl_count[lt]++,kt=0,Cn<=Fe&&(kt=vo[Fe-Cn]),jn=rt[2*Fe],ye.opt_len+=jn*(lt+kt),bs&&(ye.static_len+=jn*(Wt[2*Fe+1]+kt)));if(dr!==0){do{for(lt=Ii-1;ye.bl_count[lt]===0;)lt--;ye.bl_count[lt]--,ye.bl_count[lt+1]+=2,ye.bl_count[Ii]--,dr-=2}while(0<dr);for(lt=Ii;lt!==0;lt--)for(Fe=ye.bl_count[lt];Fe!==0;)Tn<(Ze=ye.heap[--Re])||(rt[2*Ze+1]!==lt&&(ye.opt_len+=(lt-rt[2*Ze+1])*rt[2*Ze],rt[2*Ze+1]=lt),Fe--)}}(S,B),Se(ce,Z,S.bl_count)}function M(S,B,q){var K,W,ce=-1,pe=B[1],ue=0,ve=7,Z=4;for(pe===0&&(ve=138,Z=3),B[2*(q+1)+1]=65535,K=0;K<=q;K++)W=pe,pe=B[2*(K+1)+1],++ue<ve&&W===pe||(ue<Z?S.bl_tree[2*W]+=ue:W!==0?(W!==ce&&S.bl_tree[2*W]++,S.bl_tree[2*w]++):ue<=10?S.bl_tree[2*b]++:S.bl_tree[2*C]++,ce=W,Z=(ue=0)===pe?(ve=138,3):W===pe?(ve=6,3):(ve=7,4))}function te(S,B,q){var K,W,ce=-1,pe=B[1],ue=0,ve=7,Z=4;for(pe===0&&(ve=138,Z=3),K=0;K<=q;K++)if(W=pe,pe=B[2*(K+1)+1],!(++ue<ve&&W===pe)){if(ue<Z)for(;ie(S,W,S.bl_tree),--ue!=0;);else W!==0?(W!==ce&&(ie(S,W,S.bl_tree),ue--),ie(S,w,S.bl_tree),Q(S,ue-3,2)):ue<=10?(ie(S,b,S.bl_tree),Q(S,ue-3,3)):(ie(S,C,S.bl_tree),Q(S,ue-11,7));ce=W,Z=(ue=0)===pe?(ve=138,3):W===pe?(ve=6,3):(ve=7,4)}}l(J);var X=!1;function T(S,B,q,K){Q(S,(c<<1)+(K?1:0),3),function(W,ce,pe,ue){we(W),ue&&($(W,pe),$(W,~pe)),s.arraySet(W.pending_buf,W.window,ce,pe,W.pending),W.pending+=pe}(S,B,q,!0)}i._tr_init=function(S){X||(function(){var B,q,K,W,ce,pe=new Array(y+1);for(W=K=0;W<u-1;W++)for(z[W]=K,B=0;B<1<<A[W];B++)_[K++]=W;for(_[K-1]=W,W=ce=0;W<16;W++)for(J[W]=ce,B=0;B<1<<F[W];B++)U[ce++]=W;for(ce>>=7;W<f;W++)for(J[W]=ce<<7,B=0;B<1<<F[W]-7;B++)U[256+ce++]=W;for(q=0;q<=y;q++)pe[q]=0;for(B=0;B<=143;)H[2*B+1]=8,B++,pe[8]++;for(;B<=255;)H[2*B+1]=9,B++,pe[9]++;for(;B<=279;)H[2*B+1]=7,B++,pe[7]++;for(;B<=287;)H[2*B+1]=8,B++,pe[8]++;for(Se(H,d+1,pe),B=0;B<f;B++)D[2*B+1]=5,D[2*B]=ne(B,5);j=new le(H,A,h+1,d,y),R=new le(D,F,0,f,y),ee=new le(new Array(0),N,0,v,m)}(),X=!0),S.l_desc=new k(S.dyn_ltree,j),S.d_desc=new k(S.dyn_dtree,R),S.bl_desc=new k(S.bl_tree,ee),S.bi_buf=0,S.bi_valid=0,_e(S)},i._tr_stored_block=T,i._tr_flush_block=function(S,B,q,K){var W,ce,pe=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(ue){var ve,Z=4093624447;for(ve=0;ve<=31;ve++,Z>>>=1)if(1&Z&&ue.dyn_ltree[2*ve]!==0)return a;if(ue.dyn_ltree[18]!==0||ue.dyn_ltree[20]!==0||ue.dyn_ltree[26]!==0)return o;for(ve=32;ve<h;ve++)if(ue.dyn_ltree[2*ve]!==0)return o;return a}(S)),xe(S,S.l_desc),xe(S,S.d_desc),pe=function(ue){var ve;for(M(ue,ue.dyn_ltree,ue.l_desc.max_code),M(ue,ue.dyn_dtree,ue.d_desc.max_code),xe(ue,ue.bl_desc),ve=v-1;3<=ve&&ue.bl_tree[2*O[ve]+1]===0;ve--);return ue.opt_len+=3*(ve+1)+5+5+4,ve}(S),W=S.opt_len+3+7>>>3,(ce=S.static_len+3+7>>>3)<=W&&(W=ce)):W=ce=q+5,q+4<=W&&B!==-1?T(S,B,q,K):S.strategy===4||ce===W?(Q(S,2+(K?1:0),3),de(S,H,D)):(Q(S,4+(K?1:0),3),function(ue,ve,Z,ye){var ge;for(Q(ue,ve-257,5),Q(ue,Z-1,5),Q(ue,ye-4,4),ge=0;ge<ye;ge++)Q(ue,ue.bl_tree[2*O[ge]+1],3);te(ue,ue.dyn_ltree,ve-1),te(ue,ue.dyn_dtree,Z-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,pe+1),de(S,S.dyn_ltree,S.dyn_dtree)),_e(S),K&&we(S)},i._tr_tally=function(S,B,q){return S.pending_buf[S.d_buf+2*S.last_lit]=B>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&B,S.pending_buf[S.l_buf+S.last_lit]=255&q,S.last_lit++,B===0?S.dyn_ltree[2*q]++:(S.matches++,B--,S.dyn_ltree[2*(_[q]+h+1)]++,S.dyn_dtree[2*V(B)]++),S.last_lit===S.lit_bufsize-1},i._tr_align=function(S){Q(S,2,3),ie(S,x,H),function(B){B.bi_valid===16?($(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):8<=B.bi_valid&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(t,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,r,i){(function(s){(function(a,o){if(!a.setImmediate){var l,c,u,h,d=1,f={},v=!1,g=a.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(a);y=y&&y.setTimeout?y:a,l={}.toString.call(a.process)==="[object process]"?function(w){process.nextTick(function(){m(w)})}:function(){if(a.postMessage&&!a.importScripts){var w=!0,b=a.onmessage;return a.onmessage=function(){w=!1},a.postMessage("","*"),a.onmessage=b,w}}()?(h="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",x,!1):a.attachEvent("onmessage",x),function(w){a.postMessage(h+w,"*")}):a.MessageChannel?((u=new MessageChannel).port1.onmessage=function(w){m(w.data)},function(w){u.port2.postMessage(w)}):g&&"onreadystatechange"in g.createElement("script")?(c=g.documentElement,function(w){var b=g.createElement("script");b.onreadystatechange=function(){m(w),b.onreadystatechange=null,c.removeChild(b),b=null},c.appendChild(b)}):function(w){setTimeout(m,0,w)},y.setImmediate=function(w){typeof w!="function"&&(w=new Function(""+w));for(var b=new Array(arguments.length-1),C=0;C<b.length;C++)b[C]=arguments[C+1];var A={callback:w,args:b};return f[d]=A,l(d),d++},y.clearImmediate=p}function p(w){delete f[w]}function m(w){if(v)setTimeout(m,0,w);else{var b=f[w];if(b){v=!0;try{(function(C){var A=C.callback,F=C.args;switch(F.length){case 0:A();break;case 1:A(F[0]);break;case 2:A(F[0],F[1]);break;case 3:A(F[0],F[1],F[2]);break;default:A.apply(o,F)}})(b)}finally{p(w),v=!1}}}}function x(w){w.source===a&&typeof w.data=="string"&&w.data.indexOf(h)===0&&m(+w.data.slice(h.length))}})(typeof self=="undefined"?s===void 0?this:s:self)}).call(this,typeof os!="undefined"?os:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})})(y2);var x2=y2.exports,vi=(n=>(n[n.Geometry=0]="Geometry",n[n.LightEmittingObject=1]="LightEmittingObject",n[n.LightEmittingSurface=2]="LightEmittingSurface",n[n.Joint=3]="Joint",n[n.Sensor=4]="Sensor",n))(vi||{}),lp=(n=>(n[n.Rectangle=0]="Rectangle",n[n.Circle=1]="Circle",n))(lp||{}),dd=(n=>(n[n.Single=0]="Single",n[n.Range=1]="Range",n))(dd||{});class k6{constructor(){P(this,"knownPartNames",new Array);P(this,"domParser",new DOMParser)}}class O6{constructor(e){this.logger=e}getChildNode(e,t){for(var r of t.childNodes)if(r.nodeName==e)return r;return null}getChildNodes(e,t){const r=new Array;for(var i of t.childNodes)i.nodeName==e&&r.push(i);return r}getAttribute(e,t){var i;if(t.nodeType!=Node.ELEMENT_NODE)return null;const r=t.attributes.getNamedItem(e);return(i=r==null?void 0:r.textContent)!=null?i:null}}class z6 extends O6{constructor(e){super(e)}getXYZAttributes(e){const t=Number(this.getAttribute("x",e)),r=Number(this.getAttribute("y",e)),i=Number(this.getAttribute("z",e));if(isNaN(t)||isNaN(r)||isNaN(i))throw new Error(`Failed to parse '${name}' vector element in ${e.nodeName}`);return{x:t,y:r,z:i}}getVector(e,t){const r=this.getChildNode(e,t);return r?this.getXYZAttributes(r):null}parse(e){const t=new k6;var r=null;try{r=t.domParser.parseFromString(e,"text/xml")}catch{throw new Error("Failed to parse structure.xml")}if(!r)throw new Error("Failed to parse structure.xml");try{const i=this.getChildNode("Luminaire",r.getRootNode());if(!i)throw new Error("structure.xml has no 'Luminaire' root element");return this.parseLuminaire(t,i)}catch(i){throw i instanceof Error?i:new Error("Unknown error occurred!")}}parseLuminaire(e,t){const r=this.getChildNode("Header",t);if(!r)throw new Error("Luminaire/Header element is mandatory");const i=this.parseHeader(r),s=this.getChildNode("GeometryDefinitions",t);if(!s)throw new Error("Luminaire/GeometryDefinitions element is mandatory");const a=this.parseGeometryDefinitions(s),o=this.getChildNode("Structure",t);if(!o)throw new Error("Luminaire/Structure element is mandatory");const l=this.parseStructure(e,o);return{header:i,geometryDefinitions:a,structure:l}}parseHeader(e){const t={name:null,description:null},r=this.getChildNode("Name",e);r&&r.textContent&&(t.name=r.textContent);const i=this.getChildNode("Description",e);return i&&i.textContent&&(t.description=i.textContent),t}parseGeometryDefinitions(e){const t=this.getChildNodes("GeometryFileDefinition",e);if(!t.length)throw new Error("At least one Luminaire/GeometryDefinitions/GeometryDefinition expected");return t.map(r=>this.parseGeometryDefinition(r))}parseGeometryDefinition(e){const t=this.getAttribute("id",e);if(!t)throw new Error("id attribute in Luminaire/GeometryDefinitions/GeometryDefinition is mandatory");const r=this.getAttribute("filename",e);if(!r)throw new Error("filename attribute in Luminaire/GeometryDefinitions/GeometryDefinition is mandatory");const i=this.getAttribute("units",e);if(!i)throw new Error("units attribute in Luminaire/GeometryDefinitions/GeometryDefinition is mandatory");if(!t)throw new Error("id attribute in Luminaire/GeometryDefinitions/GeometryDefinition has invalid value");if(!r)throw new Error("filename attribute in Luminaire/GeometryDefinitions/GeometryDefinition has invalid value");var o=mr[i];if(o==null)throw new Error(`Unknown unit type: ${i}`);return{id:t,filename:r,units:o}}parseGeometries(e,t){const r=this.getChildNodes("Geometry",t);if(!r.length)throw new Error("At least one Geometry element expected");return r.map(i=>this.parseGeometry(e,i))}parseStructure(e,t){return this.parseGeometries(e,t)}parsePartName(e,t){const r=this.getAttribute("partName",t);if(!r||!r.length)throw new Error(`'partName' attribute in '${t.nodeName}' element must not be empty`);if(!r.match(Lr.partNameRe))throw new Error(`'partName' value "${r}" is invalid.'partName' value must start with a letter and contain only letters, digits, dots, hyphens and underscores.`);if(e.knownPartNames.includes(r))throw new Error(`'partName' in element '${t.nodeName}' is not unique!`);return e.knownPartNames.push(r),r}parseCommon(e,t){const r=this.parsePartName(e,t),i=this.getVector("Position",t);if(!i)throw new Error(`'Position' element in '${t.nodeName}' (${r}) element is mandatory`);const s=this.getVector("Rotation",t);if(!s)throw new Error(`'Rotation' element in '${t.nodeName}' (${r}) element is mandatory`);return{partName:r,position:i,rotation:s}}parseJoint(e,t){const r=this.parseCommon(e,t),i=new Array,s=this.getChildNode("Geometries",t);s?i.push(...this.parseGeometries(e,s)):this.logger.warn(`No 'Geometries' element found in 'Joint' (${r.partName}) element!`);const a=this.getChildNode("DefaultRotation",t),o=a!=null?this.getXYZAttributes(a):null,l=this.parseAxisConstraint(t,"XAxis"),c=this.parseAxisConstraint(t,"YAxis"),u=this.parseAxisConstraint(t,"ZAxis");return{type:vi.Joint,...r,geometries:i,defaultRotation:o,xAxis:l,yAxis:c,zAxis:u}}parseJoints(e,t){const r=this.getChildNode("Joints",t);if(!r)return[];const i=this.getChildNodes("Joint",r);if(!i.length)throw new Error("At least one 'Joint' element in 'Joints' element expected");return i.map(s=>this.parseJoint(e,s))}parseLightEmittingObjectShape(e){const t=this.getChildNode("Rectangle",e);if(t){const i=this.getAttribute("sizeX",t);if(i==null)throw new Error("'sizeX' attribute expected in 'Rectangle' element");const s=this.getAttribute("sizeY",t);if(s==null)throw new Error("'sizeY' attribute expected in 'Rectangle' element");const a=Number(i);if(isNaN(a))throw new Error(`'sizeX' attribute in 'Rectangle' element has invalid value: ${i}`);const o=Number(s);if(isNaN(o))throw new Error(`'sizeY' attribute in 'Rectangle' element has invalid value: ${s}`);return{type:lp.Rectangle,sizeX:a,sizeY:o}}const r=this.getChildNode("Circle",e);if(r){const i=this.getAttribute("diameter",r);if(i==null)throw new Error("'diameter' attribute expected in 'Circle' element");const s=Number(i);if(isNaN(s))throw new Error(`'diameter' attribute in 'Circle' element has invalid value: ${i}`);return{type:lp.Circle,diameter:s}}throw new Error("'LightEmittingObject' needs exactly one shape element of type 'Rectangle' or 'Circle'")}parseLuminousHeights(e,t){const r=this.getChildNode("LuminousHeights",e);if(!r)return{c0:0,c90:0,c180:0,c270:0};const i=f=>`'LuminousHeights' element in 'LightEmittingObject' (${t}) must have a '${f}'-attribute with zero or positive numeric value!`,s=this.getAttribute("c0",r);if(!s)throw new Error(i("c0"));const a=this.getAttribute("c90",r);if(!a)throw new Error(i("c90"));const o=this.getAttribute("c180",r);if(!o)throw new Error(i("c180"));const l=this.getAttribute("c270",r);if(!l)throw new Error(i("c270"));const c=Number(s),u=Number(a),h=Number(o),d=Number(l);if(isNaN(c))throw new Error(i("c0"));if(isNaN(u))throw new Error(i("c90"));if(isNaN(h))throw new Error(i("c180"));if(isNaN(d))throw new Error(i("c270"));return{c0:c,c90:u,c180:h,c270:d}}parseLightEmittingObject(e,t){const r=this.parseCommon(e,t);return{type:vi.LightEmittingObject,...r,shape:this.parseLightEmittingObjectShape(t),luminousHeights:this.parseLuminousHeights(t,r.partName)}}parseLightEmittingObjects(e,t){const r=this.getChildNode("LightEmittingObjects",t);if(!r)return[];const i=this.getChildNodes("LightEmittingObject",r);if(!i.length)throw new Error("At least one 'LightEmittingObject' element in 'LightEmittingObjects' element expected");return i.map(s=>this.parseLightEmittingObject(e,s))}parseLightEmittingSurface(e,t){const r=this.parsePartName(e,t),i=new Map,s=new Array;this.getChildNodes("LightEmittingObjectReference",t).forEach(o=>{const l=this.getAttribute("lightEmittingPartName",o);if(!l||!l.length)throw new Error("'LightEmittingObjectReference' node needs a lightEmittingPartName attribute!");const c=this.getAttribute("intensity",o);let u=c!=null?Number(c):1;isNaN(u)?u=1:u<0?u=0:u>1&&(u=1),i.set(l,u)});const a=this.getChildNode("FaceAssignments",t);if(!a)throw new Error("'LightEmittingSurface' node needs a 'FaceAssignments' sub node!");return a.childNodes.forEach(o=>{if(o.nodeName=="FaceAssignment"){const l=this.getAttribute("groupIndex",o),c=l==null?0:Number(l),u=isNaN(c)?0:c,h=this.getAttribute("faceIndex",o);if(!h||!h.length)throw new Error("'FaceAssignment' node needs a 'faceIndex' attribute!");const d=Number(h);if(isNaN(d)||d<0)throw new Error("'faceIndex' attribute in 'FaceAssignment' node must be greater than or equal to zero!");s.push({type:dd.Single,groupIndex:u,faceIndex:d})}else if(o.nodeName=="FaceRangeAssignment"){const l=this.getAttribute("groupIndex",o),c=l==null?0:Number(l),u=isNaN(c)?0:c,h=this.getAttribute("faceIndexBegin",o);if(!h||!h.length)throw new Error("'FaceRangeAssignment' node needs a 'faceIndexBegin' attribute!");const d=Number(h);if(isNaN(d)||d<0)throw new Error("'faceIndexBegin' attribute in 'FaceRangeAssignment' node must be greater than or equal to zero!");const f=this.getAttribute("faceIndexEnd",o);if(!f||!f.length)throw new Error("'FaceRangeAssignment' node needs a 'faceIndexEnd' attribute!");const v=Number(f);if(isNaN(v)||v<0)throw new Error("'faceIndexEnd' attribute in 'FaceRangeAssignment' node must be greater than or equal to zero!");s.push({type:dd.Range,groupIndex:u,faceIndexBegin:d,faceIndexEnd:v})}}),{type:vi.LightEmittingSurface,partName:r,lightEmittingObjectReferences:i,faceAssignments:s}}parseLightEmittingSurfaces(e,t){const r=this.getChildNode("LightEmittingSurfaces",t);if(!r)return[];const i=this.getChildNodes("LightEmittingSurface",r);if(!i.length)throw new Error("At least one 'LightEmittingObject' element in 'LightEmittingObjects' element expected");return i.map(s=>this.parseLightEmittingSurface(e,s))}parseSensor(e,t){return{type:vi.Sensor,...this.parseCommon(e,t)}}parseSensors(e,t){const r=this.getChildNode("SensorObjects",t);if(!r)return[];const i=this.getChildNodes("SensorObject",r);if(!i.length)throw new Error("At least one 'SensorObject' element in 'SensorObjects' element expected");return i.map(s=>this.parseSensor(e,s))}parseElectricalConnector(e){return this.getXYZAttributes(e)}parseElectricalConnectors(e){const t=this.getChildNode("ElectricalConnectors",e);if(!t)return[];const r=this.getChildNodes("ElectricalConnector",t);if(!r.length)throw new Error("At least one 'ElectricalConnector' element in 'ElectricalConnectors' element expected");return r.map(i=>this.parseElectricalConnector(i))}parsePendulumConnector(e){return this.getXYZAttributes(e)}parsePendulumConnectors(e){const t=this.getChildNode("PendulumConnectors",e);if(!t)return[];const r=this.getChildNodes("PendulumConnector",t);if(!r.length)throw new Error("At least one 'PendulumConnector' element in 'PendulumConnectors' element expected");return r.map(i=>this.parsePendulumConnector(i))}parseGeometry(e,t){const{partName:r,position:i,rotation:s}=this.parseCommon(e,t),a=this.getChildNode("GeometryReference",t);if(!a)throw new Error("'GeometryReference' element in 'Geometry' element is mandatory ");const o=this.getAttribute("geometryId",a);if(!o||!o.length)throw new Error("'geometryId' attribute in 'GeometryReference' element is mandatory");const l=this.parseJoints(e,t),c=this.parseLightEmittingObjects(e,t),u=this.parseLightEmittingSurfaces(e,t),h=this.parseSensors(e,t),d=this.parseElectricalConnectors(t),f=this.parsePendulumConnectors(t),v=this.getAttribute("includedInMeasurement",t),g=!v||v=="true";return{type:vi.Geometry,partName:r,position:i,rotation:s,geometryReference:{geometryId:o},lightEmittingObjects:c,lightEmittingSurfaces:u,joints:l,sensors:h,electricalConnectors:d,pendulumConnectors:f,includedInMeasurement:g}}parseAxisConstraint(e,t){const r=this.getChildNode(t,e);if(!r)return null;const i=this.getAttribute("min",r);if(i==null)throw new Error(`'min' attribute in '${e.nodeName}'/'${t}' expected`);const s=Number(i);if(isNaN(s))throw new Error(`'min' attribute in '${e.nodeName}'/'${t}' has invalid value: ${i}`);const a=this.getAttribute("max",r);if(a==null)throw new Error(`'max' attribute in '${e.nodeName}'/'${t}' expected`);const o=Number(a);if(isNaN(o))throw new Error(`'max' attribute in '${e.nodeName}'/'${t}' has invalid value: ${a}`);const l=this.getAttribute("step",r);if(l==null)throw new Error(`'step' attribute in '${e.nodeName}'/'${t}' expected`);const c=Number(l);if(isNaN(c))throw new Error(`'step' attribute in '${e.nodeName}'/'${t}' has invalid value: ${l}`);return{min:s,max:o,step:c}}}class U6{constructor(){P(this,"nextMeshId",1);P(this,"nextPartId",1);P(this,"meshDefinitions",new Array);P(this,"meshDefinitionIdNameMapping",new Map);P(this,"parts",new Array);P(this,"lightEmittingObjectNameIdMappging",new Map);P(this,"lightEmittingSurfaces",new Map)}async convertMeshDefinition(e){var a;const t=vt.getScaledVector(e.size,e.geomDefinition.units),r=new pf;let i=null;try{i=await r.createScreenshot(e.url)}catch(o){const l=(a=o==null?void 0:o.toString())!=null?a:"";He.warn(Xe.ScreenshotAfterMeshFailed,l)}const s={id:this.nextMeshId++,name:e.name,meshUrl:e.url,units:e.geomDefinition.units,material:{libraries:as.addMany(as.getInitialState(),e.mtlLibraries.map(o=>{var c,u;return{name:o,url:(u=(c=e.loadedMaterialLibraries.get(o))==null?void 0:c.url)!=null?u:null,ignored:!1}})),textures:ki.addMany(ki.getInitialState(),e.textureFilenames.map(o=>{var c;return{name:o,url:(c=e.loadedTextures.get(o))!=null?c:null,ignored:!1}}))},groups:Xa.addMany(Xa.getInitialState(),e.groups.map(o=>({id:o.index,name:o.name,faceCount:o.faceCount}))),size:e.size,faceCount:e.faceCount,scaledSize:t,previewUrl:i,ignoredSize:!1};r.dispose(),this.meshDefinitions.push(s),this.meshDefinitionIdNameMapping.set(e.geomDefinition.id,s.id)}convertGeometryObject(e,t=0){const r=this.meshDefinitionIdNameMapping.get(e.geometryReference.geometryId);if(!r)throw new Error("Invalid mesh id: "+e.geometryReference.geometryId);const i=this.nextPartId++,s={type:Y.Geometry,id:i,name:e.partName,parentId:t,position:e.position,rotation:e.rotation,meshId:r,includedInMeasurement:e.includedInMeasurement};this.parts.push(s),e.lightEmittingObjects.forEach(a=>this.convertObject(a,i)),e.lightEmittingSurfaces.forEach(a=>this.convertObject(a,i)),e.joints.forEach(a=>this.convertObject(a,i)),e.sensors.forEach(a=>this.convertObject(a,i)),e.electricalConnectors.forEach(a=>{const o=this.nextPartId++,l={type:Y.ElectricalConnector,id:o,name:e.partName,parentId:i,position:a,rotation:{x:0,y:0,z:0}};this.parts.push(l)}),e.pendulumConnectors.forEach(a=>{const o=this.nextPartId++,l={type:Y.PendulumConnector,id:o,name:e.partName,parentId:i,position:a,rotation:{x:0,y:0,z:0}};this.parts.push(l)})}convertLightEmittingObject(e,t){const r=this.nextPartId++,i={type:Y.LightEmittingObject,id:r,name:e.partName,parentId:t,position:e.position,rotation:e.rotation,shape:e.shape.type==lp.Rectangle?{type:Oe.Rectangle,sizeX:e.shape.sizeX,sizeY:e.shape.sizeY}:{type:Oe.Circle,diameter:e.shape.diameter},luminousHeights:{c0:e.luminousHeights.c0,c90:e.luminousHeights.c90,c180:e.luminousHeights.c180,c270:e.luminousHeights.c270}};this.lightEmittingObjectNameIdMappging.set(e.partName,r),this.parts.push(i)}convertFaceAssignment(e,t){if(e.type==dd.Single)return{type:kn.Single,id:t.nextFaceAssignmentId++,groupId:e.groupIndex,faceId:e.faceIndex};if(e.type==dd.Range)return{type:kn.Range,id:t.nextFaceAssignmentId++,groupId:e.groupIndex,startFaceId:e.faceIndexBegin,endFaceId:e.faceIndexEnd};He.throw(Xe.UnknownLesAssignmentType,`Unknown face assignment type: ${e.type}!`)}convertLightEmittingSurface(e,t){const r=this.nextPartId++,i={nextFaceAssignmentId:1},s=e.faceAssignments.map(l=>this.convertFaceAssignment(l,i)),a=ms.addMany(ms.getInitialState(),s),o={type:Y.LightEmittingSurface,id:r,name:e.partName,parentId:t,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},lightEmittingObjects:Bs.getInitialState(),faceAssignments:a,nextFaceAssignmentId:i.nextFaceAssignmentId};this.lightEmittingSurfaces.set(o,e),this.parts.push(o)}convertJointObject(e,t){var s,a,o,l,c,u,h,d,f,v,g,y,p,m,x,w,b,C,A,F,N,O,H,D;const r=this.nextPartId++,i={type:Y.Joint,id:r,name:e.partName,parentId:t,position:e.position,rotation:e.rotation,xAxis:{isRotatable:!!e.xAxis,default:(a=(s=e.defaultRotation)==null?void 0:s.x)!=null?a:0,min:(l=(o=e.xAxis)==null?void 0:o.min)!=null?l:-90,max:(u=(c=e.xAxis)==null?void 0:c.max)!=null?u:90,step:(d=(h=e.xAxis)==null?void 0:h.step)!=null?d:1},yAxis:{isRotatable:!!e.yAxis,default:(v=(f=e.defaultRotation)==null?void 0:f.y)!=null?v:0,min:(y=(g=e.yAxis)==null?void 0:g.min)!=null?y:-90,max:(m=(p=e.yAxis)==null?void 0:p.max)!=null?m:90,step:(w=(x=e.yAxis)==null?void 0:x.step)!=null?w:1},zAxis:{isRotatable:!!e.zAxis,default:(C=(b=e.defaultRotation)==null?void 0:b.z)!=null?C:0,min:(F=(A=e.zAxis)==null?void 0:A.min)!=null?F:-90,max:(O=(N=e.zAxis)==null?void 0:N.max)!=null?O:90,step:(D=(H=e.zAxis)==null?void 0:H.step)!=null?D:1}};this.parts.push(i),e.geometries.forEach(U=>this.convertGeometryObject(U,r))}convertSensorObject(e,t){const r=this.nextPartId++,i={type:Y.Sensor,id:r,name:e.partName,parentId:t,position:e.position,rotation:e.rotation};this.parts.push(i)}convertObject(e,t=0){e.type==vi.Geometry?this.convertGeometryObject(e,t):e.type==vi.LightEmittingObject?this.convertLightEmittingObject(e,t):e.type==vi.LightEmittingSurface?this.convertLightEmittingSurface(e,t):e.type==vi.Joint?this.convertJointObject(e,t):e.type==vi.Sensor?this.convertSensorObject(e,t):He.throw(Xe.UnknownDtoType,"Unknown dto type:"+e.type.toString())}async convert(e){var s,a;for(const o of e.objs)await this.convertMeshDefinition(o);e.dto.structure.map(o=>this.convertObject(o));const t=this.parts.map(o=>{if(o.type!=Y.LightEmittingSurface)return o;const l=this.lightEmittingSurfaces.get(o);return l&&l.lightEmittingObjectReferences.forEach((c,u)=>{const h=this.lightEmittingObjectNameIdMappging.get(u);h!=null&&(o.lightEmittingObjects=Bs.addOne(o.lightEmittingObjects,{lightEmittingObjectId:h,intensity:c}))}),o});let r=0;for(const o of t)if(o.type==Y.Geometry){const l=this.meshDefinitions.find(c=>c.id==o.meshId);l&&(r+=l.faceCount)}return{name:(s=e.dto.header.name)!=null?s:"",description:(a=e.dto.header.description)!=null?a:"",meshes:rr.addMany(rr.getInitialState(),this.meshDefinitions),parts:gt.addMany(gt.getInitialState(),t),nextPartId:this.parts.length+1,nextMeshId:this.meshDefinitions.length+1,totalFaceCount:r}}}class B6{constructor(){P(this,"textureLoader",new im)}warn(e){He.warn(Xe.ImportWarning,e)}critical(e){He.error(Xe.ImportError,e)}}class Ex{import(e){const t=new B6;me.dispatch(Pe.progressStarted({title:"Loading L3D File ..."})),x2.loadAsync(e).then(async r=>{const i=r.file("structure.xml");if(!i)throw new Error("structure.xml is not available");await i.async("string").then(async s=>new z6(t).parse(s)).then(async s=>{const a=await this.loadObjFiles(t,s.geometryDefinitions,r);return{dto:s,objs:a}}).then(async s=>(await this.updateEngineCacheAsync(t,s),s)).then(async s=>await this.updateStore(s))}).then(()=>{me.dispatch(Pe.progressCleared()),so.trackLoaded()},r=>{const i=r.toString();me.dispatch(Pe.progressUpdated({inProgress:!1,closable:!0,title:"Failed to read L3D file",message:i}));const s="Failed to read L3D file: "+i;t.critical(s)})}async updateEngineCacheAsync(e,t){Xt.clear();const r=new Map;for(var i of t.objs){const a=Xt.addData(i.url,i.group);i.loadedMaterialLibraries.forEach(o=>{a.materialLibraries.push({name:o.name,url:o.url,materialInfos:o.materialInfos,textureFileNames:o.textureFileNames,ignored:!1})}),i.loadedTextures.forEach((o,l)=>{r.set(l,o)});for(var s of i.group.children)s instanceof be&&await this.updateMeshMaterialsAsync(e,s,i,r)}}async updateStore(e){const r=await new U6().convert(e);me.dispatch(Te.loaded(r))}getFileName(e){return e.split("\\").pop().split("/").pop()}async loadMaterialLibraries(e,t,r,i,s){const a=new Map;return await Promise.all(s.map(async o=>{o=this.getFileName(o);const l=`${i}/${o}`,c=r.file(l);if(!c){e.warn(`'${i}/${o}' is not available!`);return}const u=await c.async("blob"),h=await t.readMtlBlobAsync(c.name,u);a.set(o,h)})),a}async loadTextures(e,t,r,i){const s=new Map;return await Promise.all(i.map(async a=>{a=this.getFileName(a);const o=`${r}/${a}`,l=t.file(o);if(!l){e.warn(`'${o}' is not available!`);return}const c=await l.async("blob"),u=URL.createObjectURL(c);s.set(a,u)})),s}async loadObjFiles(e,t,r){const i=new y0,s=new Array;for(let a of t){const o=`${a.id}/${a.filename}`,l=r.file(o);if(!l)throw new Error(`'${o}' not found!`);const c=await l.async("blob"),u=await i.readObjAsync(c).then(async h=>{const d=await this.loadMaterialLibraries(e,i,r,a.id,h.mtlLibraries),f=new Array;d.forEach(g=>f.push(...g.textureFileNames));const v=new Array(...new Set(f));return{...h,name:a.filename,textureFilenames:v,loadedMaterialLibraries:d,size:h.size}}).then(async h=>{const d=await this.loadTextures(e,r,a.id,h.textureFilenames),f=new Map;return h.loadedMaterialLibraries.forEach(v=>{v.materialInfos.forEach((g,y)=>{f.has(y)||f.set(y,g)})}),{...h,loadedTextures:d,materialInfos:f}});s.push({geomDefinition:a,...u})}return s}async convertMaterialAsync(e,t,r,i){if(!r.materialInfos.get(t.name))return e.warn("Not defined material: "+t.name),new Pu(t.name,1,new Ce(.6,.6,.6));const s=r.materialInfos.get(t.name);if(!s)throw new Error("Invalid material: "+t.name);return await y0.convertMaterialAsync(t.name,s,e.textureLoader,i)}async updateMeshMaterialsAsync(e,t,r,i){if(Array.isArray(t.material))for(let s=0;s<t.material.length;s++)t.material[s]=await this.convertMaterialAsync(e,t.material[s],r,i);else t.material=await this.convertMaterialAsync(e,t.material,r,i)}}const H6=new L;class G6 extends Zr.Component{constructor(t){super(t);P(this,"engine");P(this,"renderElement",null);P(this,"storeSubscription",null)}createEngineDropTarget(){return{part:null,mesh:null,worldFacePosition:new L,worldFaceNormal:new L,worldFacePoints:[],worldDropPosition:new L}}canDropModelInScene(t,r){const i=Wl.getPickPosition(t.nativeEvent,this);return!(!this.engine.tryGetScenePosition(i,r)||r.length()>10)}canDropOnPart(t,r){const i=Wl.getPickPosition(t.nativeEvent,this);return this.engine.tryGetPositionOnGeometricObject(i,r)}onDragOver(t){var a,o;const r=me.getState().runtime.dragDrop;if(!r||!t.dataTransfer.types.includes(r.uniqueId))return;let i=null;const s=this.createEngineDropTarget();this.canDropOnPart(t,s)?s.part&&yn.canDropOnPartId(s.part.partId,r)&&(t.preventDefault(),i={id:s.part.partId,type:s.part.partType}):yn.canDropOnPart(null,r)&&this.canDropModelInScene(t,H6)&&t.preventDefault(),((a=r.hoverPart)==null?void 0:a.id)==(i==null?void 0:i.id)&&((o=r.hoverPart)==null?void 0:o.type)==(i==null?void 0:i.type)||me.dispatch(Pe.dragDropHoverPartIdUpdated(i))}dropModel(t,r){var o;if(((o=r.itemData)==null?void 0:o.type)!=kd.Geometry)return;const i=r.itemData.meshId;if(!this.engine.canInsertMesh(i))return;const s=new L,a=this.createEngineDropTarget();if(r.hoverPart&&this.canDropOnPart(t,a)&&a.part){const l=mt.part(r.hoverPart.id)(me.getState());if(yn.canDropOnPart(l,r)){const c=a.part.worldToLocal(new L().copy(a.worldDropPosition));yn.performDrop(l,r,{position:{x:c.x,y:c.y,z:c.z}})}}else this.canDropModelInScene(t,s)&&yn.canDropOnPart(null,r)&&yn.performDrop(null,r,{position:{x:s.x,y:s.y,z:s.z}})}dropModels(t){const r=t.dataTransfer.files;if(r==null||r.length==0)return;let i=null;for(let a=0;a<r.length;a++){const o=r.item(a);if(o!=null&&o.name.toLowerCase().endsWith(".l3d")){i=o;break}}const s=Cu.hasChanges(me.getState());if(i)s?me.dispatch(Pe.requestL3DOverride({newL3D:!0,fileName:i.name,l3DUrl:URL.createObjectURL(i)})):new Ex().import(i);else{const a=new L;if(!this.canDropModelInScene(t,a))return;new pm().ImportObjects(r,new Mx,o=>{me.dispatch(Te.geometryMeshesAndPartsAdded({...o,position:{x:a.x,y:a.y,z:a.z}}))},o=>me.dispatch(Pe.importMessageCreated({message:o})))}}dropLeo(t){const r=this.createEngineDropTarget();!this.canDropOnPart(t,r)||this.engine.createLeoFromDropTarget(r)}dropJoint(t){const r=this.createEngineDropTarget();if(!this.canDropOnPart(t,r)||r.part==null)return;const i=r.part,s=i.worldToLocal(r.worldDropPosition);me.dispatch(Te.jointPartAdded({parentId:i.partId,position:{x:s.x,y:s.y,z:s.z}}))}dropSensor(t){const r=this.createEngineDropTarget();if(!this.canDropOnPart(t,r)||!(r.part instanceof ao)||r.worldFaceNormal==null)return;const i=r.part,s=i.worldToLocal(r.worldDropPosition),a=i.worldToLocal(r.worldFaceNormal).sub(i.worldToLocal(new L(0,0,0))),o=vt.rotationFromNormal(a);me.dispatch(Te.sensorPartAdded({parentId:i.partId,position:{x:s.x,y:s.y,z:s.z},rotation:{x:st.radToDeg(o.x),y:st.radToDeg(o.y),z:st.radToDeg(o.z)}}))}dropPendulumConnector(t){const r=this.createEngineDropTarget();if(!this.canDropOnPart(t,r)||r.part==null)return;const i=r.part,s=i.worldToLocal(r.worldDropPosition);me.dispatch(Te.pendulumConnectorPartAdded({parentId:i.partId,position:{x:s.x,y:s.y,z:s.z}}))}dropElectricalConnector(t){const r=this.createEngineDropTarget();if(!this.canDropOnPart(t,r)||r.part==null)return;const i=r.part,s=i.worldToLocal(r.worldDropPosition);me.dispatch(Te.electricalConnectorPartAdded({parentId:i.partId,position:{x:s.x,y:s.y,z:s.z}}))}onDrop(t){if(t.dataTransfer.files.length!=0){this.dropModels(t);return}const r=me.getState().runtime.dragDrop;!r||r.type==Ns.NewItem&&(!t.dataTransfer.types.includes(r.uniqueId)||(r.itemType==Y.Geometry?this.dropModel(t,r):r.itemType==Y.LightEmittingObject?this.dropLeo(t):r.itemType==Y.Joint?this.dropJoint(t):r.itemType==Y.Sensor?this.dropSensor(t):r.itemType==Y.PendulumConnector?this.dropPendulumConnector(t):r.itemType==Y.ElectricalConnector&&this.dropElectricalConnector(t)))}render(){return E("div",{ref:t=>this.renderElement=t,className:Kz.renderer,onDragOver:t=>this.onDragOver(t),onDrop:t=>this.onDrop(t),tabIndex:-1,onClick:()=>{this.renderElement.focus()}})}componentDidMount(){this.engine=new QU(this),this.storeSubscription=me.subscribe(()=>{En.next(me.getState())}),En.next(me.getState())}componentWillUnmount(){var t,r;(t=this.storeSubscription)==null||t.call(this),(r=this.engine)==null||r.dispose()}get element(){if(this.renderElement==null)throw Error("'renderElement in Renderer is not initialized!'");return this.renderElement}get width(){return this.element.clientWidth}get height(){return this.element.clientHeight}get rect(){const t=this.element.getBoundingClientRect();return{left:t.left,top:t.top,width:this.width,height:this.height}}}const V6="_main_tzoxd_1",j6="_textualButton_tzoxd_27",W6="_bar_tzoxd_37",X6="_separator_tzoxd_93",Y6="_active_tzoxd_111";var dt={main:V6,textualButton:j6,bar:W6,separator:X6,active:Y6};const $6=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("path",{d:"M10.8,7.3l16.9,15.6l-6.2,0.4l-1.4,0.1l0.6,1.3L24,32l-3.8,1.7l-3.2-7.4L16.3,25l-1,1l-4.5,4.3L10.8,7.3 M9.8,5l0,27.6 l6.2-5.9l3.6,8.3l5.7-2.5l-3.6-8.3l8.5-0.5L9.8,5L9.8,5z"}))),Z6=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("polygon",{points:"30.4,14.6 29.6,15.4 33.8,19.5 20.5,19.5 20.5,6.2 24.6,10.4 25.4,9.6 20,4.3 14.6,9.6 15.4,10.4 19.5,6.2  19.5,19.5 6.2,19.5 10.4,15.4 9.6,14.6 4.3,20 9.6,25.4 10.4,24.6 6.2,20.5 19.5,20.5 19.5,33.8 15.4,29.6 14.6,30.4 20,35.7  25.4,30.4 24.6,29.6 20.5,33.8 20.5,20.5 33.8,20.5 29.6,24.6 30.4,25.4 35.7,20  "}))),q6=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("path",{d:"M24.5,28.4l-0.1,1l6,0.5c-2.5,2.3-5.7,3.5-9.1,3.5c-3.6,0-7-1.4-9.5-4s-4-5.9-4-9.5s1.4-7,4-9.5s5.9-4,9.5-4 c3.6,0,7,1.4,9.5,4l0.7-0.7c-2.7-2.7-6.4-4.2-10.3-4.2s-7.5,1.5-10.3,4.2C8.4,12.4,6.9,16,6.9,19.9s1.5,7.5,4.2,10.3 c2.7,2.7,6.4,4.2,10.3,4.2c3.5,0,6.9-1.3,9.5-3.6l-0.5,5.6l1,0.1l0.7-7.5L24.5,28.4z"}))),Q6=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40","xmlns:v":"https://vecta.io/nano",width:"1em",height:"1em",...n},I.exports.createElement("path",{d:"M29.5 15.74v-2.49a9.51 9.51 0 0 0-9.5-9.5 9.51 9.51 0 0 0-9.5 9.5v2.49H6v20h28v-20h-4.5zm-18-2.49a8.51 8.51 0 0 1 8.5-8.5 8.51 8.51 0 0 1 8.5 8.5v2.49h-17v-2.49zM33 34.74H7v-18h26v18zm-15.25-7.46v4.21h4.5v-4.21c1.09-.74 1.75-1.98 1.75-3.29a4 4 0 1 0-8 0c0 1.31.66 2.55 1.75 3.29zM20 20.99a3.01 3.01 0 0 1 3 3c0 1.07-.56 2.04-1.5 2.58l-.25.14v3.77h-2.5v-3.77l-.25-.14c-.94-.55-1.5-1.51-1.5-2.58a3.01 3.01 0 0 1 3-3z"})),J6=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 40 40","xmlns:v":"https://vecta.io/nano",...n},I.exports.createElement("path",{d:"M15.4 16.1L11.2 12h17.6l-4.2 4.1.8.8 5.3-5.4-5.3-5.4-.8.8 4.2 4.1H11.2l4.2-4.1-.8-.8-5.3 5.4 5.3 5.4zM33 6h1v11h-1zM6 6h1v11H6zm23.5 17h-1H25h-1-3.5-1H16h-1-3.5-1H7 6v1 10h1V24h3.5v6h1v-6H15v10h1V24h3.5v6h1v-6H24v10h1V24h3.5v6h1v-6H33v10h1V24v-1h-1z"}));function K6(){const n=Ae(bt.activeTool),e=Ae(bt.canActivateRotateTool),t=Ae(bt.canActivateTranslateTool),r=Ae(bt.fixChildren),i=Je();return fe("div",{className:dt.bar,children:[E("button",{className:n.type==Le.None?dt.active:"",onClick:()=>i(je.toolDataSet({type:Le.None})),title:"Selection Tool",children:E($6,{})}),E("button",{className:n.type==Le.Translate?dt.active:"",disabled:!t,onClick:()=>i(je.toolDataSet({type:Le.Translate})),title:"Move Tool",children:E(Z6,{})}),E("button",{className:n.type==Le.Rotate?dt.active:"",disabled:!e,onClick:()=>i(je.toolDataSet({type:Le.Rotate})),title:"Rotate Tool",children:E(q6,{})}),E("div",{className:dt.separator}),E("button",{className:r?dt.active:"",onClick:()=>i(je.fixChildrenSet(!r)),title:"Lock child positions/rotations in world space",children:E(Q6,{})}),E("div",{className:dt.separator}),E("button",{className:n.type==Le.Measurement?dt.active:"",onClick:()=>i(je.toolDataSet({type:Le.Measurement})),title:"Measurement Tool",children:E(J6,{})})]})}const w2=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("path",{d:"M27,8h9V4H4v4h9v4h4.6c-1.7,1.5-4.1,4-6.2,7.5c-2.3,4-5.9,11-3.7,13.3c1.7,1.7,2.9,2.3,5.1,0.7c2.2-1.6,3.2-0.6,4.4,0.7 c0.8,0.9,1.6,1.8,2.9,1.8c1.3,0,2.1-1,2.9-1.8c1.2-1.3,2.1-2.3,4.1-0.7c2.3,1.7,3.4,0.9,4.9-0.7c1.8-1.9,0.6-7.1-3-13.3 c-2.1-3.5-4.6-6-6.3-7.5H27V8z M5,7V5h30v2h-8H13H5z M22,12.7c1.7,1.4,4.2,3.9,6.3,7.4c3.7,6.3,4.3,10.8,3.1,12.1 c-1.5,1.5-2,1.8-3.6,0.6c-2.8-2.1-4.3-0.5-5.5,0.8c-0.7,0.8-1.3,1.5-2.2,1.5c-0.8,0-1.4-0.7-2.1-1.4c-0.8-0.9-1.7-1.9-3.1-1.9 c-0.7,0-1.6,0.3-2.6,1c-1.7,1.2-2.3,0.9-3.8-0.6c-1-1-0.5-4.7,3.8-12.1c2-3.5,4.4-5.9,6-7.3c0.5-0.5,1.1-0.7,1.8-0.7h0.1 C20.8,12,21.5,12.2,22,12.7z M26,11h-5.8c0,0-0.1,0-0.1,0H14V8h12V11z"}),I.exports.createElement("rect",{x:19,y:15,width:2,height:1}),I.exports.createElement("rect",{x:19,y:18,width:2,height:1}),I.exports.createElement("rect",{x:19,y:21,width:2,height:1}),I.exports.createElement("rect",{x:19,y:24,width:2,height:1}),I.exports.createElement("rect",{x:19,y:27,width:2,height:1}),I.exports.createElement("rect",{x:19,y:30,width:2,height:1})))),_2=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("path",{d:"M26.8,18.8c0.8-3.2-1.2-6.5-4.4-7.3c-0.5-0.1-1-0.2-1.4-0.2c-2.7,0-5.1,1.8-5.8,4.6c-0.8,3.2,1.2,6.5,4.4,7.3 c0.5,0.1,1,0.2,1.4,0.2C23.7,23.4,26.2,21.6,26.8,18.8z M21,22.4c-0.4,0-0.8,0-1.2-0.1c-1.3-0.3-2.4-1.1-3.1-2.3 c-0.7-1.1-0.9-2.5-0.6-3.8c0.6-2.2,2.5-3.8,4.8-3.8c0.4,0,0.8,0,1.2,0.1c1.3,0.3,2.4,1.1,3.1,2.3c0.7,1.1,0.9,2.5,0.6,3.8 C25.3,20.8,23.3,22.4,21,22.4z"}),I.exports.createElement("path",{d:"M29.5,20.3c-0.9,2.7-3,4.8-5.7,5.7l6.5,6.5l5.7-5.7L29.5,20.3z M25.6,26.3c1.8-0.9,3.3-2.4,4.2-4.2l4.7,4.7L30.3,31 L25.6,26.3z"}),I.exports.createElement("path",{d:"M4,13.4v8h8.9c-0.6-1.2-0.9-2.6-0.9-4c0-1.4,0.3-2.8,0.9-4H4z M11.5,20.4H5v-6h6.5c-0.3,1-0.5,2-0.5,3 C11,18.4,11.2,19.4,11.5,20.4z"}),I.exports.createElement("rect",{x:20,y:16.4,width:2,height:2})))),b2=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("path",{d:"M36,28v-3h-6v-2h-7.1c-2.1,0-3.9,1.7-3.9,3.9V29h-7.5C7.9,29,5,26.1,5,22.5S7.9,16,11.5,16h11c4.1,0,7.5-3.4,7.5-7.5V4h-1 v4.5c0,3.6-2.9,6.5-6.5,6.5h-11C7.4,15,4,18.4,4,22.5S7.4,30,11.5,30H19v2.1c0,2.1,1.7,3.9,3.9,3.9H30v-2h6v-3h-6v-3H36z M35,26v1 h-5v-1H35z M35,32v1h-5v-1H35z M29,31v3v1h-6.1c-1.6,0-2.9-1.3-2.9-2.9V30v-1v-2.1c0-1.6,1.3-2.9,2.9-2.9H29v1v3V31z"}))),S2=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("path",{d:"M30,22V8h-1v14H11V8h-1v14H4v10h32V22H30z M35,31H5v-8h30V31z"}))),M2=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("path",{d:"M24,4.3h-8v8h8V4.3z M23,11.3h-6v-6h6V11.3z"}),I.exports.createElement("path",{d:"M31.5,23.7L30.8,23c-6,6-15.6,6-21.6,0l-0.7,0.7c3.2,3.2,7.3,4.8,11.5,4.8S28.3,26.9,31.5,23.7z"}),I.exports.createElement("path",{d:"M26.7,18.7L25.9,18c-3.3,3.3-8.6,3.3-11.9,0l-0.7,0.7c1.8,1.8,4.2,2.8,6.7,2.8S24.8,20.5,26.7,18.7z"}),I.exports.createElement("path",{d:"M35.2,28.9c-8.7,7.7-21.7,7.7-30.4,0l-0.7,0.7c4.5,4,10.2,6.1,15.8,6.1c5.7,0,11.3-2,15.8-6.1L35.2,28.9z"})))),eB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("polygon",{points:"14,33 7,33 7,26 6,26 6,34 14,34 14,37 19,33.5 14,30  "}),I.exports.createElement("path",{d:"M29,20c-1.4-3.6-4.9-6.1-9-6.1s-7.6,2.5-9,6.1c1.4,3.6,4.9,6.1,9,6.1S27.6,23.6,29,20z M20,25.1c-3.5,0-6.5-2-7.9-5.1 c1.4-3.1,4.5-5.1,7.9-5.1s6.5,2,7.9,5.1C26.5,23.1,23.5,25.1,20,25.1z"}),I.exports.createElement("polygon",{points:"7,7 14,7 14,6 6,6 6,14 7,14  "}),I.exports.createElement("polygon",{points:"26,6 26,3 21,6.5 26,10 26,7 33,7 33,14 34,14 34,6  "}),I.exports.createElement("polygon",{points:"33,33 26,33 26,34 34,34 34,26 33,26  "}),I.exports.createElement("path",{d:"M20,17c-1.7,0-3,1.3-3,3s1.3,3,3,3s3-1.3,3-3S21.7,17,20,17z M20,22c-1.1,0-2-0.9-2-2c0-1.1,0.9-2,2-2s2,0.9,2,2 C22,21.1,21.1,22,20,22z"})))),tB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40","xmlns:v":"https://vecta.io/nano",width:"1em",height:"1em",...n},I.exports.createElement("path",{d:"M12.29 4L4 12.29V36h23.71L36 27.71V4H12.29zM35 27.29l-7 7V12.71l7-7v21.58zM5 34.58V13h7v.6h1V13h14v14h-.61v1H27v7H5.41L5 34.59zM34.29 5l-7 7H5.71l7-7H34.3zM14.91 27h.96v1h-.96zm2.87 0h.96v1h-.96zm11.48 0h.96v1h-.96zm2.87 0h.96v1h-.96zm-8.61 0h.96v1h-.96zm-2.87 0h.96v1h-.96zM12 27h1v1h-1zm0-2.87h1v.96h-1zm0-2.87h1v.96h-1zm0-2.87h1v.96h-1zm0-8.62h1v.96h-1zm0 5.74h1v.96h-1zm0-8.61h1v.96h-1zM5.987 33.313l.707-.707.707.707-.707.707zm3.67-3.684l.707-.707.707.707-.707.707zm-1.83 1.842l.707-.707.707.707-.707.707z"})),nB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40","xmlns:v":"https://vecta.io/nano",width:"1em",height:"1em",...n},I.exports.createElement("path",{fill:"#9d9d9c",d:"M4.21 35.08L12.26 27h23.4l-8.44 8.52H5.05l-.84-.44z"}),I.exports.createElement("path",{d:"M26.39 27h.96v1h-.96zM12 12.64h1v.96h-1zM20.65 27h.96v1h-.96zm-2.87 0h.96v1h-.96zm-2.87 0h.96v1h-.96zm8.61 0h.96v1h-.96zM12 27h1v1h-1zm-2.343 2.629l.707-.707.707.707-.707.707zm-3.67 3.684l.707-.707.707.707-.707.707zm1.84-1.842l.707-.707.707.707-.707.707zM12 24.13h1v.96h-1zm0-5.74h1v.96h-1zm0 2.87h1v.96h-1zm0-5.75h1v.96h-1zM32.13 27h.96v1h-.96zm-2.87 0h.96v1h-.96zM12 6.9h1v.96h-1zm0 2.87h1v.96h-1z"}),I.exports.createElement("path",{fill:"#f69000",opacity:.65,d:"M4.5 12.5h23v23h-23z"}),I.exports.createElement("path",{d:"M12.29 4L4 12.29V36h23.71L36 27.71V4H12.29zM35 27.29l-7 7V12.71l7-7v21.58zM5 34.58V13h22v22H5.41L5 34.59zM34.29 5l-7 7H5.71l7-7H34.3z"})),rB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40","xmlns:v":"https://vecta.io/nano",width:"1em",height:"1em",...n},I.exports.createElement("path",{fill:"#9d9d9c",d:"M4.21 35.08L12.26 27h23.4l-8.44 8.52H5.05l-.84-.44z"}),I.exports.createElement("path",{fill:"#f69000",opacity:.65,d:"M35.31 27.97H11.98v-23l.85-.47h22.83v23l-.35.47z"}),I.exports.createElement("path",{d:"M17.78 27h.96v1h-.96zm2.87 0h.96v1h-.96zm-5.74 0h.96v1h-.96zm17.22 0h.96v1h-.96zm-8.61 0h.96v1h-.96zm5.74 0h.96v1h-.96zM12 27h1v1h-1zm0-2.87h1v.96h-1zm0-14.36h1v.96h-1zm0 5.74h1v.96h-1zm0 5.75h1v.96h-1zM12 6.9h1v.96h-1zm0 11.49h1v.96h-1zM5.987 33.313l.707-.707.707.707-.707.707zm1.84-1.842l.707-.707.707.707-.707.707zm1.83-1.842l.707-.707.707.707-.707.707zM12.29 4L4 12.29V36h23.71L36 27.71V4H12.29zM35 27.29l-7 7V12.71l7-7v21.58zM5 34.58V13h7v.6h1V13h14v14h-.61v1H27v7H5.41L5 34.59zM34.29 5l-7 7H5.71l7-7H34.3z"})),iB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40","xmlns:v":"https://vecta.io/nano",width:"1em",height:"1em",...n},I.exports.createElement("path",{fill:"#9d9d9c",d:"M4.21 35.08L12.26 27h23.4l-8.44 8.52H5.05l-.84-.44z"}),I.exports.createElement("path",{d:"M35 27h.5v1H35zm-1.91 1h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zM12 27h1v1h-1zm1-1.92h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1V6.9h1v.96zM12 4.5h1V5h-1zM4.85 35.85l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71z"}),I.exports.createElement("path",{fill:"#f69000",opacity:.65,d:"M27.5 12.67l8-8.17v23l-7.79 8-.21-22.83z"}),I.exports.createElement("path",{d:"M27.148 12.145l7.997-7.997.707.707-7.997 7.997z"}),I.exports.createElement("path",{d:"M28 35.5h-1V13H4.5v-1H28v23.5z"}),I.exports.createElement("path",{d:"M27.71 36H4V12.29L12.29 4H36v23.71L27.71 36zM5 35h22.29L35 27.29V5H12.71L5 12.71V35z"})),sB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40","xmlns:v":"https://vecta.io/nano",width:"1em",height:"1em",...n},I.exports.createElement("path",{fill:"#9d9d9c",d:"M4.21 35.08L12.26 27h23.4l-8.44 8.52H5.05l-.84-.44z"}),I.exports.createElement("path",{fill:"#f69000",opacity:.65,d:"M4.5 12.67l8-8.17.5.03v23.22l-7.78 7.74-.64.13-.08-22.95z"}),I.exports.createElement("path",{d:"M35 27h.5v1H35zm-1.91 1h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zM12 27h1v1h-1zm1-1.92h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1V6.9h1v.96zM12 4.5h1V5h-1zM4.85 35.85l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm16.778-18.185l7.997-7.997.707.707-7.997 7.997z"}),I.exports.createElement("path",{d:"M28 35.5h-1V13H4.5v-1H28v23.5z"}),I.exports.createElement("path",{d:"M27.71 36H4V12.29L12.29 4H36v23.71L27.71 36zM5 35h22.29L35 27.29V5H12.71L5 12.71V35z"})),aB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40","xmlns:v":"https://vecta.io/nano",width:"1em",height:"1em",...n},I.exports.createElement("path",{fill:"#9d9d9c",d:"M4.21 35.08L12.26 27h23.4l-8.44 8.52H5.05l-.84-.44z"}),I.exports.createElement("path",{d:"M35 27h.5v1H35zm-1.91 1h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zM12 27h1v1h-1zm1-1.92h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1V6.9h1v.96zM12 4.5h1V5h-1z"}),I.exports.createElement("path",{fill:"#f69000",opacity:.65,d:"M4.43 12.28l8.06-8.08h23.39l-8.44 8.53H5.27l-.84-.45z"}),I.exports.createElement("path",{d:"M4.85 35.85l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71z"}),I.exports.createElement("path",{fill:"none",stroke:"#000",strokeMiterlimit:10,d:"M35.5 4.5l-8 8"}),I.exports.createElement("path",{d:"M28 35.5h-1V13H4.5v-1H28v23.5z"}),I.exports.createElement("path",{d:"M27.71 36H4V12.29L12.29 4H36v23.71L27.71 36zM5 35h22.29L35 27.29V5H12.71L5 12.71V35z"})),oB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 40","xmlns:v":"https://vecta.io/nano",width:"1em",height:"1em",...n},I.exports.createElement("path",{fill:"#c6c6c6",d:"M4.21 35.08L12.26 27h23.4l-8.44 8.52H5.05l-.84-.44z"}),I.exports.createElement("path",{fill:"#9d9d9c",d:"M4.21 35.08L12.26 27h23.4l-8.44 8.52H5.05l-.84-.44z"}),I.exports.createElement("path",{fill:"#f69000",opacity:.65,d:"M4.21 35.08L12.26 27h23.4l-8.44 8.52H5.05l-.84-.44z"}),I.exports.createElement("path",{d:"M35 27h.5v1H35zm-1.91 1h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zm-2.87 0h-.96v-1h.96v1zM12 27h1v1h-1zm1-1.92h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1v-.96h1v.96zm0-2.87h-1V6.9h1v.96zM12 4.5h1V5h-1zM4.85 35.85l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm1.84-1.84l-.71-.71.71-.71.71.71-.71.71zm16.778-18.185l7.997-7.997.707.707-7.997 7.997z"}),I.exports.createElement("path",{d:"M28 35.5h-1V13H4.5v-1H28v23.5z"}),I.exports.createElement("path",{d:"M27.71 36H4V12.29L12.29 4H36v23.71L27.71 36zM5 35h22.29L35 27.29V5H12.71L5 12.71V35z"})),lB=n=>I.exports.createElement("svg",{viewBox:"0 0 40 40",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",...n},I.exports.createElement("g",{transform:"matrix(.84896 0 0 .84896 -2.5272 8.7729)"},I.exports.createElement("path",{d:"m12.29 4-8.29 8.29v23.71h23.71l8.29-8.29v-23.71zm22.71 23.29-7 7v-21.58l7-7zm-30 7.29v-21.58h22v22h-21.59l-0.41-0.41zm29.29-29.58-7 7h-21.58l7-7h21.59z"}),I.exports.createElement("path",{d:"m4.68 35.33 7.8284-7.8284v-22.992",fill:"none",stroke:"#000",strokeWidth:"1px"}),I.exports.createElement("path",{d:"m12.508 27.501 22.992-0.03404",fill:"none",stroke:"#000",strokeWidth:"1px"})),I.exports.createElement("g",{transform:"matrix(.84896 0 0 .84896 8.4071 -2.5116)"},I.exports.createElement("path",{d:"m12.29 4-8.29 8.29v23.71h23.71l8.29-8.29v-23.71zm22.71 23.29-7 7v-21.58l7-7zm-30 7.29v-21.58h22v22h-21.59l-0.41-0.41zm29.29-29.58-7 7h-21.58l7-7h21.59z"}),I.exports.createElement("path",{d:"m4.68 35.33 7.8284-7.8284v-22.992",fill:"none",stroke:"#000",strokeWidth:"1px"}),I.exports.createElement("path",{d:"m12.508 27.501 22.992-0.03404",fill:"none",stroke:"#000",strokeWidth:"1px"})));function cB(){const n=Je(),e=Ae(pt.view.areJointObjectsVisible),t=Ae(pt.view.areLightEmittingObjectsVisible),r=Ae(pt.view.areSensorObjectsVisible),i=Ae(pt.view.areElectricalConnectorObjectsVisible),s=Ae(pt.view.arePendulumConnectorObjectsVisible),a=Ae(pt.view.cameraType),o=Ae(pt.view.xzFlipped),l=Ae(pt.view.yzFlipped),c=Ae(pt.view.xyFlipped),u=Ae(pt.view.wireframe2d),h=Ae(pt.view.wireframe3d),d=a==$e.Pers?h:u;function f(){n(Pe.lightEmittingObjectVisibilitySet(!t))}function v(){n(Pe.jointObjectVisibilitySet(!e))}function g(){n(Pe.sensorObjectVisibilitySet(!r))}function y(){n(Pe.electricalConnectorObjectVisibilitySet(!i))}function p(){n(Pe.pendulumConnectorObjectVisibilitySet(!s))}const m=()=>{Xt.resetCamera(),n(Pe.objectsVisibilityReset())},x=()=>{a==$e.Pers?n(Pe.wireframe3dChanged(!d)):n(Pe.wireframe2dChanged(!d))};return fe(Ve,{children:[fe("div",{className:dt.bar,children:[E("button",{className:a==$e.Pers?dt.active:"",onClick:()=>n(Pe.cameraTypeChanged({type:$e.Pers})),children:E(tB,{})}),E("button",{className:a==$e.XZ&&!o?dt.active:"",onClick:()=>n(Pe.cameraTypeChanged({type:$e.XZ,xzFlipped:!1})),children:E(nB,{})}),E("button",{className:a==$e.XZ&&o?dt.active:"",onClick:()=>n(Pe.cameraTypeChanged({type:$e.XZ,xzFlipped:!0})),children:E(rB,{})}),E("button",{className:a==$e.YZ&&!l?dt.active:"",onClick:()=>n(Pe.cameraTypeChanged({type:$e.YZ,yzFlipped:!1})),children:E(iB,{})}),E("button",{className:a==$e.YZ&&l?dt.active:"",onClick:()=>n(Pe.cameraTypeChanged({type:$e.YZ,yzFlipped:!0})),children:E(sB,{})}),E("button",{className:a==$e.XY&&!c?dt.active:"",onClick:()=>n(Pe.cameraTypeChanged({type:$e.XY,xyFlipped:!1})),children:E(aB,{})}),E("button",{className:a==$e.XY&&c?dt.active:"",onClick:()=>n(Pe.cameraTypeChanged({type:$e.XY,xyFlipped:!0})),children:E(oB,{})})]}),fe("div",{className:dt.bar,children:[E("button",{title:"Toggle the visibility of light emitting objects",className:t?"":dt.active,onClick:f,children:E(w2,{})}),E("button",{title:"Toggle the visibility of joints",className:e?"":dt.active,onClick:v,children:E(_2,{})}),E("button",{title:"Toggle the visibility of sensors",className:r?"":dt.active,onClick:g,children:E(M2,{})}),E("button",{title:"Toggle the visibility of electrical connectors",className:i?"":dt.active,onClick:y,children:E(b2,{})}),E("button",{title:"Toggle the visibility of pendulum connectors",className:s?"":dt.active,onClick:p,children:E(S2,{})}),E("div",{className:dt.separator}),E("button",{title:"Toggle wireframe mode",className:d?dt.active:"",onClick:x,children:E(lB,{})}),E("div",{className:dt.separator}),E("button",{onClick:m,title:"Reset view",children:E(eB,{})})]})]})}function uB(n,e={}){e.filter=e.filter||(()=>!0);function t(){return o()||h()||u()||c()}function r(){return v(/\s*/),o(!0)||u()||l()||a(!1)}function i(){const p=s(),m=[];let x,w=r();for(;w;){if(w.node.type==="Element"){if(x)throw new Error("Found multiple root nodes");x=w.node}w.excluded||m.push(w.node),w=r()}if(!x)throw new Error("Failed to parse XML");return{declaration:p?p.node:null,root:x,children:m}}function s(){return a(!0)}function a(p){const m=v(p?/^<\?(xml)\s*/:/^<\?([\w-:.]+)\s*/);if(!m)return;const x={name:m[1],type:"ProcessingInstruction",attributes:{}};for(;!(g()||y("?>"));){const w=d();if(!w)return x;x.attributes[w.name]=w.value}return v(/\?>/),{excluded:p?!1:e.filter(x)===!1,node:x}}function o(p){const m=v(/^<([\w-:.]+)\s*/);if(!m)return;const x={type:"Element",name:m[1],attributes:{},children:[]};for(;!(g()||y(">")||y("?>")||y("/>"));){const b=d();if(!b)return x;x.attributes[b.name]=b.value}const w=p?!1:e.filter(x)===!1;if(v(/^\s*\/>/))return x.children=null,{excluded:w,node:x};if(v(/\??>/),!w){let b=t();for(;b;)b.excluded||x.children.push(b.node),b=t()}return v(/^<\/[\w-:.]+>/),{excluded:w,node:x}}function l(){const p=v(/^<!DOCTYPE\s+[^>]*>/);if(p){const m={type:"DocumentType",content:p[0]};return{excluded:e.filter(m)===!1,node:m}}}function c(){if(n.startsWith("<![CDATA[")){const p=n.indexOf("]]>");if(p>-1){const m=p+3,x={type:"CDATA",content:n.substring(0,m)};return n=n.slice(m),{excluded:e.filter(x)===!1,node:x}}}}function u(){const p=v(/^<!--[\s\S]*?-->/);if(p){const m={type:"Comment",content:p[0]};return{excluded:e.filter(m)===!1,node:m}}}function h(){const p=v(/^([^<]+)/);if(p){const m={type:"Text",content:p[1]};return{excluded:e.filter(m)===!1,node:m}}}function d(){const p=v(/([\w-:.]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);if(!!p)return{name:p[1],value:f(p[2])}}function f(p){return p.replace(/^['"]|['"]$/g,"")}function v(p){const m=n.match(p);if(!!m)return n=n.slice(m[0].length),m}function g(){return n.length===0}function y(p){return n.indexOf(p)===0}return n=n.trim(),i()}var dB=uB;function cp(n){if(!n.options.indentation&&!n.options.lineSeparator)return;n.content+=n.options.lineSeparator;let e;for(e=0;e<n.level;e++)n.content+=n.options.indentation}function cs(n,e){n.content+=e}function E2(n,e,t){if(typeof n.content=="string")hB(n,e,t);else if(n.type==="Element")fB(n,e,t);else if(n.type==="ProcessingInstruction")T2(n,e);else throw new Error("Unknown node type: "+n.type)}function hB(n,e,t){t||(n.content=n.content.trim()),n.content.length>0&&(!t&&e.content.length>0&&cp(e),cs(e,n.content))}function fB(n,e,t){if(!t&&e.content.length>0&&cp(e),cs(e,"<"+n.name),A2(e,n.attributes),n.children===null){const r=e.options.whiteSpaceAtEndOfSelfclosingTag?" />":"/>";cs(e,r)}else if(n.children.length===0)cs(e,"></"+n.name+">");else{cs(e,">"),e.level++;let r=n.attributes["xml:space"]==="preserve";if(!r&&e.options.collapseContent){let i=!1,s=!1,a=!1;n.children.forEach(function(o,l){o.type==="Text"?(o.content.includes(`
`)?(s=!0,o.content=o.content.trim()):(l===0||l===n.children.length-1)&&o.content.trim().length===0&&(o.content=""),o.content.length>0&&(i=!0)):o.type==="CDATA"?i=!0:a=!0}),i&&(!a||!s)&&(r=!0)}n.children.forEach(function(i){E2(i,e,t||r,e.options)}),e.level--,!t&&!r&&cp(e),cs(e,"</"+n.name+">")}}function A2(n,e){Object.keys(e).forEach(function(t){const r=e[t].replace(/"/g,"&quot;");cs(n," "+t+'="'+r+'"')})}function T2(n,e){e.content.length>0&&cp(e),cs(e,"<?"+n.name),A2(e,n.attributes),cs(e,"?>")}function pB(n,e={}){e.indentation="indentation"in e?e.indentation:"    ",e.collapseContent=e.collapseContent===!0,e.lineSeparator="lineSeparator"in e?e.lineSeparator:`\r
`,e.whiteSpaceAtEndOfSelfclosingTag=!!e.whiteSpaceAtEndOfSelfclosingTag;const r=dB(n,{filter:e.filter}),i={content:"",level:0,options:e};return r.declaration&&T2(r.declaration,i),r.children.forEach(function(s){E2(s,i,!1)}),i.content.replace(/\r\n/g,`
`).replace(/\n/g,e.lineSeparator)}var mB=pB,C2={exports:{}};(function(n,e){(function(t,r){r()})(os,function(){function t(c,u){return typeof u=="undefined"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c}function r(c,u,h){var d=new XMLHttpRequest;d.open("GET",c),d.responseType="blob",d.onload=function(){l(d.response,u,h)},d.onerror=function(){console.error("could not download file")},d.send()}function i(c){var u=new XMLHttpRequest;u.open("HEAD",c,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function s(c){try{c.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),c.dispatchEvent(u)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof os=="object"&&os.global===os?os:void 0,o=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(c,u,h){var d=a.URL||a.webkitURL,f=document.createElement("a");u=u||c.name||"download",f.download=u,f.rel="noopener",typeof c=="string"?(f.href=c,f.origin===location.origin?s(f):i(f.href)?r(c,u,h):s(f,f.target="_blank")):(f.href=d.createObjectURL(c),setTimeout(function(){d.revokeObjectURL(f.href)},4e4),setTimeout(function(){s(f)},0))}:"msSaveOrOpenBlob"in navigator?function(c,u,h){if(u=u||c.name||"download",typeof c!="string")navigator.msSaveOrOpenBlob(t(c,h),u);else if(i(c))r(c,u,h);else{var d=document.createElement("a");d.href=c,d.target="_blank",setTimeout(function(){s(d)})}}:function(c,u,h,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof c=="string")return r(c,u,h);var f=c.type==="application/octet-stream",v=/constructor/i.test(a.HTMLElement)||a.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||f&&v||o)&&typeof FileReader!="undefined"){var y=new FileReader;y.onloadend=function(){var x=y.result;x=g?x:x.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=x:location=x,d=null},y.readAsDataURL(c)}else{var p=a.URL||a.webkitURL,m=p.createObjectURL(c);d?d.location=m:location.href=m,d=null,setTimeout(function(){p.revokeObjectURL(m)},4e4)}});a.saveAs=l.saveAs=l,n.exports=l})})(C2);class gB{constructor(e){P(this,"exportedGeometryDefinitions",new Array);P(this,"exportedMeshes",new Map);P(this,"partGeometryDefinitionMapping",new Map);P(this,"nextGeometryId",1);this.zip=e}}class vB{constructor(e,t){this.state=e,this.progress=t}canExport(){return mt.hasLightEmittingParts(this.state)}async export(){const e=new x2,t=new gB(e);await this.createModelFiles(t),this.createStructureXml(t),this.progress.start("Exporting L3D ..."),e.generateAsync({type:"blob",compression:"DEFLATE"}).then(r=>{const i=this.state.luminaire.name.trim(),s=(i||"luminaire")+".l3d";C2.exports.saveAs(r,s),this.progress.clear(),so.trackSaved()},r=>{const i=r.toString(),s="Failed to export L3D: "+i;this.progress.update({closable:!0,inProgress:!1,message:s})})}async createModelFiles(e){const t=at.selectAll(this.state.luminaire.parts);for(const r of t){if(r.type!=Y.Geometry)continue;e.exportedMeshes.has(r.meshId)||await this.createModelFileFromMesh(e,r.meshId);const i=e.exportedMeshes.get(r.meshId);if(i==null)throw new Error(`No geometry name for mesh id (${r.meshId}) available!`);e.partGeometryDefinitionMapping.set(r.id,i)}}async createModelFileFromMesh(e,t){const r=qt.selectAll(this.state.luminaire.meshes).find(o=>o.id==t);if(r==null)return;const i="geom_"+e.nextGeometryId++,s=e.zip.folder(i);if(s==null)throw new Error(`Failed to create folder (${i}) in zip!`);const a=await(await fetch(r.meshUrl)).blob();s.file(r.name,a);{const o=sd.selectAll(r.material.libraries);for(let l=0;l<o.length;l++){const c=o[l];if(!c.url)continue;const u=await(await fetch(c.url)).blob();s.file(c.name,u)}}{const o=ad.selectAll(r.material.textures);for(let l=0;l<o.length;l++){const c=o[l];if(!c.url)continue;const u=await(await fetch(c.url)).blob();s.file(c.name,u)}}e.exportedMeshes.set(r.id,i),e.exportedGeometryDefinitions.push({id:i,filename:r.name,units:r.units})}createStructureXml(e){const t=this.writeLuminaireXml(e);e.zip.file("structure.xml",t)}writeLuminaireXml(e){const t=document.implementation.createDocument("","",null),r=t.createElement("Luminaire");r.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","noNamespaceSchemaLocation","https://gldf.io/xsd/l3d/0.11.0/l3d.xsd"),this.writeHeader(t,r),this.writeGeometryDefinitions(e,t,r),this.writeStructure(e,t,r);const s=new XMLSerializer().serializeToString(r);return mB(s,{collapseContent:!0})}writeHeader(e,t){const r=e.createElement("Header"),i=e.createElement("FormatVersion");i.setAttribute("major","0"),i.setAttribute("minor","11"),r.appendChild(i);const s=this.state.luminaire,a=e.createElement("Name");if(a.textContent=s.name,r.appendChild(a),s.description.length){const c=e.createElement("Description");c.textContent=s.description,r.appendChild(c)}const o=e.createElement("CreatedWithApplication");o.textContent="Online L3D-Editor",r.appendChild(o);const l=e.createElement("CreationTimeCode");l.textContent=new Date().toISOString(),r.appendChild(l),t.appendChild(r)}writeGeometryDefinitions(e,t,r){const i=t.createElement("GeometryDefinitions");e.exportedGeometryDefinitions.forEach(a=>{const o=t.createElement("GeometryFileDefinition");o.setAttribute("id",a.id),o.setAttribute("filename",a.filename),o.setAttribute("units",mr[a.units].toString()),i.appendChild(o)}),r.appendChild(i)}writeStructure(e,t,r){const i=t.createElement("Structure");at.selectAll(this.state.luminaire.parts).filter(a=>a.type==Y.Geometry&&a.parentId==0).forEach(a=>this.writeGeometryPart(e,t,i,a)),r.appendChild(i)}writeCommonPartData(e,t,r){t.setAttribute("partName",r.name);const i=e.createElement("Position");i.setAttribute("x",r.position.x.toString()),i.setAttribute("y",r.position.y.toString()),i.setAttribute("z",r.position.z.toString()),t.appendChild(i);const s=e.createElement("Rotation");s.setAttribute("x",r.rotation.x.toString()),s.setAttribute("y",r.rotation.y.toString()),s.setAttribute("z",r.rotation.z.toString()),t.appendChild(s)}writeGeometryPart(e,t,r,i){const s=t.createElement("Geometry");this.writeCommonPartData(t,s,i),this.writeGeometryReference(e,t,s,i),this.writeJointParts(e,t,s,i),this.writeLeoParts(t,s,i),this.writeSensorParts(t,s,i),this.writeLightEmittingSurfaceParts(t,s,i),this.writeElectricalConnectorParts(t,s,i),this.writePendulumConnectorParts(t,s,i),i.includedInMeasurement||s.setAttribute("includedInMeasurement","false"),r.appendChild(s)}writeGeometryReference(e,t,r,i){const s=t.createElement("GeometryReference"),a=e.partGeometryDefinitionMapping.get(i.id);a!=null&&(s.setAttribute("geometryId",a),r.appendChild(s))}writeGeometryParts(e,t,r,i){const s=at.selectAll(this.state.luminaire.parts).filter(a=>a.type==Y.Geometry&&a.parentId==i.id);if(s.length){const a=t.createElement("Geometries");s.forEach(o=>this.writeGeometryPart(e,t,a,o)),r.appendChild(a)}}writeJointAxisConstraints(e,t,r){const i=(a,o)=>{a.setAttribute("min",o.min.toString()),a.setAttribute("max",o.max.toString()),a.setAttribute("step",o.step.toString())};if(r.xAxis.isRotatable){const a=e.createElement("XAxis");i(a,r.xAxis),t.appendChild(a)}if(r.yAxis.isRotatable){const a=e.createElement("YAxis");i(a,r.yAxis),t.appendChild(a)}if(r.zAxis.isRotatable){const a=e.createElement("ZAxis");i(a,r.zAxis),t.appendChild(a)}const s=e.createElement("DefaultRotation");s.setAttribute("x",r.xAxis.default.toString()),s.setAttribute("y",r.yAxis.default.toString()),s.setAttribute("z",r.zAxis.default.toString()),t.appendChild(s)}writeJointPart(e,t,r,i){const s=t.createElement("Joint");this.writeCommonPartData(t,s,i),this.writeJointAxisConstraints(t,s,i),this.writeGeometryParts(e,t,s,i),r.appendChild(s)}writeJointParts(e,t,r,i){const s=at.selectAll(this.state.luminaire.parts).filter(a=>a.type==Y.Joint&&a.parentId==i.id);if(s.length){const a=t.createElement("Joints");s.forEach(o=>this.writeJointPart(e,t,a,o)),r.appendChild(a)}}writeLeoParts(e,t,r){const i=at.selectAll(this.state.luminaire.parts).filter(s=>s.type==Y.LightEmittingObject&&s.parentId==r.id);if(i.length){const s=e.createElement("LightEmittingObjects");i.forEach(a=>this.writeLeoPart(e,s,a)),t.appendChild(s)}}writeSensorParts(e,t,r){const i=at.selectAll(this.state.luminaire.parts).filter(s=>s.type==Y.Sensor&&s.parentId==r.id);if(i.length){const s=e.createElement("SensorObjects");i.forEach(a=>this.writeSensorPart(e,s,a)),t.appendChild(s)}}writeElectricalConnectorParts(e,t,r){const i=at.selectAll(this.state.luminaire.parts).filter(s=>s.type==Y.ElectricalConnector&&s.parentId==r.id);if(i.length){const s=e.createElement("ElectricalConnectors");i.forEach(a=>this.writeElectricalConnectorPart(e,s,a)),t.appendChild(s)}}writePendulumConnectorParts(e,t,r){const i=at.selectAll(this.state.luminaire.parts).filter(s=>s.type==Y.PendulumConnector&&s.parentId==r.id);if(i.length){const s=e.createElement("PendulumConnectors");i.forEach(a=>this.writePendulumConnectorPart(e,s,a)),t.appendChild(s)}}writeLightEmittingSurfaceParts(e,t,r){const i=at.selectAll(this.state.luminaire.parts).filter(s=>s.type==Y.LightEmittingSurface&&s.parentId==r.id).map(s=>s);if(i.length){const s=e.createElement("LightEmittingSurfaces");i.forEach(a=>this.writeLightEmittingSurfacePart(e,s,a)),t.appendChild(s)}}writeLeoPart(e,t,r){const i=e.createElement("LightEmittingObject");switch(this.writeCommonPartData(e,i,r),r.shape.type){case Oe.Rectangle:const s=e.createElement("Rectangle");s.setAttribute("sizeX",r.shape.sizeX.toString()),s.setAttribute("sizeY",r.shape.sizeY.toString()),i.appendChild(s);break;case Oe.Circle:const a=e.createElement("Circle");a.setAttribute("diameter",r.shape.diameter.toString()),i.appendChild(a);break;default:throw new Error("Unknown light emitting shape")}this.writeLuminousHeights(e,i,r.luminousHeights),t.appendChild(i)}writeLuminousHeights(e,t,r){if(r.c0<=0&&r.c90<=0&&r.c180<=0&&r.c270<=0)return;const i=e.createElement("LuminousHeights");i.setAttribute("c0",r.c0.toString()),i.setAttribute("c90",r.c90.toString()),i.setAttribute("c180",r.c180.toString()),i.setAttribute("c270",r.c270.toString()),t.appendChild(i)}writeSensorPart(e,t,r){const i=e.createElement("SensorObject");this.writeCommonPartData(e,i,r),t.appendChild(i)}writePendulumConnectorPart(e,t,r){const i=e.createElement("PendulumConnector");i.setAttribute("x",r.position.x.toString()),i.setAttribute("y",r.position.y.toString()),i.setAttribute("z",r.position.z.toString()),t.appendChild(i)}writeElectricalConnectorPart(e,t,r){const i=e.createElement("ElectricalConnector");i.setAttribute("x",r.position.x.toString()),i.setAttribute("y",r.position.y.toString()),i.setAttribute("z",r.position.z.toString()),t.appendChild(i)}writeLightEmittingSurfacePart(e,t,r){const i=e.createElement("LightEmittingSurface");i.setAttribute("partName",r.name),id.selectAll(r.lightEmittingObjects).forEach(a=>{const o=mt.lightEmittingPart(a.lightEmittingObjectId)(me.getState());if(!o){He.warn(Xe.NoLightEmittingPartWithIdAvailable,`No LightEmittingPart with id (${a.lightEmittingObjectId}) available!`);return}const l=e.createElement("LightEmittingObjectReference");l.setAttribute("lightEmittingPartName",o.name),a.intensity>=0&&a.intensity<=1&&l.setAttribute("intensity",a.intensity.toString()),i.appendChild(l)});const s=e.createElement("FaceAssignments");Il.selectAll(r.faceAssignments).forEach(a=>{if(a.type==kn.Single){const o=e.createElement("FaceAssignment");o.setAttribute("groupIndex",a.groupId.toString()),o.setAttribute("faceIndex",a.faceId.toString()),s.appendChild(o)}else if(a.type==kn.Range){const o=e.createElement("FaceRangeAssignment");o.setAttribute("groupIndex",a.groupId.toString()),o.setAttribute("faceIndexBegin",a.startFaceId.toString()),o.setAttribute("faceIndexEnd",a.endFaceId.toString()),s.appendChild(o)}else He.warn(Xe.UnknownLesAssignmentType,"Unknown les assignment type: "+a.type)}),i.appendChild(s),t.appendChild(i)}}const yB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("path",{d:"M24,5h-1H9v30h22V13v-1L24,5z M29.6,12H24V6.4L29.6,12z M30,34H10V6h13v6v1h1h6V34z"}))),xB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("path",{d:"M31.9,18v-4v-1h-1h-13V8h-14v5v1v17.4V32h1h26.9l4.3-14H31.9z M4.9,9h12v4h-12V9z M4.9,14h13h13v4H8L4.9,28.2V14z M31,31 h-26l3.7-12h26L31,31z"}))),wB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("polygon",{points:"33,25 33,33 7,33 7,7 15,7 15,6 6,6 6,34 34,34 34,25  "}),I.exports.createElement("path",{d:"M19.7,27.6l8-10.7H23C23.3,11.4,27.9,7,33.5,7V6H28c-6.2,0-11.4,4.8-11.9,10.9h-4.4L19.7,27.6z M17,17.9l0-0.5 C17.3,11.6,22.2,7,28,7h0.8c-4,1.8-6.8,5.8-6.8,10.4l0,0.5h3.7l-6,8l-6-8H17z"})))),_B=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("path",{d:"M29,6H11H6v23l5,5h2h14h7V6H29z M28,7v11H12V7H28z M14,33v-9h12v9H14z M33,33h-6V23H13v10h-1.6L7,28.6V7h4v12h18V7h4V33z"}))),bB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("polygon",{points:"35.1,19.5 7,19.5 17.5,10.4 16.8,9.6 4.9,20 16.8,30.4 17.5,29.6 7,20.5 35.1,20.5  "}))),SB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("polygon",{points:"23.2,9.6 22.5,10.4 33,19.5 4.9,19.5 4.9,20.5 33,20.5 22.5,29.6 23.2,30.4 35.1,20  "})));function MB(){const n=Ae(l=>l),e=Ae(Cu.canHistoryUndo),t=Ae(Cu.canHistoryRedo),r=Ae(Cu.hasChanges),i=Je(),s=new vB(n,new Mx),a=()=>{const l=document.createElement("input");l.setAttribute("type","file"),l.setAttribute("accept",".l3d"),l.onchange=c=>{const u=c.target.files;if(u&&u.length){const h=u.item(0);h!=null&&(r?i(Pe.requestL3DOverride({newL3D:!0,fileName:h.name,l3DUrl:URL.createObjectURL(h)})):new Ex().import(h))}},l.click()},o=()=>{r?i(Pe.requestL3DOverride({newL3D:!1})):(Xt.clear(),i(Te.reset()))};return fe("div",{className:dt.bar,children:[E("button",{onClick:o,title:"New L3D",children:E(yB,{})}),E("button",{onClick:a,title:"Load L3D",children:E(xB,{})}),E("button",{onClick:()=>i(Pe.modalPushed({type:gr.ModelCatalog,startImport:!0})),title:"Import .obj files into current L3D",children:E(wB,{})}),E("button",{disabled:!s.canExport(),onClick:()=>{s.export()},title:"Save/Download current L3D",children:E(_B,{})}),E("div",{className:dt.separator}),E("button",{disabled:!e,onClick:()=>i(Vl.undo()),title:"Undo",children:E(bB,{})}),E("button",{disabled:!t,onClick:()=>i(Vl.redo()),title:"Redo",children:E(SB,{})})]})}const EB=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 40 40",fill:"#1d1d1b","xmlns:v":"https://vecta.io/nano",...n},I.exports.createElement("path",{d:"M36.5 23v-6h-5.3c-.3-1-.7-2-1.2-2.9l3.8-3.8-4.2-4.2-3.8 3.9A13.9 13.9 0 0 0 23 8.8V3.5h-6v5.3c-1 .3-2 .7-2.9 1.2l-3.8-3.8-4.2 4.2 3.8 3.8L8.8 17H3.5v6h5.3c.3 1 .7 2 1.2 2.9l-3.8 3.8 4.2 4.2 3.8-3.8c.9.5 1.9.9 2.9 1.2v5.3H23v-5.3c1-.3 2-.7 2.9-1.2l3.8 3.8 4.2-4.2-3.9-3.9c.5-.9.9-1.9 1.2-2.9h5.3zm-6.2-.6c-.3 1.2-.7 2.3-1.4 3.3l-.2.3 3.6 3.6-2.8 2.8-3.5-3.7-.3.2c-1 .6-2.1 1.1-3.3 1.4l-.4.1v5.1h-4v-5.1l-.4-.1c-1.2-.3-2.3-.7-3.3-1.4l-.3-.2-3.6 3.6-2.8-2.8 3.6-3.6-.2-.3c-.6-1-1.1-2.1-1.4-3.3V22H4.5v-4h5.1l.1-.4c.3-1.2.7-2.3 1.4-3.3l.2-.3-3.6-3.6 2.8-2.8 3.6 3.6.3-.2c1-.6 2.1-1.1 3.3-1.4h.3V4.5h4v5.1l.4.1c1.2.3 2.3.7 3.3 1.4l.3.2 3.6-3.6 2.8 2.8-3.7 3.5.2.3c.6 1 1.1 2.1 1.4 3.3l.1.4h5.1v4h-5.1l-.1.4zM20 13.5a6.49 6.49 0 0 0-6.5 6.5 6.49 6.49 0 0 0 6.5 6.5 6.49 6.49 0 0 0 6.5-6.5 6.49 6.49 0 0 0-6.5-6.5zm0 12c-3 0-5.5-2.5-5.5-5.5s2.5-5.5 5.5-5.5 5.5 2.5 5.5 5.5-2.5 5.5-5.5 5.5z"}));function AB(){const n=Je();return fe("div",{className:dt.bar,children:[E("button",{onClick:()=>window.open("https://gldf.io/docs/tools-dev/l3d-editor","_blank"),title:"Help",className:dt.textualButton,children:"?"}),E("button",{onClick:()=>n(Pe.modalPushed({type:gr.Settings})),title:"Settings",children:E(EB,{})})]})}function TB(){const n=Je(),e=Ae(pt.view.wallMode),t=!Ae(pt.view.wallMode);return E(Ve,{children:fe("div",{className:dt.bar,children:[E("button",{className:e==!1?[dt.active,dt.textualButton].join(" "):dt.textualButton,onClick:()=>n(Pe.setGroundMode()),title:"Floor/Ceiling luminaire mode",children:"\u2195"}),E("button",{className:t==!1?[dt.active,dt.textualButton].join(" "):dt.textualButton,onClick:()=>n(Pe.setWallMode()),title:"Wall luminaire mode",children:"\u2194"})]})})}function CB(){return fe("div",{className:dt.main,children:[E(MB,{}),E(K6,{}),E(cB,{}),E(TB,{}),E(AB,{})]})}const PB="_main_1qhh1_1",IB="_messageBox_1qhh1_19";var Ib={main:PB,messageBox:IB};function LB(){const n=Ae(pt.messages.overlay.tool);return n?E("div",{className:Ib.main,children:E("div",{className:Ib.messageBox,children:n})}):E(Ve,{})}const RB="_main_dy2yz_1",FB="_gridContainer_dy2yz_15",DB="_itemGrid_dy2yz_31",NB="_item_dy2yz_31",kB="_selected_dy2yz_81",OB="_title_dy2yz_91";var $a={main:RB,gridContainer:FB,itemGrid:DB,item:NB,selected:kB,title:OB};const zB="_sidebarRow_1pfou_1",UB="_header_1pfou_9";var Od={sidebarRow:zB,header:UB};function BB(){return E("div",{children:fe("p",{children:["Catalog has no objects!",E("br",{})," Please import some .obj files to get started!"]})})}function HB(n){var s;const e=Je(),t=(a,o)=>{const l=yn.startNewItemDragDrop(Y.Geometry,{type:kd.Geometry,meshId:o}),c=document.createElement("img",{});a.dataTransfer.setData(l,""),a.dataTransfer.setDragImage(c,0,0)},r=n.isSelected?[$a.item,$a.selected].join(" "):$a.item,i=n.mesh;return fe("div",{title:i.name,onClick:()=>n.onClick(),className:r,draggable:"true",onDragStart:a=>t(a,i.id),onDragEnd:a=>e(Pe.dragDropStopped()),children:[E("div",{children:E("img",{draggable:"false",src:(s=i.previewUrl)!=null?s:""})}),E("div",{className:$a.title,children:i.name})]},i.id)}function GB(n){const e=Ae(bt.selectedMeshId),t=Je();return E("div",{className:$a.itemGrid,children:n.meshes.map(r=>E(HB,{mesh:r,isSelected:e==r.id,onClick:()=>t(je.selectedMeshSet(r.id))},r.id))})}function VB(){const n=Ae(mt.meshDefinitions),e=qt.selectAll(n),t=Ae(bt.selectedMeshId),r=Je(),i=()=>{t!=null&&r(Te.geometryPartAdded({meshId:t,position:{x:0,y:0,z:0}}))};return fe("div",{className:$a.main,children:[E("div",{className:Od.header,children:"Models"}),fe("div",{className:$a.gridContainer,children:[e.length==0&&E(BB,{}),e.length>0&&E(GB,{meshes:e})]}),fe("div",{children:[E("button",{disabled:t==null,onClick:i,children:"Insert"})," ",E("button",{onClick:()=>r(Pe.modalPushed({type:gr.ModelCatalog})),children:"Catalog"})]})]})}const jB="_catalog_cf2hg_1",WB="_content_cf2hg_13",XB="_item_cf2hg_33",YB="_dragable_cf2hg_73";var Vr={catalog:jB,content:WB,item:XB,dragable:YB};function $B(){const n=Je(),e=o=>{const l=yn.startNewItemDragDrop(Y.LightEmittingObject);o.dataTransfer.setData(l,"")},t=o=>{const l=yn.startNewItemDragDrop(Y.PendulumConnector);o.dataTransfer.setData(l,"")},r=o=>{const l=yn.startNewItemDragDrop(Y.ElectricalConnector);o.dataTransfer.setData(l,"")},i=o=>{const l=yn.startNewItemDragDrop(Y.Sensor);o.dataTransfer.setData(l,"")},s=o=>{const l=yn.startNewItemDragDrop(Y.Joint);o.dataTransfer.setData(l,"")},a=o=>{n(Pe.dragDropStopped())};return fe("div",{className:Vr.catalog,children:[E("div",{className:Od.header,children:"Luminaire"}),fe("div",{className:Vr.content,children:[fe("div",{className:Vr.item,title:"Drag this element into the scene or structure tree to add a new LEO",children:[E(w2,{}),E("div",{className:Vr.dragable,draggable:"true",onDragStart:e,onDragEnd:a})]}),fe("div",{className:Vr.item,title:"Drag this element into the scene or structure tree to add a new joint",children:[E(_2,{}),E("div",{className:Vr.dragable,draggable:"true",onDragStart:s,onDragEnd:a})]}),fe("div",{className:Vr.item,title:"Drag this element into the scene or structure tree to add a new sensor",children:[E(M2,{}),E("div",{className:Vr.dragable,draggable:"true",onDragStart:i,onDragEnd:a})]}),fe("div",{className:Vr.item,title:"Drag this element into the scene or structure tree to add a new electrical connector",children:[E("div",{className:Vr.dragable,draggable:"true",onDragStart:r,onDragEnd:a}),E(b2,{})]}),fe("div",{className:Vr.item,title:"Drag this element into the scene or structure tree to add a new pendulum connector",children:[E("div",{className:Vr.dragable,draggable:"true",onDragStart:t,onDragEnd:a}),E(S2,{})]})]})]})}const ZB="_main_lfxf8_1",qB="_tree_lfxf8_7",QB="_treeItemHeader_lfxf8_12",JB="_text_lfxf8_20",KB="_icon_lfxf8_26",e8="_selected_lfxf8_30",t8="_subSelected_lfxf8_35",n8="_hidden_lfxf8_40",r8="_dropZone_lfxf8_44",i8="_treeItemChildList_lfxf8_53",s8="_itemCollapseButton_lfxf8_57",a8="_collapsed_lfxf8_71",o8="_expanded_lfxf8_75",l8="_icons_lfxf8_79",c8="_grab_lfxf8_95",u8="_visibleIcons_lfxf8_103",d8="_treeItem_lfxf8_12";var Bt={main:ZB,tree:qB,treeItemHeader:QB,text:JB,icon:KB,selected:e8,subSelected:t8,hidden:n8,dropZone:r8,treeItemChildList:i8,itemCollapseButton:s8,collapsed:a8,expanded:o8,icons:l8,delete:"_delete_lfxf8_88",grab:c8,visibleIcons:u8,treeItem:d8};const h8=n=>I.exports.createElement("svg",{width:"1em",height:"1em",viewBox:"0 0 5.2916665 5.2916668",id:"svg5","inkscape:version":"1.1.1 (3bf5ae0d25, 2021-09-20)","sodipodi:docname":"Drag-20x20.svg","xmlns:inkscape":"http://www.inkscape.org/namespaces/inkscape","xmlns:sodipodi":"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd",xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg",...n},I.exports.createElement("sodipodi:namedview",{id:"namedview7",pagecolor:"#ffffff",bordercolor:"#999999",borderopacity:1,"inkscape:pageshadow":0,"inkscape:pageopacity":0,"inkscape:pagecheckerboard":0,"inkscape:document-units":"px",showgrid:"false",units:"px","inkscape:zoom":32,"inkscape:cx":11.921875,"inkscape:cy":16.015625,"inkscape:window-width":2560,"inkscape:window-height":1377,"inkscape:window-x":1912,"inkscape:window-y":957,"inkscape:window-maximized":1,"inkscape:current-layer":"layer1"}),I.exports.createElement("defs",{id:"defs2"}),I.exports.createElement("g",{"inkscape:label":"Ebene 1","inkscape:groupmode":"layer",id:"layer1"},I.exports.createElement("path",{style:{fill:"none",stroke:"#000000",strokeWidth:"0.387156px",strokeLinecap:"butt",strokeLinejoin:"miter",strokeOpacity:1},d:"M 1.8999657,1.0875681 2.647882,0.28435781 3.3928826,1.0875681 Z",id:"path604"}),I.exports.createElement("path",{style:{fill:"none",stroke:"#000000",strokeWidth:"0.387156px",strokeLinecap:"butt",strokeLinejoin:"miter",strokeOpacity:1},d:"M 1.0875678,3.3917013 0.28435774,2.6437849 1.0875678,1.8987846 Z",id:"path604-2"}),I.exports.createElement("path",{style:{fill:"none",stroke:"#000000",strokeWidth:"0.387155px",strokeLinecap:"butt",strokeLinejoin:"miter",strokeOpacity:1},d:"M 4.2041317,1.8999647 5.0073421,2.6478814 4.2041317,3.3928822 Z",id:"path604-2-1"}),I.exports.createElement("path",{style:{fill:"none",stroke:"#000000",strokeWidth:"0.387156px",strokeLinecap:"butt",strokeLinejoin:"miter",strokeOpacity:1},d:"M 3.3917017,4.2041322 2.6437852,5.0073427 1.8987846,4.2041322 Z",id:"path604-6"}))),f8=n=>I.exports.createElement("svg",{width:"1em",height:"1em",viewBox:"0 0 5.2917 5.2917",xmlns:"http://www.w3.org/2000/svg",...n},I.exports.createElement("path",{d:"m2.6465 1.1914a0.1323 0.1323 0 0 0-0.099609 0.042969l-2.3809 2.6465a0.1323 0.1323 0 0 0 0.097656 0.2207h4.7637a0.1323 0.1323 0 0 0 0.097656-0.2207l-2.3809-2.6465a0.1323 0.1323 0 0 0-0.097656-0.042969zm0 0.33008 2.084 2.3145h-4.168z",color:"#000000",strokeLinecap:"round",strokeLinejoin:"round",style:{InkscapeStroke:"none"}})),p8=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("g",null,I.exports.createElement("rect",{x:28,y:24,width:8,height:4})),I.exports.createElement("g",null,I.exports.createElement("path",{d:"M4,14.7v10.6C4,29,7,32,10.7,32H24V8H10.7C7,8,4,11,4,14.7z"})),I.exports.createElement("g",null,I.exports.createElement("rect",{x:28,y:12,width:8,height:4}))))),m8=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("g",null,I.exports.createElement("rect",{x:10,y:4,width:4,height:16})),I.exports.createElement("g",null,I.exports.createElement("rect",{x:26,y:4,width:4,height:16})),I.exports.createElement("g",null,I.exports.createElement("rect",{x:4,y:24,width:32,height:12}))))),g8=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("rect",{x:14,y:4,width:12,height:12}),I.exports.createElement("path",{d:"M29.2,24.2l-2.8-2.8c-3.5,3.5-9.2,3.5-12.7,0l-2.8,2.8C15.9,29.3,24.1,29.3,29.2,24.2z"}),I.exports.createElement("path",{d:"M32,27c-6.6,6.6-17.4,6.6-24,0l-2.8,2.8c8.2,8.2,21.5,8.2,29.7,0L32,27z"})))),v8=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("path",{d:"M15.4,31.2c0,2.6,2.1,4.6,4.6,4.7c2.6,0,4.6-2.1,4.6-4.7H20H15.4z"}),I.exports.createElement("path",{d:"M20.4,4.1c-0.1,0-0.3,0-0.4,0c-0.1,0-0.3,0-0.4,0c-5.4,0.2-9.8,4.7-9.9,10.1c-0.1,3.2,1.3,6.1,3.6,8.1 c1,0.8,1.5,2,1.5,3.3v1.7h10.3v-1.7c0-1.3,0.6-2.5,1.5-3.3c2.3-1.9,3.7-4.8,3.6-8.1C30.2,8.8,25.8,4.3,20.4,4.1z"})))),y8=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("path",{d:"M27.1,18.6c0-3.9-3.1-7-7-7s-7,3.1-7,7c0,3.9,3.1,7,7,7S27.1,22.4,27.1,18.6z M20.1,21.6c-1.7,0-3-1.3-3-3s1.3-3,3-3 c1.7,0,3,1.3,3,3S21.7,21.6,20.1,21.6z"}),I.exports.createElement("path",{d:"M4.1,14.6v8h5.8c-0.5-1.2-0.8-2.6-0.8-4s0.3-2.8,0.8-4H4.1z"}),I.exports.createElement("path",{d:"M30.1,23c-1.1,2.5-3.1,4.5-5.7,5.7l5.8,5.8l5.7-5.7L30.1,23z"})))),P2=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("polygon",{points:"6.1,28.5 18.1,35.4 18.1,24 6.2,17.2  "}),I.exports.createElement("polygon",{points:"20,4.6 6.2,12.6 20.1,20.6 33.9,12.6  "}),I.exports.createElement("polygon",{points:"22.1,24 22.1,35.4 33.8,28.5 33.9,17.2  "})))),x8=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("g",null,I.exports.createElement("rect",{x:6,y:6,width:8,height:28})),I.exports.createElement("g",null,I.exports.createElement("rect",{x:18,y:10,width:16,height:4})),I.exports.createElement("g",null,I.exports.createElement("rect",{x:18,y:18,width:16,height:4})),I.exports.createElement("g",null,I.exports.createElement("rect",{x:18,y:26,width:16,height:4}))))),w8=n=>I.exports.createElement("svg",{width:"1em",height:"1em",viewBox:"0 5 40 30",xmlns:"http://www.w3.org/2000/svg",...n},I.exports.createElement("g",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeWidth:1.5},I.exports.createElement("path",{d:"m5 20c15-17.636 30 0 30 0"}),I.exports.createElement("path",{d:"m5 20c15 17.569 30 0 30 0"}),I.exports.createElement("circle",{cx:20,cy:20,r:6.3407,strokeLinejoin:"round"}))),_8=n=>I.exports.createElement("svg",{width:"1em",height:"1em",viewBox:"0 5 40 30",xmlns:"http://www.w3.org/2000/svg",...n},I.exports.createElement("g",{fill:"none",stroke:"#000",strokeLinecap:"round"},I.exports.createElement("g",{strokeWidth:1.5},I.exports.createElement("path",{d:"m5 20c15-17.636 30 0 30 0"}),I.exports.createElement("path",{d:"m5 20c15 17.569 30 0 30 0"}),I.exports.createElement("circle",{cx:20,cy:20,r:6.3407,strokeLinejoin:"round"})),I.exports.createElement("path",{d:"m5 30.562 30-20.937",strokeWidth:2})));function Lb(n){switch(n){case Y.LightEmittingObject:return 1;case Y.Sensor:return 2;case Y.ElectricalConnector:return 3;case Y.PendulumConnector:return 4;case Y.Joint:return 5}return 0}function b8(n,e){const t=Lb(n.type)*1e3+n.id,r=Lb(e.type)*1e3+e.id;return t-r}function S8(n){switch(n.type){case Y.Geometry:return E(P2,{});case Y.Joint:return E(y8,{});case Y.LightEmittingObject:return E(v8,{});case Y.Sensor:return E(g8,{});case Y.PendulumConnector:return E(m8,{});case Y.ElectricalConnector:return E(p8,{});case Y.LightEmittingSurface:return E(x8,{})}}function M8(n){const e=Ae(bt.isFaceGroupSelected(n.part.id,n.id)),t=Ae(bt.isFaceGroupHidden(n.part.id,n.id)),r=Je(),i=I.exports.useRef(null),s=[Bt.treeItemHeader];return e&&s.push(Bt.subSelected),t&&s.push(Bt.hidden),E("div",{className:Bt.treeItem,children:fe("div",{className:s.join(" "),onClick:()=>{r(je.geometryPartSelected({id:n.part.id,groups:[{id:n.id}]}))},onContextMenu:()=>{var a;return(a=i.current)==null?void 0:a.click()},ref:i,children:[E("div",{className:Bt.itemCollapseButton}),E("div",{className:Bt.icon,children:E(P2,{})}),E("div",{className:Bt.text,title:n.name,children:n.name}),fe("span",{className:Bt.visibleIcons,children:[E("span",{onClick:a=>{a.stopPropagation(),r(je.hideGeometryFaceGroups({partId:n.part.id,groupIndices:[n.id]}))},children:!t&&E(w8,{})}),E("span",{onClick:a=>{a.stopPropagation(),r(je.showGeometryFaceGroups({partId:n.part.id,groupIndices:[n.id]}))},children:t&&E(_8,{})})]})]})})}function E8(n){const e=Ae(mt.meshDefinition(n.part.meshId)),t=e==null?void 0:e.groups;if(!t)return E(Ve,{});const r=yA.selectAll(t);return E(Ve,{children:r.map(i=>E(M8,{part:n.part,id:i.id,name:i.name},i.id))})}function I2(n){const e=Ae(mt.part(n.partId)),t=Ae(mt.childParts(n.partId)).sort(b8),r=Ae(bt.selectedPartIds),i=Ae(pt.dragDrop),s=Je(),a=I.exports.useRef(null),[o,l]=I.exports.useState(!1),c=r.includes(n.partId)||!r.length&&n.partId==0,u=i!=null&&yn.canDropOnPart(e,i),h=[Bt.treeItemHeader];c&&h.push(Bt.selected),u&&h.push(Bt.dropZone);const d=()=>{n.partId==0?s(je.partSelectionCleared()):s(je.partsSelected([n.partId]))},f=w=>{const b=me.getState().runtime.dragDrop;if(!!b){w.stopPropagation();for(var C of w.dataTransfer.types){if(C!=b.uniqueId)continue;if(yn.canDropOnPart(e,b)){w.preventDefault();break}}}},v=w=>{const b=me.getState().runtime.dragDrop;if(!!b){w.stopPropagation();for(var C of w.dataTransfer.types){if(C!=b.uniqueId)continue;yn.canDropOnPart(e,b)&&yn.performDrop(e,b)}}},g=w=>{if(!e)return;const b=yn.startExistingPartDragDrop(e);w.dataTransfer.setData(b,"")},y=w=>{!e||yn.stopDragDrop()},p=w=>{w.stopPropagation(),s(Te.partsDeleted([n.partId]))},m=e!=null?S8(e):"";let x=null;return e&&e.type==Y.Geometry&&(x=E(E8,{part:e})),fe("div",{className:Bt.treeItem,children:[fe("div",{className:h.join(" "),onClick:d,onDragOver:f,onDrop:v,onContextMenu:()=>{var w;return(w=a.current)==null?void 0:w.click()},ref:a,children:[E("div",{className:Bt.itemCollapseButton,children:t.length>0&&E(f8,{className:o?Bt.collapsed:Bt.expanded,onClick:()=>l(!o)})}),E("div",{className:Bt.icon,draggable:"true",onDragStart:g,onDragEnd:y,title:n.name,children:m}),E("div",{className:Bt.text,draggable:"true",onDragStart:g,onDragEnd:y,title:n.name,children:n.name}),fe("span",{className:Bt.icons,children:[E("span",{draggable:"true",onDragStart:g,onDragEnd:y,className:Bt.grab,children:E(h8,{className:Bt.grab})}),E("span",{className:Bt.delete,onClick:p,children:"DEL"})]})]}),!o&&fe("div",{className:Bt.treeItemChildList,children:[x,t.map(w=>E(I2,{partId:w.id,name:w.name},w.id))]})]})}function A8(){const n=Ae(mt.name);return fe("div",{className:Bt.main,children:[E("div",{className:Od.header,children:"Structure"}),E("div",{className:Bt.tree,children:E(I2,{partId:0,name:n})})]})}const T8="_sidebar_1ss1x_1",C8="_content_1ss1x_15",P8="_row_1ss1x_31",I8="_element_1ss1x_39",L8="_dragger_1ss1x_55";var Ra={sidebar:T8,content:C8,row:P8,element:I8,dragger:L8};function ar(){return ar=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ar.apply(this,arguments)}function hd(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var L2=function(e){return!!e&&e[0]==="o"},Rb=aa.exports.unstable_batchedUpdates||function(n){return n()},Xo=function(e,t,r){return r===void 0&&(r=1e-4),Math.abs(e-t)<r},fd=function(e,t){return!!(e&&e[t])||e===!0},Bi=function(e,t){return typeof e=="function"?e(t):e},Ax=function(e,t){if(!t)return e;for(var r={},i=function(l,c){var u=c[l],h=e[u],d=t[u],f=void 0;typeof d=="function"?f=function(g){d(g),h(g)}:f=h,r[u]=f},s=0,a=Object.keys(e);s<a.length;s++)i(s,a);return r},R8=function(e){if(typeof e!="string")return{top:0,right:0,bottom:0,left:0};var t=e.trim().split(/\s+/,4).map(parseFloat),r=isNaN(t[0])?0:t[0],i=isNaN(t[1])?r:t[1];return{top:r,right:i,bottom:isNaN(t[2])?r:t[2],left:isNaN(t[3])?i:t[3]}},Yg=function(e){for(;e;){if(e=e.parentNode,!e||e===document.body)return;var t=getComputedStyle(e),r=t.overflow,i=t.overflowX,s=t.overflowY;if(/auto|scroll|overlay|hidden/.test(r+s+i))return e}};function R2(n,e){return{"aria-disabled":n||void 0,tabIndex:n?void 0:e?0:-1}}function Fb(n,e){for(var t=0;t<n.length;t++)if(n[t]===e)return t;return-1}var pd=function(e){var t=e.block,r=e.element,i=e.modifiers,s=e.className;return I.exports.useMemo(function(){for(var a=r?t+"__"+r:t,o=a,l=0,c=Object.keys(i||{});l<c.length;l++){var u=c[l],h=i[u];h&&(o+=" "+a+"--",o+=h===!0?u:u+"-"+h)}var d=typeof s=="function"?s(i):s;return typeof d=="string"&&(d=d.trim(),d&&(o+=" "+d)),o},[t,r,i,s])},F8="szh-menu-container",Iu="szh-menu",D8="arrow",N8="item",k8="divider",F2=I.exports.createContext(),D2=I.exports.createContext({}),Db=I.exports.createContext({}),N2=I.exports.createContext({}),O8=I.exports.createContext({}),k2=I.exports.createContext({}),O2=I.exports.createContext({}),us=Object.freeze({ENTER:"Enter",ESC:"Escape",SPACE:" ",HOME:"Home",END:"End",LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown"}),vn=Object.freeze({RESET:"RESET",SET:"SET",UNSET:"UNSET",INCREASE:"INCREASE",DECREASE:"DECREASE",FIRST:"FIRST",LAST:"LAST",SET_INDEX:"SET_INDEX"}),au=Object.freeze({CLICK:"click",CANCEL:"cancel",BLUR:"blur",SCROLL:"scroll"}),Nb=Object.freeze({FIRST:"first",LAST:"last"}),z8=Object.freeze({entering:"opening",entered:"open",exiting:"closing",exited:"closed"}),U8=function(e){var t=I.exports.useState(),r=t[0],i=t[1],s=I.exports.useRef({items:[],hoverIndex:-1,sorted:!1}),a=s.current,o=I.exports.useCallback(function(c,u){var h=a.items;if(!c)a.items=[];else if(u)h.push(c);else{var d=h.indexOf(c);d>-1&&h.splice(d,1)}a.hoverIndex=-1,a.sorted=!1},[a]),l=I.exports.useCallback(function(c,u,h){var d=a.items,f=a.hoverIndex,v=function(){if(!a.sorted){var m=e.current.querySelectorAll(".szh-menu__item");d.sort(function(x,w){return Fb(m,x)-Fb(m,w)}),a.sorted=!0}},g=-1,y=void 0;switch(c){case vn.RESET:break;case vn.SET:y=u;break;case vn.UNSET:y=function(m){return m===u?void 0:m};break;case vn.FIRST:v(),g=0,y=d[g];break;case vn.LAST:v(),g=d.length-1,y=d[g];break;case vn.SET_INDEX:v(),g=h,y=d[g];break;case vn.INCREASE:v(),g=f,g<0&&(g=d.indexOf(u)),g++,g>=d.length&&(g=0),y=d[g];break;case vn.DECREASE:v(),g=f,g<0&&(g=d.indexOf(u)),g--,g<0&&(g=d.length-1),y=d[g];break}y||(g=-1),i(y),a.hoverIndex=g},[e,a]);return{hoverItem:r,dispatch:l,updateItems:o}},B8=function(e,t,r,i){var s=t.current.getBoundingClientRect(),a=e.current.getBoundingClientRect(),o=r===window?{left:0,top:0,right:document.documentElement.clientWidth,bottom:window.innerHeight}:r.getBoundingClientRect(),l=R8(i),c=function(y){return y+a.left-o.left-l.left},u=function(y){return y+a.left+s.width-o.right+l.right},h=function(y){return y+a.top-o.top-l.top},d=function(y){return y+a.top+s.height-o.bottom+l.bottom},f=function(y){var p=c(y);if(p<0)y-=p;else{var m=u(y);m>0&&(y-=m,p=c(y),p<0&&(y-=p))}return y},v=function(y){var p=h(y);if(p<0)y-=p;else{var m=d(y);m>0&&(y-=m,p=h(y),p<0&&(y-=p))}return y};return{menuRect:s,containerRect:a,getLeftOverflow:c,getRightOverflow:u,getTopOverflow:h,getBottomOverflow:d,confineHorizontally:f,confineVertically:v}},H8=function(e){var t=e.positionHelpers,r=e.anchorPoint,i=t.menuRect,s=t.containerRect,a=t.getLeftOverflow,o=t.getRightOverflow,l=t.getTopOverflow,c=t.getBottomOverflow,u=t.confineHorizontally,h=t.confineVertically,d,f;d=r.x-s.left,f=r.y-s.top;var v=o(d);if(v>0){var g=d-i.width,y=a(g);(y>=0||-y<v)&&(d=g),d=u(d)}var p="bottom",m=c(f);if(m>0){var x=f-i.height,w=l(x);(w>=0||-w<m)&&(f=x,p="top"),f=h(f)}return{x:d,y:f,computedDirection:p}},G8=function(e){var t=e.arrowRef,r=e.menuY,i=e.anchorRect,s=e.containerRect,a=e.menuRect,o=i.top-s.top-r+i.height/2,l=t.current.offsetHeight*1.25;return o=Math.max(l,o),o=Math.min(o,a.height-l),o},V8=function(e){var t=e.anchorRect,r=e.containerRect,i=e.menuRect,s=e.placeLeftorRightY,a=e.placeLeftX,o=e.placeRightX,l=e.getLeftOverflow,c=e.getRightOverflow,u=e.confineHorizontally,h=e.confineVertically,d=e.arrowRef,f=e.arrow,v=e.direction,g=e.position,y=v,p=s;g!=="initial"&&(p=h(p),g==="anchor"&&(p=Math.min(p,t.bottom-r.top),p=Math.max(p,t.top-r.top-i.height)));var m,x,w;y==="left"?(m=a,g!=="initial"&&(x=l(m),x<0&&(w=c(o),(w<=0||-x>w)&&(m=o,y="right")))):(m=o,g!=="initial"&&(w=c(m),w>0&&(x=l(a),(x>=0||-x<w)&&(m=a,y="left")))),g==="auto"&&(m=u(m));var b=f?G8({menuY:p,arrowRef:d,anchorRect:t,containerRect:r,menuRect:i}):void 0;return{arrowY:b,x:m,y:p,computedDirection:y}},j8=function(e){var t=e.arrowRef,r=e.menuX,i=e.anchorRect,s=e.containerRect,a=e.menuRect,o=i.left-s.left-r+i.width/2,l=t.current.offsetWidth*1.25;return o=Math.max(l,o),o=Math.min(o,a.width-l),o},W8=function(e){var t=e.anchorRect,r=e.containerRect,i=e.menuRect,s=e.placeToporBottomX,a=e.placeTopY,o=e.placeBottomY,l=e.getTopOverflow,c=e.getBottomOverflow,u=e.confineHorizontally,h=e.confineVertically,d=e.arrowRef,f=e.arrow,v=e.direction,g=e.position,y=v==="top"?"top":"bottom",p=s;g!=="initial"&&(p=u(p),g==="anchor"&&(p=Math.min(p,t.right-r.left),p=Math.max(p,t.left-r.left-i.width)));var m,x,w;y==="top"?(m=a,g!=="initial"&&(x=l(m),x<0&&(w=c(o),(w<=0||-x>w)&&(m=o,y="bottom")))):(m=o,g!=="initial"&&(w=c(m),w>0&&(x=l(a),(x>=0||-x<w)&&(m=a,y="top")))),g==="auto"&&(m=h(m));var b=f?j8({menuX:p,arrowRef:d,anchorRect:t,containerRect:r,menuRect:i}):void 0;return{arrowX:b,x:p,y:m,computedDirection:y}},X8=function(e){var t=e.arrow,r=e.align,i=e.direction,s=e.offsetX,a=e.offsetY,o=e.position,l=e.anchorRef,c=e.arrowRef,u=e.positionHelpers,h=u.menuRect,d=u.containerRect,f=s,v=a;t&&(i==="left"||i==="right"?f+=c.current.offsetWidth:v+=c.current.offsetHeight);var g=l.current.getBoundingClientRect(),y=g.left-d.left-h.width-f,p=g.right-d.left+f,m=g.top-d.top-h.height-v,x=g.bottom-d.top+v,w,b;r==="end"?(w=g.right-d.left-h.width,b=g.bottom-d.top-h.height):r==="center"?(w=g.left-d.left-(h.width-g.width)/2,b=g.top-d.top-(h.height-g.height)/2):(w=g.left-d.left,b=g.top-d.top),w+=f,b+=v;var C=ar({},u,{anchorRect:g,placeLeftX:y,placeRightX:p,placeLeftorRightY:b,placeTopY:m,placeBottomY:x,placeToporBottomX:w,arrowRef:c,arrow:t,direction:i,position:o});switch(i){case"left":case"right":return V8(C);case"top":case"bottom":default:return W8(C)}},kb=typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement!="undefined"?I.exports.useLayoutEffect:I.exports.useEffect,Ob=function(e,t){typeof e=="function"?e(t):e&&(e.current=t)},z2=function(e,t){return I.exports.useMemo(function(){return e?t?function(r){Ob(e,r),Ob(t,r)}:e:t},[e,t])},Y8=["ariaLabel","menuClassName","menuStyle","arrowClassName","arrowStyle","anchorPoint","anchorRef","containerRef","externalRef","parentScrollingRef","arrow","align","direction","position","overflow","setDownOverflow","repositionFlag","captureFocus","state","endTransition","isDisabled","menuItemFocus","offsetX","offsetY","children","onClose"],$8=function(e){var t=e.ariaLabel,r=e.menuClassName,i=e.menuStyle,s=e.arrowClassName,a=e.arrowStyle,o=e.anchorPoint,l=e.anchorRef,c=e.containerRef,u=e.externalRef,h=e.parentScrollingRef,d=e.arrow,f=e.align,v=f===void 0?"start":f,g=e.direction,y=g===void 0?"bottom":g,p=e.position,m=p===void 0?"auto":p,x=e.overflow,w=x===void 0?"visible":x,b=e.setDownOverflow,C=e.repositionFlag,A=e.captureFocus,F=A===void 0?!0:A,N=e.state,O=e.endTransition,H=e.isDisabled,D=e.menuItemFocus,U=e.offsetX,_=U===void 0?0:U,z=e.offsetY,j=z===void 0?0:z,R=e.children,ee=e.onClose,J=hd(e,Y8),le=I.exports.useState({x:0,y:0}),k=le[0],V=le[1],$=I.exports.useState({}),Q=$[0],ie=$[1],ne=I.exports.useState(),Se=ne[0],_e=ne[1],we=I.exports.useState(y),Me=we[0],ke=we[1],de=I.exports.useState(0),xe=de[0],M=de[1],te=I.exports.useReducer(function(se){return se+1},1),X=te[0],T=te[1],S=I.exports.useContext(k2),B=S.transition,q=S.boundingBoxRef,K=S.boundingBoxPadding,W=S.rootMenuRef,ce=S.rootAnchorRef,pe=S.scrollNodesRef,ue=S.reposition,ve=S.viewScroll,Z=I.exports.useContext(Db).reposSubmenu||C,ye=I.exports.useRef(null),ge=I.exports.useRef(),Re=I.exports.useRef(),Fe=I.exports.useRef(!1),Ze=I.exports.useRef({width:0,height:0}),lt=I.exports.useRef(function(){}),kt=U8(ye),jn=kt.hoverItem,rt=kt.dispatch,Tn=kt.updateItems,Wt=L2(N),bs=fd(B,"open"),vo=fd(B,"close"),Cn=pe.current,Ii=function(re){var he=!1;switch(re.key){case us.HOME:rt(vn.FIRST),he=!0;break;case us.END:rt(vn.LAST),he=!0;break;case us.UP:rt(vn.DECREASE,jn),he=!0;break;case us.DOWN:rt(vn.INCREASE,jn),he=!0;break;case us.SPACE:re.target&&re.target.className.indexOf(Iu)!==-1&&re.preventDefault();break}he&&(re.preventDefault(),re.stopPropagation())},dr=function(){N==="closing"&&_e(),Bi(O)},Li=I.exports.useCallback(function(se){if(!!c.current){Cn.menu||(Cn.menu=(q?q.current:Yg(W.current))||window);var re=B8(c,ye,Cn.menu,K),he=re.menuRect,We={computedDirection:"bottom"};o?We=H8({positionHelpers:re,anchorPoint:o}):l&&(We=X8({arrow:d,align:v,direction:y,offsetX:_,offsetY:j,position:m,anchorRef:l,arrowRef:Re,positionHelpers:re}));var Be=We,Ge=Be.arrowX,Ke=Be.arrowY,ht=Be.x,it=Be.y,ft=Be.computedDirection,_t=he.height;if(!se&&w!=="visible"){var Or=re.getTopOverflow,yt=re.getBottomOverflow,zr,Et,Ri=Ze.current.height,Ur=yt(it);if(Ur>0||Xo(Ur,0)&&Xo(_t,Ri))zr=_t-Ur,Et=Ur;else{var _r=Or(it);(_r<0||Xo(_r,0)&&Xo(_t,Ri))&&(zr=_t+_r,Et=0-_r,zr>=0&&(it-=_r))}zr>=0?(_t=zr,_e({height:zr,overflowAmt:Et})):_e()}d&&ie({x:Ge,y:Ke}),V({x:ht,y:it}),ke(ft),Ze.current={width:he.width,height:_t}}},[d,v,K,y,_,j,m,w,o,l,c,q,W,Cn]);kb(function(){Wt&&(Li(),Fe.current&&T()),Fe.current=Wt,lt.current=Li},[Wt,Li,Z]),kb(function(){Se&&!b&&(ye.current.scrollTop=0)},[Se,b]),I.exports.useEffect(function(){return Tn},[Tn]),I.exports.useEffect(function(){var se=Cn.menu;if(!(!Wt||!se)){if(se=se.addEventListener?se:window,!Cn.anchors){Cn.anchors=[];for(var re=Yg(ce&&ce.current);re&&re!==se;)Cn.anchors.push(re),re=Yg(re)}var he=ve;if(Cn.anchors.length&&he==="initial"&&(he="auto"),he!=="initial"){var We=function(){he==="auto"?Rb(function(){return Li(!0)}):Bi(ee,{reason:au.SCROLL})},Be=Cn.anchors.concat(ve!=="initial"?se:[]);return Be.forEach(function(Ge){return Ge.addEventListener("scroll",We)}),function(){return Be.forEach(function(Ge){return Ge.removeEventListener("scroll",We)})}}}},[ce,Cn,Wt,ee,ve,Li]);var yc=!!Se&&Se.overflowAmt>0;I.exports.useEffect(function(){if(!(yc||!Wt||!h)){var se=function(){return Rb(Li)},re=h.current;return re.addEventListener("scroll",se),function(){return re.removeEventListener("scroll",se)}}},[Wt,yc,h,Li]),I.exports.useEffect(function(){if(!(typeof ResizeObserver!="function"||ue==="initial")){var se=new ResizeObserver(function(he){var We=he[0],Be=We.borderBoxSize,Ge=We.target,Ke,ht;if(Be){var it=Be[0]||Be,ft=it.inlineSize,_t=it.blockSize;Ke=ft,ht=_t}else{var Or=Ge.getBoundingClientRect();Ke=Or.width,ht=Or.height}Ke===0||ht===0||Xo(Ke,Ze.current.width,1)&&Xo(ht,Ze.current.height,1)||aa.exports.flushSync(function(){lt.current(),T()})}),re=ye.current;return se.observe(re,{box:"border-box"}),function(){return se.unobserve(re)}}},[ue]),I.exports.useEffect(function(){if(!Wt){rt(vn.RESET),vo||_e();return}var se=D||{},re=se.position,he=se.alwaysUpdate,We=function(){re===Nb.FIRST?rt(vn.FIRST):re===Nb.LAST?rt(vn.LAST):re>=-1&&rt(vn.SET_INDEX,void 0,re)};if(he)We();else if(F){var Be=setTimeout(function(){ye.current.contains(document.activeElement)||(ge.current.focus(),We())},bs?170:100);return function(){return clearTimeout(Be)}}},[Wt,bs,vo,F,D,rt]);var Bd=xe>0,yo=I.exports.useMemo(function(){return{isParentOpen:Wt,isSubmenuOpen:Bd,setOpenSubmenuCount:M,dispatch:rt,updateItems:Tn}},[Wt,Bd,rt,Tn]),xc,Ta;Se&&(b?Ta=Se.overflowAmt:xc=Se.height);var Hd=I.exports.useMemo(function(){return{reposSubmenu:X,overflow:w,overflowAmt:Ta,parentMenuRef:ye,parentDir:Me}},[X,w,Ta,Me]),Gd=xc>=0?{maxHeight:xc,overflow:w}:void 0,vm=I.exports.useMemo(function(){return{state:N,dir:Me}},[N,Me]),ym=I.exports.useMemo(function(){return{dir:Me}},[Me]),G=pd({block:Iu,element:D8,modifiers:ym,className:s}),ae=Ax({onKeyDown:Ii,onAnimationEnd:dr},J);return fe("ul",ar({role:"menu","aria-label":t},J,ae,R2(H),{ref:z2(u,ye),className:pd({block:Iu,modifiers:vm,className:r}),style:ar({},i,Gd,{margin:0,display:N==="closed"?"none":void 0,position:"absolute",left:k.x,top:k.y}),children:[E("div",{ref:ge,tabIndex:-1,style:{position:"absolute",left:0,top:0}}),d&&E("div",{className:G,style:ar({},a,{position:"absolute",left:Q.x,top:Q.y}),ref:Re}),E(Db.Provider,{value:Hd,children:E(D2.Provider,{value:yo,children:E(F2.Provider,{value:jn,children:R})})})]}))},Z8=["aria-label","className","containerProps","initialMounted","unmountOnClose","transition","transitionTimeout","boundingBoxRef","boundingBoxPadding","reposition","submenuOpenDelay","submenuCloseDelay","skipOpen","viewScroll","portal","theming","onItemClick","onClose"],q8=I.exports.forwardRef(function(e,t){var r=e["aria-label"],i=e.className,s=e.containerProps,a=e.initialMounted,o=e.unmountOnClose,l=e.transition,c=e.transitionTimeout,u=e.boundingBoxRef,h=e.boundingBoxPadding,d=e.reposition,f=d===void 0?"auto":d,v=e.submenuOpenDelay,g=v===void 0?300:v,y=e.submenuCloseDelay,p=y===void 0?150:y,m=e.skipOpen,x=e.viewScroll,w=x===void 0?"initial":x,b=e.portal,C=e.theming,A=e.onItemClick,F=e.onClose,N=hd(e,Z8),O=I.exports.useRef(null),H=I.exports.useRef({}),D=N.anchorRef,U=N.state,_=I.exports.useMemo(function(){return{initialMounted:a,unmountOnClose:o,transition:l,transitionTimeout:c,boundingBoxRef:u,boundingBoxPadding:h,rootMenuRef:O,rootAnchorRef:D,scrollNodesRef:H,reposition:f,viewScroll:w}},[a,o,l,c,D,u,h,f,w]),z=I.exports.useMemo(function(){return{submenuOpenDelay:g,submenuCloseDelay:p}},[g,p]),j=I.exports.useMemo(function(){return{handleClick:function(Q,ie){Q.stopPropagation||Bi(A,Q);var ne=Q.keepOpen;ne===void 0&&(ne=ie&&Q.key===us.SPACE),ne||Bi(F,{value:Q.value,key:Q.key,reason:au.CLICK})},handleClose:function(Q){Bi(F,{key:Q,reason:au.CLICK})}}},[A,F]),R=function(Q){var ie=Q.key;switch(ie){case us.ESC:Bi(F,{key:ie,reason:au.CANCEL});break}},ee=function(Q){L2(U)&&!Q.currentTarget.contains(Q.relatedTarget||document.activeElement)&&(Bi(F,{reason:au.BLUR}),m&&(m.current=!0,setTimeout(function(){return m.current=!1},300)))},J=fd(l,"item"),le=I.exports.useMemo(function(){return{theme:C,itemTransition:J}},[C,J]),k=Ax({onKeyDown:R,onBlur:ee},s),V=E("div",ar({},s,k,{className:pd({block:F8,modifiers:le,className:i}),style:ar({},s==null?void 0:s.style,{position:"relative"}),ref:O,children:U&&E(k2.Provider,{value:_,children:E(O2.Provider,{value:z,children:E(N2.Provider,{value:j,children:E($8,ar({},N,{ariaLabel:r||"Menu",externalRef:t,containerRef:O,onClose:F}))})})})}));return b===!0&&typeof document!="undefined"?aa.exports.createPortal(V,document.body):b?b.target?aa.exports.createPortal(V,b.target):b.stablePosition?null:V:V}),$g=0,Zg=1,Wh=2,qg=3,Qg=4,Q8=5,J8=6,U2=["preEnter","entering","entered","preExit","exiting","exited","unmounted"],Jg=function(e){return e?J8:Q8},zb=function(e,t,r,i,s){clearTimeout(i.current),t(e),r.current=e,s&&s({state:U2[e]})},K8=function(e){var t=e===void 0?{}:e,r=t.enter,i=r===void 0?!0:r,s=t.exit,a=s===void 0?!0:s,o=t.preEnter,l=t.preExit,c=t.timeout,u=t.initialEntered,h=t.mountOnEnter,d=t.unmountOnExit,f=t.onChange,v=I.exports.useState(u?Wh:Jg(h)),g=v[0],y=v[1],p=I.exports.useRef(g),m=I.exports.useRef(),x,w;typeof c=="object"?(x=c.enter,w=c.exit):x=w=c;var b=I.exports.useCallback(function(){var A;switch(p.current){case Zg:case $g:A=Wh;break;case Qg:case qg:A=Jg(d);break}A!==void 0&&zb(A,y,p,m,f)},[f,d]),C=I.exports.useCallback(function(A){var F=function O(H){switch(zb(H,y,p,m,f),H){case Zg:x>=0&&(m.current=setTimeout(b,x));break;case Qg:w>=0&&(m.current=setTimeout(b,w));break;case $g:case qg:m.current=setTimeout(function(){return O(H+1)},0);break}},N=p.current<=Wh;typeof A!="boolean"&&(A=!N),A?N||F(i?o?$g:Zg:Wh):N&&F(a?l?qg:Qg:Jg(d))},[b,f,i,a,o,l,x,w,d]);return I.exports.useEffect(function(){return function(){return clearTimeout(m.current)}},[]),[U2[g],C,b]},eH=function(e){var t=e===void 0?{}:e,r=t.initialMounted,i=t.unmountOnClose,s=t.transition,a=t.transitionTimeout,o=a===void 0?500:a,l=K8({mountOnEnter:!r,unmountOnExit:i,timeout:o,enter:fd(s,"open"),exit:fd(s,"close")}),c=l[0],u=l[1],h=l[2];return[{state:z8[c],endTransition:h},u]},tH=function(e,t){var r=I.exports.memo(t),i=I.exports.forwardRef(function(s,a){var o=I.exports.useRef(null);return E(r,ar({},s,{itemRef:o,externalRef:a,isHovering:I.exports.useContext(F2)===o.current}))});return i.displayName="WithHovering("+e+")",i},nH=function(e,t,r){I.exports.useEffect(function(){if(!e){var i=t.current;return r(i,!0),function(){r(i)}}},[e,t,r])},rH=function(e,t,r,i){var s=I.exports.useContext(O2),a=s.submenuCloseDelay,o=I.exports.useContext(D2),l=o.isParentOpen,c=o.isSubmenuOpen,u=o.dispatch,h=o.updateItems,d=I.exports.useRef(0),f=function(){!r&&!i&&u(vn.SET,e.current)},v=function(){!i&&u(vn.UNSET,e.current)},g=function(x){r&&!x.currentTarget.contains(x.relatedTarget)&&v()},y=function(){c?d.current||(d.current=setTimeout(function(){d.current=0,f()},a)):f()},p=function(x,w){d.current&&(clearTimeout(d.current),d.current=0),!w&&v()};return nH(i,e,h),I.exports.useEffect(function(){return function(){return clearTimeout(d.current)}},[]),I.exports.useEffect(function(){r&&l&&t.current&&t.current.focus()},[t,r,l]),{setHover:f,onBlur:g,onMouseMove:y,onMouseLeave:p}},iH=["className","value","href","type","checked","disabled","children","onClick","isHovering","itemRef","externalRef"],sH=["setHover"],aH=tH("MenuItem",function(e){var t=e.className,r=e.value,i=e.href,s=e.type,a=e.checked,o=e.disabled,l=e.children,c=e.onClick,u=e.isHovering,h=e.itemRef,d=e.externalRef,f=hd(e,iH),v=!!o,g=rH(h,h,u,v),y=g.setHover,p=hd(g,sH),m=I.exports.useContext(N2),x=I.exports.useContext(O8),w=s==="radio",b=s==="checkbox",C=!!i&&!v&&!w&&!b,A=w?x.value===r:b?!!a:!1,F=function(_){if(v){_.stopPropagation(),_.preventDefault();return}var z={value:r,syntheticEvent:_};_.key!==void 0&&(z.key=_.key),b&&(z.checked=!A),w&&(z.name=x.name),Bi(c,z),w&&Bi(x.onRadioChange,z),m.handleClick(z,b||w)},N=function(_){if(!!u)switch(_.key){case us.ENTER:case us.SPACE:C?h.current.click():F(_);break}},O=I.exports.useMemo(function(){return{type:s,disabled:v,hover:u,checked:A,anchor:C}},[s,v,u,A,C]),H=Ax(ar({},p,{onMouseDown:y,onKeyDown:N,onClick:F}),f),D=ar({role:w?"menuitemradio":b?"menuitemcheckbox":"menuitem","aria-checked":w||b?A:void 0},f,H,R2(v,u),{ref:z2(d,h),className:pd({block:Iu,element:N8,modifiers:O,className:t}),children:I.exports.useMemo(function(){return Bi(l,O)},[l,O])});return C?E("li",{role:"presentation",children:E("a",ar({href:i},D))}):E("li",ar({},D))}),oH=["className"],mc=I.exports.memo(I.exports.forwardRef(function(e,t){var r=e.className,i=hd(e,oH);return E("li",ar({role:"separator"},i,{ref:t,className:pd({block:Iu,element:k8,className:r})}))}));const lH="_overlay_1e8la_1",cH="_noInput_1e8la_21",uH="_label_1e8la_29";var mf={overlay:lH,noInput:cH,label:uH};class dH{createLightEmittingSurface(e,t,r){if(t.length>1)r(je.toolDataSet({type:Le.LesEdit,mode:Nt.SelectParts,lightEmittingPartId:e}));else if(t.length==1){const i=t[0].id;r(je.partsSelected([i])),r(je.toolDataSet({type:Le.LesEdit,mode:Nt.SelectFaces,lightEmittingPartId:e,geometryPartId:i}))}}}const B2=new dH;function Rr(n){var e;return E(aH,{onClick:t=>{var r;return(r=n.onClick)==null?void 0:r.call(n,t)},onMouseDown:t=>{t.stopPropagation()},disabled:(e=n.disabled)!=null?e:!1,children:n.children})}function mm(n){const e=Je();return fe(Ve,{children:[E(Rr,{onClick:()=>e(je.toolDataSet({type:Le.Translate})),children:"Move"}),E(Rr,{onClick:()=>e(je.toolDataSet({type:Le.Rotate})),children:"Rotate"}),E(mc,{}),E(Rr,{onClick:()=>{e(Te.partsDeleted([n.id]))},children:"Delete"})]})}function hH(n){const e=Je(),t=Ae(bt.hasHiddenFaceGroups(n.selection.id));return n.selection.faceGroups.length?E(mH,{selection:n.selection}):fe(Ve,{children:[t?fe(Ve,{children:[E(Rr,{onClick:()=>e(je.showAllGeometryFaceGroups({partId:n.selection.id})),children:"Unhide all meshes"}),E(mc,{})]}):null,E(mm,{id:n.selection.id})]})}function fH(n){const e=Je();return fe(Ve,{children:[E(Rr,{disabled:n.selection.axis==null,onClick:()=>{n.selection.axis!=null&&e(je.toolDataSet({type:Le.EditJoint,jointId:n.selection.id,axis:n.selection.axis}))},children:"Adjust degrees of freedom"}),E(mc,{}),E(mm,{id:n.selection.id})]})}function pH(n){const e=Ae(mt.parts),t=at.selectAll(e).filter(i=>i.type==Y.Geometry).map(i=>i),r=Je();return fe(Ve,{children:[E(Rr,{onClick:()=>r(Te.rotateLeoPart({partId:n.id})),children:"Rotate G0"}),E(Rr,{onClick:()=>B2.createLightEmittingSurface(n.id,t,r),children:"Create Light Emitting Surface"}),E(mc,{}),E(mm,{id:n.id})]})}function mH(n){const e=Ae(bt.hiddenItems).find(l=>l.id==n.selection.id),t=Ae(bt.activeTool),r=Je(),i=n.selection;let s=!1,a=!1;const o=t.type==Le.LesEdit&&(t.mode==Nt.CreateLeo||t.mode==Nt.EditLesFaces||t.mode==Nt.SelectFaces);return e&&e.type==Y.Geometry?i.faceGroups.forEach(l=>{e.faceGroups.includes(l.index)?a=!0:s=!0}):s=!0,fe(Ve,{children:[o&&fe(Ve,{children:[E(Rr,{onClick:()=>r(je.expandFaceSelection()),children:"Select all faces"}),E(mc,{})]}),s&&E(Rr,{onClick:()=>r(je.hideGeometryFaceGroups({partId:i.id,groupIndices:i.faceGroups.map(l=>l.index)})),children:"Hide"}),a&&E(Rr,{onClick:()=>r(je.showGeometryFaceGroups({partId:i.id,groupIndices:i.faceGroups.map(l=>l.index)})),children:"Unhide"})]})}function gH(n){const e=Je();if(n.selection.length==0)return E(Rr,{onClick:()=>e(je.toolDataSet({type:Le.InsertPosition})),children:"Define insert position"});const t=n.selection[0];return t.type==Y.LightEmittingObject?E(pH,{id:t.id}):t.type==Y.LightEmittingSurface?fe(Ve,{children:[E(Rr,{onClick:()=>e(je.lesEditStarted(t.id)),children:"Edit"}),E(mc,{}),E(Rr,{onClick:()=>e(Te.partsDeleted([t.id])),children:"Delete"})]}):t.type==Y.Geometry?E(hH,{selection:t}):t.type==Y.Joint?E(fH,{selection:t}):E(mm,{id:n.selection[0].id})}function H2(n){const e=I.exports.useRef(null),[t,r]=eH(),[i,s]=I.exports.useState({x:0,y:0}),a=Ae(mt.partCount)>0,o=Ae(bt.selection),l=a&&o.length<=1,c=l?E(q8,{...t,anchorPoint:i,anchorRef:e,onClose:()=>r(!1),children:E(gH,{selection:o})}):null;return fe("div",{ref:e,className:mf.overlay,onContextMenu:u=>{!l||(s({x:u.clientX,y:u.clientY}),r(!0))},onMouseDown:()=>r(!1),children:[n.children,c]})}function vH(){const n=Ae(pt.ui.leftSidebarWidth),e=Je(),t=I.exports.useRef(null),[r,i]=I.exports.useState(!1),s=I.exports.useCallback(c=>{i(!0)},[]),a=c=>{e(Pe.uiLeftSidebarWidthSet(c))},o=I.exports.useCallback(()=>{i(!1)},[]),l=I.exports.useCallback(c=>{t.current&&r&&a(c.clientX-t.current.getBoundingClientRect().left+3)},[r]);return I.exports.useEffect(()=>(window.addEventListener("mousemove",l),window.addEventListener("mouseup",o),()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",o)}),[l,o]),fe("div",{className:Ra.sidebar,ref:t,style:{width:n},children:[fe("div",{className:Ra.content,children:[E("div",{className:Ra.row,children:E($B,{})}),E("div",{className:Ra.row,children:E(VB,{})}),E("div",{className:Ra.row,children:E("div",{className:Ra.element,children:E(H2,{children:E(A8,{})})})})]}),E("div",{className:Ra.dragger,onMouseDown:s})]})}function Tx(n){const e=Ae(n.sourceSelector),[t,r]=I.exports.useState(""),[i,s]=I.exports.useState(!1),[a,o]=I.exports.useState(!0);function l(f){const v=f.target.value;r(v),s(!0),n.onValidate&&o(v==e||n.onValidate(v))}function c(){var f,v;if(!!i&&!(n.required&&t.trim()=="")){if(!((v=(f=n.onValidate)==null?void 0:f.call(n,t))==null||v)){r(e),s(!1);return}n.onChange(t),s(!1)}}function u(f){f.key=="Enter"?c():f.key=="Escape"&&(r(e),s(!1))}const h=i?t:e,d=new Array;return a||d.push("invalid"),E("input",{id:n.id,className:d.join(" "),type:"text",onChange:l,onKeyDown:u,onBlur:c,value:h})}function yH(n){const e=Ae(n.sourceSelector),[t,r]=I.exports.useState(""),[i,s]=I.exports.useState(!1);function a(u){r(u.target.value),s(!0)}function o(){!i||n.required&&t.trim()==""||(n.onChange(t),s(!1))}function l(u){u.key=="Enter"?o():u.key=="Escape"&&(r(e),s(!1))}const c=i?t:e;return E("textarea",{id:n.id,onChange:a,onKeyDown:l,onBlur:o,value:c})}const xH="_grid_qk23f_1",wH="_title_qk23f_15",_H="_col2_qk23f_23",bH="_clip_qk23f_35";var Vt={grid:xH,title:wH,col2:_H,clip:bH};function SH(){const n=Je(),e=Ae(mt.partCount);return fe("div",{className:Vt.grid,children:[E("div",{className:Vt.label,children:"Name"}),E(Tx,{sourceSelector:mt.name,onChange:t=>n(Te.luminaireNameSet(t))}),E("div",{className:Vt.label,children:"Description"}),E(yH,{sourceSelector:mt.description,onChange:t=>n(Te.luminaireDescriptionSet(t))}),E("div",{}),E("button",{disabled:!e,onClick:()=>n(je.toolDataSet({type:Le.InsertPosition})),children:"Define insert position"})]})}function Yo(){}function MH(){return!0}function $c(n){return!!(n||"").match(/\d/)}function Ub(n){return n==null}function Bb(n){return n.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function EH(n){switch(n){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function AH(n,e,t){var r=EH(t),i=n.search(/[1-9]/);return i=i===-1?n.length:i,n.substring(0,i)+n.substring(i,n.length).replace(r,"$1"+e)}function x0(n,e){e===void 0&&(e=!0);var t=n[0]==="-",r=t&&e;n=n.replace("-","");var i=n.split("."),s=i[0],a=i[1]||"";return{beforeDecimal:s,afterDecimal:a,hasNagation:t,addNegation:r}}function TH(n){if(!n)return n;var e=n[0]==="-";e&&(n=n.substring(1,n.length));var t=n.split("."),r=t[0].replace(/^0+/,"")||"0",i=t[1]||"";return(e?"-":"")+r+(i?"."+i:"")}function G2(n,e,t){for(var r="",i=t?"0":"",s=0;s<=e-1;s++)r+=n[s]||i;return r}function Hb(n,e){return Array(e+1).join(n)}function CH(n){n+="";var e=n[0]==="-"?"-":"";e&&(n=n.substring(1));var t=n.split(/[eE]/g),r=t[0],i=t[1];if(i=Number(i),!i)return e+r;r=r.replace(".","");var s=1+i,a=r.length;return s<0?r="0."+Hb("0",Math.abs(s))+r:s>=a?r=r+Hb("0",s-a):r=(r.substring(0,s)||"0")+"."+r.substring(s),e+r}function PH(n,e,t){if(["","-"].indexOf(n)!==-1)return n;var r=n.indexOf(".")!==-1&&e,i=x0(n),s=i.beforeDecimal,a=i.afterDecimal,o=i.hasNagation,l=parseFloat("0."+(a||"0")),c=a.length<=e?"0."+a:l.toFixed(e),u=c.split("."),h=s.split("").reverse().reduce(function(g,y,p){return g.length>p?(Number(g[0])+Number(y)).toString()+g.substring(1,g.length):y+g},u[0]),d=G2(u[1]||"",Math.min(e,a.length),t),f=o?"-":"",v=r?".":"";return""+f+h+v+d}function Gb(n,e){if(n.value=n.value,n!==null){if(n.createTextRange){var t=n.createTextRange();return t.move("character",e),t.select(),!0}return n.selectionStart||n.selectionStart===0?(n.focus(),n.setSelectionRange(e,e),!0):(n.focus(),!1)}}function IH(n,e){for(var t=0,r=0,i=n.length,s=e.length;n[t]===e[t]&&t<i;)t++;for(;n[i-1-r]===e[s-1-r]&&s-r>t&&i-r>t;)r++;return{start:t,end:i-r}}function Kg(n,e,t){return Math.min(Math.max(n,e),t)}function Vb(n){return Math.max(n.selectionStart,n.selectionEnd)}function LH(n){return n||typeof navigator!="undefined"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function RH(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)===-1&&(t[r]=n[r]);return t}var FH={displayType:"input",decimalSeparator:".",thousandsGroupStyle:"thousand",fixedDecimalScale:!1,prefix:"",suffix:"",allowNegative:!0,allowEmptyFormatting:!1,allowLeadingZeros:!1,isNumericString:!1,type:"text",onValueChange:Yo,onChange:Yo,onKeyDown:Yo,onMouseUp:Yo,onFocus:Yo,onBlur:Yo,isAllowed:MH},Lu=function(n){function e(t){n.call(this,t);var r=t.defaultValue;this.validateProps();var i=this.formatValueProp(r);this.state={value:i,numAsString:this.removeFormatting(i),mounted:!1},this.selectionBeforeInput={selectionStart:0,selectionEnd:0},this.onChange=this.onChange.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.componentDidMount=function(){this.setState({mounted:!0})},e.prototype.componentDidUpdate=function(r){this.updateValueIfRequired(r)},e.prototype.componentWillUnmount=function(){clearTimeout(this.focusTimeout),clearTimeout(this.caretPositionTimeout)},e.prototype.updateValueIfRequired=function(r){var i=this,s=i.props,a=i.state,o=i.focusedElm,l=a.value,c=a.numAsString;if(c===void 0&&(c=""),r!==s){this.validateProps();var u=this.formatNumString(c),h=Ub(s.value)?u:this.formatValueProp(),d=this.removeFormatting(h),f=parseFloat(d),v=parseFloat(c);((!isNaN(f)||!isNaN(v))&&f!==v||u!==l||o===null&&h!==l)&&this.updateValue({formattedValue:h,numAsString:d,input:o,source:"prop",event:null})}},e.prototype.getFloatString=function(r){r===void 0&&(r="");var i=this.props,s=i.decimalScale,a=this.getSeparators(),o=a.decimalSeparator,l=this.getNumberRegex(!0),c=r[0]==="-";c&&(r=r.replace("-","")),o&&s===0&&(r=r.split(o)[0]),r=(r.match(l)||[]).join("").replace(o,".");var u=r.indexOf(".");return u!==-1&&(r=r.substring(0,u)+"."+r.substring(u+1,r.length).replace(new RegExp(Bb(o),"g"),"")),c&&(r="-"+r),r},e.prototype.getNumberRegex=function(r,i){var s=this.props,a=s.format,o=s.decimalScale,l=s.customNumerals,c=this.getSeparators(),u=c.decimalSeparator;return new RegExp("[0-9"+(l?l.join(""):"")+"]"+(u&&o!==0&&!i&&!a?"|"+Bb(u):""),r?"g":void 0)},e.prototype.getSeparators=function(){var r=this.props,i=r.decimalSeparator,s=this.props,a=s.thousandSeparator,o=s.allowedDecimalSeparators;return a===!0&&(a=","),o||(o=[i,"."]),{decimalSeparator:i,thousandSeparator:a,allowedDecimalSeparators:o}},e.prototype.getMaskAtIndex=function(r){var i=this.props,s=i.mask;return s===void 0&&(s=" "),typeof s=="string"?s:s[r]||" "},e.prototype.getValueObject=function(r,i){var s=parseFloat(i);return{formattedValue:r,value:i,floatValue:isNaN(s)?void 0:s}},e.prototype.validateProps=function(){var r=this.props,i=r.mask,s=this.getSeparators(),a=s.decimalSeparator,o=s.thousandSeparator;if(a===o)throw new Error(`
          Decimal separator can't be same as thousand separator.
          thousandSeparator: `+o+` (thousandSeparator = {true} is same as thousandSeparator = ",")
          decimalSeparator: `+a+` (default value for decimalSeparator is .)
       `);if(i){var l=i==="string"?i:i.toString();if(l.match(/\d/g))throw new Error(`
          Mask `+i+` should not contain numeric character;
        `)}},e.prototype.setPatchedCaretPosition=function(r,i,s){Gb(r,i),this.caretPositionTimeout=setTimeout(function(){r.value===s&&Gb(r,i)},0)},e.prototype.correctCaretPosition=function(r,i,s){var a=this.props,o=a.prefix,l=a.suffix,c=a.format;if(r==="")return 0;if(i=Kg(i,0,r.length),!c){var u=r[0]==="-";return Kg(i,o.length+(u?1:0),r.length-l.length)}if(typeof c=="function"||c[i]==="#"&&$c(r[i])||c[i-1]==="#"&&$c(r[i-1]))return i;var h=c.indexOf("#"),d=c.lastIndexOf("#");i=Kg(i,h,d+1);for(var f=c.substring(i,c.length).indexOf("#"),v=i,g=i+(f===-1?0:f);v>h&&(c[v]!=="#"||!$c(r[v]));)v-=1;var y=!$c(r[g])||s==="left"&&i!==h||i-v<g-i;return y?$c(r[v])?v+1:v:g},e.prototype.getCaretPosition=function(r,i,s){var a=this.props,o=a.format,l=this.state.value,c=this.getNumberRegex(!0),u=(r.match(c)||[]).join(""),h=(i.match(c)||[]).join(""),d,f;for(d=0,f=0;f<s;f++){var v=r[f]||"",g=i[d]||"";if(!(!v.match(c)&&v!==g)&&!(v==="0"&&g.match(c)&&g!=="0"&&u.length!==h.length)){for(;v!==i[d]&&d<i.length;)d++;d++}}return typeof o=="string"&&!l&&(d=i.length),d=this.correctCaretPosition(i,d),d},e.prototype.removePrefixAndSuffix=function(r){var i=this.props,s=i.format,a=i.prefix,o=i.suffix;if(!s&&r){var l=r[0]==="-";l&&(r=r.substring(1,r.length)),r=a&&r.indexOf(a)===0?r.substring(a.length,r.length):r;var c=r.lastIndexOf(o);r=o&&c!==-1&&c===r.length-o.length?r.substring(0,c):r,l&&(r="-"+r)}return r},e.prototype.removePatternFormatting=function(r){for(var i=this.props,s=i.format,a=s.split("#").filter(function(f){return f!==""}),o=0,l="",c=0,u=a.length;c<=u;c++){var h=a[c]||"",d=c===u?r.length:r.indexOf(h,o);if(d===-1){l=r;break}else l+=r.substring(o,d),o=d+h.length}return(l.match(this.getNumberRegex(!0))||[]).join("")},e.prototype.removeFormatting=function(r){var i=this.props,s=i.format,a=i.removeFormatting;return r&&(s?typeof s=="string"?r=this.removePatternFormatting(r):typeof a=="function"?r=a(r):r=(r.match(this.getNumberRegex(!0))||[]).join(""):(r=this.removePrefixAndSuffix(r),r=this.getFloatString(r)),r)},e.prototype.formatWithPattern=function(r){for(var i=this.props,s=i.format,a=0,o=s.split(""),l=0,c=s.length;l<c;l++)s[l]==="#"&&(o[l]=r[a]||this.getMaskAtIndex(a),a+=1);return o.join("")},e.prototype.formatAsNumber=function(r){var i=this.props,s=i.decimalScale,a=i.fixedDecimalScale,o=i.prefix,l=i.suffix,c=i.allowNegative,u=i.thousandsGroupStyle,h=this.getSeparators(),d=h.thousandSeparator,f=h.decimalSeparator,v=r.indexOf(".")!==-1||s&&a,g=x0(r,c),y=g.beforeDecimal,p=g.afterDecimal,m=g.addNegation;return s!==void 0&&(p=G2(p,s,a)),d&&(y=AH(y,d,u)),o&&(y=o+y),l&&(p=p+l),m&&(y="-"+y),r=y+(v&&f||"")+p,r},e.prototype.formatNumString=function(r){r===void 0&&(r="");var i=this.props,s=i.format,a=i.allowEmptyFormatting,o=i.customNumerals,l=r;if(o&&o.length===10){var c=new RegExp("["+o.join("")+"]","g");l=r.replace(c,function(u){return o.indexOf(u).toString()})}return r===""&&!a?l="":r==="-"&&!s?l="-":typeof s=="string"?l=this.formatWithPattern(l):typeof s=="function"?l=s(l):l=this.formatAsNumber(l),l},e.prototype.formatValueProp=function(r){var i=this.props,s=i.format,a=i.decimalScale,o=i.fixedDecimalScale,l=i.allowEmptyFormatting,c=this.props,u=c.value,h=c.isNumericString;u=Ub(u)?r:u;var d=!u&&u!==0;if(d&&l&&(u=""),d&&!l)return"";typeof u=="number"&&(u=CH(u),h=!0),u==="Infinity"&&h&&(u=""),h&&!s&&typeof a=="number"&&(u=PH(u,a,o));var f=h?this.formatNumString(u):this.formatInput(u);return f},e.prototype.formatNegation=function(r){r===void 0&&(r="");var i=this.props,s=i.allowNegative,a=new RegExp("(-)"),o=new RegExp("(-)(.)*(-)"),l=a.test(r),c=o.test(r);return r=r.replace(/-/g,""),l&&!c&&s&&(r="-"+r),r},e.prototype.formatInput=function(r){r===void 0&&(r="");var i=this.props,s=i.format;return s||(r=this.removePrefixAndSuffix(r),r=this.formatNegation(r)),r=this.removeFormatting(r),this.formatNumString(r)},e.prototype.isCharacterAFormat=function(r,i){var s=this.props,a=s.format,o=s.prefix,l=s.suffix,c=s.decimalScale,u=s.fixedDecimalScale,h=this.getSeparators(),d=h.decimalSeparator;return!!(typeof a=="string"&&a[r]!=="#"||!a&&(r<o.length||r>=i.length-l.length||c&&u&&i[r]===d))},e.prototype.correctInputValue=function(r,i,s){var a=this,o=this.props,l=o.format,c=o.allowNegative,u=o.prefix,h=o.suffix,d=o.decimalScale,f=this.getSeparators(),v=f.allowedDecimalSeparators,g=f.decimalSeparator,y=this.state.numAsString||"",p=this.selectionBeforeInput,m=p.selectionStart,x=p.selectionEnd,w=IH(i,s),b=w.start,C=w.end;if(!l&&b===C&&v.indexOf(s[m])!==-1){var A=d===0?"":g;return s.substr(0,m)+A+s.substr(m+1,s.length)}var F=l?0:u.length,N=i.length-(l?0:h.length);if(s.length>i.length||!s.length||b===C||m===0&&x===i.length||b===0&&C===i.length||m===F&&x===N)return s;var O=i.substr(b,C-b),H=!![].concat(O).find(function(k,V){return a.isCharacterAFormat(V+b,i)});if(H){var D=i.substr(b),U={},_=[];[].concat(D).forEach(function(k,V){a.isCharacterAFormat(V+b,i)?U[V]=k:V>O.length-1&&_.push(k)}),Object.keys(U).forEach(function(k){_.length>k?_.splice(k,0,U[k]):_.push(U[k])}),s=i.substr(0,b)+_.join("")}if(!l){var z=this.removeFormatting(s),j=x0(z,c),R=j.beforeDecimal,ee=j.afterDecimal,J=j.addNegation,le=r<s.indexOf(g)+1;if(z.length<y.length&&le&&R===""&&!parseFloat(ee))return J?"-":""}return s},e.prototype.updateValue=function(r){var i=r.formattedValue,s=r.input,a=r.setCaretPosition;a===void 0&&(a=!0);var o=r.source,l=r.event,c=r.numAsString,u=r.caretPos,h=this.props,d=h.onValueChange,f=this.state,v=f.value;if(s){if(u===void 0&&a){var g=r.inputValue||s.value,y=Vb(s);s.value=i,u=this.getCaretPosition(g,i,y)}s.value=i,a&&this.setPatchedCaretPosition(s,u,i)}c===void 0&&(c=this.removeFormatting(i)),i!==v&&(this.setState({value:i,numAsString:c}),d(this.getValueObject(i,c),{event:l,source:o}))},e.prototype.onChange=function(r){var i=r.target,s=i.value,a=this,o=a.state,l=a.props,c=l.isAllowed,u=o.value||"",h=Vb(i);s=this.correctInputValue(h,u,s);var d=this.formatInput(s)||"",f=this.removeFormatting(d),v=this.getValueObject(d,f),g=c(v);g||(d=u),this.updateValue({formattedValue:d,numAsString:f,inputValue:s,input:i,event:r,source:"event"}),g&&l.onChange(r)},e.prototype.onBlur=function(r){var i=this,s=i.props,a=i.state,o=s.format,l=s.onBlur,c=s.allowLeadingZeros,u=a.numAsString,h=a.value;if(this.focusedElm=null,clearTimeout(this.focusTimeout),clearTimeout(this.caretPositionTimeout),!o){isNaN(parseFloat(u))&&(u=""),c||(u=TH(u));var d=this.formatNumString(u);if(d!==h){this.updateValue({formattedValue:d,numAsString:u,input:r.target,setCaretPosition:!1,event:r,source:"event"}),l(r);return}}l(r)},e.prototype.onKeyDown=function(r){var i=r.target,s=r.key,a=i.selectionStart,o=i.selectionEnd,l=i.value;l===void 0&&(l="");var c,u=this.props,h=u.decimalScale,d=u.fixedDecimalScale,f=u.prefix,v=u.suffix,g=u.format,y=u.onKeyDown,p=h!==void 0&&d,m=this.getNumberRegex(!1,p),x=new RegExp("-"),w=typeof g=="string";if(this.selectionBeforeInput={selectionStart:a,selectionEnd:o},s==="ArrowLeft"||s==="Backspace"?c=a-1:s==="ArrowRight"?c=a+1:s==="Delete"&&(c=a),c===void 0||a!==o){y(r);return}var b=c,C=w?g.indexOf("#"):f.length,A=w?g.lastIndexOf("#")+1:l.length-v.length;if(s==="ArrowLeft"||s==="ArrowRight"){var F=s==="ArrowLeft"?"left":"right";b=this.correctCaretPosition(l,c,F)}else if(s==="Delete"&&!m.test(l[c])&&!x.test(l[c]))for(;!m.test(l[b])&&b<A;)b++;else if(s==="Backspace"&&!m.test(l[c])){if(a<=C+1&&l[0]==="-"&&typeof g=="undefined"){var N=l.substring(1);this.updateValue({formattedValue:N,caretPos:b,input:i,event:r,source:"event"})}else if(!x.test(l[c])){for(;!m.test(l[b-1])&&b>C;)b--;b=this.correctCaretPosition(l,b,"left")}}(b!==c||c<C||c>A)&&(r.preventDefault(),this.setPatchedCaretPosition(i,b,l)),r.isUnitTestRun&&this.setPatchedCaretPosition(i,b,l),y(r)},e.prototype.onMouseUp=function(r){var i=r.target,s=i.selectionStart,a=i.selectionEnd,o=i.value;if(o===void 0&&(o=""),s===a){var l=this.correctCaretPosition(o,s);l!==s&&this.setPatchedCaretPosition(i,l,o)}this.props.onMouseUp(r)},e.prototype.onFocus=function(r){var i=this;r.persist(),this.focusedElm=r.target,this.focusTimeout=setTimeout(function(){var s=r.target,a=s.selectionStart,o=s.selectionEnd,l=s.value;l===void 0&&(l="");var c=i.correctCaretPosition(l,a);c!==a&&!(a===0&&o===l.length)&&i.setPatchedCaretPosition(s,c,l),i.props.onFocus(r)},0)},e.prototype.render=function(){var r=this.props,i=r.type,s=r.displayType,a=r.customInput,o=r.renderText,l=r.getInputRef,c=r.format;r.thousandSeparator,r.decimalSeparator,r.allowedDecimalSeparators,r.thousandsGroupStyle,r.decimalScale,r.fixedDecimalScale,r.prefix,r.suffix,r.removeFormatting,r.mask,r.defaultValue,r.isNumericString,r.allowNegative,r.allowEmptyFormatting,r.allowLeadingZeros,r.onValueChange,r.isAllowed,r.customNumerals,r.onChange,r.onKeyDown,r.onMouseUp,r.onFocus,r.onBlur,r.value;var u=RH(r,["type","displayType","customInput","renderText","getInputRef","format","thousandSeparator","decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","decimalScale","fixedDecimalScale","prefix","suffix","removeFormatting","mask","defaultValue","isNumericString","allowNegative","allowEmptyFormatting","allowLeadingZeros","onValueChange","isAllowed","customNumerals","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value"]),h=u,d=this.state,f=d.value,v=d.mounted,g=v&&LH(c)?"numeric":void 0,y=Object.assign({inputMode:g},h,{type:i,value:f,onChange:this.onChange,onKeyDown:this.onKeyDown,onMouseUp:this.onMouseUp,onFocus:this.onFocus,onBlur:this.onBlur});if(s==="text")return o?o(f,h)||null:Zr.createElement("span",Object.assign({},h,{ref:l}),f);if(a){var p=a;return Zr.createElement(p,Object.assign({},y,{ref:l}))}return Zr.createElement("input",Object.assign({},y,{ref:l}))},e}(Zr.Component);Lu.defaultProps=FH;const DH="_control_86mwv_1",NH="_inputX_86mwv_11",kH="_inputY_86mwv_19",OH="_inputZ_86mwv_27",zH="_red_86mwv_53",UH="_green_86mwv_61",BH="_blue_86mwv_69",HH="_svg_86mwv_77",GH="_firstSvg_86mwv_95";var di={control:DH,inputX:NH,inputY:kH,inputZ:OH,red:zH,green:UH,blue:BH,svg:HH,firstSvg:GH};function w0(n){const e=Ae(n.sourceSelector),[t,r]=I.exports.useState(!1),[i,s]=I.exports.useState(e.x),[a,o]=I.exports.useState(e.y),[l,c]=I.exports.useState(e.y);var u=null;if(n.tempSourceSelector){const p=Ae(n.tempSourceSelector);p!=null&&(u=p)}u!=null?(i!=u.x&&s(u.x),a!=u.y&&o(u.y),l!=u.z&&c(u.z)):t||(i!=e.x&&s(e.x),a!=e.y&&o(e.y),l!=e.z&&c(e.z));function h(){t&&(i!=e.x||a!=e.y||l!=e.z)&&!Number.isNaN(i)&&!Number.isNaN(a)&&!Number.isNaN(l)?n.onChange({x:i,y:a,z:l}):(s(e.x),o(e.y),c(e.z)),r(!1)}function d(p){h()}function f(p){p.key=="Enter"?h():p.key=="Escape"&&(s(e.x),o(e.y),c(e.z),r(!1))}function v(p){s(parseFloat(p.currentTarget.value)),r(!0)}function g(p){o(parseFloat(p.currentTarget.value)),r(!0)}function y(p){c(parseFloat(p.currentTarget.value)),r(!0)}return fe("div",{className:di.control,children:[E("svg",{className:[di.svg,di.firstSvg].join(" "),children:E("rect",{className:di.red,x:"0",y:"0",width:"12",height:"12"})}),E("div",{className:di.inputX,children:E(Lu,{value:i,decimalScale:3,fixedDecimalScale:!0,allowedDecimalSeparators:[".",","],onBlur:d,onKeyDown:f,onChange:v})}),E("svg",{className:di.svg,children:E("rect",{className:di.green,x:"0",y:"0",width:"12",height:"12"})}),E("div",{className:di.inputY,children:E(Lu,{value:a,decimalScale:3,fixedDecimalScale:!0,allowedDecimalSeparators:[".",","],onBlur:d,onKeyDown:f,onChange:g})}),E("svg",{className:di.svg,children:E("rect",{className:di.blue,x:"0",y:"0",width:"12",height:"12"})}),E("div",{className:di.inputZ,children:E(Lu,{value:l,decimalScale:3,fixedDecimalScale:!0,allowedDecimalSeparators:[".",","],onBlur:d,onKeyDown:f,onChange:y})})]})}function V2(n){return n.vector?fe("span",{children:[n.vector.x.toFixed(3),"m x ",n.vector.y.toFixed(3),"m x ",n.vector.z.toFixed(3),"m"]}):E(Ve,{})}function VH(n){const e=Ae(mt.meshDefinition(n.part.meshId)),t=Je();if(e==null)return E(Ve,{});const r=()=>{t(je.toolDataSet({type:Le.LesEdit,mode:Nt.CreateLeo,geometryPartId:n.part.id}))},i=s=>{const a=s.currentTarget.checked;t(Te.geometryPartIncludedInMeasurementChanged({partId:n.part.id,included:a}))};return fe(Ve,{children:[E("div",{children:"Size"}),E(V2,{vector:e.scaledSize}),E("div",{}),E("button",{onClick:r,children:"Create Light Emitting Object"}),E("div",{}),fe("div",{children:[E("input",{type:"checkbox",checked:n.part.includedInMeasurement,onChange:i}),"Included in Measurement"]})]})}function Mi(n){var h;const[e,t]=I.exports.useState(0),[r,i]=I.exports.useState(!1),s=n.id,a=(h=n.decimals)!=null?h:3;!r&&e!=n.value&&t(n.value);function o(){r&&e!=n.value&&!Number.isNaN(e)?n.onChanged(e):t(n.value),i(!1)}function l(d){o()}function c(d){d.key=="Enter"?o():d.key=="Escape"&&(t(n.value),i(!1))}function u(d){const f=Number.parseFloat(d.target.value);t(f),i(!0)}return E(Lu,{value:e,id:s,decimalScale:a,fixedDecimalScale:!0,allowedDecimalSeparators:[".",","],onBlur:l,onKeyDown:c,onChange:u})}const jH="_grid_2klof_1",WH="_dog_2klof_49",XH="_red_2klof_57",YH="_green_2klof_65",$H="_blue_2klof_73",ZH="_svg_2klof_81";var za={grid:jH,dog:WH,red:XH,green:YH,blue:$H,svg:ZH};function ev(n){const e=Ae(pt.temp.jointAxisData);function t(c){var f;const u=tt.anglePlusMinus180(c),h=u>n.data.max?n.data.max:u,d={...n.data,min:h,default:tt.valueInMinMaxRange(n.data.default,h,n.data.max)};(f=n.onChanged)==null||f.call(n,d)}function r(c){var h;const u={...n.data,default:tt.valueInMinMaxRange(c,n.data.min,n.data.max)};(h=n.onChanged)==null||h.call(n,u)}function i(c){var f;const u=tt.anglePlusMinus180(c),h=u<n.data.min?n.data.min:u,d={...n.data,max:h,default:tt.valueInMinMaxRange(n.data.default,n.data.min,h)};(f=n.onChanged)==null||f.call(n,d)}function s(c){var d;const u=tt.valueInMinMaxRange(c,0,180),h={...n.data,step:u};(d=n.onChanged)==null||d.call(n,h)}let a=n.data.min,o=n.data.default,l=n.data.max;return e!=null&&e.axis==n.axis&&(a=e.min,o=e.default,l=e.max),E(Ve,{children:fe("div",{className:za.grid,children:[E("label",{children:"Min"}),E(Mi,{value:a,onChanged:t,decimals:1}),E("label",{children:"Default"}),E(Mi,{value:o,onChanged:r,decimals:1}),E("label",{children:"Max"}),E(Mi,{value:l,onChanged:i,decimals:1}),E("label",{children:"Step"}),E(Mi,{value:n.data.step,onChanged:s,decimals:1})]})})}function qH(n){Ae(bt.activeTool);const e=Je(),t=n.part;function r(u){const h=u.currentTarget.checked;e(Te.jointPartXAxisChanged({partId:t.id,axis:{...t.xAxis,isRotatable:h}}))}function i(u){const h=u.currentTarget.checked;e(Te.jointPartYAxisChanged({partId:t.id,axis:{...t.yAxis,isRotatable:h}}))}function s(u){const h=u.currentTarget.checked;e(Te.jointPartZAxisChanged({partId:t.id,axis:{...t.zAxis,isRotatable:h}}))}function a(u){e(Te.jointPartXAxisChanged({partId:t.id,axis:u}))}function o(u){e(Te.jointPartYAxisChanged({partId:t.id,axis:u}))}function l(u){e(Te.jointPartZAxisChanged({partId:t.id,axis:u}))}function c(u){e(je.jointPartSelected({id:t.id,axis:u})),e(je.toolDataSet({type:Le.EditJoint,jointId:t.id,axis:u}))}return fe(Ve,{children:[E("div",{className:Vt.title,children:"Degrees of freedom"}),fe("div",{children:[E("svg",{className:za.svg,children:E("rect",{className:za.red,x:"0",y:"0",width:"12",height:"12"})}),E("label",{children:"X-Axis"})]}),fe("div",{className:Vt.col2,children:[E("input",{type:"checkbox",checked:t.xAxis.isRotatable,onChange:r}),t.xAxis.isRotatable&&E("button",{onClick:()=>c(xt.X),children:"Adjust"})]}),E("div",{}),E("div",{children:t.xAxis.isRotatable&&E(ev,{axis:xt.X,data:t.xAxis,onChanged:a})}),fe("div",{children:[E("svg",{className:za.svg,children:E("rect",{className:za.green,x:"0",y:"0",width:"12",height:"12"})}),E("label",{children:"Y-Axis"})]}),fe("div",{className:Vt.col2,children:[E("input",{type:"checkbox",checked:t.yAxis.isRotatable,onChange:i}),t.yAxis.isRotatable&&E("button",{onClick:()=>c(xt.Y),children:"Adjust"})]}),E("div",{}),E("div",{children:t.yAxis.isRotatable&&E(ev,{axis:xt.Y,data:t.yAxis,onChanged:o})}),fe("div",{children:[E("svg",{className:za.svg,children:E("rect",{className:za.blue,x:"0",y:"0",width:"12",height:"12"})}),E("label",{children:"Z-Axis"})]}),fe("div",{className:Vt.col2,children:[E("input",{type:"checkbox",checked:t.zAxis.isRotatable,onChange:s}),t.zAxis.isRotatable&&E("button",{onClick:()=>c(xt.Z),children:"Adjust"})]}),E("div",{}),E("div",{children:t.zAxis.isRotatable&&E(ev,{axis:xt.Z,data:t.zAxis,onChanged:l})})]})}const QH="_lesView_17ryc_1",JH="_partName_17ryc_15";var j2={lesView:QH,partName:JH};function KH(n){const e=Je(),t=n.leo.intensity,r=i=>{const s=Number.parseFloat(i.target.value);e(Te.lesLeoAssignmentIntensityChanged({lesId:n.les.id,leoId:n.leo.part.id,intensity:s}))};return fe(Ve,{children:[E("div",{children:n.les.partName}),E("select",{value:t,onChange:r,children:Array.from(Array(10).keys()).reverse().map(i=>fe("option",{value:(i+1)/10,children:[(i+1)*10,"%"]},i))})]})}function e7(n){const e=n.les.geometryPart;if(!n.les.lightEmittingObjects.length)return E(Ve,{});const t=n.les.faceCount;return fe(Ve,{children:[E("div",{children:"Geometry:"}),E("div",{className:j2.partName,children:e.name}),n.les.lightEmittingObjects.map(r=>E(KH,{leo:r,les:n.les},r.part.id)),E("div",{children:"Faces:"}),E("div",{children:t})]})}function t7(n){const e=Ae(mt.lightEmittingSurfacesForLeo(n.leoPartId));return e.length?E("div",{className:j2.lesView,children:e.map(t=>E(e7,{les:t},t.id))}):E("div",{children:"This Light Emitting Object has no assigned Light Emitting Surfaces!"})}const n7="_grid_16kd6_1";var r7={grid:n7};function i7(n){const e=Ae(pt.temp.leoShape),t=Je(),r=n.part.shape;if(r.type!=Oe.Rectangle)return E(Ve,{});function i(o,l){o<.001&&(o=.001),l<.001&&(l=.001),t(Te.lightEmittingPartShapeChanged({partId:n.part.id,shape:{type:Oe.Rectangle,sizeX:o,sizeY:l}}))}const s=e!=null&&e.type==Oe.Rectangle?e.sizeX:r.sizeX,a=e!=null&&e.type==Oe.Rectangle?e.sizeY:r.sizeY;return fe(Ve,{children:[E("label",{children:"Size X"}),E(Mi,{value:s,onChanged:o=>i(o,a)}),E("label",{children:"Size Y"}),E(Mi,{value:a,onChanged:o=>i(s,o)})]})}function s7(n){const e=Ae(pt.temp.leoShape),t=Je(),r=n.part.shape;if(r.type!=Oe.Circle)return E(Ve,{});const i=e!=null&&e.type==Oe.Circle?e.diameter:r.diameter;return fe(Ve,{children:[E("label",{children:"Diameter"}),E(Mi,{value:i,onChanged:s=>t(Te.lightEmittingPartShapeChanged({partId:n.part.id,shape:{type:Oe.Circle,diameter:s<.001?.001:s}}))})]})}function a7(n){const e=Ae(mt.parts),t=Je(),r=at.selectAll(e).filter(d=>d.type==Y.Geometry).map(d=>d),i=n.part.shape,s=d=>{if(d==Oe.Rectangle)return{type:Oe.Rectangle,sizeX:i.type==Oe.Circle?i.diameter:.1,sizeY:i.type==Oe.Circle?i.diameter:.1};if(d==Oe.Circle)return{type:Oe.Circle,diameter:i.type==Oe.Rectangle?i.sizeX:.1};throw new Error("Unknown light emitting shape type!")},a=d=>{const f=Number.parseInt(d.target.value);t(Te.lightEmittingPartShapeChanged({partId:n.part.id,shape:s(f)}))},o=()=>{B2.createLightEmittingSurface(n.part.id,r,t)},l=n.part.luminousHeights,c=d=>{const f={...l};d(f),t(Te.lightEmittingPartLuminousHeightsChanged({partId:n.part.id,luminousHeights:f}))},u=()=>{t(Te.rotateLeoPart({partId:n.part.id}))},h=()=>{t(je.toolDataSet({type:Le.ScaleLeo}))};return fe(Ve,{children:[E("label",{htmlFor:"lightEmittingShapeTypeSelect",children:"Shape"}),fe("select",{id:"lightEmittingShapeTypeSelect",value:i.type,onChange:d=>a(d),children:[E("option",{value:Oe.Rectangle,children:"Rectangular"}),E("option",{value:Oe.Circle,children:"Circular"})]}),i.type==Oe.Rectangle&&E(i7,{part:n.part}),i.type==Oe.Circle&&E(s7,{part:n.part}),E("div",{}),E("button",{onClick:()=>h(),children:"Scale LEO"}),E("div",{}),E("button",{onClick:()=>u(),children:"Rotate G0"}),E("div",{className:Vt.title,children:"Luminous Heights"}),E("div",{}),fe("div",{className:r7.grid,children:[E("div",{children:"C0"}),E(Mi,{value:l.c0,onChanged:d=>c(f=>f.c0=d)}),E("div",{children:"C90"}),E(Mi,{value:l.c90,onChanged:d=>c(f=>f.c90=d)}),E("div",{children:"C180"}),E(Mi,{value:l.c180,onChanged:d=>c(f=>f.c180=d)}),E("div",{children:"C270"}),E(Mi,{value:l.c270,onChanged:d=>c(f=>f.c270=d)})]}),E("div",{className:Vt.title,children:"Light Emitting Surfaces"}),E("div",{}),E("button",{onClick:o,children:"Create Light Emitting Surface"}),E("div",{}),E(t7,{leoPartId:n.part.id})]})}const o7="_assignmentsHeader_165jg_1";var l7={assignmentsHeader:o7};function c7(n){const e=Ae(mt.lightEmittingPart(n.assignment.lightEmittingObjectId)),t=Je(),r=n.assignment.intensity,i=s=>{const a=Number.parseFloat(s.target.value);t(Te.lesLeoAssignmentIntensityChanged({lesId:n.lesId,leoId:n.assignment.lightEmittingObjectId,intensity:a}))};return fe(Ve,{children:[E("div",{className:Vt.clip,children:e.name}),E("select",{value:r,onChange:i,children:Array.from(Array(10).keys()).reverse().map(s=>fe("option",{value:(s+1)/10,children:[(s+1)*10,"%"]},s))})]})}function u7(n){const e=Ae(mt.geometryPart(n.part.parentId)),t=Je(),r=id.selectAll(n.part.lightEmittingObjects),i=o=>{t(Te.partNameSet({partId:n.part.id,name:o}))},s=new Tu().getFaceCount(n.part),a=o=>!!o.match(Lr.partNameRe)&&!mt.isPartNameTaken(o)(me.getState());return fe(Ve,{children:[E("div",{children:"ID"}),E(Tx,{sourceSelector:mt.partName(n.part.id),onChange:i,onValidate:a}),E("div",{children:"Geometry"}),E("div",{className:Vt.clip,children:e.name}),E("div",{className:l7.assignmentsHeader,children:"Light Emitting Parts"}),r.map(o=>E(c7,{assignment:o,lesId:n.part.id},o.lightEmittingObjectId)),E("div",{children:"Assigned Faces"}),E("div",{children:s}),E("div",{}),E("button",{onClick:()=>t(je.lesEditStarted(n.part.id)),children:"Edit Assigned Faces"})]})}function d7(n){const e=Je(),t=Ae(mt.part(n.partId)),r=Ae(bt.fixChildren);if(!t)return E(Ve,{});const i=t.type!=Y.LightEmittingSurface,s=t.type!=Y.LightEmittingSurface&&t.type!=Y.PendulumConnector&&t.type!=Y.ElectricalConnector,a=t.type!=Y.LightEmittingSurface,o=c=>{e(Te.partNameSet({partId:n.partId,name:c}))},l=c=>!!c.match(Lr.partNameRe)&&!mt.isPartNameTaken(c)(me.getState());return fe("div",{className:Vt.grid,children:[i&&fe(Ve,{children:[E("div",{children:"ID"}),E(Tx,{sourceSelector:mt.partName(n.partId),onChange:o,onValidate:l})]}),a&&fe(Ve,{children:[E("div",{children:"Position"}),E(w0,{sourceSelector:mt.partPosition(n.partId),onChange:c=>e(Te.partPositionSet({partId:n.partId,position:c,lockChildren:r})),tempSourceSelector:pt.temp.position})]}),s&&fe(Ve,{children:[E("div",{children:"Rotation"}),E(w0,{sourceSelector:mt.partRotation(n.partId),onChange:c=>e(Te.partRotationSet({partId:n.partId,rotation:c,lockChildren:r})),tempSourceSelector:pt.temp.rotation})]}),t.type==Y.Geometry&&E(VH,{part:t}),t.type==Y.Joint&&E(qH,{part:t}),t.type==Y.LightEmittingObject&&E(a7,{part:t}),t.type==Y.LightEmittingSurface&&E(u7,{part:t})]})}function h7(){const n=Ae(bt.selectedPartEntities),e=sn.selectAll(n);return e.length==0?E(SH,{}):e.length==1?E(d7,{partId:e[0].id}):E(Ve,{})}function f7(){const n=Je();return E(Ve,{children:E("button",{onClick:()=>{n(je.toolDataSet({type:Le.LesEdit,mode:Nt.SelectParts,clearSelection:!0}))},children:"Create New LES"})})}function Cx(){return fe("div",{className:["hintBox","info"].join(" "),children:[E("div",{className:"title",children:"\u26A0 Hint"}),fe("div",{className:"content",children:['You can select all faces of a mesh by picking a single face, then right clicking and selecting the "Select all faces" action in the context menu.',E("br",{}),'Or by right clicking the mesh in the "Structure" tree and selecting the same action.']})]})}function W2(){return fe("div",{className:["hintBox","error"].join(" "),children:[E("div",{className:"title",children:"\u26A0 Error"}),E("div",{className:"content",children:"You must select at least one face!"})]})}function p7(){const n=Ae(bt.activeTool);return n.type!=Le.LesEdit?(He.warn(Xe.UnexpectedToolTypeInLesEditToolProperties,`Unexpected tool type ${n.type}!`),E(Ve,{})):n.mode!=Nt.SelectParts?(He.warn(Xe.UnexpectedToolModeInLesEditToolProperties,`Unexpected tool mode ${n.mode}!`),E(Ve,{})):n.lightEmittingPartId==null?E(Ve,{children:"Please select a light emitting object (LEO) for LES"}):n.geometryPartId==null?E(Ve,{children:"Please select a geometry object for LES"}):E(Ve,{})}function m7(){const n=Ae(bt.activeTool),e=Ae(bt.selectedParts),t=Ae(bt.activeTool),r=Je(),i=e.length==0||e[0].faceGroups.size==0,s=()=>{if(n.type!=Le.LesEdit||e.length==0||e[0].faceGroups.size==0)return;const o=n.geometryPartId,l=n.lightEmittingPartId;if(o==null||l==null||o!=e[0].part.id)return;const c=new Array;e[0].faceGroups.forEach((u,h)=>{!u.size||c.push({groupId:h,faces:Array.from(u.values())})}),r(Te.lesCreated({geometryPartId:o,lightEmittingPartId:l,faceGroups:c}))},a=()=>{const o=t.type==Le.LesEdit?t.lightEmittingPartId:null;r(je.toolDataSet({type:Le.None})),o&&r(je.partsSelected([o]))};return fe(Ve,{children:[E("div",{children:"Please select faces on the geometry object and click create"}),E("div",{className:Vt.grid,children:fe("div",{className:[Vt.title,Vt.col2].join(" "),children:[E("button",{disabled:i,onClick:s,children:"Create"}),E("button",{onClick:a,children:"Cancel"})]})}),E(Cx,{}),i?E(W2,{}):null]})}function g7(){const n=Ae(bt.activeTool),e=Je(),t=()=>{document.dispatchEvent(new Event("lightEmittingObjectFromSelectionRequest"))},r=()=>{const i=n.type==Le.LesEdit?n.geometryPartId:null;e(je.toolDataSet({type:Le.None})),i&&e(je.partsSelected([i]))};return fe(Ve,{children:[E("div",{children:"Please select faces for new Light Emitting Object and click create"}),E("div",{className:Vt.grid,children:fe("div",{className:[Vt.title,Vt.col2].join(" "),children:[E("button",{onClick:t,children:"Create"}),E("button",{onClick:r,children:"Cancel"})]})}),E(Cx,{})]})}function v7(){const n=Ae(bt.activeTool),e=Ae(bt.selectedParts),t=Je(),r=e.length==0||e[0].faceGroups.size==0,i=()=>{if(n.type!=Le.LesEdit||n.lesId==null||e.length==0||e[0].faceGroups.size==0)return;const a=new Array;e[0].faceGroups.forEach((o,l)=>{!o.size||a.push({groupId:l,faces:Array.from(o.values())})}),t(Te.lesUpdated({id:n.lesId,faceGroups:a}))},s=()=>{const a=n.type==Le.LesEdit?n.lesId:null;t(je.toolDataSet({type:Le.None})),a&&t(je.partsSelected([a]))};return fe(Ve,{children:[E("div",{children:"Please select faces on the geometry object and click submit to update the LES"}),E("div",{className:Vt.grid,children:fe("div",{className:[Vt.title,Vt.col2].join(" "),children:[E("button",{disabled:r,onClick:i,children:"Submit"}),E("button",{onClick:s,children:"Cancel"})]})}),E(Cx,{}),r?E(W2,{}):null]})}function y7(){const n=Ae(bt.activeTool);return n.type!=Le.LesEdit?E(Ve,{}):n.mode==Nt.None?E(f7,{}):n.mode==Nt.SelectParts?E(p7,{}):n.mode==Nt.SelectFaces?E(m7,{}):n.mode==Nt.EditLesFaces?E(v7,{}):n.mode==Nt.CreateLeo?E(g7,{}):E(Ve,{})}function x7(){const n=Ae(pt.temp.insertPoint),e=Je(),t=!!n&&(n.x!=0||n.y!=0||n.z!=0);return fe("div",{className:Vt.grid,children:[E("div",{children:"Offset"}),E(w0,{onChange:r=>e(Pe.tempInsertPointSet(r)),sourceSelector:pt.temp.insertPoint}),E("div",{}),fe("div",{className:[Vt.title,Vt.col2].join(" "),children:[E("button",{disabled:!t,onClick:()=>{t&&(e(je.toolDataSet({type:Le.None})),e(Te.moveRootPartsByOffset({x:-n.x,y:-n.y,z:-n.z})),e(Pe.tempInsertPointCleared()))},children:"Submit"}),E("button",{onClick:()=>{e(Pe.tempInsertPointCleared()),e(je.toolDataSet({type:Le.None}))},children:"Cancel"})]})]})}const w7="_main_1w306_1",_7="_props_1w306_13";var jb={main:w7,props:_7};function b7(){const n=Ae(bt.activeTool);return n.type==Le.LesEdit?E(y7,{}):n.type==Le.InsertPosition?E(x7,{}):E(h7,{})}function S7(){return fe("div",{className:jb.main,children:[E("div",{className:Od.header,children:"Properties"}),E("div",{className:jb.props,children:E(b7,{})})]})}const M7="_sidebar_1ixks_1",E7="_content_1ixks_15",A7="_dragger_1ixks_31";var tv={sidebar:M7,content:E7,dragger:A7};const T7="_content_1b0ic_1",C7="_view_1b0ic_9",P7="_circle_1b0ic_19";var nv={content:T7,view:C7,circle:P7};const Wb=1e4,Xb=5e3;function I7(){const n=Ae(mt.surfaceCount),e=n>Wb?"red":n>Xb?"yellow":n==0?"grey":"green";return fe("div",{className:nv.content,children:[E("div",{className:Od.header,children:"Model Information"}),fe("div",{children:["Surface Count: ",n]}),fe("div",{className:nv.view,children:[E("div",{className:nv.circle,style:{backgroundColor:e}}),fe("div",{children:[e=="red"&&fe(Ve,{children:["This model is not suitable for lighting simulation because it has more than ",Wb," surfaces"]}),e=="yellow"&&fe(Ve,{children:["This model is suitable for lighting simulation, but still has more than ",Xb," surfaces"]}),e=="green"&&E(Ve,{children:"This model is perfectly suitable for lighting simulation"}),e=="grey"&&E(Ve,{children:"No model information available"})]})]}),E("div",{})]})}function L7(){const n=Ae(pt.ui.rightSidebarWidth),e=Je(),t=I.exports.useRef(null),[r,i]=I.exports.useState(!1),s=I.exports.useCallback(c=>{i(!0)},[]),a=c=>{e(Pe.uiRightSidebarWidthSet(c))},o=I.exports.useCallback(()=>{i(!1)},[]),l=I.exports.useCallback(c=>{t.current&&r&&a(document.body.clientWidth-c.clientX+2)},[r]);return I.exports.useEffect(()=>(window.addEventListener("mousemove",l),window.addEventListener("mouseup",o),()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",o)}),[l,o]),fe("div",{className:tv.sidebar,ref:t,style:{width:n},children:[E("div",{className:tv.dragger,onMouseDown:s}),fe("div",{className:tv.content,children:[E(S7,{}),E(I7,{})]})]})}const R7="_main_1nhvw_1";var F7={main:R7};class D7 extends Zr.Component{constructor(t){super(t);P(this,"isDisposed$",new Mn);this.state={lineCount:0,pointCount:0,triangleCount:0,callCount:0}}render(){return fe("div",{className:F7.main,children:[E("div",{children:"Points:"}),E("div",{children:this.state.pointCount}),E("div",{children:"Lines:"}),E("div",{children:this.state.lineCount}),E("div",{children:"Triangles:"}),E("div",{children:this.state.triangleCount}),E("div",{children:"Calls:"}),E("div",{children:this.state.callCount})]})}componentDidMount(){Dr.renderState$.pipe(an(this.isDisposed$)).subscribe(t=>{this.setState(t)})}componentWillUnmount(){this.isDisposed$.next(!0)}}oE((n,e)=>({...e,sidebarWidth:n.runtime.ui.leftSidebarWidth}))(D7);var _0={exports:{}},oo={},b0={exports:{}},Ci={},up={exports:{}};(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;/*!
 * Adapted from jQuery UI core
 *
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/ui-core/
 */var t=/input|select|textarea|button|object|iframe/;function r(l){var c=l.offsetWidth<=0&&l.offsetHeight<=0;if(c&&!l.innerHTML)return!0;try{var u=window.getComputedStyle(l);return c?u.getPropertyValue("overflow")!=="visible"||l.scrollWidth<=0&&l.scrollHeight<=0:u.getPropertyValue("display")=="none"}catch{return console.warn("Failed to inspect element style"),!1}}function i(l){for(var c=l,u=l.getRootNode&&l.getRootNode();c&&c!==document.body;){if(u&&c===u&&(c=u.host.parentNode),r(c))return!1;c=c.parentNode}return!0}function s(l,c){var u=l.nodeName.toLowerCase(),h=t.test(u)&&!l.disabled||u==="a"&&l.href||c;return h&&i(l)}function a(l){var c=l.getAttribute("tabindex");c===null&&(c=void 0);var u=isNaN(c);return(u||c>=0)&&s(l,!u)}function o(l){var c=[].slice.call(l.querySelectorAll("*"),0).reduce(function(u,h){return u.concat(h.shadowRoot?o(h.shadowRoot):[h])},[]);return c.filter(a)}n.exports=e.default})(up,up.exports);Object.defineProperty(Ci,"__esModule",{value:!0});Ci.resetState=z7;Ci.log=U7;Ci.handleBlur=md;Ci.handleFocus=gd;Ci.markForFocusLater=B7;Ci.returnFocus=H7;Ci.popWithoutFocus=G7;Ci.setupScopedFocus=V7;Ci.teardownScopedFocus=j7;var N7=up.exports,k7=O7(N7);function O7(n){return n&&n.__esModule?n:{default:n}}var $l=[],dl=null,S0=!1;function z7(){$l=[]}function U7(){}function md(){S0=!0}function gd(){if(S0){if(S0=!1,!dl)return;setTimeout(function(){if(!dl.contains(document.activeElement)){var n=(0,k7.default)(dl)[0]||dl;n.focus()}},0)}}function B7(){$l.push(document.activeElement)}function H7(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=null;try{$l.length!==0&&(e=$l.pop(),e.focus({preventScroll:n}));return}catch{console.warn(["You tried to return focus to",e,"but it is not in the DOM anymore"].join(" "))}}function G7(){$l.length>0&&$l.pop()}function V7(n){dl=n,window.addEventListener?(window.addEventListener("blur",md,!1),document.addEventListener("focus",gd,!0)):(window.attachEvent("onBlur",md),document.attachEvent("onFocus",gd))}function j7(){dl=null,window.addEventListener?(window.removeEventListener("blur",md),document.removeEventListener("focus",gd)):(window.detachEvent("onBlur",md),document.detachEvent("onFocus",gd))}var M0={exports:{}};(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=up.exports,r=i(t);function i(o){return o&&o.__esModule?o:{default:o}}function s(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document;return o.activeElement.shadowRoot?s(o.activeElement.shadowRoot):o.activeElement}function a(o,l){var c=(0,r.default)(o);if(!c.length){l.preventDefault();return}var u=void 0,h=l.shiftKey,d=c[0],f=c[c.length-1],v=s();if(o===v){if(!h)return;u=f}if(f===v&&!h&&(u=d),d===v&&h&&(u=f),u){l.preventDefault(),u.focus();return}var g=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent),y=g!=null&&g[1]!="Chrome"&&/\biPod\b|\biPad\b/g.exec(navigator.userAgent)==null;if(!!y){var p=c.indexOf(v);if(p>-1&&(p+=h?-1:1),u=c[p],typeof u=="undefined"){l.preventDefault(),u=h?f:d,u.focus();return}l.preventDefault(),u.focus()}}n.exports=e.default})(M0,M0.exports);var Pi={},W7=function(){},X7=W7,Ai={},X2={exports:{}};/*!
  Copyright (c) 2015 Jed Watson.
  Based on code that is Copyright 2013-2015, Facebook, Inc.
  All rights reserved.
*/(function(n){(function(){var e=!!(typeof window!="undefined"&&window.document&&window.document.createElement),t={canUseDOM:e,canUseWorkers:typeof Worker!="undefined",canUseEventListeners:e&&!!(window.addEventListener||window.attachEvent),canUseViewport:e&&!!window.screen};n.exports?n.exports=t:window.ExecutionEnvironment=t})()})(X2);Object.defineProperty(Ai,"__esModule",{value:!0});Ai.canUseDOM=Ai.SafeNodeList=Ai.SafeHTMLCollection=void 0;var Y7=X2.exports,$7=Z7(Y7);function Z7(n){return n&&n.__esModule?n:{default:n}}var gm=$7.default,q7=gm.canUseDOM?window.HTMLElement:{};Ai.SafeHTMLCollection=gm.canUseDOM?window.HTMLCollection:{};Ai.SafeNodeList=gm.canUseDOM?window.NodeList:{};Ai.canUseDOM=gm.canUseDOM;Ai.default=q7;Object.defineProperty(Pi,"__esModule",{value:!0});Pi.resetState=tG;Pi.log=nG;Pi.assertNodeList=Y2;Pi.setElement=rG;Pi.validateElement=Px;Pi.hide=iG;Pi.show=sG;Pi.documentNotReadyOrSSRTesting=aG;var Q7=X7,J7=eG(Q7),K7=Ai;function eG(n){return n&&n.__esModule?n:{default:n}}var Xr=null;function tG(){Xr&&(Xr.removeAttribute?Xr.removeAttribute("aria-hidden"):Xr.length!=null?Xr.forEach(function(n){return n.removeAttribute("aria-hidden")}):document.querySelectorAll(Xr).forEach(function(n){return n.removeAttribute("aria-hidden")})),Xr=null}function nG(){}function Y2(n,e){if(!n||!n.length)throw new Error("react-modal: No elements were found for selector "+e+".")}function rG(n){var e=n;if(typeof e=="string"&&K7.canUseDOM){var t=document.querySelectorAll(e);Y2(t,e),e=t}return Xr=e||Xr,Xr}function Px(n){var e=n||Xr;return e?Array.isArray(e)||e instanceof HTMLCollection||e instanceof NodeList?e:[e]:((0,J7.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}function iG(n){var e=!0,t=!1,r=void 0;try{for(var i=Px(n)[Symbol.iterator](),s;!(e=(s=i.next()).done);e=!0){var a=s.value;a.setAttribute("aria-hidden","true")}}catch(o){t=!0,r=o}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}function sG(n){var e=!0,t=!1,r=void 0;try{for(var i=Px(n)[Symbol.iterator](),s;!(e=(s=i.next()).done);e=!0){var a=s.value;a.removeAttribute("aria-hidden")}}catch(o){t=!0,r=o}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}function aG(){Xr=null}var gc={};Object.defineProperty(gc,"__esModule",{value:!0});gc.resetState=oG;gc.log=lG;var Ru={},Fu={};function Yb(n,e){n.classList.remove(e)}function oG(){var n=document.getElementsByTagName("html")[0];for(var e in Ru)Yb(n,Ru[e]);var t=document.body;for(var r in Fu)Yb(t,Fu[r]);Ru={},Fu={}}function lG(){}var cG=function(e,t){return e[t]||(e[t]=0),e[t]+=1,t},uG=function(e,t){return e[t]&&(e[t]-=1),t},dG=function(e,t,r){r.forEach(function(i){cG(t,i),e.add(i)})},hG=function(e,t,r){r.forEach(function(i){uG(t,i),t[i]===0&&e.remove(i)})};gc.add=function(e,t){return dG(e.classList,e.nodeName.toLowerCase()=="html"?Ru:Fu,t.split(" "))};gc.remove=function(e,t){return hG(e.classList,e.nodeName.toLowerCase()=="html"?Ru:Fu,t.split(" "))};var vc={};Object.defineProperty(vc,"__esModule",{value:!0});vc.log=pG;vc.resetState=mG;function fG(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var $2=function n(){var e=this;fG(this,n),this.register=function(t){e.openInstances.indexOf(t)===-1&&(e.openInstances.push(t),e.emit("register"))},this.deregister=function(t){var r=e.openInstances.indexOf(t);r!==-1&&(e.openInstances.splice(r,1),e.emit("deregister"))},this.subscribe=function(t){e.subscribers.push(t)},this.emit=function(t){e.subscribers.forEach(function(r){return r(t,e.openInstances.slice())})},this.openInstances=[],this.subscribers=[]},dp=new $2;function pG(){console.log("portalOpenInstances ----------"),console.log(dp.openInstances.length),dp.openInstances.forEach(function(n){return console.log(n)}),console.log("end portalOpenInstances ----------")}function mG(){dp=new $2}vc.default=dp;var Ix={};Object.defineProperty(Ix,"__esModule",{value:!0});Ix.resetState=xG;Ix.log=wG;var gG=vc,vG=yG(gG);function yG(n){return n&&n.__esModule?n:{default:n}}var Xn=void 0,mi=void 0,Ka=[];function xG(){for(var n=[Xn,mi],e=0;e<n.length;e++){var t=n[e];!t||t.parentNode&&t.parentNode.removeChild(t)}Xn=mi=null,Ka=[]}function wG(){console.log("bodyTrap ----------"),console.log(Ka.length);for(var n=[Xn,mi],e=0;e<n.length;e++){var t=n[e],r=t||{};console.log(r.nodeName,r.className,r.id)}console.log("edn bodyTrap ----------")}function $b(){Ka.length!==0&&Ka[Ka.length-1].focusContent()}function _G(n,e){!Xn&&!mi&&(Xn=document.createElement("div"),Xn.setAttribute("data-react-modal-body-trap",""),Xn.style.position="absolute",Xn.style.opacity="0",Xn.setAttribute("tabindex","0"),Xn.addEventListener("focus",$b),mi=Xn.cloneNode(),mi.addEventListener("focus",$b)),Ka=e,Ka.length>0?(document.body.firstChild!==Xn&&document.body.insertBefore(Xn,document.body.firstChild),document.body.lastChild!==mi&&document.body.appendChild(mi)):(Xn.parentElement&&Xn.parentElement.removeChild(Xn),mi.parentElement&&mi.parentElement.removeChild(mi))}vG.default.subscribe(_G);(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var t=Object.assign||function(_){for(var z=1;z<arguments.length;z++){var j=arguments[z];for(var R in j)Object.prototype.hasOwnProperty.call(j,R)&&(_[R]=j[R])}return _},r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},i=function(){function _(z,j){for(var R=0;R<j.length;R++){var ee=j[R];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(z,ee.key,ee)}}return function(z,j,R){return j&&_(z.prototype,j),R&&_(z,R),z}}(),s=I.exports,a=Sy.exports,o=b(a),l=Ci,c=w(l),u=M0.exports,h=b(u),d=Pi,f=w(d),v=gc,g=w(v),y=Ai,p=b(y),m=vc,x=b(m);function w(_){if(_&&_.__esModule)return _;var z={};if(_!=null)for(var j in _)Object.prototype.hasOwnProperty.call(_,j)&&(z[j]=_[j]);return z.default=_,z}function b(_){return _&&_.__esModule?_:{default:_}}function C(_,z){if(!(_ instanceof z))throw new TypeError("Cannot call a class as a function")}function A(_,z){if(!_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z&&(typeof z=="object"||typeof z=="function")?z:_}function F(_,z){if(typeof z!="function"&&z!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof z);_.prototype=Object.create(z&&z.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),z&&(Object.setPrototypeOf?Object.setPrototypeOf(_,z):_.__proto__=z)}var N={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},O=9,H=27,D=0,U=function(_){F(z,_);function z(j){C(this,z);var R=A(this,(z.__proto__||Object.getPrototypeOf(z)).call(this,j));return R.setOverlayRef=function(ee){R.overlay=ee,R.props.overlayRef&&R.props.overlayRef(ee)},R.setContentRef=function(ee){R.content=ee,R.props.contentRef&&R.props.contentRef(ee)},R.afterClose=function(){var ee=R.props,J=ee.appElement,le=ee.ariaHideApp,k=ee.htmlOpenClassName,V=ee.bodyOpenClassName;V&&g.remove(document.body,V),k&&g.remove(document.getElementsByTagName("html")[0],k),le&&D>0&&(D-=1,D===0&&f.show(J)),R.props.shouldFocusAfterRender&&(R.props.shouldReturnFocusAfterClose?(c.returnFocus(R.props.preventScroll),c.teardownScopedFocus()):c.popWithoutFocus()),R.props.onAfterClose&&R.props.onAfterClose(),x.default.deregister(R)},R.open=function(){R.beforeOpen(),R.state.afterOpen&&R.state.beforeClose?(clearTimeout(R.closeTimer),R.setState({beforeClose:!1})):(R.props.shouldFocusAfterRender&&(c.setupScopedFocus(R.node),c.markForFocusLater()),R.setState({isOpen:!0},function(){R.openAnimationFrame=requestAnimationFrame(function(){R.setState({afterOpen:!0}),R.props.isOpen&&R.props.onAfterOpen&&R.props.onAfterOpen({overlayEl:R.overlay,contentEl:R.content})})}))},R.close=function(){R.props.closeTimeoutMS>0?R.closeWithTimeout():R.closeWithoutTimeout()},R.focusContent=function(){return R.content&&!R.contentHasFocus()&&R.content.focus({preventScroll:!0})},R.closeWithTimeout=function(){var ee=Date.now()+R.props.closeTimeoutMS;R.setState({beforeClose:!0,closesAt:ee},function(){R.closeTimer=setTimeout(R.closeWithoutTimeout,R.state.closesAt-Date.now())})},R.closeWithoutTimeout=function(){R.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},R.afterClose)},R.handleKeyDown=function(ee){ee.keyCode===O&&(0,h.default)(R.content,ee),R.props.shouldCloseOnEsc&&ee.keyCode===H&&(ee.stopPropagation(),R.requestClose(ee))},R.handleOverlayOnClick=function(ee){R.shouldClose===null&&(R.shouldClose=!0),R.shouldClose&&R.props.shouldCloseOnOverlayClick&&(R.ownerHandlesClose()?R.requestClose(ee):R.focusContent()),R.shouldClose=null},R.handleContentOnMouseUp=function(){R.shouldClose=!1},R.handleOverlayOnMouseDown=function(ee){!R.props.shouldCloseOnOverlayClick&&ee.target==R.overlay&&ee.preventDefault()},R.handleContentOnClick=function(){R.shouldClose=!1},R.handleContentOnMouseDown=function(){R.shouldClose=!1},R.requestClose=function(ee){return R.ownerHandlesClose()&&R.props.onRequestClose(ee)},R.ownerHandlesClose=function(){return R.props.onRequestClose},R.shouldBeClosed=function(){return!R.state.isOpen&&!R.state.beforeClose},R.contentHasFocus=function(){return document.activeElement===R.content||R.content.contains(document.activeElement)},R.buildClassName=function(ee,J){var le=(typeof J=="undefined"?"undefined":r(J))==="object"?J:{base:N[ee],afterOpen:N[ee]+"--after-open",beforeClose:N[ee]+"--before-close"},k=le.base;return R.state.afterOpen&&(k=k+" "+le.afterOpen),R.state.beforeClose&&(k=k+" "+le.beforeClose),typeof J=="string"&&J?k+" "+J:k},R.attributesFromObject=function(ee,J){return Object.keys(J).reduce(function(le,k){return le[ee+"-"+k]=J[k],le},{})},R.state={afterOpen:!1,beforeClose:!1},R.shouldClose=null,R.moveFromContentToOverlay=null,R}return i(z,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(R,ee){this.props.isOpen&&!R.isOpen?this.open():!this.props.isOpen&&R.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!ee.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var R=this.props,ee=R.appElement,J=R.ariaHideApp,le=R.htmlOpenClassName,k=R.bodyOpenClassName;k&&g.add(document.body,k),le&&g.add(document.getElementsByTagName("html")[0],le),J&&(D+=1,f.hide(ee)),x.default.register(this)}},{key:"render",value:function(){var R=this.props,ee=R.id,J=R.className,le=R.overlayClassName,k=R.defaultStyles,V=R.children,$=J?{}:k.content,Q=le?{}:k.overlay;if(this.shouldBeClosed())return null;var ie={ref:this.setOverlayRef,className:this.buildClassName("overlay",le),style:t({},Q,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},ne=t({id:ee,ref:this.setContentRef,style:t({},$,this.props.style.content),className:this.buildClassName("content",J),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",t({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),Se=this.props.contentElement(ne,V);return this.props.overlayElement(ie,Se)}}]),z}(s.Component);U.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},U.propTypes={isOpen:o.default.bool.isRequired,defaultStyles:o.default.shape({content:o.default.object,overlay:o.default.object}),style:o.default.shape({content:o.default.object,overlay:o.default.object}),className:o.default.oneOfType([o.default.string,o.default.object]),overlayClassName:o.default.oneOfType([o.default.string,o.default.object]),bodyOpenClassName:o.default.string,htmlOpenClassName:o.default.string,ariaHideApp:o.default.bool,appElement:o.default.oneOfType([o.default.instanceOf(p.default),o.default.instanceOf(y.SafeHTMLCollection),o.default.instanceOf(y.SafeNodeList),o.default.arrayOf(o.default.instanceOf(p.default))]),onAfterOpen:o.default.func,onAfterClose:o.default.func,onRequestClose:o.default.func,closeTimeoutMS:o.default.number,shouldFocusAfterRender:o.default.bool,shouldCloseOnOverlayClick:o.default.bool,shouldReturnFocusAfterClose:o.default.bool,preventScroll:o.default.bool,role:o.default.string,contentLabel:o.default.string,aria:o.default.object,data:o.default.object,children:o.default.node,shouldCloseOnEsc:o.default.bool,overlayRef:o.default.func,contentRef:o.default.func,id:o.default.string,overlayElement:o.default.func,contentElement:o.default.func,testId:o.default.string},e.default=U,n.exports=e.default})(b0,b0.exports);function Z2(){var n=this.constructor.getDerivedStateFromProps(this.props,this.state);n!=null&&this.setState(n)}function q2(n){function e(t){var r=this.constructor.getDerivedStateFromProps(n,t);return r!=null?r:null}this.setState(e.bind(this))}function Q2(n,e){try{var t=this.props,r=this.state;this.props=n,this.state=e,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(t,r)}finally{this.props=t,this.state=r}}Z2.__suppressDeprecationWarning=!0;q2.__suppressDeprecationWarning=!0;Q2.__suppressDeprecationWarning=!0;function bG(n){var e=n.prototype;if(!e||!e.isReactComponent)throw new Error("Can only polyfill class components");if(typeof n.getDerivedStateFromProps!="function"&&typeof e.getSnapshotBeforeUpdate!="function")return n;var t=null,r=null,i=null;if(typeof e.componentWillMount=="function"?t="componentWillMount":typeof e.UNSAFE_componentWillMount=="function"&&(t="UNSAFE_componentWillMount"),typeof e.componentWillReceiveProps=="function"?r="componentWillReceiveProps":typeof e.UNSAFE_componentWillReceiveProps=="function"&&(r="UNSAFE_componentWillReceiveProps"),typeof e.componentWillUpdate=="function"?i="componentWillUpdate":typeof e.UNSAFE_componentWillUpdate=="function"&&(i="UNSAFE_componentWillUpdate"),t!==null||r!==null||i!==null){var s=n.displayName||n.name,a=typeof n.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+s+" uses "+a+" but also contains the following legacy lifecycles:"+(t!==null?`
  `+t:"")+(r!==null?`
  `+r:"")+(i!==null?`
  `+i:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof n.getDerivedStateFromProps=="function"&&(e.componentWillMount=Z2,e.componentWillReceiveProps=q2),typeof e.getSnapshotBeforeUpdate=="function"){if(typeof e.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");e.componentWillUpdate=Q2;var o=e.componentDidUpdate;e.componentDidUpdate=function(c,u,h){var d=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:h;o.call(this,c,u,d)}}return n}var SG=Object.freeze(Object.defineProperty({__proto__:null,polyfill:bG},Symbol.toStringTag,{value:"Module"})),MG=lT(SG);Object.defineProperty(oo,"__esModule",{value:!0});oo.bodyOpenClassName=oo.portalClassName=void 0;var Zb=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},EG=function(){function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),J2=I.exports,hp=zd(J2),AG=aa.exports,fp=zd(AG),TG=Sy.exports,et=zd(TG),CG=b0.exports,qb=zd(CG),PG=Pi,IG=RG(PG),Xs=Ai,Qb=zd(Xs),LG=MG;function RG(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}function zd(n){return n&&n.__esModule?n:{default:n}}function FG(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Jb(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n}function DG(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var NG=oo.portalClassName="ReactModalPortal",kG=oo.bodyOpenClassName="ReactModal__Body--open",Ua=Xs.canUseDOM&&fp.default.createPortal!==void 0,Kb=function(e){return document.createElement(e)},eS=function(){return Ua?fp.default.createPortal:fp.default.unstable_renderSubtreeIntoContainer};function Xh(n){return n()}var Ud=function(n){DG(e,n);function e(){var t,r,i,s;FG(this,e);for(var a=arguments.length,o=Array(a),l=0;l<a;l++)o[l]=arguments[l];return s=(r=(i=Jb(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),i),i.removePortal=function(){!Ua&&fp.default.unmountComponentAtNode(i.node);var c=Xh(i.props.parentSelector);c&&c.contains(i.node)?c.removeChild(i.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},i.portalRef=function(c){i.portal=c},i.renderPortal=function(c){var u=eS(),h=u(i,hp.default.createElement(qb.default,Zb({defaultStyles:e.defaultStyles},c)),i.node);i.portalRef(h)},r),Jb(i,s)}return EG(e,[{key:"componentDidMount",value:function(){if(!!Xs.canUseDOM){Ua||(this.node=Kb("div")),this.node.className=this.props.portalClassName;var r=Xh(this.props.parentSelector);r.appendChild(this.node),!Ua&&this.renderPortal(this.props)}}},{key:"getSnapshotBeforeUpdate",value:function(r){var i=Xh(r.parentSelector),s=Xh(this.props.parentSelector);return{prevParent:i,nextParent:s}}},{key:"componentDidUpdate",value:function(r,i,s){if(!!Xs.canUseDOM){var a=this.props,o=a.isOpen,l=a.portalClassName;r.portalClassName!==l&&(this.node.className=l);var c=s.prevParent,u=s.nextParent;u!==c&&(c.removeChild(this.node),u.appendChild(this.node)),!(!r.isOpen&&!o)&&!Ua&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(!(!Xs.canUseDOM||!this.node||!this.portal)){var r=this.portal.state,i=Date.now(),s=r.isOpen&&this.props.closeTimeoutMS&&(r.closesAt||i+this.props.closeTimeoutMS);s?(r.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,s-i)):this.removePortal()}}},{key:"render",value:function(){if(!Xs.canUseDOM||!Ua)return null;!this.node&&Ua&&(this.node=Kb("div"));var r=eS();return r(hp.default.createElement(qb.default,Zb({ref:this.portalRef,defaultStyles:e.defaultStyles},this.props)),this.node)}}],[{key:"setAppElement",value:function(r){IG.setElement(r)}}]),e}(J2.Component);Ud.propTypes={isOpen:et.default.bool.isRequired,style:et.default.shape({content:et.default.object,overlay:et.default.object}),portalClassName:et.default.string,bodyOpenClassName:et.default.string,htmlOpenClassName:et.default.string,className:et.default.oneOfType([et.default.string,et.default.shape({base:et.default.string.isRequired,afterOpen:et.default.string.isRequired,beforeClose:et.default.string.isRequired})]),overlayClassName:et.default.oneOfType([et.default.string,et.default.shape({base:et.default.string.isRequired,afterOpen:et.default.string.isRequired,beforeClose:et.default.string.isRequired})]),appElement:et.default.oneOfType([et.default.instanceOf(Qb.default),et.default.instanceOf(Xs.SafeHTMLCollection),et.default.instanceOf(Xs.SafeNodeList),et.default.arrayOf(et.default.instanceOf(Qb.default))]),onAfterOpen:et.default.func,onRequestClose:et.default.func,closeTimeoutMS:et.default.number,ariaHideApp:et.default.bool,shouldFocusAfterRender:et.default.bool,shouldCloseOnOverlayClick:et.default.bool,shouldReturnFocusAfterClose:et.default.bool,preventScroll:et.default.bool,parentSelector:et.default.func,aria:et.default.object,data:et.default.object,role:et.default.string,contentLabel:et.default.string,shouldCloseOnEsc:et.default.bool,overlayRef:et.default.func,contentRef:et.default.func,id:et.default.string,overlayElement:et.default.func,contentElement:et.default.func};Ud.defaultProps={isOpen:!1,portalClassName:NG,bodyOpenClassName:kG,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(e,t){return hp.default.createElement("div",e,t)},contentElement:function(e,t){return hp.default.createElement("div",e,t)}};Ud.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}};(0,LG.polyfill)(Ud);oo.default=Ud;(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var t=oo,r=i(t);function i(s){return s&&s.__esModule?s:{default:s}}e.default=r.default,n.exports=e.default})(_0,_0.exports);var go=oT(_0.exports);const OG="_confirmHeader_cf3gl_1",zG="_confirmButton_cf3gl_11",UG="_cancelButton_cf3gl_25",BG="_xButton_cf3gl_27";var Yh={confirmHeader:OG,confirmButton:zG,cancelButton:UG,xButton:BG};function HG(n){return fe("div",{children:[E("button",{onClick:n.onCancel,className:Yh.xButton,children:"x"}),E("div",{className:Yh.confirmHeader,children:n.text}),E("br",{}),E("button",{onClick:n.onAccept,className:Yh.confirmButton,children:"YES"}),E("button",{onClick:n.onCancel,className:Yh.cancelButton,children:"NO"})]})}function K2(n){const e=Je(),t=Object.keys(mr).filter(i=>!isNaN(Number(i))).map(i=>Number.parseInt(i));function r(i){const s=Number.parseInt(i.currentTarget.value);e(Te.meshUnitsChanged({meshId:n.mesh.id,units:s}))}return E("select",{id:n.id,onChange:r,value:n.mesh.units,children:t.map(i=>E("option",{value:i,children:mr[i].toString()},i))})}const GG="_block_766jb_1";var VG={block:GG};const jG="_icon_1td79_1",WG="_warning_1td79_23",XG="_error_1td79_33";var rv={icon:jG,warning:WG,error:XG};const YG=n=>I.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"1em",height:"1em",viewBox:"0 0 40 40",enableBackground:"new 0 0 40 40",xmlSpace:"preserve",...n},I.exports.createElement("g",{id:"Fl\\xE4che",display:"none"},I.exports.createElement("rect",{display:"inline",fill:"#FF7E90",width:40,height:40})),I.exports.createElement("g",{id:"Rahmen",display:"none"}),I.exports.createElement("g",{id:"Icon"},I.exports.createElement("g",null,I.exports.createElement("path",{d:"M20,5c8.3,0,15,6.7,15,15s-6.7,15-15,15S5,28.3,5,20S11.7,5,20,5 M20,4C11.2,4,4,11.2,4,20s7.2,16,16,16s16-7.2,16-16 S28.8,4,20,4L20,4z"}),I.exports.createElement("g",null,I.exports.createElement("path",{d:"M19,27.7c0-0.3,0.1-0.5,0.3-0.7c0.2-0.2,0.4-0.3,0.7-0.3s0.5,0.1,0.7,0.3c0.2,0.2,0.3,0.4,0.3,0.7c0,0.3-0.1,0.5-0.3,0.7 c-0.2,0.2-0.4,0.3-0.7,0.3s-0.5-0.1-0.7-0.3C19.1,28.1,19,27.9,19,27.7z M20.6,23.7h-1.3l-0.1-12.3h1.5L20.6,23.7z"})))));function gf(n){if(n.isIgnored)return E("span",{children:"\u2713"});const e=n.type=="warning"?rv.warning:n.type=="error"?rv.error:"";return E(YG,{className:[rv.icon,e].join(" "),onClick:()=>n.setIgnored()})}const $G="_container_1574l_1",ZG="_objectBiggerThanTwoMetersText_1574l_11",qG="_objectBiggerThanTenMetersText_1574l_19",QG="_objectHasNormalSize_1574l_27";var $o={container:$G,objectBiggerThanTwoMetersText:ZG,objectBiggerThanTenMetersText:qG,objectHasNormalSize:QG};function eT(n){let e,t="",r=$o.objectHasNormalSize;return Lr.isBiggerThan10Meters(n.size)?(e=E(gf,{setIgnored:n.onIgnored,isIgnored:n.isIgnored,type:"error"}),t="Watch out your object is more than ten meters tall",r=$o.objectBiggerThanTenMetersText):Lr.isBiggerThan2Meters(n.size)?(e=E(gf,{setIgnored:n.onIgnored,isIgnored:n.isIgnored,type:"warning"}),t="Watch out your object is more than two meters tall",r=$o.objectBiggerThanTwoMetersText):Lr.isSmallerThan1CentiMeters(n.size)&&(e=E(gf,{setIgnored:n.onIgnored,isIgnored:n.isIgnored,type:"warning"}),t="Watch out your object is less than five centimeters tall",r=$o.objectBiggerThanTwoMetersText),n.isIgnored&&(r=$o.objectHasNormalSize),fe("div",{className:[$o.container,r].join(" "),title:t,children:[E(V2,{vector:n.size})," ",e]})}function JG(n){const e=Je(),t=Ae(mt.meshDefinition(n.meshId));if(!t)return E("div",{});const r=()=>{e(Te.sizelIgnored({meshId:n.meshId}))};return fe("div",{className:VG.block,children:[E("span",{children:"Name: "}),E("span",{children:t.name}),E("br",{}),E("span",{children:"Units: "}),E(K2,{id:"meshDefinitionUnits",mesh:t}),E("div",{children:"Size: "}),E(eT,{isIgnored:t.ignoredSize,size:t.scaledSize,onIgnored:r})]})}const KG="_confirmHeader_14w3g_1",eV="_confirmButton_14w3g_11",tV="_cancelButton_14w3g_27",nV="_img_14w3g_35",rV="_list_14w3g_47";var iv={confirmHeader:KG,confirmButton:eV,cancelButton:tV,img:nV,list:rV};function iV(n){return fe("div",{className:iv.list,children:[E("div",{className:iv.confirmHeader,children:n.text}),E("br",{}),E("div",{children:n.meshIds.map(e=>E(JG,{meshId:e},e.toString()))}),E("br",{}),E("button",{onClick:n.onDone,className:iv.confirmButton,children:"Done"}),E("br",{})]})}function sV(){const n=uE(),e=Ae(pt.requestedL3DOverride),t=Ae(Cu.hasChanges),r=x4.selectAll(Ae(pt.meshSizeWarnings)),i=r.length>0,s=async c=>{const h=await(await fetch(c.l3DUrl)).blob(),d=new File([h],c.fileName);new Ex().import(d)},a=async()=>{e!=null&&e.newL3D?(await s(e),URL.revokeObjectURL(e.l3DUrl)):(Xt.clear(),n(Te.reset())),n(Pe.requestL3DOverride(null))};let o=e!=null;!t&&o&&(o=!1),o=o||i;let l={};return e?l={content:{top:"45%",bottom:"45%",left:"40%",right:"40%",padding:0,minHeight:128,minWidth:252}}:i&&(l={content:{top:"50%",left:"50%",right:"50%",bottom:"50%",minWidth:260,padding:0,height:463,position:"absolute",transform:"translate(-50%, -50%)"}}),E("div",{children:fe(go,{isOpen:o,style:l,contentLabel:"Confirm overwrite current L3D",children:[e&&E(HG,{onAccept:a,onCancel:()=>n(Pe.requestL3DOverride(null)),showCancel:!0,showClose:!0,text:"Your current luminaire will be disposed. Continue?"}),i&&E(iV,{text:"The following models seem to have an unrealistic size. Please check if the unit type is correct.",onDone:()=>n(Pe.clearMeshSizeWarnings()),meshIds:r.map(c=>c.id)})]})})}function aV(){const n=Ae(pt.measurementOverlay);return n==null?E(Ve,{}):E("div",{className:[mf.overlay,mf.noInput].join(" "),children:xA.selectAll(n.labels).map(e=>E("div",{className:mf.label,style:{left:`${e.position.x}px`,top:`${e.position.y}px`},children:e.text},e.id))})}/*! js-cookie v3.0.1 | MIT */function $h(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)n[r]=t[r]}return n}var oV={read:function(n){return n[0]==='"'&&(n=n.slice(1,-1)),n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(n){return encodeURIComponent(n).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function E0(n,e){function t(i,s,a){if(typeof document!="undefined"){a=$h({},e,a),typeof a.expires=="number"&&(a.expires=new Date(Date.now()+a.expires*864e5)),a.expires&&(a.expires=a.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var l in a)!a[l]||(o+="; "+l,a[l]!==!0&&(o+="="+a[l].split(";")[0]));return document.cookie=i+"="+n.write(s,i)+o}}function r(i){if(!(typeof document=="undefined"||arguments.length&&!i)){for(var s=document.cookie?document.cookie.split("; "):[],a={},o=0;o<s.length;o++){var l=s[o].split("="),c=l.slice(1).join("=");try{var u=decodeURIComponent(l[0]);if(a[u]=n.read(c,u),i===u)break}catch{}}return i?a[i]:a}}return Object.create({set:t,get:r,remove:function(i,s){t(i,"",$h({},s,{expires:-1}))},withAttributes:function(i){return E0(this.converter,$h({},this.attributes,i))},withConverter:function(i){return E0($h({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(n)}})}var A0=E0(oV,{path:"/"});const Lx={border:"1px solid black",borderRadius:8},Rx={...Lx,position:"absolute",left:"25%",right:"25%",top:"50%",bottom:void 0,transform:"translateY(-50%)",height:"max-content"},lV={...Rx,left:"50%",right:void 0,transform:"translate(-50%, -50%)",padding:"20px"},cV="_title_1c89y_1",uV="_content_1c89y_11",dV="_footer_1c89y_25",hV="_spinner_1c89y_45",fV="_spinnerBorder_1c89y_1";var yi={title:cV,content:uV,footer:dV,spinner:hV,spinnerBorder:fV};function pV(n){const e=t=>{const r=new Date;r.setFullYear(r.getFullYear()+10);const i=A0.get("CookieConsent")=="all";A0.set("CookieConsent",t?"all":"mandatory",{expires:r,sameSite:"strict"}),me.dispatch(Pe.modalClosed(n.id)),n.data.updating?n.data.updating==!0&&(!t&&i?me.dispatch(Pe.modalPushed({type:gr.ReloadRequest})):t&&!i&&so.start()):t&&so.start()};return fe(go,{style:{overlay:n.overlayStyle,content:Rx},isOpen:!0,children:[E("div",{className:yi.title,children:"About Cookies"}),fe("div",{className:yi.content,children:["This website uses cookies. Those have two functions: On the one hand they are providing basic functionality for this website. On the other hand they allow us to improve our content for you by saving and analyzing anonymized user data. You can redraw your consent to using these cookies at any time. Find more information regarding cookies on our"," ",E("a",{href:"https://gldf.io/privacy-policy",target:"_blank",children:"Data Protection Declaration"})," ","and regarding us on the"," ",E("a",{href:"https://gldf.io/imprint",target:"_blank",children:"Imprint"}),"."]}),fe("div",{className:yi.footer,children:[E("button",{onClick:()=>e(!1),children:"Accept only required cookies"})," ",E("button",{onClick:()=>e(!0),children:"Accept all cookies"})]})]})}const mV="_main_106qe_1",gV="_renderTarget_106qe_21",vV="_gridContainer_106qe_39",yV="_grid_106qe_39",xV="_item_106qe_75",wV="_header_106qe_91",_V="_preview_106qe_103",bV="_filename_106qe_127",SV="_missing_106qe_141",MV="_button_106qe_151",EV="_innerList_106qe_177",AV="_objectBiggerThanTwoMetersText_106qe_185",TV="_objectBiggerThanTenMetersText_106qe_193",CV="_objectHasNormalSize_106qe_201",PV="_removeButton_106qe_229";var xi={main:mV,renderTarget:gV,gridContainer:vV,grid:yV,item:xV,header:wV,preview:_V,filename:bV,missing:SV,button:MV,innerList:EV,objectBiggerThanTwoMetersText:AV,objectBiggerThanTenMetersText:TV,objectHasNormalSize:CV,removeButton:PV};const IV="_container_1qnwp_1",LV="_filename_1qnwp_11",RV="_missing_1qnwp_25";var Zh={container:IV,filename:LV,missing:RV};function tT(n){const e=I.exports.useRef(null),t=n.file;return t.url!=null?E("div",{className:Zh.filename,children:t.name}):fe("div",{className:Zh.container,children:[fe("div",{className:[Zh.filename,Zh.missing].join(" "),onClick:()=>{var r;(r=e.current)==null||r.click()},children:[t.name,E("input",{ref:e,type:"file",multiple:!0,hidden:!0,accept:n.fileFilter,onChange:n.importCallback})]}),E(gf,{setIgnored:n.setIgnored,isIgnored:n.isIgnored,type:"warning"})]})}function FV(n){const e=Je(),t=n.mesh,r=sd.selectAll(t.material.libraries),i=s=>{const a=s.currentTarget.files;if(a==null||a.length==0)return[];new pm().ImportMaterialLibraries(a,t.id,o=>e(Te.materialLibrariesUpdated(o)),o=>e(Pe.importMessageCreated({message:o})))};return fe(Ve,{children:[r.length!=0&&E("div",{children:"Material Libraries:"}),E("div",{className:xi.innerList,children:r.map(s=>E(tT,{meshId:t.id,file:s,setIgnored:()=>e(Te.materialIgnored({meshId:t.id,materialName:s.name})),isIgnored:s.ignored,importCallback:i,fileFilter:".mtl,.jpg,.png"},s.name))})]})}function DV(n){const e=Je(),t=n.mesh,r=ad.selectAll(t.material.textures),i=s=>{const a=s.currentTarget.files;if(a==null||a.length==0)return[];new pm().ImportTextures(a,t.id,o=>e(Te.texturesUpdated(o)),o=>e(Pe.importMessageCreated({message:o})))};return fe(Ve,{children:[r.length!=0&&E("div",{children:"Textures:"}),E("div",{className:xi.innerList,children:r.map(s=>E(tT,{meshId:t.id,file:s,setIgnored:()=>e(Te.textureIgnored({meshId:t.id,textureName:s.name})),isIgnored:s.ignored,importCallback:i,fileFilter:".mtl,.jpg,.png"},s.name))})]})}class NV extends Zr.Component{constructor(t){super(t);P(this,"renderData",new Map);P(this,"renderTarget",null);P(this,"renderer",null);P(this,"resizeHandler");this.resizeHandler=()=>{this.renderer!=null&&this.renderTarget!=null&&this.renderer.setSize(this.renderTarget.clientWidth,this.renderTarget.clientHeight)}}createScene(t){const r=new Ea;if(Xt.hasData(t.meshUrl)){const i=Xt.getData(t.meshUrl);r.add(i.group)}return r}createBoundingBox(t){const r=new ur;return r.setFromObject(t.children[0]),r}createCamera(t){const r=new L,i=new L;t.getSize(r);const s=Math.max(r.x,r.y,r.z);t.getCenter(i);const a=new rn(45,1);return a.position.set(s*2,s*2,i.z+s),a.lookAt(0,0,i.z),a}syncRenderData(){this.renderData.forEach(r=>{r.isValid=!1}),this.props.meshDefinitions.forEach(r=>{const i=this.renderData.get(r.id);if(i)i.mesh=r,i.isValid=!0;else{const s=this.createScene(r),a=this.createBoundingBox(s),o=new L;a.getSize(o);const l=o.x,c=o.y,u=o.z,h=new L;a.getCenter(h);const d=this.createCamera(a),f={isValid:!0,mesh:r,scene:s,camera:d,bbox:a,sizeX:l,sizeY:c,sizeZ:u,center:h,preview:null,previewElement:null};f.preview=E("div",{className:xi.preview,ref:v=>f.previewElement=v}),this.renderData.set(r.id,f)}});const t=new Array;this.renderData.forEach((r,i)=>{r.isValid||t.push(i)}),t.forEach(r=>this.renderData.delete(r))}render(){this.syncRenderData();const t=Array.from(this.renderData);return fe("div",{className:xi.main,children:[E("div",{className:xi.renderTarget,ref:r=>this.renderTarget=r}),E("div",{className:xi.gridContainer,children:E("div",{className:xi.grid,children:t.map(([r,i])=>E(OV,{value:i},i.mesh.id))})})]})}componentDidMount(){this.renderTarget!=null&&(this.renderer=new St({antialias:!0,alpha:!1}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.renderTarget.clientWidth,this.renderTarget.clientHeight),this.renderer.setClearColor("#FFFFFF"),this.renderer.setScissorTest(!0),this.renderer.autoClear=!1,this.renderTarget.appendChild(this.renderer.domElement),window.addEventListener("resize",this.resizeHandler),requestAnimationFrame(()=>this.renderPreviews()))}componentWillUnmount(){var t;window.removeEventListener("resize",this.resizeHandler),(t=this.renderer)==null||t.dispose(),this.renderer=null}componentDidUpdate(){requestAnimationFrame(()=>this.renderPreviews())}renderPreviews(){this.renderer!=null&&(this.renderer.setScissorTest(!1),this.renderer.clear(!0,!0),this.renderer.setScissorTest(!0),this.renderData.forEach(t=>{if(this.renderer==null||this.renderTarget==null||t.previewElement==null)return;const r=t.camera,i=this.renderer.domElement;let s=t.scene.children[0];if(s==null&&Xt.hasData(t.mesh.meshUrl)){const v=Xt.getData(t.mesh.meshUrl);t.scene.add(v.group),s=v.group}s.rotation.z=Date.now()*3e-4;const a=i.getBoundingClientRect(),o=t.previewElement.getBoundingClientRect(),l=o.top-a.top,c=a.bottom-o.bottom,u=o.left-a.left,{width:h,height:d}=o;c<-h||l<-d||(r.aspect=h/d,r.updateProjectionMatrix(),this.renderer.setScissor(u,c,h,d),this.renderer.setViewport(u,c,h,d),this.renderer.render(t.scene,r))}),requestAnimationFrame(()=>this.renderPreviews()))}}const kV=oE(n=>({meshDefinitions:qt.selectAll(mt.meshDefinitions(n))}))(NV);function OV(n){const e=Je(),t=()=>{e(Te.sizelIgnored({meshId:n.value.mesh.id}))},r=()=>{e(Te.removeMesh(n.value.mesh.id))},i=Ae(mt.canRemoveMesh(n.value.mesh.id)),s=n.value.preview,a=n.value.mesh;return fe("div",{className:xi.item,children:[E("div",{className:[xi.header,xi.filename].join(" "),title:a.name,children:a.name}),E("button",{disabled:!i,onClick:()=>r(),className:xi.removeButton,children:"X"}),s,E("div",{children:"Units: "}),E(K2,{id:"meshDefinitionUnits",mesh:a}),E(eT,{size:a.scaledSize,isIgnored:a.ignoredSize,onIgnored:t}),E(FV,{mesh:a}),E(DV,{mesh:a})]})}const zV="_main_42z0w_1",UV="_header_42z0w_21",BV="_footer_42z0w_35",HV="_item_42z0w_49",GV="_defaultUnits_42z0w_57",VV="_grid_42z0w_65",jV="_closeButton_42z0w_79",WV="_messagesContainer_42z0w_91",XV="_messageList_42z0w_105",YV="_messageListItem_42z0w_127",$V="_messageListItemCloseButton_42z0w_141";var Wr={main:zV,header:UV,footer:BV,item:HV,defaultUnits:GV,grid:VV,closeButton:jV,messagesContainer:WV,messageList:XV,messageListItem:YV,messageListItemCloseButton:$V};function ZV(n){const e=Je(),t=Ae(pt.defaultScaling),r=Object.keys(mr).filter(s=>!isNaN(Number(s))).map(s=>Number.parseInt(s));function i(s){const a=Number.parseInt(s.currentTarget.value);e(Pe.defaultScalingChanged(a))}return E("select",{id:n.id,onChange:i,value:t,children:r.map(s=>E("option",{value:s,children:mr[s].toString()},s))})}function qV(){const n=Ae(pt.importMessages),e=Je(),t=y4.selectAll(n);if(!t.length)return E(Ve,{});const r=i=>{e(Pe.importMessageRemoved(i))};return E("div",{className:Wr.messagesContainer,children:E("div",{className:Wr.messageList,children:t.map(i=>fe("div",{className:Wr.messageListItem,children:[E("div",{className:Wr.messageListItemCloseButton,onClick:()=>r(i.id),children:"X"}),i.message]},i.id))})})}function QV(n){const e=I.exports.useRef(null),t=Je(),r=o=>{const l=o.currentTarget.files;if(l==null)return[];new pm().ImportObjects(l,new Mx,c=>t(Te.objectsImported(c)),c=>t(Pe.importMessageCreated({message:c})))},i={content:{...Lx,top:"15%",bottom:"15%",left:"15%",right:"15%",padding:0},overlay:n.overlayStyle},s=()=>{t(Pe.clearImportMessages()),t(Pe.modalClosed(n.id))},a=o=>{var l;o&&((l=e.current)==null||l.click())};return E(go,{isOpen:!0,onAfterOpen:()=>a(n.data.startImport==!0),contentLabel:"Object Catalog",onRequestClose:s,style:i,children:fe("div",{className:Wr.main,children:[E(qV,{}),fe("div",{className:Wr.header,children:[E("button",{className:Wr.item,onClick:()=>{var o;return(o=e.current)==null?void 0:o.click()},children:"Import"}),E("label",{className:Wr.defaultUnits,htmlFor:"defaultUnits",children:"Units:"}),E("div",{className:Wr.defaultUnits,children:E(ZV,{id:"defaultUnits"})})]}),fe("div",{className:Wr.grid,children:[E("input",{ref:e,type:"file",hidden:!0,accept:".obj,.mtl,.jpg,.png",multiple:!0,onChange:r}),E(kV,{})]}),E("div",{className:Wr.footer,children:E("button",{className:Wr.closeButton,onClick:s,children:"Done"})})]})})}function JV(n){const e=Je(),t=Ae(pt.progress);if(!t)return E(Ve,{});const r=()=>{e(Pe.progressCleared())};return E(go,{style:{overlay:n.overlayStyle,content:lV},isOpen:!0,children:fe("div",{className:yi.overlay,children:[E("div",{className:yi.title,children:t.title}),fe("div",{className:yi.content,children:[t.inProgress&&E("span",{className:yi.spinner}),t.message!=null&&E("span",{children:t.message})]}),E("div",{className:yi.footer,children:t.closable&&E("button",{onClick:r,children:"Close"})})]})})}function KV(n){const e=Je();return fe(go,{style:{overlay:n.overlayStyle,content:Rx},isOpen:!0,children:[E("div",{className:yi.title,children:"Reload required"}),E("div",{className:yi.content,children:"Changes only take effect after a reload."}),fe("div",{className:yi.footer,children:[E("button",{onClick:()=>window.location.reload(),children:"Reload now"})," ",E("button",{onClick:()=>e(Pe.modalClosed(n.id)),children:"Later"})]})]})}const e9="_main_1o89m_1",t9="_header_1o89m_10",n9="_title_1o89m_18",r9="_footer_1o89m_23",i9="_menu_1o89m_31",s9="_active_1o89m_55";var Fa={main:e9,header:t9,title:n9,footer:r9,menu:i9,active:s9};const a9="_frame_ltnv3_1";var o9={frame:a9},l9="/assets/licenses.7b07f709.html";function c9(){return E("iframe",{className:o9.frame,src:l9})}class nT{static registerShortcuts(e){const t=e.slice();let r=0;for(const i of e)this.Shortcuts.filter(s=>i.key==s.key&&i.activeIn==s.activeIn&&i.helpText==s.helpText).length?t.splice(r,1):r++;this.Shortcuts=[...this.Shortcuts,...t]}}P(nT,"Shortcuts",[{key:"Control + y",activeIn:"Global",helpText:"Redo last operation"},{key:"Control + z",activeIn:"Global",helpText:"Undo last operation"},{key:"Delete",activeIn:"Global",helpText:"Delete the selected part in the viewport"},{key:"Control",activeIn:"Edit LES mode",helpText:"Hold to deselect selected faces"},{key:"Escape",activeIn:"Viewport",helpText:"Switch to 'Select' mode"}]);const u9="_closeButton_1b00v_13",d9="_margin_1b00v_27",h9="_red_1b00v_31",f9="_green_1b00v_35",p9="_blue_1b00v_39",m9="_svg_1b00v_43";var Di={closeButton:u9,margin:d9,red:h9,green:f9,blue:p9,svg:m9};function g9(){return fe("div",{children:[E("h1",{className:Di.margin,children:"Shortcuts"}),fe("table",{className:Di.table,children:[E("thead",{children:fe("tr",{children:[E("th",{children:"Key"}),E("th",{children:"Active in"}),E("th",{children:"Help text"})]})}),E("tbody",{children:nT.Shortcuts.sort((n,e)=>n.activeIn>e.activeIn?1:-1).map(n=>fe("tr",{children:[E("td",{children:n.key}),E("td",{children:n.activeIn}),E("td",{children:n.helpText})]},n.key))})]}),E("h1",{className:Di.margin,children:"Legend"}),fe("div",{className:Di.margin,children:[fe("div",{children:[E("svg",{className:Di.svg,children:E("rect",{className:Di.red,x:"0",y:"0",width:"12",height:"12"})}),E("label",{children:"X-Axis"})]}),fe("div",{children:[E("svg",{className:Di.svg,children:E("rect",{className:Di.green,x:"0",y:"0",width:"12",height:"12"})}),E("label",{children:"Y-Axis"})]}),fe("div",{children:[E("svg",{className:Di.svg,children:E("rect",{className:Di.blue,x:"0",y:"0",width:"12",height:"12"})}),E("label",{children:"Z-Axis"})]})]})]})}function v9(n){return n.type=="help"?E(g9,{}):n.type=="licenses"?E(c9,{}):E(Ve,{})}const y9={...Lx,top:"15%",bottom:"15%",left:"15%",right:"15%",padding:0};function x9(n){const[e,t]=I.exports.useState("help"),r=Je(),i=()=>r(Pe.modalClosed(n.id));return E(go,{style:{overlay:n.overlayStyle,content:y9},isOpen:!0,children:fe("div",{className:Fa.main,children:[fe("div",{className:Fa.header,children:[E("div",{className:Fa.title,children:"Settings"}),E("button",{onClick:i,children:"X"})]}),fe("div",{className:Fa.menu,children:[E("button",{className:e=="help"?Fa.active:"",onClick:()=>t("help"),children:"Help"}),E("button",{className:e=="licenses"?Fa.active:"",onClick:()=>t("licenses"),children:"Licenses"}),E("button",{onClick:()=>r(Pe.modalPushed({type:gr.Cookies,updating:!0})),children:"Cookies"})]}),E(v9,{type:e}),E("div",{className:Fa.footer,children:E("button",{onClick:i,children:"Close"})})]})})}const w9={backgroundColor:"#0000007F"},_9={backgroundColor:"transparent"};function b9(n){return n.modal.data.type==gr.Settings?E(x9,{id:n.modal.id,overlayStyle:n.overlayStyle}):n.modal.data.type==gr.Cookies?E(pV,{id:n.modal.id,data:n.modal.data,overlayStyle:n.overlayStyle}):n.modal.data.type==gr.ReloadRequest?E(KV,{id:n.modal.id,overlayStyle:n.overlayStyle}):n.modal.data.type==gr.ModelCatalog?E(QV,{id:n.modal.id,data:n.modal.data,overlayStyle:n.overlayStyle}):n.modal.data.type==gr.Progress?E(JV,{id:n.modal.id,overlayStyle:n.overlayStyle}):E(Ve,{})}function S9(){const n=Ae(pt.modal.data);return n.length?E(Ve,{children:n.map((e,t)=>E(b9,{modal:e,overlayStyle:t==n.length-1?w9:_9},e.id))}):E(Ve,{})}ot.DefaultUp.set(0,0,1);function M9(){const n=A0.get("CookieConsent");n=="all"?so.start():n||setTimeout(()=>{pt.modal.isModalOpen(gr.Cookies)(me.getState())||me.dispatch(Pe.modalPushed({type:gr.Cookies}))},2500)}function E9(){const n=i=>{i.preventDefault()},e=i=>{i.preventDefault()},t=i=>{me.getState().runtime.dragDrop==null&&i.preventDefault()},r=i=>{me.getState().runtime.dragDrop==null&&i.preventDefault()};return M9(),I.exports.useEffect(()=>{const i=s=>(s.preventDefault(),s.returnValue=" ","");return window.addEventListener("beforeunload",i),()=>window.removeEventListener("beforeunload",i)},[]),fe(Ve,{children:[fe("div",{className:eb.main,onDrop:i=>r(i),onDragOver:i=>t(i),onDragEnter:i=>n(i),onDragLeave:i=>e(i),onContextMenu:i=>i.preventDefault(),children:[E(vH,{}),fe("div",{className:eb.viewportArea,children:[E(H2,{children:E(G6,{})}),E(CB,{}),E(LB,{}),E(aV,{}),!1,E(sV,{})]}),E(L7,{})]}),E(S9,{})]})}const rT=document.getElementById("root");go.setAppElement(rT||"root");hP.render(E(Zr.StrictMode,{children:E(EP,{store:me,children:E(E9,{})})}),rT);
